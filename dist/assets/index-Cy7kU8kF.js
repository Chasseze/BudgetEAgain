import{r as e,a as t,g as n}from"./vendor-BxThA0WO.js";import{r as s,R as r,P as i,a,C as o,T as c,L as l,B as u,b as h,X as d,Y as p,c as f,d as m}from"./charts-grmioYNZ.js";import{H as g,C as y,B as v,T as w,S as b,U as x,X as _,a as E,b as T,D as I,A as N,W as C,P as S,c as k,d as A,e as R,Z as j,F as D,f as O,g as P,R as L,E as M,h as U,i as F,L as V,j as $,k as B,l as q,m as z,n as G,o as H,G as K,p as W,q as Q,r as Y,M as X,s as J,t as Z,u as ee,v as te,w as ne,x as se,y as re,z as ie,I as ae,J as oe}from"./icons-CKcewjEP.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver(e=>{for(const n of e)if("childList"===n.type)for(const e of n.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)}).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),"use-credentials"===e.crossOrigin?t.credentials="include":"anonymous"===e.crossOrigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();var ce,le,ue={exports:{}},he={};var de,pe=(le||(le=1,ue.exports=function(){if(ce)return he;ce=1;var t=e(),n=Symbol.for("react.element"),s=Symbol.for("react.fragment"),r=Object.prototype.hasOwnProperty,i=t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,a={key:!0,ref:!0,__self:!0,__source:!0};function o(e,t,s){var o,c={},l=null,u=null;for(o in void 0!==s&&(l=""+s),void 0!==t.key&&(l=""+t.key),void 0!==t.ref&&(u=t.ref),t)r.call(t,o)&&!a.hasOwnProperty(o)&&(c[o]=t[o]);if(e&&e.defaultProps)for(o in t=e.defaultProps)void 0===c[o]&&(c[o]=t[o]);return{$$typeof:n,type:e,key:l,ref:u,props:c,_owner:i.current}}return he.Fragment=s,he.jsx=o,he.jsxs=o,he}()),ue.exports),fe={};const me=n(function(){if(de)return fe;de=1;var e=t();return fe.createRoot=e.createRoot,fe.hydrateRoot=e.hydrateRoot,fe}());const ge=({activeTab:e,setActiveTab:t,darkMode:n})=>{const s=[{id:"home",icon:pe.jsx(g,{className:"w-5 h-5"}),label:"Home"},{id:"transactions",icon:pe.jsx(y,{className:"w-5 h-5"}),label:"History"},{id:"analytics",icon:pe.jsx(v,{className:"w-5 h-5"}),label:"Stats"},{id:"goals",icon:pe.jsx(w,{className:"w-5 h-5"}),label:"Goals"},{id:"settings",icon:pe.jsx(b,{className:"w-5 h-5"}),label:"Settings"}];return pe.jsx("nav",{className:`fixed bottom-0 left-0 right-0 md:hidden ${n?"bg-gray-900 border-gray-700":"bg-white border-gray-200"} border-t z-40 shadow-lg`,style:{paddingBottom:"env(safe-area-inset-bottom)"},children:pe.jsx("div",{className:"flex justify-around items-center py-2 px-1",children:s.map(s=>pe.jsxs("button",{onClick:()=>t(s.id),className:"flex flex-col items-center py-2 px-3 rounded-xl transition-all duration-200 min-w-[60px] "+(e===s.id?n?"text-indigo-400 bg-indigo-900/30":"text-indigo-600 bg-indigo-50":n?"text-gray-500 hover:text-gray-300 hover:bg-gray-800":"text-gray-400 hover:text-gray-600 hover:bg-gray-100"),"aria-label":s.label,"aria-current":e===s.id?"page":void 0,children:[pe.jsx("span",{className:"transition-transform duration-200 "+(e===s.id?"scale-110":""),children:s.icon}),pe.jsx("span",{className:"text-xs mt-1 font-medium transition-opacity duration-200 "+(e===s.id?"opacity-100":"opacity-70"),children:s.label})]},s.id))})})},ye=({message:e,onUndo:t,onClose:n,darkMode:r})=>(s.useEffect(()=>{const e=setTimeout(n,5e3);return()=>clearTimeout(e)},[n]),pe.jsxs("div",{className:`fixed bottom-20 md:bottom-6 left-1/2 transform -translate-x-1/2 z-50\n        ${r?"bg-gray-800":"bg-gray-900"}\n        text-white px-4 py-3 rounded-lg shadow-lg flex items-center gap-3\n        animate-slide-up`,children:[pe.jsx("span",{className:"text-sm md:text-base",children:e}),t&&pe.jsxs("button",{onClick:t,className:"flex items-center gap-1 text-indigo-400 hover:text-indigo-300\r\n            font-medium transition-colors text-sm",children:[pe.jsx(x,{className:"w-4 h-4"}),"Undo"]}),pe.jsx("button",{onClick:n,className:"text-gray-400 hover:text-white transition-colors ml-1","aria-label":"Close notification",children:pe.jsx(_,{className:"w-4 h-4"})})]})),ve=({totalIncome:e,totalExpenses:t,remaining:n,budgetUsedPercent:s})=>{const r=e=>e.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2});return pe.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3 md:gap-4 mb-6",children:[pe.jsxs("div",{className:"bg-gradient-to-br from-green-400 to-green-600 rounded-xl shadow-lg p-4 md:p-6 text-white transform transition-transform hover:scale-105",children:[pe.jsx("div",{className:"flex items-center justify-between mb-2",children:pe.jsx("div",{className:"p-2 bg-white/20 rounded-lg",children:pe.jsx(E,{className:"w-5 h-5 md:w-6 md:h-6"})})}),pe.jsx("p",{className:"text-green-100 text-xs md:text-sm mb-1",children:"Total Income"}),pe.jsxs("p",{className:"text-xl md:text-2xl lg:text-3xl font-bold truncate",children:["$",r(e)]})]}),pe.jsxs("div",{className:"bg-gradient-to-br from-red-400 to-red-600 rounded-xl shadow-lg p-4 md:p-6 text-white transform transition-transform hover:scale-105",children:[pe.jsx("div",{className:"flex items-center justify-between mb-2",children:pe.jsx("div",{className:"p-2 bg-white/20 rounded-lg",children:pe.jsx(T,{className:"w-5 h-5 md:w-6 md:h-6"})})}),pe.jsx("p",{className:"text-red-100 text-xs md:text-sm mb-1",children:"Total Expenses"}),pe.jsxs("p",{className:"text-xl md:text-2xl lg:text-3xl font-bold truncate",children:["$",r(t)]})]}),pe.jsxs("div",{className:`bg-gradient-to-br ${n>=0?"from-blue-400 to-blue-600":"from-orange-400 to-orange-600"} rounded-xl shadow-lg p-4 md:p-6 text-white transform transition-transform hover:scale-105`,children:[pe.jsx("div",{className:"flex items-center justify-between mb-2",children:pe.jsx("div",{className:"p-2 bg-white/20 rounded-lg",children:pe.jsx(I,{className:"w-5 h-5 md:w-6 md:h-6"})})}),pe.jsx("p",{className:"text-blue-100 text-xs md:text-sm mb-1",children:"Remaining"}),pe.jsxs("p",{className:"text-xl md:text-2xl lg:text-3xl font-bold truncate",children:[n<0?"-":"","$",r(Math.abs(n))]})]}),pe.jsxs("div",{className:`bg-gradient-to-br ${s>100?"from-red-400 to-red-600":s>80?"from-yellow-400 to-yellow-600":"from-purple-400 to-purple-600"} rounded-xl shadow-lg p-4 md:p-6 text-white transform transition-transform hover:scale-105`,children:[pe.jsx("div",{className:"flex items-center justify-between mb-2",children:pe.jsx("div",{className:"p-2 bg-white/20 rounded-lg",children:pe.jsx(N,{className:"w-5 h-5 md:w-6 md:h-6"})})}),pe.jsx("p",{className:"text-purple-100 text-xs md:text-sm mb-1",children:"Budget Used"}),pe.jsxs("p",{className:"text-xl md:text-2xl lg:text-3xl font-bold",children:[Math.min(s,999).toFixed(0),"%"]}),pe.jsx("div",{className:"w-full bg-white/30 rounded-full h-2 mt-2 overflow-hidden",children:pe.jsx("div",{className:"bg-white h-2 rounded-full transition-all duration-500 ease-out",style:{width:`${Math.min(s,100)}%`}})})]})]})},we={"Food & Dining":{icon:pe.jsx(P,{className:"w-3 h-3 md:w-4 md:h-4"}),color:"#FF6B6B"},Transportation:{icon:pe.jsx(O,{className:"w-3 h-3 md:w-4 md:h-4"}),color:"#4ECDC4"},Entertainment:{icon:pe.jsx(D,{className:"w-3 h-3 md:w-4 md:h-4"}),color:"#45B7D1"},"Bills & Utilities":{icon:pe.jsx(j,{className:"w-3 h-3 md:w-4 md:h-4"}),color:"#FFA07A"},Shopping:{icon:pe.jsx(R,{className:"w-3 h-3 md:w-4 md:h-4"}),color:"#98D8C8"},Healthcare:{icon:pe.jsx(A,{className:"w-3 h-3 md:w-4 md:h-4"}),color:"#F7DC6F"},Education:{icon:pe.jsx(k,{className:"w-3 h-3 md:w-4 md:h-4"}),color:"#BB8FCE"},Other:{icon:pe.jsx(S,{className:"w-3 h-3 md:w-4 md:h-4"}),color:"#85C1E2"},Salary:{icon:pe.jsx(C,{className:"w-3 h-3 md:w-4 md:h-4"}),color:"#4ade80"},Freelance:{icon:pe.jsx(y,{className:"w-3 h-3 md:w-4 md:h-4"}),color:"#34d399"},Investment:{icon:pe.jsx(E,{className:"w-3 h-3 md:w-4 md:h-4"}),color:"#22c55e"}},be=({category:e,size:t="md",showIcon:n=!0})=>{const s=we[e]||we.Other;return pe.jsxs("span",{className:`inline-flex items-center rounded-full font-medium transition-all duration-200 hover:scale-105 ${{sm:"px-2 py-0.5 text-xs gap-1",md:"px-2.5 py-1 text-xs gap-1.5",lg:"px-3 py-1.5 text-sm gap-2"}[t]}`,style:{backgroundColor:`${s.color}20`,color:s.color,border:`1px solid ${s.color}40`},children:[n&&pe.jsx("span",{className:"flex-shrink-0",children:s.icon}),pe.jsx("span",{className:"truncate max-w-[100px] md:max-w-none",children:e})]})},xe=({transactions:e,onEdit:t,onDelete:n,onViewReceipt:s,darkMode:r,searchQuery:i=""})=>{const a=e=>new Date(e).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"}),o=(e,t)=>{if(!t.trim())return e;const n=new RegExp(`(${t.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")})`,"gi");return e.split(n).map((e,t)=>n.test(e)?pe.jsx("mark",{className:"bg-yellow-200 dark:bg-yellow-800 rounded px-0.5",children:e},t):e)},c=e.reduce((e,t)=>{const n=t.date;return e[n]||(e[n]=[]),e[n].push(t),e},{}),l=Object.keys(c).sort((e,t)=>new Date(t).getTime()-new Date(e).getTime());return 0===e.length?pe.jsxs("div",{className:"text-center py-12 "+(r?"text-gray-400":"text-gray-500"),children:[pe.jsx("div",{className:"text-6xl mb-4",children:"ðŸ“­"}),pe.jsx("p",{className:"text-lg font-medium",children:"No transactions found"}),pe.jsx("p",{className:"text-sm mt-1",children:i?"Try adjusting your search or filters":"Add your first transaction to get started"})]}):pe.jsx("div",{className:"space-y-6",children:l.map(e=>pe.jsxs("div",{children:[pe.jsx("div",{className:"sticky top-0 z-10 py-2 px-1 mb-2 "+(r?"bg-gray-900":"bg-gradient-to-br from-indigo-50 via-purple-50 to-pink-50"),children:pe.jsx("h3",{className:"text-sm font-semibold "+(r?"text-gray-400":"text-gray-600"),children:a(e)})}),pe.jsx("div",{className:"space-y-2",children:c[e].map(e=>{return pe.jsxs("div",{className:"group flex flex-col sm:flex-row justify-between items-start sm:items-center p-4 rounded-xl border-2 transition-all duration-300 hover:shadow-lg "+("income"===e.type?r?"border-green-800 bg-green-900/30 hover:bg-green-900/50":"border-green-200 bg-green-50 hover:bg-green-100":r?"border-red-800 bg-red-900/30 hover:bg-red-900/50":"border-red-200 bg-red-50 hover:bg-red-100"),children:[pe.jsxs("div",{className:"flex-1 min-w-0 mb-3 sm:mb-0",children:[pe.jsxs("div",{className:"flex items-center gap-2 mb-1 flex-wrap",children:[pe.jsx("h4",{className:"font-semibold truncate "+(r?"text-white":"text-gray-800"),children:o(e.description,i)}),e.isRecurring&&pe.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-0.5 rounded-full text-xs "+(r?"bg-indigo-900/50 text-indigo-300":"bg-indigo-100 text-indigo-600"),children:[pe.jsx(L,{className:"w-3 h-3"}),"Recurring"]}),e.receipt&&pe.jsx("button",{onClick:()=>s(e.receipt),className:"p-1 rounded-full transition-colors "+(r?"text-indigo-400 hover:bg-indigo-900/50":"text-indigo-600 hover:bg-indigo-100"),title:"View receipt",children:pe.jsx(M,{className:"w-4 h-4"})})]}),pe.jsx("div",{className:"mb-1",children:pe.jsx(be,{category:e.category,size:"sm"})}),pe.jsx("p",{className:"text-xs sm:hidden "+(r?"text-gray-500":"text-gray-400"),children:a(e.date)})]}),pe.jsxs("div",{className:"flex items-center gap-3 w-full sm:w-auto justify-between sm:justify-end",children:[pe.jsxs("span",{className:"text-xl sm:text-2xl font-bold whitespace-nowrap "+("income"===e.type?"text-green-600 dark:text-green-400":"text-red-600 dark:text-red-400"),children:["income"===e.type?"+":"-","$",(c=e.amount,c.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2}))]}),pe.jsxs("div",{className:"flex items-center gap-1 opacity-100 sm:opacity-0 sm:group-hover:opacity-100 transition-opacity",children:[pe.jsx("button",{onClick:()=>t(e),className:"p-2 rounded-lg transition-all "+(r?"text-gray-400 hover:text-indigo-400 hover:bg-indigo-900/50":"text-gray-500 hover:text-indigo-600 hover:bg-indigo-100"),title:"Edit transaction",children:pe.jsx(U,{className:"w-4 h-4 sm:w-5 sm:h-5"})}),pe.jsx("button",{onClick:()=>n(e.id),className:"p-2 rounded-lg transition-all "+(r?"text-gray-400 hover:text-red-400 hover:bg-red-900/50":"text-gray-500 hover:text-red-600 hover:bg-red-100"),title:"Delete transaction",children:pe.jsx(F,{className:"w-4 h-4 sm:w-5 sm:h-5"})})]})]})]},e.id);var c})})]},e))})};var _e={};const Ee=function(e){const t=[];let n=0;for(let s=0;s<e.length;s++){let r=e.charCodeAt(s);r<128?t[n++]=r:r<2048?(t[n++]=r>>6|192,t[n++]=63&r|128):55296==(64512&r)&&s+1<e.length&&56320==(64512&e.charCodeAt(s+1))?(r=65536+((1023&r)<<10)+(1023&e.charCodeAt(++s)),t[n++]=r>>18|240,t[n++]=r>>12&63|128,t[n++]=r>>6&63|128,t[n++]=63&r|128):(t[n++]=r>>12|224,t[n++]=r>>6&63|128,t[n++]=63&r|128)}return t},Te={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:"function"==typeof atob,encodeByteArray(e,t){if(!Array.isArray(e))throw Error("encodeByteArray takes an array as a parameter");this.init_();const n=t?this.byteToCharMapWebSafe_:this.byteToCharMap_,s=[];for(let r=0;r<e.length;r+=3){const t=e[r],i=r+1<e.length,a=i?e[r+1]:0,o=r+2<e.length,c=o?e[r+2]:0,l=t>>2,u=(3&t)<<4|a>>4;let h=(15&a)<<2|c>>6,d=63&c;o||(d=64,i||(h=64)),s.push(n[l],n[u],n[h],n[d])}return s.join("")},encodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?btoa(e):this.encodeByteArray(Ee(e),t)},decodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?atob(e):function(e){const t=[];let n=0,s=0;for(;n<e.length;){const r=e[n++];if(r<128)t[s++]=String.fromCharCode(r);else if(r>191&&r<224){const i=e[n++];t[s++]=String.fromCharCode((31&r)<<6|63&i)}else if(r>239&&r<365){const i=((7&r)<<18|(63&e[n++])<<12|(63&e[n++])<<6|63&e[n++])-65536;t[s++]=String.fromCharCode(55296+(i>>10)),t[s++]=String.fromCharCode(56320+(1023&i))}else{const i=e[n++],a=e[n++];t[s++]=String.fromCharCode((15&r)<<12|(63&i)<<6|63&a)}}return t.join("")}(this.decodeStringToByteArray(e,t))},decodeStringToByteArray(e,t){this.init_();const n=t?this.charToByteMapWebSafe_:this.charToByteMap_,s=[];for(let r=0;r<e.length;){const t=n[e.charAt(r++)],i=r<e.length?n[e.charAt(r)]:0;++r;const a=r<e.length?n[e.charAt(r)]:64;++r;const o=r<e.length?n[e.charAt(r)]:64;if(++r,null==t||null==i||null==a||null==o)throw new Ie;const c=t<<2|i>>4;if(s.push(c),64!==a){const e=i<<4&240|a>>2;if(s.push(e),64!==o){const e=a<<6&192|o;s.push(e)}}}return s},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let e=0;e<this.ENCODED_VALS.length;e++)this.byteToCharMap_[e]=this.ENCODED_VALS.charAt(e),this.charToByteMap_[this.byteToCharMap_[e]]=e,this.byteToCharMapWebSafe_[e]=this.ENCODED_VALS_WEBSAFE.charAt(e),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[e]]=e,e>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(e)]=e,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(e)]=e)}}};class Ie extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const Ne=function(e){return function(e){const t=Ee(e);return Te.encodeByteArray(t,!0)}(e).replace(/\./g,"")},Ce=function(e){try{return Te.decodeString(e,!0)}catch(t){}return null};const Se=()=>function(){if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if("undefined"!=typeof global)return global;throw new Error("Unable to locate global object.")}().__FIREBASE_DEFAULTS__,ke=()=>{try{return Se()||(()=>{if("undefined"==typeof process)return;const e=_e.__FIREBASE_DEFAULTS__;return e?JSON.parse(e):void 0})()||(()=>{if("undefined"==typeof document)return;let e;try{e=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch(n){return}const t=e&&Ce(e[1]);return t&&JSON.parse(t)})()}catch(e){return}},Ae=e=>ke()?.emulatorHosts?.[e],Re=e=>{const t=Ae(e);if(!t)return;const n=t.lastIndexOf(":");if(n<=0||n+1===t.length)throw new Error(`Invalid host ${t} with no separate hostname and port!`);const s=parseInt(t.substring(n+1),10);return"["===t[0]?[t.substring(1,n-1),s]:[t.substring(0,n),s]},je=()=>ke()?.config,De=e=>ke()?.[`_${e}`];class Oe{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}wrapCallback(e){return(t,n)=>{t?this.reject(t):this.resolve(n),"function"==typeof e&&(this.promise.catch(()=>{}),1===e.length?e(t):e(t,n))}}}function Pe(e){try{return(e.startsWith("http://")||e.startsWith("https://")?new URL(e).hostname:e).endsWith(".cloudworkstations.dev")}catch{return!1}}async function Le(e){return(await fetch(e,{credentials:"include"})).ok}function Me(e,t){if(e.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const n=t||"demo-project",s=e.iat||0,r=e.sub||e.user_id;if(!r)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const i={iss:`https://securetoken.google.com/${n}`,aud:n,iat:s,exp:s+3600,auth_time:s,sub:r,user_id:r,firebase:{sign_in_provider:"custom",identities:{}},...e};return[Ne(JSON.stringify({alg:"none",type:"JWT"})),Ne(JSON.stringify(i)),""].join(".")}const Ue={};let Fe=!1;function Ve(e,t){if("undefined"==typeof window||"undefined"==typeof document||!Pe(window.location.host)||Ue[e]===t||Ue[e]||Fe)return;function n(e){return`__firebase__banner__${e}`}Ue[e]=t;const s="__firebase__banner",r=function(){const e={prod:[],emulator:[]};for(const t of Object.keys(Ue))Ue[t]?e.emulator.push(t):e.prod.push(t);return e}().prod.length>0;function i(){const e=document.createElement("span");return e.style.cursor="pointer",e.style.marginLeft="16px",e.style.fontSize="24px",e.innerHTML=" &times;",e.onclick=()=>{Fe=!0,function(){const e=document.getElementById(s);e&&e.remove()}()},e}function a(){const e=function(e){let t=document.getElementById(e),n=!1;return t||(t=document.createElement("div"),t.setAttribute("id",e),n=!0),{created:n,element:t}}(s),t=n("text"),a=document.getElementById(t)||document.createElement("span"),o=n("learnmore"),c=document.getElementById(o)||document.createElement("a"),l=n("preprendIcon"),u=document.getElementById(l)||document.createElementNS("http://www.w3.org/2000/svg","svg");if(e.created){const t=e.element;!function(e){e.style.display="flex",e.style.background="#7faaf0",e.style.position="fixed",e.style.bottom="5px",e.style.left="5px",e.style.padding=".5em",e.style.borderRadius="5px",e.style.alignItems="center"}(t),function(e,t){e.setAttribute("id",t),e.innerText="Learn more",e.href="https://firebase.google.com/docs/studio/preview-apps#preview-backend",e.setAttribute("target","__blank"),e.style.paddingLeft="5px",e.style.textDecoration="underline"}(c,o);const n=i();!function(e,t){e.setAttribute("width","24"),e.setAttribute("id",t),e.setAttribute("height","24"),e.setAttribute("viewBox","0 0 24 24"),e.setAttribute("fill","none"),e.style.marginLeft="-6px"}(u,l),t.append(u,a,c,n),document.body.appendChild(t)}r?(a.innerText="Preview backend disconnected.",u.innerHTML='<g clip-path="url(#clip0_6013_33858)">\n<path d="M4.8 17.6L12 5.6L19.2 17.6H4.8ZM6.91667 16.4H17.0833L12 7.93333L6.91667 16.4ZM12 15.6C12.1667 15.6 12.3056 15.5444 12.4167 15.4333C12.5389 15.3111 12.6 15.1667 12.6 15C12.6 14.8333 12.5389 14.6944 12.4167 14.5833C12.3056 14.4611 12.1667 14.4 12 14.4C11.8333 14.4 11.6889 14.4611 11.5667 14.5833C11.4556 14.6944 11.4 14.8333 11.4 15C11.4 15.1667 11.4556 15.3111 11.5667 15.4333C11.6889 15.5444 11.8333 15.6 12 15.6ZM11.4 13.6H12.6V10.4H11.4V13.6Z" fill="#212121"/>\n</g>\n<defs>\n<clipPath id="clip0_6013_33858">\n<rect width="24" height="24" fill="white"/>\n</clipPath>\n</defs>'):(u.innerHTML='<g clip-path="url(#clip0_6083_34804)">\n<path d="M11.4 15.2H12.6V11.2H11.4V15.2ZM12 10C12.1667 10 12.3056 9.94444 12.4167 9.83333C12.5389 9.71111 12.6 9.56667 12.6 9.4C12.6 9.23333 12.5389 9.09444 12.4167 8.98333C12.3056 8.86111 12.1667 8.8 12 8.8C11.8333 8.8 11.6889 8.86111 11.5667 8.98333C11.4556 9.09444 11.4 9.23333 11.4 9.4C11.4 9.56667 11.4556 9.71111 11.5667 9.83333C11.6889 9.94444 11.8333 10 12 10ZM12 18.4C11.1222 18.4 10.2944 18.2333 9.51667 17.9C8.73889 17.5667 8.05556 17.1111 7.46667 16.5333C6.88889 15.9444 6.43333 15.2611 6.1 14.4833C5.76667 13.7056 5.6 12.8778 5.6 12C5.6 11.1111 5.76667 10.2833 6.1 9.51667C6.43333 8.73889 6.88889 8.06111 7.46667 7.48333C8.05556 6.89444 8.73889 6.43333 9.51667 6.1C10.2944 5.76667 11.1222 5.6 12 5.6C12.8889 5.6 13.7167 5.76667 14.4833 6.1C15.2611 6.43333 15.9389 6.89444 16.5167 7.48333C17.1056 8.06111 17.5667 8.73889 17.9 9.51667C18.2333 10.2833 18.4 11.1111 18.4 12C18.4 12.8778 18.2333 13.7056 17.9 14.4833C17.5667 15.2611 17.1056 15.9444 16.5167 16.5333C15.9389 17.1111 15.2611 17.5667 14.4833 17.9C13.7167 18.2333 12.8889 18.4 12 18.4ZM12 17.2C13.4444 17.2 14.6722 16.6944 15.6833 15.6833C16.6944 14.6722 17.2 13.4444 17.2 12C17.2 10.5556 16.6944 9.32778 15.6833 8.31667C14.6722 7.30555 13.4444 6.8 12 6.8C10.5556 6.8 9.32778 7.30555 8.31667 8.31667C7.30556 9.32778 6.8 10.5556 6.8 12C6.8 13.4444 7.30556 14.6722 8.31667 15.6833C9.32778 16.6944 10.5556 17.2 12 17.2Z" fill="#212121"/>\n</g>\n<defs>\n<clipPath id="clip0_6083_34804">\n<rect width="24" height="24" fill="white"/>\n</clipPath>\n</defs>',a.innerText="Preview backend running in this workspace."),a.setAttribute("id",t)}"loading"===document.readyState?window.addEventListener("DOMContentLoaded",a):a()}function $e(){return"undefined"!=typeof navigator&&"string"==typeof navigator.userAgent?navigator.userAgent:""}function Be(){const e="object"==typeof chrome?chrome.runtime:"object"==typeof browser?browser.runtime:void 0;return"object"==typeof e&&void 0!==e.id}function qe(){return!function(){const e=ke()?.forceEnvironment;if("node"===e)return!0;if("browser"===e)return!1;try{return"[object process]"===Object.prototype.toString.call(global.process)}catch(t){return!1}}()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function ze(){try{return"object"==typeof indexedDB}catch(e){return!1}}function Ge(){return new Promise((e,t)=>{try{let n=!0;const s="validate-browser-context-for-indexeddb-analytics-module",r=self.indexedDB.open(s);r.onsuccess=()=>{r.result.close(),n||self.indexedDB.deleteDatabase(s),e(!0)},r.onupgradeneeded=()=>{n=!1},r.onerror=()=>{t(r.error?.message||"")}}catch(n){t(n)}})}function He(){return!("undefined"==typeof navigator||!navigator.cookieEnabled)}class Ke extends Error{constructor(e,t,n){super(t),this.code=e,this.customData=n,this.name="FirebaseError",Object.setPrototypeOf(this,Ke.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,We.prototype.create)}}class We{constructor(e,t,n){this.service=e,this.serviceName=t,this.errors=n}create(e,...t){const n=t[0]||{},s=`${this.service}/${e}`,r=this.errors[e],i=r?function(e,t){return e.replace(Qe,(e,n)=>{const s=t[n];return null!=s?String(s):`<${n}?>`})}(r,n):"Error",a=`${this.serviceName}: ${i} (${s}).`;return new Ke(s,a,n)}}const Qe=/\{\$([^}]+)}/g;function Ye(e,t){if(e===t)return!0;const n=Object.keys(e),s=Object.keys(t);for(const r of n){if(!s.includes(r))return!1;const n=e[r],i=t[r];if(Xe(n)&&Xe(i)){if(!Ye(n,i))return!1}else if(n!==i)return!1}for(const r of s)if(!n.includes(r))return!1;return!0}function Xe(e){return null!==e&&"object"==typeof e}function Je(e){const t=[];for(const[n,s]of Object.entries(e))Array.isArray(s)?s.forEach(e=>{t.push(encodeURIComponent(n)+"="+encodeURIComponent(e))}):t.push(encodeURIComponent(n)+"="+encodeURIComponent(s));return t.length?"&"+t.join("&"):""}function Ze(e){const t={};return e.replace(/^\?/,"").split("&").forEach(e=>{if(e){const[n,s]=e.split("=");t[decodeURIComponent(n)]=decodeURIComponent(s)}}),t}function et(e){const t=e.indexOf("?");if(!t)return"";const n=e.indexOf("#",t);return e.substring(t,n>0?n:void 0)}class tt{constructor(e,t){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=t,this.task.then(()=>{e(this)}).catch(e=>{this.error(e)})}next(e){this.forEachObserver(t=>{t.next(e)})}error(e){this.forEachObserver(t=>{t.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,t,n){let s;if(void 0===e&&void 0===t&&void 0===n)throw new Error("Missing Observer.");s=function(e,t){if("object"!=typeof e||null===e)return!1;for(const n of t)if(n in e&&"function"==typeof e[n])return!0;return!1}(e,["next","error","complete"])?e:{next:e,error:t,complete:n},void 0===s.next&&(s.next=nt),void 0===s.error&&(s.error=nt),void 0===s.complete&&(s.complete=nt);const r=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?s.error(this.finalError):s.complete()}catch(e){}}),this.observers.push(s),r}unsubscribeOne(e){void 0!==this.observers&&void 0!==this.observers[e]&&(delete this.observers[e],this.observerCount-=1,0===this.observerCount&&void 0!==this.onNoObservers&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let t=0;t<this.observers.length;t++)this.sendOne(t,e)}sendOne(e,t){this.task.then(()=>{if(void 0!==this.observers&&void 0!==this.observers[e])try{t(this.observers[e])}catch(n){"undefined"!=typeof console&&console.error}})}close(e){this.finalized||(this.finalized=!0,void 0!==e&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function nt(){}function st(e,t=1e3,n=2){const s=t*Math.pow(n,e),r=Math.round(.5*s*(Math.random()-.5)*2);return Math.min(144e5,s+r)}function rt(e){return e&&e._delegate?e._delegate:e}class it{constructor(e,t,n){this.name=e,this.instanceFactory=t,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}const at="[DEFAULT]";class ot{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){const e=new Oe;if(this.instancesDeferred.set(t,e),this.isInitialized(t)||this.shouldAutoInitialize())try{const n=this.getOrInitializeService({instanceIdentifier:t});n&&e.resolve(n)}catch(n){}}return this.instancesDeferred.get(t).promise}getImmediate(e){const t=this.normalizeInstanceIdentifier(e?.identifier),n=e?.optional??!1;if(!this.isInitialized(t)&&!this.shouldAutoInitialize()){if(n)return null;throw Error(`Service ${this.name} is not available`)}try{return this.getOrInitializeService({instanceIdentifier:t})}catch(s){if(n)return null;throw s}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,this.shouldAutoInitialize()){if(function(e){return"EAGER"===e.instantiationMode}(e))try{this.getOrInitializeService({instanceIdentifier:at})}catch(t){}for(const[e,n]of this.instancesDeferred.entries()){const s=this.normalizeInstanceIdentifier(e);try{const e=this.getOrInitializeService({instanceIdentifier:s});n.resolve(e)}catch(t){}}}}clearInstance(e=at){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter(e=>"INTERNAL"in e).map(e=>e.INTERNAL.delete()),...e.filter(e=>"_delete"in e).map(e=>e._delete())])}isComponentSet(){return null!=this.component}isInitialized(e=at){return this.instances.has(e)}getOptions(e=at){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:t={}}=e,n=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(n))throw Error(`${this.name}(${n}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const s=this.getOrInitializeService({instanceIdentifier:n,options:t});for(const[r,i]of this.instancesDeferred.entries()){n===this.normalizeInstanceIdentifier(r)&&i.resolve(s)}return s}onInit(e,t){const n=this.normalizeInstanceIdentifier(t),s=this.onInitCallbacks.get(n)??new Set;s.add(e),this.onInitCallbacks.set(n,s);const r=this.instances.get(n);return r&&e(r,n),()=>{s.delete(e)}}invokeOnInitCallbacks(e,t){const n=this.onInitCallbacks.get(t);if(n)for(const s of n)try{s(e,t)}catch{}}getOrInitializeService({instanceIdentifier:e,options:t={}}){let n=this.instances.get(e);if(!n&&this.component&&(n=this.component.instanceFactory(this.container,{instanceIdentifier:(s=e,s===at?void 0:s),options:t}),this.instances.set(e,n),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(n,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,n)}catch{}var s;return n||null}normalizeInstanceIdentifier(e=at){return this.component?this.component.multipleInstances?e:at:e}shouldAutoInitialize(){return!!this.component&&"EXPLICIT"!==this.component.instantiationMode}}class ct{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const t=this.getProvider(e.name);if(t.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const t=new ot(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}}var lt,ut;(ut=lt||(lt={}))[ut.DEBUG=0]="DEBUG",ut[ut.VERBOSE=1]="VERBOSE",ut[ut.INFO=2]="INFO",ut[ut.WARN=3]="WARN",ut[ut.ERROR=4]="ERROR",ut[ut.SILENT=5]="SILENT";const ht={debug:lt.DEBUG,verbose:lt.VERBOSE,info:lt.INFO,warn:lt.WARN,error:lt.ERROR,silent:lt.SILENT},dt=lt.INFO,pt={[lt.DEBUG]:"log",[lt.VERBOSE]:"log",[lt.INFO]:"info",[lt.WARN]:"warn",[lt.ERROR]:"error"},ft=(e,t,...n)=>{if(t<e.logLevel)return;(new Date).toISOString();if(!pt[t])throw new Error(`Attempted to log a message with an invalid logType (value: ${t})`)};class mt{constructor(e){this.name=e,this._logLevel=dt,this._logHandler=ft,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in lt))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel="string"==typeof e?ht[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if("function"!=typeof e)throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,lt.DEBUG,...e),this._logHandler(this,lt.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,lt.VERBOSE,...e),this._logHandler(this,lt.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,lt.INFO,...e),this._logHandler(this,lt.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,lt.WARN,...e),this._logHandler(this,lt.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,lt.ERROR,...e),this._logHandler(this,lt.ERROR,...e)}}let gt,yt;const vt=new WeakMap,wt=new WeakMap,bt=new WeakMap,xt=new WeakMap,_t=new WeakMap;let Et={get(e,t,n){if(e instanceof IDBTransaction){if("done"===t)return wt.get(e);if("objectStoreNames"===t)return e.objectStoreNames||bt.get(e);if("store"===t)return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return Nt(e[t])},set:(e,t,n)=>(e[t]=n,!0),has:(e,t)=>e instanceof IDBTransaction&&("done"===t||"store"===t)||t in e};function Tt(e){return e!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?(yt||(yt=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])).includes(e)?function(...t){return e.apply(Ct(this),t),Nt(vt.get(this))}:function(...t){return Nt(e.apply(Ct(this),t))}:function(t,...n){const s=e.call(Ct(this),t,...n);return bt.set(s,t.sort?t.sort():[t]),Nt(s)}}function It(e){return"function"==typeof e?Tt(e):(e instanceof IDBTransaction&&function(e){if(wt.has(e))return;const t=new Promise((t,n)=>{const s=()=>{e.removeEventListener("complete",r),e.removeEventListener("error",i),e.removeEventListener("abort",i)},r=()=>{t(),s()},i=()=>{n(e.error||new DOMException("AbortError","AbortError")),s()};e.addEventListener("complete",r),e.addEventListener("error",i),e.addEventListener("abort",i)});wt.set(e,t)}(e),t=e,(gt||(gt=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])).some(e=>t instanceof e)?new Proxy(e,Et):e);var t}function Nt(e){if(e instanceof IDBRequest)return function(e){const t=new Promise((t,n)=>{const s=()=>{e.removeEventListener("success",r),e.removeEventListener("error",i)},r=()=>{t(Nt(e.result)),s()},i=()=>{n(e.error),s()};e.addEventListener("success",r),e.addEventListener("error",i)});return t.then(t=>{t instanceof IDBCursor&&vt.set(t,e)}).catch(()=>{}),_t.set(t,e),t}(e);if(xt.has(e))return xt.get(e);const t=It(e);return t!==e&&(xt.set(e,t),_t.set(t,e)),t}const Ct=e=>_t.get(e);function St(e,t,{blocked:n,upgrade:s,blocking:r,terminated:i}={}){const a=indexedDB.open(e,t),o=Nt(a);return s&&a.addEventListener("upgradeneeded",e=>{s(Nt(a.result),e.oldVersion,e.newVersion,Nt(a.transaction),e)}),n&&a.addEventListener("blocked",e=>n(e.oldVersion,e.newVersion,e)),o.then(e=>{i&&e.addEventListener("close",()=>i()),r&&e.addEventListener("versionchange",e=>r(e.oldVersion,e.newVersion,e))}).catch(()=>{}),o}const kt=["get","getKey","getAll","getAllKeys","count"],At=["put","add","delete","clear"],Rt=new Map;function jt(e,t){if(!(e instanceof IDBDatabase)||t in e||"string"!=typeof t)return;if(Rt.get(t))return Rt.get(t);const n=t.replace(/FromIndex$/,""),s=t!==n,r=At.includes(n);if(!(n in(s?IDBIndex:IDBObjectStore).prototype)||!r&&!kt.includes(n))return;const i=async function(e,...t){const i=this.transaction(e,r?"readwrite":"readonly");let a=i.store;return s&&(a=a.index(t.shift())),(await Promise.all([a[n](...t),r&&i.done]))[0]};return Rt.set(t,i),i}Et=(e=>({...e,get:(t,n,s)=>jt(t,n)||e.get(t,n,s),has:(t,n)=>!!jt(t,n)||e.has(t,n)}))(Et);class Dt{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(e=>{if(function(e){const t=e.getComponent();return"VERSION"===t?.type}(e)){const t=e.getImmediate();return`${t.library}/${t.version}`}return null}).filter(e=>e).join(" ")}}const Ot="@firebase/app",Pt="0.14.6",Lt=new mt("@firebase/app"),Mt="@firebase/app-compat",Ut="@firebase/analytics-compat",Ft="@firebase/analytics",Vt="@firebase/app-check-compat",$t="@firebase/app-check",Bt="@firebase/auth",qt="@firebase/auth-compat",zt="@firebase/database",Gt="@firebase/data-connect",Ht="@firebase/database-compat",Kt="@firebase/functions",Wt="@firebase/functions-compat",Qt="@firebase/installations",Yt="@firebase/installations-compat",Xt="@firebase/messaging",Jt="@firebase/messaging-compat",Zt="@firebase/performance",en="@firebase/performance-compat",tn="@firebase/remote-config",nn="@firebase/remote-config-compat",sn="@firebase/storage",rn="@firebase/storage-compat",an="@firebase/firestore",on="@firebase/ai",cn="@firebase/firestore-compat",ln="firebase",un="[DEFAULT]",hn={[Ot]:"fire-core",[Mt]:"fire-core-compat",[Ft]:"fire-analytics",[Ut]:"fire-analytics-compat",[$t]:"fire-app-check",[Vt]:"fire-app-check-compat",[Bt]:"fire-auth",[qt]:"fire-auth-compat",[zt]:"fire-rtdb",[Gt]:"fire-data-connect",[Ht]:"fire-rtdb-compat",[Kt]:"fire-fn",[Wt]:"fire-fn-compat",[Qt]:"fire-iid",[Yt]:"fire-iid-compat",[Xt]:"fire-fcm",[Jt]:"fire-fcm-compat",[Zt]:"fire-perf",[en]:"fire-perf-compat",[tn]:"fire-rc",[nn]:"fire-rc-compat",[sn]:"fire-gcs",[rn]:"fire-gcs-compat",[an]:"fire-fst",[cn]:"fire-fst-compat",[on]:"fire-vertex","fire-js":"fire-js",[ln]:"fire-js-all"},dn=new Map,pn=new Map,fn=new Map;function mn(e,t){try{e.container.addComponent(t)}catch(n){Lt.debug(`Component ${t.name} failed to register with FirebaseApp ${e.name}`,n)}}function gn(e){const t=e.name;if(fn.has(t))return Lt.debug(`There were multiple attempts to register component ${t}.`),!1;fn.set(t,e);for(const n of dn.values())mn(n,e);for(const n of pn.values())mn(n,e);return!0}function yn(e,t){const n=e.container.getProvider("heartbeat").getImmediate({optional:!0});return n&&n.triggerHeartbeat(),e.container.getProvider(t)}function vn(e){return null!=e&&void 0!==e.settings}const wn=new We("app","Firebase",{"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."});class bn{constructor(e,t,n){this._isDeleted=!1,this._options={...e},this._config={...t},this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=n,this.container.addComponent(new it("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw wn.create("app-deleted",{appName:this._name})}}const xn="12.6.0";function _n(e,t={}){let n=e;if("object"!=typeof t){t={name:t}}const s={name:un,automaticDataCollectionEnabled:!0,...t},r=s.name;if("string"!=typeof r||!r)throw wn.create("bad-app-name",{appName:String(r)});if(n||(n=je()),!n)throw wn.create("no-options");const i=dn.get(r);if(i){if(Ye(n,i.options)&&Ye(s,i.config))return i;throw wn.create("duplicate-app",{appName:r})}const a=new ct(r);for(const c of fn.values())a.addComponent(c);const o=new bn(n,s,a);return dn.set(r,o),o}function En(e=un){const t=dn.get(e);if(!t&&e===un&&je())return _n();if(!t)throw wn.create("no-app",{appName:e});return t}function Tn(e,t,n){let s=hn[e]??e;n&&(s+=`-${n}`);const r=s.match(/\s|\//),i=t.match(/\s|\//);if(r||i){const e=[`Unable to register library "${s}" with version "${t}":`];return r&&e.push(`library name "${s}" contains illegal characters (whitespace or "/")`),r&&i&&e.push("and"),i&&e.push(`version name "${t}" contains illegal characters (whitespace or "/")`),void Lt.warn(e.join(" "))}gn(new it(`${s}-version`,()=>({library:s,version:t}),"VERSION"))}const In="firebase-heartbeat-store";let Nn=null;function Cn(){return Nn||(Nn=St("firebase-heartbeat-database",1,{upgrade:(e,t)=>{if(0===t)try{e.createObjectStore(In)}catch(n){}}}).catch(e=>{throw wn.create("idb-open",{originalErrorMessage:e.message})})),Nn}async function Sn(e,t){try{const n=(await Cn()).transaction(In,"readwrite"),s=n.objectStore(In);await s.put(t,kn(e)),await n.done}catch(n){if(n instanceof Ke)Lt.warn(n.message);else{const e=wn.create("idb-set",{originalErrorMessage:n?.message});Lt.warn(e.message)}}}function kn(e){return`${e.name}!${e.options.appId}`}class An{constructor(e){this.container=e,this._heartbeatsCache=null;const t=this.container.getProvider("app").getImmediate();this._storage=new jn(t),this._heartbeatsCachePromise=this._storage.read().then(e=>(this._heartbeatsCache=e,e))}async triggerHeartbeat(){try{const e=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),t=Rn();if(null==this._heartbeatsCache?.heartbeats&&(this._heartbeatsCache=await this._heartbeatsCachePromise,null==this._heartbeatsCache?.heartbeats))return;if(this._heartbeatsCache.lastSentHeartbeatDate===t||this._heartbeatsCache.heartbeats.some(e=>e.date===t))return;if(this._heartbeatsCache.heartbeats.push({date:t,agent:e}),this._heartbeatsCache.heartbeats.length>30){const e=function(e){if(0===e.length)return-1;let t=0,n=e[0].date;for(let s=1;s<e.length;s++)e[s].date<n&&(n=e[s].date,t=s);return t}(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(e,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(e){Lt.warn(e)}}async getHeartbeatsHeader(){try{if(null===this._heartbeatsCache&&await this._heartbeatsCachePromise,null==this._heartbeatsCache?.heartbeats||0===this._heartbeatsCache.heartbeats.length)return"";const e=Rn(),{heartbeatsToSend:t,unsentEntries:n}=function(e,t=1024){const n=[];let s=e.slice();for(const r of e){const e=n.find(e=>e.agent===r.agent);if(e){if(e.dates.push(r.date),Dn(n)>t){e.dates.pop();break}}else if(n.push({agent:r.agent,dates:[r.date]}),Dn(n)>t){n.pop();break}s=s.slice(1)}return{heartbeatsToSend:n,unsentEntries:s}}(this._heartbeatsCache.heartbeats),s=Ne(JSON.stringify({version:2,heartbeats:t}));return this._heartbeatsCache.lastSentHeartbeatDate=e,n.length>0?(this._heartbeatsCache.heartbeats=n,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),s}catch(e){return Lt.warn(e),""}}}function Rn(){return(new Date).toISOString().substring(0,10)}class jn{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return!!ze()&&Ge().then(()=>!0).catch(()=>!1)}async read(){if(await this._canUseIndexedDBPromise){const e=await async function(e){try{const t=(await Cn()).transaction(In),n=await t.objectStore(In).get(kn(e));return await t.done,n}catch(t){if(t instanceof Ke)Lt.warn(t.message);else{const e=wn.create("idb-get",{originalErrorMessage:t?.message});Lt.warn(e.message)}}}(this.app);return e?.heartbeats?e:{heartbeats:[]}}return{heartbeats:[]}}async overwrite(e){if(await this._canUseIndexedDBPromise){const t=await this.read();return Sn(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??t.lastSentHeartbeatDate,heartbeats:e.heartbeats})}}async add(e){if(await this._canUseIndexedDBPromise){const t=await this.read();return Sn(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??t.lastSentHeartbeatDate,heartbeats:[...t.heartbeats,...e.heartbeats]})}}}function Dn(e){return Ne(JSON.stringify({version:2,heartbeats:e})).length}var On;On="",gn(new it("platform-logger",e=>new Dt(e),"PRIVATE")),gn(new it("heartbeat",e=>new An(e),"PRIVATE")),Tn(Ot,Pt,On),Tn(Ot,Pt,"esm2020"),Tn("fire-js","");Tn("firebase","12.6.0","app");const Pn="@firebase/installations",Ln="0.6.19",Mn=1e4,Un=`w:${Ln}`,Fn="FIS_v2",Vn=36e5,$n=new We("installations","Installations",{"missing-app-config-values":'Missing App configuration value: "{$valueName}"',"not-registered":"Firebase Installation is not registered.","installation-not-found":"Firebase Installation not found.","request-failed":'{$requestName} request failed with error "{$serverCode} {$serverStatus}: {$serverMessage}"',"app-offline":"Could not process request. Application offline.","delete-pending-registration":"Can't delete installation while there is a pending registration request."});function Bn(e){return e instanceof Ke&&e.code.includes("request-failed")}function qn({projectId:e}){return`https://firebaseinstallations.googleapis.com/v1/projects/${e}/installations`}function zn(e){return{token:e.token,requestStatus:2,expiresIn:(t=e.expiresIn,Number(t.replace("s","000"))),creationTime:Date.now()};var t}async function Gn(e,t){const n=(await t.json()).error;return $n.create("request-failed",{requestName:e,serverCode:n.code,serverMessage:n.message,serverStatus:n.status})}function Hn({apiKey:e}){return new Headers({"Content-Type":"application/json",Accept:"application/json","x-goog-api-key":e})}function Kn(e,{refreshToken:t}){const n=Hn(e);return n.append("Authorization",function(e){return`${Fn} ${e}`}(t)),n}async function Wn(e){const t=await e();return t.status>=500&&t.status<600?e():t}function Qn(e){return new Promise(t=>{setTimeout(t,e)})}const Yn=/^[cdef][\w-]{21}$/;function Xn(){try{const e=new Uint8Array(17);(self.crypto||self.msCrypto).getRandomValues(e),e[0]=112+e[0]%16;const t=function(e){const t=(n=e,btoa(String.fromCharCode(...n)).replace(/\+/g,"-").replace(/\//g,"_"));var n;return t.substr(0,22)}(e);return Yn.test(t)?t:""}catch{return""}}function Jn(e){return`${e.appName}!${e.appId}`}const Zn=new Map;function es(e,t){const n=Jn(e);ts(n,t),function(e,t){const n=function(){!ns&&"BroadcastChannel"in self&&(ns=new BroadcastChannel("[Firebase] FID Change"),ns.onmessage=e=>{ts(e.data.key,e.data.fid)});return ns}();n&&n.postMessage({key:e,fid:t});0===Zn.size&&ns&&(ns.close(),ns=null)}(n,t)}function ts(e,t){const n=Zn.get(e);if(n)for(const s of n)s(t)}let ns=null;const ss="firebase-installations-store";let rs=null;function is(){return rs||(rs=St("firebase-installations-database",1,{upgrade:(e,t)=>{if(0===t)e.createObjectStore(ss)}})),rs}async function as(e,t){const n=Jn(e),s=(await is()).transaction(ss,"readwrite"),r=s.objectStore(ss),i=await r.get(n);return await r.put(t,n),await s.done,i&&i.fid===t.fid||es(e,t.fid),t}async function os(e){const t=Jn(e),n=(await is()).transaction(ss,"readwrite");await n.objectStore(ss).delete(t),await n.done}async function cs(e,t){const n=Jn(e),s=(await is()).transaction(ss,"readwrite"),r=s.objectStore(ss),i=await r.get(n),a=t(i);return void 0===a?await r.delete(n):await r.put(a,n),await s.done,!a||i&&i.fid===a.fid||es(e,a.fid),a}async function ls(e){let t;const n=await cs(e.appConfig,n=>{const s=function(e){const t=e||{fid:Xn(),registrationStatus:0};return ds(t)}(n),r=function(e,t){if(0===t.registrationStatus){if(!navigator.onLine){return{installationEntry:t,registrationPromise:Promise.reject($n.create("app-offline"))}}const n={fid:t.fid,registrationStatus:1,registrationTime:Date.now()},s=async function(e,t){try{const n=await async function({appConfig:e,heartbeatServiceProvider:t},{fid:n}){const s=qn(e),r=Hn(e),i=t.getImmediate({optional:!0});if(i){const e=await i.getHeartbeatsHeader();e&&r.append("x-firebase-client",e)}const a={fid:n,authVersion:Fn,appId:e.appId,sdkVersion:Un},o={method:"POST",headers:r,body:JSON.stringify(a)},c=await Wn(()=>fetch(s,o));if(c.ok){const e=await c.json();return{fid:e.fid||n,registrationStatus:2,refreshToken:e.refreshToken,authToken:zn(e.authToken)}}throw await Gn("Create Installation",c)}(e,t);return as(e.appConfig,n)}catch(n){throw Bn(n)&&409===n.customData.serverCode?await os(e.appConfig):await as(e.appConfig,{fid:t.fid,registrationStatus:0}),n}}(e,n);return{installationEntry:n,registrationPromise:s}}return 1===t.registrationStatus?{installationEntry:t,registrationPromise:us(e)}:{installationEntry:t}}(e,s);return t=r.registrationPromise,r.installationEntry});return""===n.fid?{installationEntry:await t}:{installationEntry:n,registrationPromise:t}}async function us(e){let t=await hs(e.appConfig);for(;1===t.registrationStatus;)await Qn(100),t=await hs(e.appConfig);if(0===t.registrationStatus){const{installationEntry:t,registrationPromise:n}=await ls(e);return n||t}return t}function hs(e){return cs(e,e=>{if(!e)throw $n.create("installation-not-found");return ds(e)})}function ds(e){return 1===(t=e).registrationStatus&&t.registrationTime+Mn<Date.now()?{fid:e.fid,registrationStatus:0}:e;var t}async function ps({appConfig:e,heartbeatServiceProvider:t},n){const s=function(e,{fid:t}){return`${qn(e)}/${t}/authTokens:generate`}(e,n),r=Kn(e,n),i=t.getImmediate({optional:!0});if(i){const e=await i.getHeartbeatsHeader();e&&r.append("x-firebase-client",e)}const a={installation:{sdkVersion:Un,appId:e.appId}},o={method:"POST",headers:r,body:JSON.stringify(a)},c=await Wn(()=>fetch(s,o));if(c.ok){return zn(await c.json())}throw await Gn("Generate Auth Token",c)}async function fs(e,t=!1){let n;const s=await cs(e.appConfig,s=>{if(!gs(s))throw $n.create("not-registered");const r=s.authToken;if(!t&&function(e){return 2===e.requestStatus&&!function(e){const t=Date.now();return t<e.creationTime||e.creationTime+e.expiresIn<t+Vn}(e)}(r))return s;if(1===r.requestStatus)return n=async function(e,t){let n=await ms(e.appConfig);for(;1===n.authToken.requestStatus;)await Qn(100),n=await ms(e.appConfig);const s=n.authToken;return 0===s.requestStatus?fs(e,t):s}(e,t),s;{if(!navigator.onLine)throw $n.create("app-offline");const t=function(e){const t={requestStatus:1,requestTime:Date.now()};return{...e,authToken:t}}(s);return n=async function(e,t){try{const n=await ps(e,t),s={...t,authToken:n};return await as(e.appConfig,s),n}catch(n){if(!Bn(n)||401!==n.customData.serverCode&&404!==n.customData.serverCode){const n={...t,authToken:{requestStatus:0}};await as(e.appConfig,n)}else await os(e.appConfig);throw n}}(e,t),t}});return n?await n:s.authToken}function ms(e){return cs(e,e=>{if(!gs(e))throw $n.create("not-registered");const t=e.authToken;return 1===(n=t).requestStatus&&n.requestTime+Mn<Date.now()?{...e,authToken:{requestStatus:0}}:e;var n})}function gs(e){return void 0!==e&&2===e.registrationStatus}async function ys(e,t=!1){const n=e;await async function(e){const{registrationPromise:t}=await ls(e);t&&await t}(n);return(await fs(n,t)).token}function vs(e){return $n.create("missing-app-config-values",{valueName:e})}const ws="installations",bs=e=>{const t=yn(e.getProvider("app").getImmediate(),ws).getImmediate();return{getId:()=>async function(e){const t=e,{installationEntry:n,registrationPromise:s}=await ls(t);return s?s.catch(console.error):fs(t).catch(console.error),n.fid}(t),getToken:e=>ys(t,e)}};gn(new it(ws,e=>{const t=e.getProvider("app").getImmediate(),n=function(e){if(!e||!e.options)throw vs("App Configuration");if(!e.name)throw vs("App Name");const t=["projectId","apiKey","appId"];for(const n of t)if(!e.options[n])throw vs(n);return{appName:e.name,projectId:e.options.projectId,apiKey:e.options.apiKey,appId:e.options.appId}}(t);return{app:t,appConfig:n,heartbeatServiceProvider:yn(t,"heartbeat"),_delete:()=>Promise.resolve()}},"PUBLIC")),gn(new it("installations-internal",bs,"PRIVATE")),Tn(Pn,Ln),Tn(Pn,Ln,"esm2020");const xs="analytics",_s="https://www.googletagmanager.com/gtag/js",Es=new mt("@firebase/analytics"),Ts=new We("analytics","Analytics",{"already-exists":"A Firebase Analytics instance with the appId {$id}  already exists. Only one Firebase Analytics instance can be created for each appId.","already-initialized":"initializeAnalytics() cannot be called again with different options than those it was initially called with. It can be called again with the same options to return the existing instance, or getAnalytics() can be used to get a reference to the already-initialized instance.","already-initialized-settings":"Firebase Analytics has already been initialized.settings() must be called before initializing any Analytics instanceor it will have no effect.","interop-component-reg-failed":"Firebase Analytics Interop Component failed to instantiate: {$reason}","invalid-analytics-context":"Firebase Analytics is not supported in this environment. Wrap initialization of analytics in analytics.isSupported() to prevent initialization in unsupported environments. Details: {$errorInfo}","indexeddb-unavailable":"IndexedDB unavailable or restricted in this environment. Wrap initialization of analytics in analytics.isSupported() to prevent initialization in unsupported environments. Details: {$errorInfo}","fetch-throttle":"The config fetch request timed out while in an exponential backoff state. Unix timestamp in milliseconds when fetch request throttling ends: {$throttleEndTimeMillis}.","config-fetch-failed":"Dynamic config fetch failed: [{$httpStatus}] {$responseMessage}","no-api-key":'The "apiKey" field is empty in the local Firebase config. Firebase Analytics requires this field tocontain a valid API key.',"no-app-id":'The "appId" field is empty in the local Firebase config. Firebase Analytics requires this field tocontain a valid app ID.',"no-client-id":'The "client_id" field is empty.',"invalid-gtag-resource":"Trusted Types detected an invalid gtag resource: {$gtagURL}."});function Is(e){if(!e.startsWith(_s)){const t=Ts.create("invalid-gtag-resource",{gtagURL:e});return Es.warn(t.message),""}return e}function Ns(e){return Promise.all(e.map(e=>e.catch(e=>e)))}function Cs(e,t){const n=function(e,t){let n;return window.trustedTypes&&(n=window.trustedTypes.createPolicy(e,t)),n}("firebase-js-sdk-policy",{createScriptURL:Is}),s=document.createElement("script"),r=`${_s}?l=${e}&id=${t}`;s.src=n?n?.createScriptURL(r):r,s.async=!0,document.head.appendChild(s)}function Ss(e,t,n,s){return async function(r,...i){try{if("event"===r){const[s,r]=i;await async function(e,t,n,s,r){try{let i=[];if(r&&r.send_to){let e=r.send_to;Array.isArray(e)||(e=[e]);const s=await Ns(n);for(const n of e){const e=s.find(e=>e.measurementId===n),r=e&&t[e.appId];if(!r){i=[];break}i.push(r)}}0===i.length&&(i=Object.values(t)),await Promise.all(i),e("event",s,r||{})}catch(i){Es.error(i)}}(e,t,n,s,r)}else if("config"===r){const[r,a]=i;await async function(e,t,n,s,r,i){const a=s[r];try{if(a)await t[a];else{const e=(await Ns(n)).find(e=>e.measurementId===r);e&&await t[e.appId]}}catch(o){Es.error(o)}e("config",r,i)}(e,t,n,s,r,a)}else if("consent"===r){const[t,n]=i;e("consent",t,n)}else if("get"===r){const[t,n,s]=i;e("get",t,n,s)}else if("set"===r){const[t]=i;e("set",t)}else e(r,...i)}catch(a){Es.error(a)}}}const ks=new class{constructor(e={},t=1e3){this.throttleMetadata=e,this.intervalMillis=t}getThrottleMetadata(e){return this.throttleMetadata[e]}setThrottleMetadata(e,t){this.throttleMetadata[e]=t}deleteThrottleMetadata(e){delete this.throttleMetadata[e]}};function As(e){return new Headers({Accept:"application/json","x-goog-api-key":e})}async function Rs(e,t=ks,n){const{appId:s,apiKey:r,measurementId:i}=e.options;if(!s)throw Ts.create("no-app-id");if(!r){if(i)return{measurementId:i,appId:s};throw Ts.create("no-api-key")}const a=t.getThrottleMetadata(s)||{backoffCount:0,throttleEndTimeMillis:Date.now()},o=new Ds;return setTimeout(async()=>{o.abort()},6e4),js({appId:s,apiKey:r,measurementId:i},a,o,t)}async function js(e,{throttleEndTimeMillis:t,backoffCount:n},s,r=ks){const{appId:i,measurementId:a}=e;try{await function(e,t){return new Promise((n,s)=>{const r=Math.max(t-Date.now(),0),i=setTimeout(n,r);e.addEventListener(()=>{clearTimeout(i),s(Ts.create("fetch-throttle",{throttleEndTimeMillis:t}))})})}(s,t)}catch(o){if(a)return Es.warn(`Timed out fetching this Firebase app's measurement ID from the server. Falling back to the measurement ID ${a} provided in the "measurementId" field in the local Firebase config. [${o?.message}]`),{appId:i,measurementId:a};throw o}try{const t=await async function(e){const{appId:t,apiKey:n}=e,s={method:"GET",headers:As(n)},r="https://firebase.googleapis.com/v1alpha/projects/-/apps/{app-id}/webConfig".replace("{app-id}",t),i=await fetch(r,s);if(200!==i.status&&304!==i.status){let e="";try{const t=await i.json();t.error?.message&&(e=t.error.message)}catch(a){}throw Ts.create("config-fetch-failed",{httpStatus:i.status,responseMessage:e})}return i.json()}(e);return r.deleteThrottleMetadata(i),t}catch(o){const t=o;if(!function(e){if(!(e instanceof Ke&&e.customData))return!1;const t=Number(e.customData.httpStatus);return 429===t||500===t||503===t||504===t}(t)){if(r.deleteThrottleMetadata(i),a)return Es.warn(`Failed to fetch this Firebase app's measurement ID from the server. Falling back to the measurement ID ${a} provided in the "measurementId" field in the local Firebase config. [${t?.message}]`),{appId:i,measurementId:a};throw o}const c=503===Number(t?.customData?.httpStatus)?st(n,r.intervalMillis,30):st(n,r.intervalMillis),l={throttleEndTimeMillis:Date.now()+c,backoffCount:n+1};return r.setThrottleMetadata(i,l),Es.debug(`Calling attemptFetch again in ${c} millis`),js(e,l,s,r)}}class Ds{constructor(){this.listeners=[]}addEventListener(e){this.listeners.push(e)}abort(){this.listeners.forEach(e=>e())}}async function Os(e,t,n,s,r,i,a){const o=Rs(e);o.then(t=>{n[t.measurementId]=t.appId,e.options.measurementId&&t.measurementId!==e.options.measurementId&&Es.warn(`The measurement ID in the local Firebase config (${e.options.measurementId}) does not match the measurement ID fetched from the server (${t.measurementId}). To ensure analytics events are always sent to the correct Analytics property, update the measurement ID field in the local config or remove it from the local config.`)}).catch(e=>Es.error(e)),t.push(o);const c=async function(){if(!ze())return Es.warn(Ts.create("indexeddb-unavailable",{errorInfo:"IndexedDB is not available in this environment."}).message),!1;try{await Ge()}catch(e){return Es.warn(Ts.create("indexeddb-unavailable",{errorInfo:e?.toString()}).message),!1}return!0}().then(e=>e?s.getId():void 0),[l,u]=await Promise.all([o,c]);(function(e){const t=window.document.getElementsByTagName("script");for(const n of Object.values(t))if(n.src&&n.src.includes(_s)&&n.src.includes(e))return n;return null})(i)||Cs(i,l.measurementId),r("js",new Date);const h=a?.config??{};return h.origin="firebase",h.update=!0,null!=u&&(h.firebase_id=u),r("config",l.measurementId,h),l.measurementId}class Ps{constructor(e){this.app=e}_delete(){return delete Ls[this.app.options.appId],Promise.resolve()}}let Ls={},Ms=[];const Us={};let Fs,Vs,$s="dataLayer",Bs=!1;function qs(e,t,n){!function(){const e=[];if(Be()&&e.push("This is a browser extension environment."),He()||e.push("Cookies are not available."),e.length>0){const t=e.map((e,t)=>`(${t+1}) ${e}`).join(" "),n=Ts.create("invalid-analytics-context",{errorInfo:t});Es.warn(n.message)}}();const s=e.options.appId;if(!s)throw Ts.create("no-app-id");if(!e.options.apiKey){if(!e.options.measurementId)throw Ts.create("no-api-key");Es.warn(`The "apiKey" field is empty in the local Firebase config. This is needed to fetch the latest measurement ID for this Firebase app. Falling back to the measurement ID ${e.options.measurementId} provided in the "measurementId" field in the local Firebase config.`)}if(null!=Ls[s])throw Ts.create("already-exists",{id:s});if(!Bs){!function(e){let t=[];Array.isArray(window[e])?t=window[e]:window[e]=t}($s);const{wrappedGtag:e,gtagCore:t}=function(e,t,n,s,r){let i=function(...e){window[s].push(arguments)};return window[r]&&"function"==typeof window[r]&&(i=window[r]),window[r]=Ss(i,e,t,n),{gtagCore:i,wrappedGtag:window[r]}}(Ls,Ms,Us,$s,"gtag");Vs=e,Fs=t,Bs=!0}Ls[s]=Os(e,Ms,Us,t,Fs,$s,n);return new Ps(e)}function zs(e=En()){const t=yn(e=rt(e),xs);return t.isInitialized()?t.getImmediate():function(e,t={}){const n=yn(e,xs);if(n.isInitialized()){const e=n.getImmediate();if(Ye(t,n.getOptions()))return e;throw Ts.create("already-initialized")}const s=n.initialize({options:t});return s}(e)}function Gs(e,t,n){e=rt(e),async function(e,t,n,s){if(s&&s.global){const t={};for(const e of Object.keys(n))t[`user_properties.${e}`]=n[e];return e("set",t),Promise.resolve()}e("config",await t,{update:!0,user_properties:n})}(Vs,Ls[e.app.options.appId],t,n).catch(e=>Es.error(e))}const Hs="@firebase/analytics",Ks="0.10.19";gn(new it(xs,(e,{options:t})=>qs(e.getProvider("app").getImmediate(),e.getProvider("installations-internal").getImmediate(),t),"PUBLIC")),gn(new it("analytics-internal",function(e){try{const t=e.getProvider(xs).getImmediate();return{logEvent:(e,n,s)=>function(e,t,n,s){e=rt(e),async function(e,t,n,s,r){if(r&&r.global)e("event",n,s);else{const r=await t;e("event",n,{...s,send_to:r})}}(Vs,Ls[e.app.options.appId],t,n,s).catch(e=>Es.error(e))}(t,e,n,s),setUserProperties:(e,n)=>Gs(t,e,n)}}catch(t){throw Ts.create("interop-component-reg-failed",{reason:t})}},"PRIVATE")),Tn(Hs,Ks),Tn(Hs,Ks,"esm2020");var Ws,Qs,Ys="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};(function(){var e;function t(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.C=Array(this.blockSize),this.o=this.h=0,this.u()}function n(e,t,n){n||(n=0);const s=Array(16);if("string"==typeof t)for(var r=0;r<16;++r)s[r]=t.charCodeAt(n++)|t.charCodeAt(n++)<<8|t.charCodeAt(n++)<<16|t.charCodeAt(n++)<<24;else for(r=0;r<16;++r)s[r]=t[n++]|t[n++]<<8|t[n++]<<16|t[n++]<<24;t=e.g[0],n=e.g[1],r=e.g[2];let i,a=e.g[3];i=t+(a^n&(r^a))+s[0]+3614090360&4294967295,i=a+(r^(t=n+(i<<7&4294967295|i>>>25))&(n^r))+s[1]+3905402710&4294967295,a=t+(i<<12&4294967295|i>>>20),i=r+(n^a&(t^n))+s[2]+606105819&4294967295,i=n+(t^(r=a+(i<<17&4294967295|i>>>15))&(a^t))+s[3]+3250441966&4294967295,i=t+(a^(n=r+(i<<22&4294967295|i>>>10))&(r^a))+s[4]+4118548399&4294967295,i=a+(r^(t=n+(i<<7&4294967295|i>>>25))&(n^r))+s[5]+1200080426&4294967295,a=t+(i<<12&4294967295|i>>>20),i=r+(n^a&(t^n))+s[6]+2821735955&4294967295,i=n+(t^(r=a+(i<<17&4294967295|i>>>15))&(a^t))+s[7]+4249261313&4294967295,i=t+(a^(n=r+(i<<22&4294967295|i>>>10))&(r^a))+s[8]+1770035416&4294967295,i=a+(r^(t=n+(i<<7&4294967295|i>>>25))&(n^r))+s[9]+2336552879&4294967295,a=t+(i<<12&4294967295|i>>>20),i=r+(n^a&(t^n))+s[10]+4294925233&4294967295,i=n+(t^(r=a+(i<<17&4294967295|i>>>15))&(a^t))+s[11]+2304563134&4294967295,i=t+(a^(n=r+(i<<22&4294967295|i>>>10))&(r^a))+s[12]+1804603682&4294967295,i=a+(r^(t=n+(i<<7&4294967295|i>>>25))&(n^r))+s[13]+4254626195&4294967295,a=t+(i<<12&4294967295|i>>>20),i=r+(n^a&(t^n))+s[14]+2792965006&4294967295,i=n+(t^(r=a+(i<<17&4294967295|i>>>15))&(a^t))+s[15]+1236535329&4294967295,i=t+(r^a&((n=r+(i<<22&4294967295|i>>>10))^r))+s[1]+4129170786&4294967295,i=a+(n^r&((t=n+(i<<5&4294967295|i>>>27))^n))+s[6]+3225465664&4294967295,a=t+(i<<9&4294967295|i>>>23),i=r+(t^n&(a^t))+s[11]+643717713&4294967295,i=n+(a^t&((r=a+(i<<14&4294967295|i>>>18))^a))+s[0]+3921069994&4294967295,i=t+(r^a&((n=r+(i<<20&4294967295|i>>>12))^r))+s[5]+3593408605&4294967295,i=a+(n^r&((t=n+(i<<5&4294967295|i>>>27))^n))+s[10]+38016083&4294967295,a=t+(i<<9&4294967295|i>>>23),i=r+(t^n&(a^t))+s[15]+3634488961&4294967295,i=n+(a^t&((r=a+(i<<14&4294967295|i>>>18))^a))+s[4]+3889429448&4294967295,i=t+(r^a&((n=r+(i<<20&4294967295|i>>>12))^r))+s[9]+568446438&4294967295,i=a+(n^r&((t=n+(i<<5&4294967295|i>>>27))^n))+s[14]+3275163606&4294967295,a=t+(i<<9&4294967295|i>>>23),i=r+(t^n&(a^t))+s[3]+4107603335&4294967295,i=n+(a^t&((r=a+(i<<14&4294967295|i>>>18))^a))+s[8]+1163531501&4294967295,i=t+(r^a&((n=r+(i<<20&4294967295|i>>>12))^r))+s[13]+2850285829&4294967295,i=a+(n^r&((t=n+(i<<5&4294967295|i>>>27))^n))+s[2]+4243563512&4294967295,a=t+(i<<9&4294967295|i>>>23),i=r+(t^n&(a^t))+s[7]+1735328473&4294967295,i=n+(a^t&((r=a+(i<<14&4294967295|i>>>18))^a))+s[12]+2368359562&4294967295,i=t+((n=r+(i<<20&4294967295|i>>>12))^r^a)+s[5]+4294588738&4294967295,i=a+((t=n+(i<<4&4294967295|i>>>28))^n^r)+s[8]+2272392833&4294967295,a=t+(i<<11&4294967295|i>>>21),i=r+(a^t^n)+s[11]+1839030562&4294967295,i=n+((r=a+(i<<16&4294967295|i>>>16))^a^t)+s[14]+4259657740&4294967295,i=t+((n=r+(i<<23&4294967295|i>>>9))^r^a)+s[1]+2763975236&4294967295,i=a+((t=n+(i<<4&4294967295|i>>>28))^n^r)+s[4]+1272893353&4294967295,a=t+(i<<11&4294967295|i>>>21),i=r+(a^t^n)+s[7]+4139469664&4294967295,i=n+((r=a+(i<<16&4294967295|i>>>16))^a^t)+s[10]+3200236656&4294967295,i=t+((n=r+(i<<23&4294967295|i>>>9))^r^a)+s[13]+681279174&4294967295,i=a+((t=n+(i<<4&4294967295|i>>>28))^n^r)+s[0]+3936430074&4294967295,a=t+(i<<11&4294967295|i>>>21),i=r+(a^t^n)+s[3]+3572445317&4294967295,i=n+((r=a+(i<<16&4294967295|i>>>16))^a^t)+s[6]+76029189&4294967295,i=t+((n=r+(i<<23&4294967295|i>>>9))^r^a)+s[9]+3654602809&4294967295,i=a+((t=n+(i<<4&4294967295|i>>>28))^n^r)+s[12]+3873151461&4294967295,a=t+(i<<11&4294967295|i>>>21),i=r+(a^t^n)+s[15]+530742520&4294967295,i=n+((r=a+(i<<16&4294967295|i>>>16))^a^t)+s[2]+3299628645&4294967295,i=t+(r^((n=r+(i<<23&4294967295|i>>>9))|~a))+s[0]+4096336452&4294967295,i=a+(n^((t=n+(i<<6&4294967295|i>>>26))|~r))+s[7]+1126891415&4294967295,a=t+(i<<10&4294967295|i>>>22),i=r+(t^(a|~n))+s[14]+2878612391&4294967295,i=n+(a^((r=a+(i<<15&4294967295|i>>>17))|~t))+s[5]+4237533241&4294967295,i=t+(r^((n=r+(i<<21&4294967295|i>>>11))|~a))+s[12]+1700485571&4294967295,i=a+(n^((t=n+(i<<6&4294967295|i>>>26))|~r))+s[3]+2399980690&4294967295,a=t+(i<<10&4294967295|i>>>22),i=r+(t^(a|~n))+s[10]+4293915773&4294967295,i=n+(a^((r=a+(i<<15&4294967295|i>>>17))|~t))+s[1]+2240044497&4294967295,i=t+(r^((n=r+(i<<21&4294967295|i>>>11))|~a))+s[8]+1873313359&4294967295,i=a+(n^((t=n+(i<<6&4294967295|i>>>26))|~r))+s[15]+4264355552&4294967295,a=t+(i<<10&4294967295|i>>>22),i=r+(t^(a|~n))+s[6]+2734768916&4294967295,i=n+(a^((r=a+(i<<15&4294967295|i>>>17))|~t))+s[13]+1309151649&4294967295,i=t+(r^((n=r+(i<<21&4294967295|i>>>11))|~a))+s[4]+4149444226&4294967295,i=a+(n^((t=n+(i<<6&4294967295|i>>>26))|~r))+s[11]+3174756917&4294967295,a=t+(i<<10&4294967295|i>>>22),i=r+(t^(a|~n))+s[2]+718787259&4294967295,i=n+(a^((r=a+(i<<15&4294967295|i>>>17))|~t))+s[9]+3951481745&4294967295,e.g[0]=e.g[0]+t&4294967295,e.g[1]=e.g[1]+(r+(i<<21&4294967295|i>>>11))&4294967295,e.g[2]=e.g[2]+r&4294967295,e.g[3]=e.g[3]+a&4294967295}function s(e,t){this.h=t;const n=[];let s=!0;for(let r=e.length-1;r>=0;r--){const i=0|e[r];s&&i==t||(n[r]=i,s=!1)}this.g=n}!function(e,t){function n(){}n.prototype=t.prototype,e.F=t.prototype,e.prototype=new n,e.prototype.constructor=e,e.D=function(e,n,s){for(var r=Array(arguments.length-2),i=2;i<arguments.length;i++)r[i-2]=arguments[i];return t.prototype[n].apply(e,r)}}(t,function(){this.blockSize=-1}),t.prototype.u=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0},t.prototype.v=function(e,t){void 0===t&&(t=e.length);const s=t-this.blockSize,r=this.C;let i=this.h,a=0;for(;a<t;){if(0==i)for(;a<=s;)n(this,e,a),a+=this.blockSize;if("string"==typeof e){for(;a<t;)if(r[i++]=e.charCodeAt(a++),i==this.blockSize){n(this,r),i=0;break}}else for(;a<t;)if(r[i++]=e[a++],i==this.blockSize){n(this,r),i=0;break}}this.h=i,this.o+=t},t.prototype.A=function(){var e=Array((this.h<56?this.blockSize:2*this.blockSize)-this.h);e[0]=128;for(var t=1;t<e.length-8;++t)e[t]=0;t=8*this.o;for(var n=e.length-8;n<e.length;++n)e[n]=255&t,t/=256;for(this.v(e),e=Array(16),t=0,n=0;n<4;++n)for(let s=0;s<32;s+=8)e[t++]=this.g[n]>>>s&255;return e};var r={};function i(e){return-128<=e&&e<128?function(e,t){var n=r;return Object.prototype.hasOwnProperty.call(n,e)?n[e]:n[e]=t(e)}(e,function(e){return new s([0|e],e<0?-1:0)}):new s([0|e],e<0?-1:0)}function a(e){if(isNaN(e)||!isFinite(e))return o;if(e<0)return d(a(-e));const t=[];let n=1;for(let s=0;e>=n;s++)t[s]=e/n|0,n*=4294967296;return new s(t,0)}var o=i(0),c=i(1),l=i(16777216);function u(e){if(0!=e.h)return!1;for(let t=0;t<e.g.length;t++)if(0!=e.g[t])return!1;return!0}function h(e){return-1==e.h}function d(e){const t=e.g.length,n=[];for(let s=0;s<t;s++)n[s]=~e.g[s];return new s(n,~e.h).add(c)}function p(e,t){return e.add(d(t))}function f(e,t){for(;(65535&e[t])!=e[t];)e[t+1]+=e[t]>>>16,e[t]&=65535,t++}function m(e,t){this.g=e,this.h=t}function g(e,t){if(u(t))throw Error("division by zero");if(u(e))return new m(o,o);if(h(e))return t=g(d(e),t),new m(d(t.g),d(t.h));if(h(t))return t=g(e,d(t)),new m(d(t.g),t.h);if(e.g.length>30){if(h(e)||h(t))throw Error("slowDivide_ only works with positive integers.");for(var n=c,s=t;s.l(e)<=0;)n=y(n),s=y(s);var r=v(n,1),i=v(s,1);for(s=v(s,2),n=v(n,2);!u(s);){var l=i.add(s);l.l(e)<=0&&(r=r.add(n),i=l),s=v(s,1),n=v(n,1)}return t=p(e,r.j(t)),new m(r,t)}for(r=o;e.l(t)>=0;){for(n=Math.max(1,Math.floor(e.m()/t.m())),s=(s=Math.ceil(Math.log(n)/Math.LN2))<=48?1:Math.pow(2,s-48),l=(i=a(n)).j(t);h(l)||l.l(e)>0;)l=(i=a(n-=s)).j(t);u(i)&&(i=c),r=r.add(i),e=p(e,l)}return new m(r,e)}function y(e){const t=e.g.length+1,n=[];for(let s=0;s<t;s++)n[s]=e.i(s)<<1|e.i(s-1)>>>31;return new s(n,e.h)}function v(e,t){const n=t>>5;t%=32;const r=e.g.length-n,i=[];for(let s=0;s<r;s++)i[s]=t>0?e.i(s+n)>>>t|e.i(s+n+1)<<32-t:e.i(s+n);return new s(i,e.h)}(e=s.prototype).m=function(){if(h(this))return-d(this).m();let e=0,t=1;for(let n=0;n<this.g.length;n++){const s=this.i(n);e+=(s>=0?s:4294967296+s)*t,t*=4294967296}return e},e.toString=function(e){if((e=e||10)<2||36<e)throw Error("radix out of range: "+e);if(u(this))return"0";if(h(this))return"-"+d(this).toString(e);const t=a(Math.pow(e,6));var n=this;let s="";for(;;){const r=g(n,t).g;let i=(((n=p(n,r.j(t))).g.length>0?n.g[0]:n.h)>>>0).toString(e);if(u(n=r))return i+s;for(;i.length<6;)i="0"+i;s=i+s}},e.i=function(e){return e<0?0:e<this.g.length?this.g[e]:this.h},e.l=function(e){return h(e=p(this,e))?-1:u(e)?0:1},e.abs=function(){return h(this)?d(this):this},e.add=function(e){const t=Math.max(this.g.length,e.g.length),n=[];let r=0;for(let s=0;s<=t;s++){let t=r+(65535&this.i(s))+(65535&e.i(s)),i=(t>>>16)+(this.i(s)>>>16)+(e.i(s)>>>16);r=i>>>16,t&=65535,i&=65535,n[s]=i<<16|t}return new s(n,-2147483648&n[n.length-1]?-1:0)},e.j=function(e){if(u(this)||u(e))return o;if(h(this))return h(e)?d(this).j(d(e)):d(d(this).j(e));if(h(e))return d(this.j(d(e)));if(this.l(l)<0&&e.l(l)<0)return a(this.m()*e.m());const t=this.g.length+e.g.length,n=[];for(var r=0;r<2*t;r++)n[r]=0;for(r=0;r<this.g.length;r++)for(let t=0;t<e.g.length;t++){const s=this.i(r)>>>16,i=65535&this.i(r),a=e.i(t)>>>16,o=65535&e.i(t);n[2*r+2*t]+=i*o,f(n,2*r+2*t),n[2*r+2*t+1]+=s*o,f(n,2*r+2*t+1),n[2*r+2*t+1]+=i*a,f(n,2*r+2*t+1),n[2*r+2*t+2]+=s*a,f(n,2*r+2*t+2)}for(e=0;e<t;e++)n[e]=n[2*e+1]<<16|n[2*e];for(e=t;e<2*t;e++)n[e]=0;return new s(n,0)},e.B=function(e){return g(this,e).h},e.and=function(e){const t=Math.max(this.g.length,e.g.length),n=[];for(let s=0;s<t;s++)n[s]=this.i(s)&e.i(s);return new s(n,this.h&e.h)},e.or=function(e){const t=Math.max(this.g.length,e.g.length),n=[];for(let s=0;s<t;s++)n[s]=this.i(s)|e.i(s);return new s(n,this.h|e.h)},e.xor=function(e){const t=Math.max(this.g.length,e.g.length),n=[];for(let s=0;s<t;s++)n[s]=this.i(s)^e.i(s);return new s(n,this.h^e.h)},t.prototype.digest=t.prototype.A,t.prototype.reset=t.prototype.u,t.prototype.update=t.prototype.v,Qs=t,s.prototype.add=s.prototype.add,s.prototype.multiply=s.prototype.j,s.prototype.modulo=s.prototype.B,s.prototype.compare=s.prototype.l,s.prototype.toNumber=s.prototype.m,s.prototype.toString=s.prototype.toString,s.prototype.getBits=s.prototype.i,s.fromNumber=a,s.fromString=function e(t,n){if(0==t.length)throw Error("number format error: empty string");if((n=n||10)<2||36<n)throw Error("radix out of range: "+n);if("-"==t.charAt(0))return d(e(t.substring(1),n));if(t.indexOf("-")>=0)throw Error('number format error: interior "-" character');const s=a(Math.pow(n,8));let r=o;for(let o=0;o<t.length;o+=8){var i=Math.min(8,t.length-o);const e=parseInt(t.substring(o,o+i),n);i<8?(i=a(Math.pow(n,i)),r=r.j(i).add(a(e))):(r=r.j(s),r=r.add(a(e)))}return r},Ws=s}).apply(void 0!==Ys?Ys:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{});var Xs,Js,Zs,er,tr,nr,sr,rr,ir="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};(function(){var e,t=Object.defineProperty;var n=function(e){e=["object"==typeof globalThis&&globalThis,e,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof ir&&ir];for(var t=0;t<e.length;++t){var n=e[t];if(n&&n.Math==Math)return n}throw Error("Cannot find global object")}(this);function s(e,s){if(s)e:{var r=n;e=e.split(".");for(var i=0;i<e.length-1;i++){var a=e[i];if(!(a in r))break e;r=r[a]}(s=s(i=r[e=e[e.length-1]]))!=i&&null!=s&&t(r,e,{configurable:!0,writable:!0,value:s})}}s("Symbol.dispose",function(e){return e||Symbol("Symbol.dispose")}),s("Array.prototype.values",function(e){return e||function(){return this[Symbol.iterator]()}}),s("Object.entries",function(e){return e||function(e){var t,n=[];for(t in e)Object.prototype.hasOwnProperty.call(e,t)&&n.push([t,e[t]]);return n}});var r=r||{},i=this||self;function a(e){var t=typeof e;return"object"==t&&null!=e||"function"==t}function o(e,t,n){return e.call.apply(e.bind,arguments)}function c(e,t,n){return(c=o).apply(null,arguments)}function l(e,t){var n=Array.prototype.slice.call(arguments,1);return function(){var t=n.slice();return t.push.apply(t,arguments),e.apply(this,t)}}function u(e,t){function n(){}n.prototype=t.prototype,e.Z=t.prototype,e.prototype=new n,e.prototype.constructor=e,e.Ob=function(e,n,s){for(var r=Array(arguments.length-2),i=2;i<arguments.length;i++)r[i-2]=arguments[i];return t.prototype[n].apply(e,r)}}var h="undefined"!=typeof AsyncContext&&"function"==typeof AsyncContext.Snapshot?e=>e&&AsyncContext.Snapshot.wrap(e):e=>e;function d(e){const t=e.length;if(t>0){const n=Array(t);for(let s=0;s<t;s++)n[s]=e[s];return n}return[]}function p(e,t){for(let s=1;s<arguments.length;s++){const t=arguments[s];var n=typeof t;if("array"==(n="object"!=n?n:t?Array.isArray(t)?"array":n:"null")||"object"==n&&"number"==typeof t.length){n=e.length||0;const s=t.length||0;e.length=n+s;for(let r=0;r<s;r++)e[n+r]=t[r]}else e.push(t)}}function f(e){i.setTimeout(()=>{throw e},0)}function m(){var e=b;let t=null;return e.g&&(t=e.g,e.g=e.g.next,e.g||(e.h=null),t.next=null),t}var g=new class{constructor(e,t){this.i=e,this.j=t,this.h=0,this.g=null}get(){let e;return this.h>0?(this.h--,e=this.g,this.g=e.next,e.next=null):e=this.i(),e}}(()=>new y,e=>e.reset());class y{constructor(){this.next=this.g=this.h=null}set(e,t){this.h=e,this.g=t,this.next=null}reset(){this.next=this.g=this.h=null}}let v,w=!1,b=new class{constructor(){this.h=this.g=null}add(e,t){const n=g.get();n.set(e,t),this.h?this.h.next=n:this.g=n,this.h=n}},x=()=>{const e=Promise.resolve(void 0);v=()=>{e.then(_)}};function _(){for(var e;e=m();){try{e.h.call(e.g)}catch(n){f(n)}var t=g;t.j(e),t.h<100&&(t.h++,e.next=t.g,t.g=e)}w=!1}function E(){this.u=this.u,this.C=this.C}function T(e,t){this.type=e,this.g=this.target=t,this.defaultPrevented=!1}E.prototype.u=!1,E.prototype.dispose=function(){this.u||(this.u=!0,this.N())},E.prototype[Symbol.dispose]=function(){this.dispose()},E.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()},T.prototype.h=function(){this.defaultPrevented=!0};var I=function(){if(!i.addEventListener||!Object.defineProperty)return!1;var e=!1,t=Object.defineProperty({},"passive",{get:function(){e=!0}});try{const e=()=>{};i.addEventListener("test",e,t),i.removeEventListener("test",e,t)}catch(n){}return e}();function N(e){return/^[\s\xa0]*$/.test(e)}function C(e,t){T.call(this,e?e.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,e&&this.init(e,t)}u(C,T),C.prototype.init=function(e,t){const n=this.type=e.type,s=e.changedTouches&&e.changedTouches.length?e.changedTouches[0]:null;this.target=e.target||e.srcElement,this.g=t,(t=e.relatedTarget)||("mouseover"==n?t=e.fromElement:"mouseout"==n&&(t=e.toElement)),this.relatedTarget=t,s?(this.clientX=void 0!==s.clientX?s.clientX:s.pageX,this.clientY=void 0!==s.clientY?s.clientY:s.pageY,this.screenX=s.screenX||0,this.screenY=s.screenY||0):(this.clientX=void 0!==e.clientX?e.clientX:e.pageX,this.clientY=void 0!==e.clientY?e.clientY:e.pageY,this.screenX=e.screenX||0,this.screenY=e.screenY||0),this.button=e.button,this.key=e.key||"",this.ctrlKey=e.ctrlKey,this.altKey=e.altKey,this.shiftKey=e.shiftKey,this.metaKey=e.metaKey,this.pointerId=e.pointerId||0,this.pointerType=e.pointerType,this.state=e.state,this.i=e,e.defaultPrevented&&C.Z.h.call(this)},C.prototype.h=function(){C.Z.h.call(this);const e=this.i;e.preventDefault?e.preventDefault():e.returnValue=!1};var S="closure_listenable_"+(1e6*Math.random()|0),k=0;function A(e,t,n,s,r){this.listener=e,this.proxy=null,this.src=t,this.type=n,this.capture=!!s,this.ha=r,this.key=++k,this.da=this.fa=!1}function R(e){e.da=!0,e.listener=null,e.proxy=null,e.src=null,e.ha=null}function j(e,t,n){for(const s in e)t.call(n,e[s],s,e)}function D(e){const t={};for(const n in e)t[n]=e[n];return t}const O="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function P(e,t){let n,s;for(let r=1;r<arguments.length;r++){for(n in s=arguments[r],s)e[n]=s[n];for(let t=0;t<O.length;t++)n=O[t],Object.prototype.hasOwnProperty.call(s,n)&&(e[n]=s[n])}}function L(e){this.src=e,this.g={},this.h=0}function M(e,t){const n=t.type;if(n in e.g){var s,r=e.g[n],i=Array.prototype.indexOf.call(r,t,void 0);(s=i>=0)&&Array.prototype.splice.call(r,i,1),s&&(R(t),0==e.g[n].length&&(delete e.g[n],e.h--))}}function U(e,t,n,s){for(let r=0;r<e.length;++r){const i=e[r];if(!i.da&&i.listener==t&&i.capture==!!n&&i.ha==s)return r}return-1}L.prototype.add=function(e,t,n,s,r){const i=e.toString();(e=this.g[i])||(e=this.g[i]=[],this.h++);const a=U(e,t,s,r);return a>-1?(t=e[a],n||(t.fa=!1)):((t=new A(t,this.src,i,!!s,r)).fa=n,e.push(t)),t};var F="closure_lm_"+(1e6*Math.random()|0),V={};function $(e,t,n,s,r){if(Array.isArray(t)){for(let i=0;i<t.length;i++)$(e,t[i],n,s,r);return null}return n=W(n),e&&e[S]?e.J(t,n,!!a(s)&&!!s.capture,r):function(e,t,n,s,r,i){if(!t)throw Error("Invalid event type");const o=a(r)?!!r.capture:!!r;let c=H(e);if(c||(e[F]=c=new L(e)),n=c.add(t,n,s,o,i),n.proxy)return n;if(s=function(){function e(n){return t.call(e.src,e.listener,n)}const t=G;return e}(),n.proxy=s,s.src=e,s.listener=n,e.addEventListener)I||(r=o),void 0===r&&(r=!1),e.addEventListener(t.toString(),s,r);else if(e.attachEvent)e.attachEvent(z(t.toString()),s);else{if(!e.addListener||!e.removeListener)throw Error("addEventListener and attachEvent are unavailable.");e.addListener(s)}return n}(e,t,n,!1,s,r)}function B(e,t,n,s,r){if(Array.isArray(t))for(var i=0;i<t.length;i++)B(e,t[i],n,s,r);else s=a(s)?!!s.capture:!!s,n=W(n),e&&e[S]?(e=e.i,(i=String(t).toString())in e.g&&((n=U(t=e.g[i],n,s,r))>-1&&(R(t[n]),Array.prototype.splice.call(t,n,1),0==t.length&&(delete e.g[i],e.h--)))):e&&(e=H(e))&&(t=e.g[t.toString()],e=-1,t&&(e=U(t,n,s,r)),(n=e>-1?t[e]:null)&&q(n))}function q(e){if("number"!=typeof e&&e&&!e.da){var t=e.src;if(t&&t[S])M(t.i,e);else{var n=e.type,s=e.proxy;t.removeEventListener?t.removeEventListener(n,s,e.capture):t.detachEvent?t.detachEvent(z(n),s):t.addListener&&t.removeListener&&t.removeListener(s),(n=H(t))?(M(n,e),0==n.h&&(n.src=null,t[F]=null)):R(e)}}}function z(e){return e in V?V[e]:V[e]="on"+e}function G(e,t){if(e.da)e=!0;else{t=new C(t,this);const n=e.listener,s=e.ha||e.src;e.fa&&q(e),e=n.call(s,t)}return e}function H(e){return(e=e[F])instanceof L?e:null}var K="__closure_events_fn_"+(1e9*Math.random()>>>0);function W(e){return"function"==typeof e?e:(e[K]||(e[K]=function(t){return e.handleEvent(t)}),e[K])}function Q(){E.call(this),this.i=new L(this),this.M=this,this.G=null}function Y(e,t){var n,s=e.G;if(s)for(n=[];s;s=s.G)n.push(s);if(e=e.M,s=t.type||t,"string"==typeof t)t=new T(t,e);else if(t instanceof T)t.target=t.target||e;else{var r=t;P(t=new T(s,e),r)}let i,a;if(r=!0,n)for(a=n.length-1;a>=0;a--)i=t.g=n[a],r=X(i,s,!0,t)&&r;if(i=t.g=e,r=X(i,s,!0,t)&&r,r=X(i,s,!1,t)&&r,n)for(a=0;a<n.length;a++)i=t.g=n[a],r=X(i,s,!1,t)&&r}function X(e,t,n,s){if(!(t=e.i.g[String(t)]))return!0;t=t.concat();let r=!0;for(let i=0;i<t.length;++i){const a=t[i];if(a&&!a.da&&a.capture==n){const t=a.listener,n=a.ha||a.src;a.fa&&M(e.i,a),r=!1!==t.call(n,s)&&r}}return r&&!s.defaultPrevented}function J(e){e.g=function(e,t){if("function"!=typeof e){if(!e||"function"!=typeof e.handleEvent)throw Error("Invalid listener argument");e=c(e.handleEvent,e)}return Number(t)>2147483647?-1:i.setTimeout(e,t||0)}(()=>{e.g=null,e.i&&(e.i=!1,J(e))},e.l);const t=e.h;e.h=null,e.m.apply(null,t)}u(Q,E),Q.prototype[S]=!0,Q.prototype.removeEventListener=function(e,t,n,s){B(this,e,t,n,s)},Q.prototype.N=function(){if(Q.Z.N.call(this),this.i){var e=this.i;for(const t in e.g){const n=e.g[t];for(let e=0;e<n.length;e++)R(n[e]);delete e.g[t],e.h--}}this.G=null},Q.prototype.J=function(e,t,n,s){return this.i.add(String(e),t,!1,n,s)},Q.prototype.K=function(e,t,n,s){return this.i.add(String(e),t,!0,n,s)};class Z extends E{constructor(e,t){super(),this.m=e,this.l=t,this.h=null,this.i=!1,this.g=null}j(e){this.h=arguments,this.g?this.i=!0:J(this)}N(){super.N(),this.g&&(i.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function ee(e){E.call(this),this.h=e,this.g={}}u(ee,E);var te=[];function ne(e){j(e.g,function(e,t){this.g.hasOwnProperty(t)&&q(e)},e),e.g={}}ee.prototype.N=function(){ee.Z.N.call(this),ne(this)},ee.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var se=i.JSON.stringify,re=i.JSON.parse,ie=class{stringify(e){return i.JSON.stringify(e,void 0)}parse(e){return i.JSON.parse(e,void 0)}};function ae(){}function oe(){}var ce={OPEN:"a",hb:"b",ERROR:"c",tb:"d"};function le(){T.call(this,"d")}function ue(){T.call(this,"c")}u(le,T),u(ue,T);var he={},de=null;function pe(){return de=de||new Q}function fe(e){T.call(this,he.Ia,e)}function me(e){const t=pe();Y(t,new fe(t))}function ge(e,t){T.call(this,he.STAT_EVENT,e),this.stat=t}function ye(e){const t=pe();Y(t,new ge(t,e))}function ve(e,t){T.call(this,he.Ja,e),this.size=t}function we(e,t){if("function"!=typeof e)throw Error("Fn must not be null and must be a function");return i.setTimeout(function(){e()},t)}function be(){this.g=!0}function xe(e,t,n,s){e.info(function(){return"XMLHTTP TEXT ("+t+"): "+function(e,t){if(!e.g)return t;if(!t)return null;try{const i=JSON.parse(t);if(i)for(e=0;e<i.length;e++)if(Array.isArray(i[e])){var n=i[e];if(!(n.length<2)){var s=n[1];if(Array.isArray(s)&&!(s.length<1)){var r=s[0];if("noop"!=r&&"stop"!=r&&"close"!=r)for(let e=1;e<s.length;e++)s[e]=""}}}return se(i)}catch(i){return t}}(e,n)+(s?" "+s:"")})}he.Ia="serverreachability",u(fe,T),he.STAT_EVENT="statevent",u(ge,T),he.Ja="timingevent",u(ve,T),be.prototype.ua=function(){this.g=!1},be.prototype.info=function(){};var _e,Ee={NO_ERROR:0,cb:1,qb:2,pb:3,kb:4,ob:5,rb:6,Ga:7,TIMEOUT:8,ub:9},Te={ib:"complete",Fb:"success",ERROR:"error",Ga:"abort",xb:"ready",yb:"readystatechange",TIMEOUT:"timeout",sb:"incrementaldata",wb:"progress",lb:"downloadprogress",Nb:"uploadprogress"};function Ie(){}function Ne(e){return encodeURIComponent(String(e))}function Ce(e){var t=1;e=e.split(":");const n=[];for(;t>0&&e.length;)n.push(e.shift()),t--;return e.length&&n.push(e.join(":")),n}function Se(e,t,n,s){this.j=e,this.i=t,this.l=n,this.S=s||1,this.V=new ee(this),this.H=45e3,this.J=null,this.o=!1,this.u=this.B=this.A=this.M=this.F=this.T=this.D=null,this.G=[],this.g=null,this.C=0,this.m=this.v=null,this.X=-1,this.K=!1,this.P=0,this.O=null,this.W=this.L=this.U=this.R=!1,this.h=new ke}function ke(){this.i=null,this.g="",this.h=!1}u(Ie,ae),Ie.prototype.g=function(){return new XMLHttpRequest},_e=new Ie;var Ae={},Re={};function je(e,t,n){e.M=1,e.A=st(Je(t)),e.u=n,e.R=!0,De(e,null)}function De(e,t){e.F=Date.now(),Le(e),e.B=Je(e.A);var n=e.B,s=e.S;Array.isArray(s)||(s=[String(s)]),yt(n.i,"t",s),e.C=0,n=e.j.L,e.h=new ke,e.g=sn(e.j,n?t:null,!e.u),e.P>0&&(e.O=new Z(c(e.Y,e,e.g),e.P)),t=e.V,n=e.g,s=e.ba;var r="readystatechange";Array.isArray(r)||(r&&(te[0]=r.toString()),r=te);for(let i=0;i<r.length;i++){const e=$(n,r[i],s||t.handleEvent,!1,t.h||t);if(!e)break;t.g[e.key]=e}t=e.J?D(e.J):{},e.u?(e.v||(e.v="POST"),t["Content-Type"]="application/x-www-form-urlencoded",e.g.ea(e.B,e.v,e.u,t)):(e.v="GET",e.g.ea(e.B,e.v,null,t)),me(),function(e,t,n,s,r,i){e.info(function(){if(e.g)if(i){var a="",o=i.split("&");for(let e=0;e<o.length;e++){var c=o[e].split("=");if(c.length>1){const e=c[0];c=c[1];const t=e.split("_");a=t.length>=2&&"type"==t[1]?a+(e+"=")+c+"&":a+(e+"=redacted&")}}}else a=null;else a=i;return"XMLHTTP REQ ("+s+") [attempt "+r+"]: "+t+"\n"+n+"\n"+a})}(e.i,e.v,e.B,e.l,e.S,e.u)}function Oe(e){return!!e.g&&("GET"==e.v&&2!=e.M&&e.j.Aa)}function Pe(e,t){var n=e.C,s=t.indexOf("\n",n);return-1==s?Re:(n=Number(t.substring(n,s)),isNaN(n)?Ae:(s+=1)+n>t.length?Re:(t=t.slice(s,s+n),e.C=s+n,t))}function Le(e){e.T=Date.now()+e.H,Me(e,e.H)}function Me(e,t){if(null!=e.D)throw Error("WatchDog timer not null");e.D=we(c(e.aa,e),t)}function Ue(e){e.D&&(i.clearTimeout(e.D),e.D=null)}function Fe(e){0==e.j.I||e.K||Jt(e.j,e)}function Ve(e){Ue(e);var t=e.O;t&&"function"==typeof t.dispose&&t.dispose(),e.O=null,ne(e.V),e.g&&(t=e.g,e.g=null,t.abort(),t.dispose())}function $e(e,t){try{var n=e.j;if(0!=n.I&&(n.g==e||He(n.h,e)))if(!e.L&&He(n.h,e)&&3==n.I){try{var s=n.Ba.g.parse(t)}catch(u){s=null}if(Array.isArray(s)&&3==s.length){var r=s;if(0==r[0]){e:if(!n.v){if(n.g){if(!(n.g.F+3e3<e.F))break e;Xt(n),$t(n)}Wt(n),ye(18)}}else n.xa=r[1],0<n.xa-n.K&&r[2]<37500&&n.F&&0==n.A&&!n.C&&(n.C=we(c(n.Va,n),6e3));Ge(n.h)<=1&&n.ta&&(n.ta=void 0)}else en(n,11)}else if((e.L||n.g==e)&&Xt(n),!N(t))for(r=n.Ba.g.parse(t),t=0;t<r.length;t++){let c=r[t];const u=c[0];if(!(u<=n.K))if(n.K=u,c=c[1],2==n.I)if("c"==c[0]){n.M=c[1],n.ba=c[2];const t=c[3];null!=t&&(n.ka=t,n.j.info("VER="+n.ka));const r=c[4];null!=r&&(n.za=r,n.j.info("SVER="+n.za));const u=c[5];null!=u&&"number"==typeof u&&u>0&&(s=1.5*u,n.O=s,n.j.info("backChannelRequestTimeoutMs_="+s)),s=n;const h=e.g;if(h){const e=h.g?h.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(e){var i=s.h;i.g||-1==e.indexOf("spdy")&&-1==e.indexOf("quic")&&-1==e.indexOf("h2")||(i.j=i.l,i.g=new Set,i.h&&(Ke(i,i.h),i.h=null))}if(s.G){const e=h.g?h.g.getResponseHeader("X-HTTP-Session-Id"):null;e&&(s.wa=e,nt(s.J,s.G,e))}}n.I=3,n.l&&n.l.ra(),n.aa&&(n.T=Date.now()-e.F,n.j.info("Handshake RTT: "+n.T+"ms"));var a=e;if((s=n).na=nn(s,s.L?s.ba:null,s.W),a.L){We(s.h,a);var o=a,l=s.O;l&&(o.H=l),o.D&&(Ue(o),Le(o)),s.g=a}else Kt(s);n.i.length>0&&qt(n)}else"stop"!=c[0]&&"close"!=c[0]||en(n,7);else 3==n.I&&("stop"==c[0]||"close"==c[0]?"stop"==c[0]?en(n,7):Vt(n):"noop"!=c[0]&&n.l&&n.l.qa(c),n.A=0)}me()}catch(u){}}Se.prototype.ba=function(e){e=e.target;const t=this.O;t&&3==Lt(e)?t.j():this.Y(e)},Se.prototype.Y=function(e){try{if(e==this.g)e:{const c=Lt(this.g),l=this.g.ya();this.g.ca();if(!(c<3)&&(3!=c||this.g&&(this.h.h||this.g.la()||Mt(this.g)))){this.K||4!=c||7==l||me(),Ue(this);var t=this.g.ca();this.X=t;var n=function(e){if(!Oe(e))return e.g.la();const t=Mt(e.g);if(""===t)return"";let n="";const s=t.length,r=4==Lt(e.g);if(!e.h.i){if("undefined"==typeof TextDecoder)return Ve(e),Fe(e),"";e.h.i=new i.TextDecoder}for(let i=0;i<s;i++)e.h.h=!0,n+=e.h.i.decode(t[i],{stream:!(r&&i==s-1)});return t.length=0,e.h.g+=n,e.C=0,e.h.g}(this);if(this.o=200==t,function(e,t,n,s,r,i,a){e.info(function(){return"XMLHTTP RESP ("+s+") [ attempt "+r+"]: "+t+"\n"+n+"\n"+i+" "+a})}(this.i,this.v,this.B,this.l,this.S,c,t),this.o){if(this.U&&!this.L){t:{if(this.g){var s,r=this.g;if((s=r.g?r.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!N(s)){var a=s;break t}}a=null}if(!(e=a)){this.o=!1,this.m=3,ye(12),Ve(this),Fe(this);break e}xe(this.i,this.l,e,"Initial handshake response via X-HTTP-Initial-Response"),this.L=!0,$e(this,e)}if(this.R){let t;for(e=!0;!this.K&&this.C<n.length;){if(t=Pe(this,n),t==Re){4==c&&(this.m=4,ye(14),e=!1),xe(this.i,this.l,null,"[Incomplete Response]");break}if(t==Ae){this.m=4,ye(15),xe(this.i,this.l,n,"[Invalid Chunk]"),e=!1;break}xe(this.i,this.l,t,null),$e(this,t)}if(Oe(this)&&0!=this.C&&(this.h.g=this.h.g.slice(this.C),this.C=0),4!=c||0!=n.length||this.h.h||(this.m=1,ye(16),e=!1),this.o=this.o&&e,e){if(n.length>0&&!this.W){this.W=!0;var o=this.j;o.g==this&&o.aa&&!o.P&&(o.j.info("Great, no buffering proxy detected. Bytes received: "+n.length),Qt(o),o.P=!0,ye(11))}}else xe(this.i,this.l,n,"[Invalid Chunked Response]"),Ve(this),Fe(this)}else xe(this.i,this.l,n,null),$e(this,n);4==c&&Ve(this),this.o&&!this.K&&(4==c?Jt(this.j,this):(this.o=!1,Le(this)))}else(function(e){const t={};e=(e.g&&Lt(e)>=2&&e.g.getAllResponseHeaders()||"").split("\r\n");for(let s=0;s<e.length;s++){if(N(e[s]))continue;var n=Ce(e[s]);const r=n[0];if("string"!=typeof(n=n[1]))continue;n=n.trim();const i=t[r]||[];t[r]=i,i.push(n)}!function(e,t){for(const n in e)t.call(void 0,e[n],n,e)}(t,function(e){return e.join(", ")})})(this.g),400==t&&n.indexOf("Unknown SID")>0?(this.m=3,ye(12)):(this.m=0,ye(13)),Ve(this),Fe(this)}}}catch(c){}},Se.prototype.cancel=function(){this.K=!0,Ve(this)},Se.prototype.aa=function(){this.D=null;const e=Date.now();e-this.T>=0?(function(e,t){e.info(function(){return"TIMEOUT: "+t})}(this.i,this.B),2!=this.M&&(me(),ye(17)),Ve(this),this.m=2,Fe(this)):Me(this,this.T-e)};var Be=class{constructor(e,t){this.g=e,this.map=t}};function qe(e){this.l=e||10,i.PerformanceNavigationTiming?e=(e=i.performance.getEntriesByType("navigation")).length>0&&("hq"==e[0].nextHopProtocol||"h2"==e[0].nextHopProtocol):e=!!(i.chrome&&i.chrome.loadTimes&&i.chrome.loadTimes()&&i.chrome.loadTimes().wasFetchedViaSpdy),this.j=e?this.l:1,this.g=null,this.j>1&&(this.g=new Set),this.h=null,this.i=[]}function ze(e){return!!e.h||!!e.g&&e.g.size>=e.j}function Ge(e){return e.h?1:e.g?e.g.size:0}function He(e,t){return e.h?e.h==t:!!e.g&&e.g.has(t)}function Ke(e,t){e.g?e.g.add(t):e.h=t}function We(e,t){e.h&&e.h==t?e.h=null:e.g&&e.g.has(t)&&e.g.delete(t)}function Qe(e){if(null!=e.h)return e.i.concat(e.h.G);if(null!=e.g&&0!==e.g.size){let t=e.i;for(const n of e.g.values())t=t.concat(n.G);return t}return d(e.i)}qe.prototype.cancel=function(){if(this.i=Qe(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&0!==this.g.size){for(const e of this.g.values())e.cancel();this.g.clear()}};var Ye=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function Xe(e){let t;this.g=this.o=this.j="",this.u=null,this.m=this.h="",this.l=!1,e instanceof Xe?(this.l=e.l,Ze(this,e.j),this.o=e.o,this.g=e.g,et(this,e.u),this.h=e.h,tt(this,vt(e.i)),this.m=e.m):e&&(t=String(e).match(Ye))?(this.l=!1,Ze(this,t[1]||"",!0),this.o=rt(t[2]||""),this.g=rt(t[3]||"",!0),et(this,t[4]),this.h=rt(t[5]||"",!0),tt(this,t[6]||"",!0),this.m=rt(t[7]||"")):(this.l=!1,this.i=new dt(null,this.l))}function Je(e){return new Xe(e)}function Ze(e,t,n){e.j=n?rt(t,!0):t,e.j&&(e.j=e.j.replace(/:$/,""))}function et(e,t){if(t){if(t=Number(t),isNaN(t)||t<0)throw Error("Bad port number "+t);e.u=t}else e.u=null}function tt(e,t,n){t instanceof dt?(e.i=t,function(e,t){t&&!e.j&&(pt(e),e.i=null,e.g.forEach(function(e,t){const n=t.toLowerCase();t!=n&&(ft(this,t),yt(this,n,e))},e)),e.j=t}(e.i,e.l)):(n||(t=it(t,ut)),e.i=new dt(t,e.l))}function nt(e,t,n){e.i.set(t,n)}function st(e){return nt(e,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),e}function rt(e,t){return e?t?decodeURI(e.replace(/%25/g,"%2525")):decodeURIComponent(e):""}function it(e,t,n){return"string"==typeof e?(e=encodeURI(e).replace(t,at),n&&(e=e.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),e):null}function at(e){return"%"+((e=e.charCodeAt(0))>>4&15).toString(16)+(15&e).toString(16)}Xe.prototype.toString=function(){const e=[];var t=this.j;t&&e.push(it(t,ot,!0),":");var n=this.g;return(n||"file"==t)&&(e.push("//"),(t=this.o)&&e.push(it(t,ot,!0),"@"),e.push(Ne(n).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(n=this.u)&&e.push(":",String(n))),(n=this.h)&&(this.g&&"/"!=n.charAt(0)&&e.push("/"),e.push(it(n,"/"==n.charAt(0)?lt:ct,!0))),(n=this.i.toString())&&e.push("?",n),(n=this.m)&&e.push("#",it(n,ht)),e.join("")},Xe.prototype.resolve=function(e){const t=Je(this);let n=!!e.j;n?Ze(t,e.j):n=!!e.o,n?t.o=e.o:n=!!e.g,n?t.g=e.g:n=null!=e.u;var s=e.h;if(n)et(t,e.u);else if(n=!!e.h){if("/"!=s.charAt(0))if(this.g&&!this.h)s="/"+s;else{var r=t.h.lastIndexOf("/");-1!=r&&(s=t.h.slice(0,r+1)+s)}if(".."==(r=s)||"."==r)s="";else if(-1!=r.indexOf("./")||-1!=r.indexOf("/.")){s=0==r.lastIndexOf("/",0),r=r.split("/");const e=[];for(let t=0;t<r.length;){const n=r[t++];"."==n?s&&t==r.length&&e.push(""):".."==n?((e.length>1||1==e.length&&""!=e[0])&&e.pop(),s&&t==r.length&&e.push("")):(e.push(n),s=!0)}s=e.join("/")}else s=r}return n?t.h=s:n=""!==e.i.toString(),n?tt(t,vt(e.i)):n=!!e.m,n&&(t.m=e.m),t};var ot=/[#\/\?@]/g,ct=/[#\?:]/g,lt=/[#\?]/g,ut=/[#\?@]/g,ht=/#/g;function dt(e,t){this.h=this.g=null,this.i=e||null,this.j=!!t}function pt(e){e.g||(e.g=new Map,e.h=0,e.i&&function(e,t){if(e){e=e.split("&");for(let n=0;n<e.length;n++){const s=e[n].indexOf("=");let r,i=null;s>=0?(r=e[n].substring(0,s),i=e[n].substring(s+1)):r=e[n],t(r,i?decodeURIComponent(i.replace(/\+/g," ")):"")}}}(e.i,function(t,n){e.add(decodeURIComponent(t.replace(/\+/g," ")),n)}))}function ft(e,t){pt(e),t=wt(e,t),e.g.has(t)&&(e.i=null,e.h-=e.g.get(t).length,e.g.delete(t))}function mt(e,t){return pt(e),t=wt(e,t),e.g.has(t)}function gt(e,t){pt(e);let n=[];if("string"==typeof t)mt(e,t)&&(n=n.concat(e.g.get(wt(e,t))));else for(e=Array.from(e.g.values()),t=0;t<e.length;t++)n=n.concat(e[t]);return n}function yt(e,t,n){ft(e,t),n.length>0&&(e.i=null,e.g.set(wt(e,t),d(n)),e.h+=n.length)}function vt(e){const t=new dt;return t.i=e.i,e.g&&(t.g=new Map(e.g),t.h=e.h),t}function wt(e,t){return t=String(t),e.j&&(t=t.toLowerCase()),t}function bt(e,t,n,s,r){try{r&&(r.onload=null,r.onerror=null,r.onabort=null,r.ontimeout=null),s(n)}catch(i){}}function xt(){this.g=new ie}function _t(e){this.i=e.Sb||null,this.h=e.ab||!1}function Et(e,t){Q.call(this),this.H=e,this.o=t,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.A=new Headers,this.h=null,this.F="GET",this.D="",this.g=!1,this.B=this.j=this.l=null,this.v=new AbortController}function Tt(e){e.j.read().then(e.Ma.bind(e)).catch(e.ga.bind(e))}function It(e){e.readyState=4,e.l=null,e.j=null,e.B=null,Nt(e)}function Nt(e){e.onreadystatechange&&e.onreadystatechange.call(e)}function Ct(e){let t="";return j(e,function(e,n){t+=n,t+=":",t+=e,t+="\r\n"}),t}function St(e,t,n){e:{for(s in n){var s=!1;break e}s=!0}s||(n=Ct(n),"string"==typeof e?null!=n&&Ne(n):nt(e,t,n))}function kt(e){Q.call(this),this.headers=new Map,this.L=e||null,this.h=!1,this.g=null,this.D="",this.o=0,this.l="",this.j=this.B=this.v=this.A=!1,this.m=null,this.F="",this.H=!1}(e=dt.prototype).add=function(e,t){pt(this),this.i=null,e=wt(this,e);let n=this.g.get(e);return n||this.g.set(e,n=[]),n.push(t),this.h+=1,this},e.forEach=function(e,t){pt(this),this.g.forEach(function(n,s){n.forEach(function(n){e.call(t,n,s,this)},this)},this)},e.set=function(e,t){return pt(this),this.i=null,mt(this,e=wt(this,e))&&(this.h-=this.g.get(e).length),this.g.set(e,[t]),this.h+=1,this},e.get=function(e,t){return e&&(e=gt(this,e)).length>0?String(e[0]):t},e.toString=function(){if(this.i)return this.i;if(!this.g)return"";const e=[],t=Array.from(this.g.keys());for(let s=0;s<t.length;s++){var n=t[s];const r=Ne(n);n=gt(this,n);for(let t=0;t<n.length;t++){let s=r;""!==n[t]&&(s+="="+Ne(n[t])),e.push(s)}}return this.i=e.join("&")},u(_t,ae),_t.prototype.g=function(){return new Et(this.i,this.h)},u(Et,Q),(e=Et.prototype).open=function(e,t){if(0!=this.readyState)throw this.abort(),Error("Error reopening a connection");this.F=e,this.D=t,this.readyState=1,Nt(this)},e.send=function(e){if(1!=this.readyState)throw this.abort(),Error("need to call open() first. ");if(this.v.signal.aborted)throw this.abort(),Error("Request was aborted.");this.g=!0;const t={headers:this.A,method:this.F,credentials:this.m,cache:void 0,signal:this.v.signal};e&&(t.body=e),(this.H||i).fetch(new Request(this.D,t)).then(this.Pa.bind(this),this.ga.bind(this))},e.abort=function(){this.response=this.responseText="",this.A=new Headers,this.status=0,this.v.abort(),this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),this.readyState>=1&&this.g&&4!=this.readyState&&(this.g=!1,It(this)),this.readyState=0},e.Pa=function(e){if(this.g&&(this.l=e,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=e.headers,this.readyState=2,Nt(this)),this.g&&(this.readyState=3,Nt(this),this.g)))if("arraybuffer"===this.responseType)e.arrayBuffer().then(this.Na.bind(this),this.ga.bind(this));else if(void 0!==i.ReadableStream&&"body"in e){if(this.j=e.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.B=new TextDecoder;Tt(this)}else e.text().then(this.Oa.bind(this),this.ga.bind(this))},e.Ma=function(e){if(this.g){if(this.o&&e.value)this.response.push(e.value);else if(!this.o){var t=e.value?e.value:new Uint8Array(0);(t=this.B.decode(t,{stream:!e.done}))&&(this.response=this.responseText+=t)}e.done?It(this):Nt(this),3==this.readyState&&Tt(this)}},e.Oa=function(e){this.g&&(this.response=this.responseText=e,It(this))},e.Na=function(e){this.g&&(this.response=e,It(this))},e.ga=function(){this.g&&It(this)},e.setRequestHeader=function(e,t){this.A.append(e,t)},e.getResponseHeader=function(e){return this.h&&this.h.get(e.toLowerCase())||""},e.getAllResponseHeaders=function(){if(!this.h)return"";const e=[],t=this.h.entries();for(var n=t.next();!n.done;)n=n.value,e.push(n[0]+": "+n[1]),n=t.next();return e.join("\r\n")},Object.defineProperty(Et.prototype,"withCredentials",{get:function(){return"include"===this.m},set:function(e){this.m=e?"include":"same-origin"}}),u(kt,Q);var At=/^https?$/i,Rt=["POST","PUT"];function jt(e,t){e.h=!1,e.g&&(e.j=!0,e.g.abort(),e.j=!1),e.l=t,e.o=5,Dt(e),Pt(e)}function Dt(e){e.A||(e.A=!0,Y(e,"complete"),Y(e,"error"))}function Ot(e){if(e.h&&void 0!==r)if(e.v&&4==Lt(e))setTimeout(e.Ca.bind(e),0);else if(Y(e,"readystatechange"),4==Lt(e)){e.h=!1;try{const r=e.ca();e:switch(r){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var t=!0;break e;default:t=!1}var n;if(!(n=t)){var s;if(s=0===r){let t=String(e.D).match(Ye)[1]||null;!t&&i.self&&i.self.location&&(t=i.self.location.protocol.slice(0,-1)),s=!At.test(t?t.toLowerCase():"")}n=s}if(n)Y(e,"complete"),Y(e,"success");else{e.o=6;try{var a=Lt(e)>2?e.g.statusText:""}catch(o){a=""}e.l=a+" ["+e.ca()+"]",Dt(e)}}finally{Pt(e)}}}function Pt(e,t){if(e.g){e.m&&(clearTimeout(e.m),e.m=null);const s=e.g;e.g=null,t||Y(e,"ready");try{s.onreadystatechange=null}catch(n){}}}function Lt(e){return e.g?e.g.readyState:0}function Mt(e){try{if(!e.g)return null;if("response"in e.g)return e.g.response;switch(e.F){case"":case"text":return e.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in e.g)return e.g.mozResponseArrayBuffer}return null}catch(t){return null}}function Ut(e,t,n){return n&&n.internalChannelParams&&n.internalChannelParams[e]||t}function Ft(e){this.za=0,this.i=[],this.j=new be,this.ba=this.na=this.J=this.W=this.g=this.wa=this.G=this.H=this.u=this.U=this.o=null,this.Ya=this.V=0,this.Sa=Ut("failFast",!1,e),this.F=this.C=this.v=this.m=this.l=null,this.X=!0,this.xa=this.K=-1,this.Y=this.A=this.D=0,this.Qa=Ut("baseRetryDelayMs",5e3,e),this.Za=Ut("retryDelaySeedMs",1e4,e),this.Ta=Ut("forwardChannelMaxRetries",2,e),this.va=Ut("forwardChannelRequestTimeoutMs",2e4,e),this.ma=e&&e.xmlHttpFactory||void 0,this.Ua=e&&e.Rb||void 0,this.Aa=e&&e.useFetchStreams||!1,this.O=void 0,this.L=e&&e.supportsCrossDomainXhr||!1,this.M="",this.h=new qe(e&&e.concurrentRequestLimit),this.Ba=new xt,this.S=e&&e.fastHandshake||!1,this.R=e&&e.encodeInitMessageHeaders||!1,this.S&&this.R&&(this.R=!1),this.Ra=e&&e.Pb||!1,e&&e.ua&&this.j.ua(),e&&e.forceLongPolling&&(this.X=!1),this.aa=!this.S&&this.X&&e&&e.detectBufferingProxy||!1,this.ia=void 0,e&&e.longPollingTimeout&&e.longPollingTimeout>0&&(this.ia=e.longPollingTimeout),this.ta=void 0,this.T=0,this.P=!1,this.ja=this.B=null}function Vt(e){if(Bt(e),3==e.I){var t=e.V++,n=Je(e.J);if(nt(n,"SID",e.M),nt(n,"RID",t),nt(n,"TYPE","terminate"),Gt(e,n),(t=new Se(e,e.j,t)).M=2,t.A=st(Je(n)),n=!1,i.navigator&&i.navigator.sendBeacon)try{n=i.navigator.sendBeacon(t.A.toString(),"")}catch(s){}!n&&i.Image&&((new Image).src=t.A,n=!0),n||(t.g=sn(t.j,null),t.g.ea(t.A)),t.F=Date.now(),Le(t)}tn(e)}function $t(e){e.g&&(Qt(e),e.g.cancel(),e.g=null)}function Bt(e){$t(e),e.v&&(i.clearTimeout(e.v),e.v=null),Xt(e),e.h.cancel(),e.m&&("number"==typeof e.m&&i.clearTimeout(e.m),e.m=null)}function qt(e){if(!ze(e.h)&&!e.m){e.m=!0;var t=e.Ea;v||x(),w||(v(),w=!0),b.add(t,e),e.D=0}}function zt(e,t){var n;n=t?t.l:e.V++;const s=Je(e.J);nt(s,"SID",e.M),nt(s,"RID",n),nt(s,"AID",e.K),Gt(e,s),e.u&&e.o&&St(s,e.u,e.o),n=new Se(e,e.j,n,e.D+1),null===e.u&&(n.J=e.o),t&&(e.i=t.G.concat(e.i)),t=Ht(e,n,1e3),n.H=Math.round(.5*e.va)+Math.round(.5*e.va*Math.random()),Ke(e.h,n),je(n,s,t)}function Gt(e,t){e.H&&j(e.H,function(e,n){nt(t,n,e)}),e.l&&j({},function(e,n){nt(t,n,e)})}function Ht(e,t,n){n=Math.min(e.i.length,n);const s=e.l?c(e.l.Ka,e.l,e):null;e:{var r=e.i;let t=-1;for(;;){const e=["count="+n];-1==t?n>0?(t=r[0].g,e.push("ofs="+t)):t=0:e.push("ofs="+t);let c=!0;for(let u=0;u<n;u++){var i=r[u].g;const n=r[u].map;if((i-=t)<0)t=Math.max(0,r[u].g-100),c=!1;else try{i="req"+i+"_"||"";try{var o=n instanceof Map?n:Object.entries(n);for(const[t,n]of o){let s=n;a(n)&&(s=se(n)),e.push(i+t+"="+encodeURIComponent(s))}}catch(l){throw e.push(i+"type="+encodeURIComponent("_badmap")),l}}catch(l){s&&s(n)}}if(c){o=e.join("&");break e}}o=void 0}return e=e.i.splice(0,n),t.G=e,o}function Kt(e){if(!e.g&&!e.v){e.Y=1;var t=e.Da;v||x(),w||(v(),w=!0),b.add(t,e),e.A=0}}function Wt(e){return!(e.g||e.v||e.A>=3)&&(e.Y++,e.v=we(c(e.Da,e),Zt(e,e.A)),e.A++,!0)}function Qt(e){null!=e.B&&(i.clearTimeout(e.B),e.B=null)}function Yt(e){e.g=new Se(e,e.j,"rpc",e.Y),null===e.u&&(e.g.J=e.o),e.g.P=0;var t=Je(e.na);nt(t,"RID","rpc"),nt(t,"SID",e.M),nt(t,"AID",e.K),nt(t,"CI",e.F?"0":"1"),!e.F&&e.ia&&nt(t,"TO",e.ia),nt(t,"TYPE","xmlhttp"),Gt(e,t),e.u&&e.o&&St(t,e.u,e.o),e.O&&(e.g.H=e.O);var n=e.g;e=e.ba,n.M=1,n.A=st(Je(t)),n.u=null,n.R=!0,De(n,e)}function Xt(e){null!=e.C&&(i.clearTimeout(e.C),e.C=null)}function Jt(e,t){var n=null;if(e.g==t){Xt(e),Qt(e),e.g=null;var s=2}else{if(!He(e.h,t))return;n=t.G,We(e.h,t),s=1}if(0!=e.I)if(t.o)if(1==s){n=t.u?t.u.length:0,t=Date.now()-t.F;var r=e.D;Y(s=pe(),new ve(s,n)),qt(e)}else Kt(e);else if(3==(r=t.m)||0==r&&t.X>0||!(1==s&&function(e,t){return!(Ge(e.h)>=e.h.j-(e.m?1:0)||(e.m?(e.i=t.G.concat(e.i),0):1==e.I||2==e.I||e.D>=(e.Sa?0:e.Ta)||(e.m=we(c(e.Ea,e,t),Zt(e,e.D)),e.D++,0)))}(e,t)||2==s&&Wt(e)))switch(n&&n.length>0&&(t=e.h,t.i=t.i.concat(n)),r){case 1:en(e,5);break;case 4:en(e,10);break;case 3:en(e,6);break;default:en(e,2)}}function Zt(e,t){let n=e.Qa+Math.floor(Math.random()*e.Za);return e.isActive()||(n*=2),n*t}function en(e,t){if(e.j.info("Error code "+t),2==t){var n=c(e.bb,e),s=e.Ua;const t=!s;s=new Xe(s||"//www.google.com/images/cleardot.gif"),i.location&&"http"==i.location.protocol||Ze(s,"https"),st(s),t?function(e,t){const n=new be;if(i.Image){const s=new Image;s.onload=l(bt,n,"TestLoadImage: loaded",!0,t,s),s.onerror=l(bt,n,"TestLoadImage: error",!1,t,s),s.onabort=l(bt,n,"TestLoadImage: abort",!1,t,s),s.ontimeout=l(bt,n,"TestLoadImage: timeout",!1,t,s),i.setTimeout(function(){s.ontimeout&&s.ontimeout()},1e4),s.src=e}else t(!1)}(s.toString(),n):function(e,t){new be;const n=new AbortController,s=setTimeout(()=>{n.abort(),bt(0,0,!1,t)},1e4);fetch(e,{signal:n.signal}).then(e=>{clearTimeout(s),e.ok?bt(0,0,!0,t):bt(0,0,!1,t)}).catch(()=>{clearTimeout(s),bt(0,0,!1,t)})}(s.toString(),n)}else ye(2);e.I=0,e.l&&e.l.pa(t),tn(e),Bt(e)}function tn(e){if(e.I=0,e.ja=[],e.l){const t=Qe(e.h);0==t.length&&0==e.i.length||(p(e.ja,t),p(e.ja,e.i),e.h.i.length=0,d(e.i),e.i.length=0),e.l.oa()}}function nn(e,t,n){var s=n instanceof Xe?Je(n):new Xe(n);if(""!=s.g)t&&(s.g=t+"."+s.g),et(s,s.u);else{var r=i.location;s=r.protocol,t=t?t+"."+r.hostname:r.hostname,r=+r.port;const e=new Xe(null);s&&Ze(e,s),t&&(e.g=t),r&&et(e,r),n&&(e.h=n),s=e}return n=e.G,t=e.wa,n&&t&&nt(s,n,t),nt(s,"VER",e.ka),Gt(e,s),s}function sn(e,t,n){if(t&&!e.L)throw Error("Can't create secondary domain capable XhrIo object.");return(t=e.Aa&&!e.ma?new kt(new _t({ab:n})):new kt(e.ma)).Fa(e.L),t}function rn(){}function an(){}function on(e,t){Q.call(this),this.g=new Ft(t),this.l=e,this.h=t&&t.messageUrlParams||null,e=t&&t.messageHeaders||null,t&&t.clientProtocolHeaderRequired&&(e?e["X-Client-Protocol"]="webchannel":e={"X-Client-Protocol":"webchannel"}),this.g.o=e,e=t&&t.initMessageHeaders||null,t&&t.messageContentType&&(e?e["X-WebChannel-Content-Type"]=t.messageContentType:e={"X-WebChannel-Content-Type":t.messageContentType}),t&&t.sa&&(e?e["X-WebChannel-Client-Profile"]=t.sa:e={"X-WebChannel-Client-Profile":t.sa}),this.g.U=e,(e=t&&t.Qb)&&!N(e)&&(this.g.u=e),this.A=t&&t.supportsCrossDomainXhr||!1,this.v=t&&t.sendRawJson||!1,(t=t&&t.httpSessionIdParam)&&!N(t)&&(this.g.G=t,null!==(e=this.h)&&t in e&&(t in(e=this.h)&&delete e[t])),this.j=new un(this)}function cn(e){le.call(this),e.__headers__&&(this.headers=e.__headers__,this.statusCode=e.__status__,delete e.__headers__,delete e.__status__);var t=e.__sm__;if(t){e:{for(const n in t){e=n;break e}e=void 0}(this.i=e)&&(e=this.i,t=null!==t&&e in t?t[e]:void 0),this.data=t}else this.data=e}function ln(){ue.call(this),this.status=1}function un(e){this.g=e}(e=kt.prototype).Fa=function(e){this.H=e},e.ea=function(e,t,n,s){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+e);t=t?t.toUpperCase():"GET",this.D=e,this.l="",this.o=0,this.A=!1,this.h=!0,this.g=this.L?this.L.g():_e.g(),this.g.onreadystatechange=h(c(this.Ca,this));try{this.B=!0,this.g.open(t,String(e),!0),this.B=!1}catch(a){return void jt(this,a)}if(e=n||"",n=new Map(this.headers),s)if(Object.getPrototypeOf(s)===Object.prototype)for(var r in s)n.set(r,s[r]);else{if("function"!=typeof s.keys||"function"!=typeof s.get)throw Error("Unknown input type for opt_headers: "+String(s));for(const e of s.keys())n.set(e,s.get(e))}s=Array.from(n.keys()).find(e=>"content-type"==e.toLowerCase()),r=i.FormData&&e instanceof i.FormData,!(Array.prototype.indexOf.call(Rt,t,void 0)>=0)||s||r||n.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[i,o]of n)this.g.setRequestHeader(i,o);this.F&&(this.g.responseType=this.F),"withCredentials"in this.g&&this.g.withCredentials!==this.H&&(this.g.withCredentials=this.H);try{this.m&&(clearTimeout(this.m),this.m=null),this.v=!0,this.g.send(e),this.v=!1}catch(a){jt(this,a)}},e.abort=function(e){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.o=e||7,Y(this,"complete"),Y(this,"abort"),Pt(this))},e.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),Pt(this,!0)),kt.Z.N.call(this)},e.Ca=function(){this.u||(this.B||this.v||this.j?Ot(this):this.Xa())},e.Xa=function(){Ot(this)},e.isActive=function(){return!!this.g},e.ca=function(){try{return Lt(this)>2?this.g.status:-1}catch(e){return-1}},e.la=function(){try{return this.g?this.g.responseText:""}catch(e){return""}},e.La=function(e){if(this.g){var t=this.g.responseText;return e&&0==t.indexOf(e)&&(t=t.substring(e.length)),re(t)}},e.ya=function(){return this.o},e.Ha=function(){return"string"==typeof this.l?this.l:String(this.l)},(e=Ft.prototype).ka=8,e.I=1,e.connect=function(e,t,n,s){ye(0),this.W=e,this.H=t||{},n&&void 0!==s&&(this.H.OSID=n,this.H.OAID=s),this.F=this.X,this.J=nn(this,null,this.W),qt(this)},e.Ea=function(e){if(this.m)if(this.m=null,1==this.I){if(!e){this.V=Math.floor(1e5*Math.random()),e=this.V++;const r=new Se(this,this.j,e);let i=this.o;if(this.U&&(i?(i=D(i),P(i,this.U)):i=this.U),null!==this.u||this.R||(r.J=i,i=null),this.S)e:{for(var t=0,n=0;n<this.i.length;n++){var s=this.i[n];if(void 0===(s="__data__"in s.map&&"string"==typeof(s=s.map.__data__)?s.length:void 0))break;if((t+=s)>4096){t=n;break e}if(4096===t||n===this.i.length-1){t=n+1;break e}}t=1e3}else t=1e3;t=Ht(this,r,t),nt(n=Je(this.J),"RID",e),nt(n,"CVER",22),this.G&&nt(n,"X-HTTP-Session-Id",this.G),Gt(this,n),i&&(this.R?t="headers="+Ne(Ct(i))+"&"+t:this.u&&St(n,this.u,i)),Ke(this.h,r),this.Ra&&nt(n,"TYPE","init"),this.S?(nt(n,"$req",t),nt(n,"SID","null"),r.U=!0,je(r,n,null)):je(r,n,t),this.I=2}}else 3==this.I&&(e?zt(this,e):0==this.i.length||ze(this.h)||zt(this))},e.Da=function(){if(this.v=null,Yt(this),this.aa&&!(this.P||null==this.g||this.T<=0)){var e=4*this.T;this.j.info("BP detection timer enabled: "+e),this.B=we(c(this.Wa,this),e)}},e.Wa=function(){this.B&&(this.B=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.P=!0,ye(10),$t(this),Yt(this))},e.Va=function(){null!=this.C&&(this.C=null,$t(this),Wt(this),ye(19))},e.bb=function(e){e?(this.j.info("Successfully pinged google.com"),ye(2)):(this.j.info("Failed to ping google.com"),ye(1))},e.isActive=function(){return!!this.l&&this.l.isActive(this)},(e=rn.prototype).ra=function(){},e.qa=function(){},e.pa=function(){},e.oa=function(){},e.isActive=function(){return!0},e.Ka=function(){},an.prototype.g=function(e,t){return new on(e,t)},u(on,Q),on.prototype.m=function(){this.g.l=this.j,this.A&&(this.g.L=!0),this.g.connect(this.l,this.h||void 0)},on.prototype.close=function(){Vt(this.g)},on.prototype.o=function(e){var t=this.g;if("string"==typeof e){var n={};n.__data__=e,e=n}else this.v&&((n={}).__data__=se(e),e=n);t.i.push(new Be(t.Ya++,e)),3==t.I&&qt(t)},on.prototype.N=function(){this.g.l=null,delete this.j,Vt(this.g),delete this.g,on.Z.N.call(this)},u(cn,le),u(ln,ue),u(un,rn),un.prototype.ra=function(){Y(this.g,"a")},un.prototype.qa=function(e){Y(this.g,new cn(e))},un.prototype.pa=function(e){Y(this.g,new ln)},un.prototype.oa=function(){Y(this.g,"b")},an.prototype.createWebChannel=an.prototype.g,on.prototype.send=on.prototype.o,on.prototype.open=on.prototype.m,on.prototype.close=on.prototype.close,rr=function(){return new an},sr=function(){return pe()},nr=he,tr={jb:0,mb:1,nb:2,Hb:3,Mb:4,Jb:5,Kb:6,Ib:7,Gb:8,Lb:9,PROXY:10,NOPROXY:11,Eb:12,Ab:13,Bb:14,zb:15,Cb:16,Db:17,fb:18,eb:19,gb:20},Ee.NO_ERROR=0,Ee.TIMEOUT=8,Ee.HTTP_ERROR=6,er=Ee,Te.COMPLETE="complete",Zs=Te,oe.EventType=ce,ce.OPEN="a",ce.CLOSE="b",ce.ERROR="c",ce.MESSAGE="d",Q.prototype.listen=Q.prototype.J,Js=oe,kt.prototype.listenOnce=kt.prototype.K,kt.prototype.getLastError=kt.prototype.Ha,kt.prototype.getLastErrorCode=kt.prototype.ya,kt.prototype.getStatus=kt.prototype.ca,kt.prototype.getResponseJson=kt.prototype.La,kt.prototype.getResponseText=kt.prototype.la,kt.prototype.send=kt.prototype.ea,kt.prototype.setWithCredentials=kt.prototype.Fa,Xs=kt}).apply(void 0!==ir?ir:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{});const ar="@firebase/firestore",or="4.9.2";class cr{constructor(e){this.uid=e}isAuthenticated(){return null!=this.uid}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}cr.UNAUTHENTICATED=new cr(null),cr.GOOGLE_CREDENTIALS=new cr("google-credentials-uid"),cr.FIRST_PARTY=new cr("first-party-uid"),cr.MOCK_USER=new cr("mock-user");let lr="12.3.0";const ur=new mt("@firebase/firestore");function hr(){return ur.logLevel}function dr(e,...t){if(ur.logLevel<=lt.DEBUG){const n=t.map(mr);ur.debug(`Firestore (${lr}): ${e}`,...n)}}function pr(e,...t){if(ur.logLevel<=lt.ERROR){const n=t.map(mr);ur.error(`Firestore (${lr}): ${e}`,...n)}}function fr(e,...t){if(ur.logLevel<=lt.WARN){const n=t.map(mr);ur.warn(`Firestore (${lr}): ${e}`,...n)}}function mr(e){if("string"==typeof e)return e;try{return t=e,JSON.stringify(t)}catch(n){return e}var t}function gr(e,t,n){let s="Unexpected state";"string"==typeof t?s=t:n=t,yr(e,s,n)}function yr(e,t,n){let s=`FIRESTORE (${lr}) INTERNAL ASSERTION FAILED: ${t} (ID: ${e.toString(16)})`;if(void 0!==n)try{s+=" CONTEXT: "+JSON.stringify(n)}catch(r){s+=" CONTEXT: "+n}throw pr(s),new Error(s)}function vr(e,t,n,s){let r="Unexpected state";"string"==typeof n?r=n:s=n,e||yr(t,r,s)}function wr(e,t){return e}const br={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class xr extends Ke{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}class _r{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}}class Er{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class Tr{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=>t(cr.UNAUTHENTICATED))}shutdown(){}}class Ir{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable(()=>t(this.token.user))}shutdown(){this.changeListener=null}}class Nr{constructor(e){this.t=e,this.currentUser=cr.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){vr(void 0===this.o,42304);let n=this.i;const s=e=>this.i!==n?(n=this.i,t(e)):Promise.resolve();let r=new _r;this.o=()=>{this.i++,this.currentUser=this.u(),r.resolve(),r=new _r,e.enqueueRetryable(()=>s(this.currentUser))};const i=()=>{const t=r;e.enqueueRetryable(async()=>{await t.promise,await s(this.currentUser)})},a=e=>{dr("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=e,this.o&&(this.auth.addAuthTokenListener(this.o),i())};this.t.onInit(e=>a(e)),setTimeout(()=>{if(!this.auth){const e=this.t.getImmediate({optional:!0});e?a(e):(dr("FirebaseAuthCredentialsProvider","Auth not yet detected"),r.resolve(),r=new _r)}},0),i()}getToken(){const e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(t=>this.i!==e?(dr("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):t?(vr("string"==typeof t.accessToken,31837,{l:t}),new Er(t.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){const e=this.auth&&this.auth.getUid();return vr(null===e||"string"==typeof e,2055,{h:e}),new cr(e)}}class Cr{constructor(e,t,n){this.P=e,this.T=t,this.I=n,this.type="FirstParty",this.user=cr.FIRST_PARTY,this.A=new Map}R(){return this.I?this.I():null}get headers(){this.A.set("X-Goog-AuthUser",this.P);const e=this.R();return e&&this.A.set("Authorization",e),this.T&&this.A.set("X-Goog-Iam-Authorization-Token",this.T),this.A}}class Sr{constructor(e,t,n){this.P=e,this.T=t,this.I=n}getToken(){return Promise.resolve(new Cr(this.P,this.T,this.I))}start(e,t){e.enqueueRetryable(()=>t(cr.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class kr{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class Ar{constructor(e,t){this.V=t,this.forceRefresh=!1,this.appCheck=null,this.m=null,this.p=null,vn(e)&&e.settings.appCheckToken&&(this.p=e.settings.appCheckToken)}start(e,t){vr(void 0===this.o,3512);const n=e=>{null!=e.error&&dr("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${e.error.message}`);const n=e.token!==this.m;return this.m=e.token,dr("FirebaseAppCheckTokenProvider",`Received ${n?"new":"existing"} token.`),n?t(e.token):Promise.resolve()};this.o=t=>{e.enqueueRetryable(()=>n(t))};const s=e=>{dr("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=e,this.o&&this.appCheck.addTokenListener(this.o)};this.V.onInit(e=>s(e)),setTimeout(()=>{if(!this.appCheck){const e=this.V.getImmediate({optional:!0});e?s(e):dr("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){if(this.p)return Promise.resolve(new kr(this.p));const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(e=>e?(vr("string"==typeof e.token,44558,{tokenResult:e}),this.m=e.token,new kr(e.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}function Rr(e){const t="undefined"!=typeof self&&(self.crypto||self.msCrypto),n=new Uint8Array(e);if(t&&"function"==typeof t.getRandomValues)t.getRandomValues(n);else for(let s=0;s<e;s++)n[s]=Math.floor(256*Math.random());return n}class jr{static newId(){const e=62*Math.floor(256/62);let t="";for(;t.length<20;){const n=Rr(40);for(let s=0;s<n.length;++s)t.length<20&&n[s]<e&&(t+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789".charAt(n[s]%62))}return t}}function Dr(e,t){return e<t?-1:e>t?1:0}function Or(e,t){const n=Math.min(e.length,t.length);for(let s=0;s<n;s++){const n=e.charAt(s),r=t.charAt(s);if(n!==r)return Mr(n)===Mr(r)?Dr(n,r):Mr(n)?1:-1}return Dr(e.length,t.length)}const Pr=55296,Lr=57343;function Mr(e){const t=e.charCodeAt(0);return t>=Pr&&t<=Lr}function Ur(e,t,n){return e.length===t.length&&e.every((e,s)=>n(e,t[s]))}const Fr="__name__";class Vr{constructor(e,t,n){void 0===t?t=0:t>e.length&&gr(637,{offset:t,range:e.length}),void 0===n?n=e.length-t:n>e.length-t&&gr(1746,{length:n,range:e.length-t}),this.segments=e,this.offset=t,this.len=n}get length(){return this.len}isEqual(e){return 0===Vr.comparator(this,e)}child(e){const t=this.segments.slice(this.offset,this.limit());return e instanceof Vr?e.forEach(e=>{t.push(e)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=void 0===e?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return 0===this.length}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,n=this.limit();t<n;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){const n=Math.min(e.length,t.length);for(let s=0;s<n;s++){const n=Vr.compareSegments(e.get(s),t.get(s));if(0!==n)return n}return Dr(e.length,t.length)}static compareSegments(e,t){const n=Vr.isNumericId(e),s=Vr.isNumericId(t);return n&&!s?-1:!n&&s?1:n&&s?Vr.extractNumericId(e).compare(Vr.extractNumericId(t)):Or(e,t)}static isNumericId(e){return e.startsWith("__id")&&e.endsWith("__")}static extractNumericId(e){return Ws.fromString(e.substring(4,e.length-2))}}class $r extends Vr{construct(e,t,n){return new $r(e,t,n)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){const t=[];for(const n of e){if(n.indexOf("//")>=0)throw new xr(br.INVALID_ARGUMENT,`Invalid segment (${n}). Paths must not contain // in them.`);t.push(...n.split("/").filter(e=>e.length>0))}return new $r(t)}static emptyPath(){return new $r([])}}const Br=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class qr extends Vr{construct(e,t,n){return new qr(e,t,n)}static isValidIdentifier(e){return Br.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),qr.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return 1===this.length&&this.get(0)===Fr}static keyField(){return new qr([Fr])}static fromServerFormat(e){const t=[];let n="",s=0;const r=()=>{if(0===n.length)throw new xr(br.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(n),n=""};let i=!1;for(;s<e.length;){const t=e[s];if("\\"===t){if(s+1===e.length)throw new xr(br.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const t=e[s+1];if("\\"!==t&&"."!==t&&"`"!==t)throw new xr(br.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);n+=t,s+=2}else"`"===t?(i=!i,s++):"."!==t||i?(n+=t,s++):(r(),s++)}if(r(),i)throw new xr(br.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new qr(t)}static emptyPath(){return new qr([])}}class zr{constructor(e){this.path=e}static fromPath(e){return new zr($r.fromString(e))}static fromName(e){return new zr($r.fromString(e).popFirst(5))}static empty(){return new zr($r.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return null!==e&&0===$r.comparator(this.path,e.path)}toString(){return this.path.toString()}static comparator(e,t){return $r.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new zr(new $r(e.slice()))}}function Gr(e,t,n){if(!n)throw new xr(br.INVALID_ARGUMENT,`Function ${e}() cannot be called with an empty ${t}.`)}function Hr(e){if(!zr.isDocumentKey(e))throw new xr(br.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${e} has ${e.length}.`)}function Kr(e){if(zr.isDocumentKey(e))throw new xr(br.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${e} has ${e.length}.`)}function Wr(e){return"object"==typeof e&&null!==e&&(Object.getPrototypeOf(e)===Object.prototype||null===Object.getPrototypeOf(e))}function Qr(e){if(void 0===e)return"undefined";if(null===e)return"null";if("string"==typeof e)return e.length>20&&(e=`${e.substring(0,20)}...`),JSON.stringify(e);if("number"==typeof e||"boolean"==typeof e)return""+e;if("object"==typeof e){if(e instanceof Array)return"an array";{const n=(t=e).constructor?t.constructor.name:null;return n?`a custom ${n} object`:"an object"}}var t;return"function"==typeof e?"a function":gr(12329,{type:typeof e})}function Yr(e,t){if("_delegate"in e&&(e=e._delegate),!(e instanceof t)){if(t.name===e.constructor.name)throw new xr(br.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const n=Qr(e);throw new xr(br.INVALID_ARGUMENT,`Expected type '${t.name}', but it was: ${n}`)}}return e}function Xr(e,t){const n={typeString:e};return t&&(n.value=t),n}function Jr(e,t){if(!Wr(e))throw new xr(br.INVALID_ARGUMENT,"JSON must be an object");let n;for(const s in t)if(t[s]){const r=t[s].typeString,i="value"in t[s]?{value:t[s].value}:void 0;if(!(s in e)){n=`JSON missing required field: '${s}'`;break}const a=e[s];if(r&&typeof a!==r){n=`JSON field '${s}' must be a ${r}.`;break}if(void 0!==i&&a!==i.value){n=`Expected '${s}' field to equal '${i.value}'`;break}}if(n)throw new xr(br.INVALID_ARGUMENT,n);return!0}const Zr=-62135596800,ei=1e6;class ti{static now(){return ti.fromMillis(Date.now())}static fromDate(e){return ti.fromMillis(e.getTime())}static fromMillis(e){const t=Math.floor(e/1e3),n=Math.floor((e-1e3*t)*ei);return new ti(t,n)}constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new xr(br.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new xr(br.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<Zr)throw new xr(br.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new xr(br.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/ei}_compareTo(e){return this.seconds===e.seconds?Dr(this.nanoseconds,e.nanoseconds):Dr(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{type:ti._jsonSchemaVersion,seconds:this.seconds,nanoseconds:this.nanoseconds}}static fromJSON(e){if(Jr(e,ti._jsonSchema))return new ti(e.seconds,e.nanoseconds)}valueOf(){const e=this.seconds-Zr;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}ti._jsonSchemaVersion="firestore/timestamp/1.0",ti._jsonSchema={type:Xr("string",ti._jsonSchemaVersion),seconds:Xr("number"),nanoseconds:Xr("number")};class ni{static fromTimestamp(e){return new ni(e)}static min(){return new ni(new ti(0,0))}static max(){return new ni(new ti(253402300799,999999999))}constructor(e){this.timestamp=e}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}function si(e){return new ri(e.readTime,e.key,-1)}class ri{constructor(e,t,n){this.readTime=e,this.documentKey=t,this.largestBatchId=n}static min(){return new ri(ni.min(),zr.empty(),-1)}static max(){return new ri(ni.max(),zr.empty(),-1)}}function ii(e,t){let n=e.readTime.compareTo(t.readTime);return 0!==n?n:(n=zr.comparator(e.documentKey,t.documentKey),0!==n?n:Dr(e.largestBatchId,t.largestBatchId))}class ai{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}}async function oi(e){if(e.code!==br.FAILED_PRECONDITION||"The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab."!==e.message)throw e;dr("LocalStore","Unexpectedly lost primary lease")}class ci{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(e=>{this.isDone=!0,this.result=e,this.nextCallback&&this.nextCallback(e)},e=>{this.isDone=!0,this.error=e,this.catchCallback&&this.catchCallback(e)})}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&gr(59440),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new ci((n,s)=>{this.nextCallback=t=>{this.wrapSuccess(e,t).next(n,s)},this.catchCallback=e=>{this.wrapFailure(t,e).next(n,s)}})}toPromise(){return new Promise((e,t)=>{this.next(e,t)})}wrapUserFunction(e){try{const t=e();return t instanceof ci?t:ci.resolve(t)}catch(t){return ci.reject(t)}}wrapSuccess(e,t){return e?this.wrapUserFunction(()=>e(t)):ci.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction(()=>e(t)):ci.reject(t)}static resolve(e){return new ci((t,n)=>{t(e)})}static reject(e){return new ci((t,n)=>{n(e)})}static waitFor(e){return new ci((t,n)=>{let s=0,r=0,i=!1;e.forEach(e=>{++s,e.next(()=>{++r,i&&r===s&&t()},e=>n(e))}),i=!0,r===s&&t()})}static or(e){let t=ci.resolve(!1);for(const n of e)t=t.next(e=>e?ci.resolve(e):n());return t}static forEach(e,t){const n=[];return e.forEach((e,s)=>{n.push(t.call(this,e,s))}),this.waitFor(n)}static mapArray(e,t){return new ci((n,s)=>{const r=e.length,i=new Array(r);let a=0;for(let o=0;o<r;o++){const c=o;t(e[c]).next(e=>{i[c]=e,++a,a===r&&n(i)},e=>s(e))}})}static doWhile(e,t){return new ci((n,s)=>{const r=()=>{!0===e()?t().next(()=>{r()},s):n()};r()})}}function li(e){return"IndexedDbTransactionError"===e.name}class ui{constructor(e,t){this.previousValue=e,t&&(t.sequenceNumberHandler=e=>this.ae(e),this.ue=e=>t.writeSequenceNumber(e))}ae(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){const e=++this.previousValue;return this.ue&&this.ue(e),e}}ui.ce=-1;function hi(e){return null==e}function di(e){return 0===e&&1/e==-1/0}function pi(e,t){let n=t;const s=e.length;for(let r=0;r<s;r++){const t=e.charAt(r);switch(t){case"\0":n+="";break;case"":n+="";break;default:n+=t}}return n}function fi(e){return e+""}function mi(e){let t=0;for(const n in e)Object.prototype.hasOwnProperty.call(e,n)&&t++;return t}function gi(e,t){for(const n in e)Object.prototype.hasOwnProperty.call(e,n)&&t(n,e[n])}function yi(e){for(const t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}class vi{constructor(e,t){this.comparator=e,this.root=t||bi.EMPTY}insert(e,t){return new vi(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,bi.BLACK,null,null))}remove(e){return new vi(this.comparator,this.root.remove(e,this.comparator).copy(null,null,bi.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){const n=this.comparator(e,t.key);if(0===n)return t.value;n<0?t=t.left:n>0&&(t=t.right)}return null}indexOf(e){let t=0,n=this.root;for(;!n.isEmpty();){const s=this.comparator(e,n.key);if(0===s)return t+n.left.size;s<0?n=n.left:(t+=n.left.size+1,n=n.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((t,n)=>(e(t,n),!1))}toString(){const e=[];return this.inorderTraversal((t,n)=>(e.push(`${t}:${n}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new wi(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new wi(this.root,e,this.comparator,!1)}getReverseIterator(){return new wi(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new wi(this.root,e,this.comparator,!0)}}class wi{constructor(e,t,n,s){this.isReverse=s,this.nodeStack=[];let r=1;for(;!e.isEmpty();)if(r=t?n(e.key,t):1,t&&s&&(r*=-1),r<0)e=this.isReverse?e.left:e.right;else{if(0===r){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(0===this.nodeStack.length)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class bi{constructor(e,t,n,s,r){this.key=e,this.value=t,this.color=null!=n?n:bi.RED,this.left=null!=s?s:bi.EMPTY,this.right=null!=r?r:bi.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,n,s,r){return new bi(null!=e?e:this.key,null!=t?t:this.value,null!=n?n:this.color,null!=s?s:this.left,null!=r?r:this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,n){let s=this;const r=n(e,s.key);return s=r<0?s.copy(null,null,null,s.left.insert(e,t,n),null):0===r?s.copy(null,t,null,null,null):s.copy(null,null,null,null,s.right.insert(e,t,n)),s.fixUp()}removeMin(){if(this.left.isEmpty())return bi.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let n,s=this;if(t(e,s.key)<0)s.left.isEmpty()||s.left.isRed()||s.left.left.isRed()||(s=s.moveRedLeft()),s=s.copy(null,null,null,s.left.remove(e,t),null);else{if(s.left.isRed()&&(s=s.rotateRight()),s.right.isEmpty()||s.right.isRed()||s.right.left.isRed()||(s=s.moveRedRight()),0===t(e,s.key)){if(s.right.isEmpty())return bi.EMPTY;n=s.right.min(),s=s.copy(n.key,n.value,null,null,s.right.removeMin())}s=s.copy(null,null,null,null,s.right.remove(e,t))}return s.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,bi.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,bi.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw gr(43730,{key:this.key,value:this.value});if(this.right.isRed())throw gr(14113,{key:this.key,value:this.value});const e=this.left.check();if(e!==this.right.check())throw gr(27949);return e+(this.isRed()?0:1)}}bi.EMPTY=null,bi.RED=!0,bi.BLACK=!1,bi.EMPTY=new class{constructor(){this.size=0}get key(){throw gr(57766)}get value(){throw gr(16141)}get color(){throw gr(16727)}get left(){throw gr(29726)}get right(){throw gr(36894)}copy(e,t,n,s,r){return this}insert(e,t,n){return new bi(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};class xi{constructor(e){this.comparator=e,this.data=new vi(this.comparator)}has(e){return null!==this.data.get(e)}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((t,n)=>(e(t),!1))}forEachInRange(e,t){const n=this.data.getIteratorFrom(e[0]);for(;n.hasNext();){const s=n.getNext();if(this.comparator(s.key,e[1])>=0)return;t(s.key)}}forEachWhile(e,t){let n;for(n=void 0!==t?this.data.getIteratorFrom(t):this.data.getIterator();n.hasNext();)if(!e(n.getNext().key))return}firstAfterOrEqual(e){const t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new _i(this.data.getIterator())}getIteratorFrom(e){return new _i(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach(e=>{t=t.add(e)}),t}isEqual(e){if(!(e instanceof xi))return!1;if(this.size!==e.size)return!1;const t=this.data.getIterator(),n=e.data.getIterator();for(;t.hasNext();){const e=t.getNext().key,s=n.getNext().key;if(0!==this.comparator(e,s))return!1}return!0}toArray(){const e=[];return this.forEach(t=>{e.push(t)}),e}toString(){const e=[];return this.forEach(t=>e.push(t)),"SortedSet("+e.toString()+")"}copy(e){const t=new xi(this.comparator);return t.data=e,t}}class _i{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}class Ei{constructor(e){this.fields=e,e.sort(qr.comparator)}static empty(){return new Ei([])}unionWith(e){let t=new xi(qr.comparator);for(const n of this.fields)t=t.add(n);for(const n of e)t=t.add(n);return new Ei(t.toArray())}covers(e){for(const t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return Ur(this.fields,e.fields,(e,t)=>e.isEqual(t))}}class Ti extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}class Ii{constructor(e){this.binaryString=e}static fromBase64String(e){const t=function(e){try{return atob(e)}catch(t){throw"undefined"!=typeof DOMException&&t instanceof DOMException?new Ti("Invalid base64 string: "+t):t}}(e);return new Ii(t)}static fromUint8Array(e){const t=function(e){let t="";for(let n=0;n<e.length;++n)t+=String.fromCharCode(e[n]);return t}(e);return new Ii(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return e=this.binaryString,btoa(e);var e}toUint8Array(){return function(e){const t=new Uint8Array(e.length);for(let n=0;n<e.length;n++)t[n]=e.charCodeAt(n);return t}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return Dr(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}Ii.EMPTY_BYTE_STRING=new Ii("");const Ni=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function Ci(e){if(vr(!!e,39018),"string"==typeof e){let t=0;const n=Ni.exec(e);if(vr(!!n,46558,{timestamp:e}),n[1]){let e=n[1];e=(e+"000000000").substr(0,9),t=Number(e)}const s=new Date(e);return{seconds:Math.floor(s.getTime()/1e3),nanos:t}}return{seconds:Si(e.seconds),nanos:Si(e.nanos)}}function Si(e){return"number"==typeof e?e:"string"==typeof e?Number(e):0}function ki(e){return"string"==typeof e?Ii.fromBase64String(e):Ii.fromUint8Array(e)}const Ai="server_timestamp",Ri="__type__",ji="__previous_value__",Di="__local_write_time__";function Oi(e){const t=(e?.mapValue?.fields||{})[Ri]?.stringValue;return t===Ai}function Pi(e){const t=e.mapValue.fields[ji];return Oi(t)?Pi(t):t}function Li(e){const t=Ci(e.mapValue.fields[Di].timestampValue);return new ti(t.seconds,t.nanos)}class Mi{constructor(e,t,n,s,r,i,a,o,c,l){this.databaseId=e,this.appId=t,this.persistenceKey=n,this.host=s,this.ssl=r,this.forceLongPolling=i,this.autoDetectLongPolling=a,this.longPollingOptions=o,this.useFetchStreams=c,this.isUsingEmulator=l}}const Ui="(default)";class Fi{constructor(e,t){this.projectId=e,this.database=t||Ui}static empty(){return new Fi("","")}get isDefaultDatabase(){return this.database===Ui}isEqual(e){return e instanceof Fi&&e.projectId===this.projectId&&e.database===this.database}}const Vi="__type__",$i="__max__",Bi={},qi="__vector__",zi="value";function Gi(e){return"nullValue"in e?0:"booleanValue"in e?1:"integerValue"in e||"doubleValue"in e?2:"timestampValue"in e?3:"stringValue"in e?5:"bytesValue"in e?6:"referenceValue"in e?7:"geoPointValue"in e?8:"arrayValue"in e?9:"mapValue"in e?Oi(e)?4:function(e){return(((e.mapValue||{}).fields||{}).__type__||{}).stringValue===$i}(e)?9007199254740991:function(e){const t=(e?.mapValue?.fields||{})[Vi]?.stringValue;return t===qi}(e)?10:11:gr(28295,{value:e})}function Hi(e,t){if(e===t)return!0;const n=Gi(e);if(n!==Gi(t))return!1;switch(n){case 0:case 9007199254740991:return!0;case 1:return e.booleanValue===t.booleanValue;case 4:return Li(e).isEqual(Li(t));case 3:return function(e,t){if("string"==typeof e.timestampValue&&"string"==typeof t.timestampValue&&e.timestampValue.length===t.timestampValue.length)return e.timestampValue===t.timestampValue;const n=Ci(e.timestampValue),s=Ci(t.timestampValue);return n.seconds===s.seconds&&n.nanos===s.nanos}(e,t);case 5:return e.stringValue===t.stringValue;case 6:return s=t,ki(e.bytesValue).isEqual(ki(s.bytesValue));case 7:return e.referenceValue===t.referenceValue;case 8:return function(e,t){return Si(e.geoPointValue.latitude)===Si(t.geoPointValue.latitude)&&Si(e.geoPointValue.longitude)===Si(t.geoPointValue.longitude)}(e,t);case 2:return function(e,t){if("integerValue"in e&&"integerValue"in t)return Si(e.integerValue)===Si(t.integerValue);if("doubleValue"in e&&"doubleValue"in t){const n=Si(e.doubleValue),s=Si(t.doubleValue);return n===s?di(n)===di(s):isNaN(n)&&isNaN(s)}return!1}(e,t);case 9:return Ur(e.arrayValue.values||[],t.arrayValue.values||[],Hi);case 10:case 11:return function(e,t){const n=e.mapValue.fields||{},s=t.mapValue.fields||{};if(mi(n)!==mi(s))return!1;for(const r in n)if(n.hasOwnProperty(r)&&(void 0===s[r]||!Hi(n[r],s[r])))return!1;return!0}(e,t);default:return gr(52216,{left:e})}var s}function Ki(e,t){return void 0!==(e.values||[]).find(e=>Hi(e,t))}function Wi(e,t){if(e===t)return 0;const n=Gi(e),s=Gi(t);if(n!==s)return Dr(n,s);switch(n){case 0:case 9007199254740991:return 0;case 1:return Dr(e.booleanValue,t.booleanValue);case 2:return function(e,t){const n=Si(e.integerValue||e.doubleValue),s=Si(t.integerValue||t.doubleValue);return n<s?-1:n>s?1:n===s?0:isNaN(n)?isNaN(s)?0:-1:1}(e,t);case 3:return Qi(e.timestampValue,t.timestampValue);case 4:return Qi(Li(e),Li(t));case 5:return Or(e.stringValue,t.stringValue);case 6:return function(e,t){const n=ki(e),s=ki(t);return n.compareTo(s)}(e.bytesValue,t.bytesValue);case 7:return function(e,t){const n=e.split("/"),s=t.split("/");for(let r=0;r<n.length&&r<s.length;r++){const e=Dr(n[r],s[r]);if(0!==e)return e}return Dr(n.length,s.length)}(e.referenceValue,t.referenceValue);case 8:return function(e,t){const n=Dr(Si(e.latitude),Si(t.latitude));return 0!==n?n:Dr(Si(e.longitude),Si(t.longitude))}(e.geoPointValue,t.geoPointValue);case 9:return Yi(e.arrayValue,t.arrayValue);case 10:return function(e,t){const n=e.fields||{},s=t.fields||{},r=n[zi]?.arrayValue,i=s[zi]?.arrayValue,a=Dr(r?.values?.length||0,i?.values?.length||0);return 0!==a?a:Yi(r,i)}(e.mapValue,t.mapValue);case 11:return function(e,t){if(e===Bi&&t===Bi)return 0;if(e===Bi)return 1;if(t===Bi)return-1;const n=e.fields||{},s=Object.keys(n),r=t.fields||{},i=Object.keys(r);s.sort(),i.sort();for(let a=0;a<s.length&&a<i.length;++a){const e=Or(s[a],i[a]);if(0!==e)return e;const t=Wi(n[s[a]],r[i[a]]);if(0!==t)return t}return Dr(s.length,i.length)}(e.mapValue,t.mapValue);default:throw gr(23264,{he:n})}}function Qi(e,t){if("string"==typeof e&&"string"==typeof t&&e.length===t.length)return Dr(e,t);const n=Ci(e),s=Ci(t),r=Dr(n.seconds,s.seconds);return 0!==r?r:Dr(n.nanos,s.nanos)}function Yi(e,t){const n=e.values||[],s=t.values||[];for(let r=0;r<n.length&&r<s.length;++r){const e=Wi(n[r],s[r]);if(e)return e}return Dr(n.length,s.length)}function Xi(e){return Ji(e)}function Ji(e){return"nullValue"in e?"null":"booleanValue"in e?""+e.booleanValue:"integerValue"in e?""+e.integerValue:"doubleValue"in e?""+e.doubleValue:"timestampValue"in e?function(e){const t=Ci(e);return`time(${t.seconds},${t.nanos})`}(e.timestampValue):"stringValue"in e?e.stringValue:"bytesValue"in e?ki(e.bytesValue).toBase64():"referenceValue"in e?function(e){return zr.fromName(e).toString()}(e.referenceValue):"geoPointValue"in e?function(e){return`geo(${e.latitude},${e.longitude})`}(e.geoPointValue):"arrayValue"in e?function(e){let t="[",n=!0;for(const s of e.values||[])n?n=!1:t+=",",t+=Ji(s);return t+"]"}(e.arrayValue):"mapValue"in e?function(e){const t=Object.keys(e.fields||{}).sort();let n="{",s=!0;for(const r of t)s?s=!1:n+=",",n+=`${r}:${Ji(e.fields[r])}`;return n+"}"}(e.mapValue):gr(61005,{value:e})}function Zi(e){switch(Gi(e)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:const t=Pi(e);return t?16+Zi(t):16;case 5:return 2*e.stringValue.length;case 6:return ki(e.bytesValue).approximateByteSize();case 7:return e.referenceValue.length;case 9:return(e.arrayValue.values||[]).reduce((e,t)=>e+Zi(t),0);case 10:case 11:return function(e){let t=0;return gi(e.fields,(e,n)=>{t+=e.length+Zi(n)}),t}(e.mapValue);default:throw gr(13486,{value:e})}}function ea(e,t){return{referenceValue:`projects/${e.projectId}/databases/${e.database}/documents/${t.path.canonicalString()}`}}function ta(e){return!!e&&"integerValue"in e}function na(e){return!!e&&"arrayValue"in e}function sa(e){return!!e&&"nullValue"in e}function ra(e){return!!e&&"doubleValue"in e&&isNaN(Number(e.doubleValue))}function ia(e){return!!e&&"mapValue"in e}function aa(e){if(e.geoPointValue)return{geoPointValue:{...e.geoPointValue}};if(e.timestampValue&&"object"==typeof e.timestampValue)return{timestampValue:{...e.timestampValue}};if(e.mapValue){const t={mapValue:{fields:{}}};return gi(e.mapValue.fields,(e,n)=>t.mapValue.fields[e]=aa(n)),t}if(e.arrayValue){const t={arrayValue:{values:[]}};for(let n=0;n<(e.arrayValue.values||[]).length;++n)t.arrayValue.values[n]=aa(e.arrayValue.values[n]);return t}return{...e}}class oa{constructor(e){this.value=e}static empty(){return new oa({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let n=0;n<e.length-1;++n)if(t=(t.mapValue.fields||{})[e.get(n)],!ia(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=aa(t)}setAll(e){let t=qr.emptyPath(),n={},s=[];e.forEach((e,r)=>{if(!t.isImmediateParentOf(r)){const e=this.getFieldsMap(t);this.applyChanges(e,n,s),n={},s=[],t=r.popLast()}e?n[r.lastSegment()]=aa(e):s.push(r.lastSegment())});const r=this.getFieldsMap(t);this.applyChanges(r,n,s)}delete(e){const t=this.field(e.popLast());ia(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return Hi(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let n=0;n<e.length;++n){let s=t.mapValue.fields[e.get(n)];ia(s)&&s.mapValue.fields||(s={mapValue:{fields:{}}},t.mapValue.fields[e.get(n)]=s),t=s}return t.mapValue.fields}applyChanges(e,t,n){gi(t,(t,n)=>e[t]=n);for(const s of n)delete e[s]}clone(){return new oa(aa(this.value))}}function ca(e){const t=[];return gi(e.fields,(e,n)=>{const s=new qr([e]);if(ia(n)){const e=ca(n.mapValue).fields;if(0===e.length)t.push(s);else for(const n of e)t.push(s.child(n))}else t.push(s)}),new Ei(t)}class la{constructor(e,t,n,s,r,i,a){this.key=e,this.documentType=t,this.version=n,this.readTime=s,this.createTime=r,this.data=i,this.documentState=a}static newInvalidDocument(e){return new la(e,0,ni.min(),ni.min(),ni.min(),oa.empty(),0)}static newFoundDocument(e,t,n,s){return new la(e,1,t,ni.min(),n,s,0)}static newNoDocument(e,t){return new la(e,2,t,ni.min(),ni.min(),oa.empty(),0)}static newUnknownDocument(e,t){return new la(e,3,t,ni.min(),ni.min(),oa.empty(),2)}convertToFoundDocument(e,t){return!this.createTime.isEqual(ni.min())||2!==this.documentType&&0!==this.documentType||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=oa.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=oa.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=ni.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return 1===this.documentState}get hasCommittedMutations(){return 2===this.documentState}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return 0!==this.documentType}isFoundDocument(){return 1===this.documentType}isNoDocument(){return 2===this.documentType}isUnknownDocument(){return 3===this.documentType}isEqual(e){return e instanceof la&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new la(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}class ua{constructor(e,t){this.position=e,this.inclusive=t}}function ha(e,t,n){let s=0;for(let r=0;r<e.position.length;r++){const i=t[r],a=e.position[r];if(s=i.field.isKeyField()?zr.comparator(zr.fromName(a.referenceValue),n.key):Wi(a,n.data.field(i.field)),"desc"===i.dir&&(s*=-1),0!==s)break}return s}function da(e,t){if(null===e)return null===t;if(null===t)return!1;if(e.inclusive!==t.inclusive||e.position.length!==t.position.length)return!1;for(let n=0;n<e.position.length;n++)if(!Hi(e.position[n],t.position[n]))return!1;return!0}class pa{constructor(e,t="asc"){this.field=e,this.dir=t}}function fa(e,t){return e.dir===t.dir&&e.field.isEqual(t.field)}class ma{}class ga extends ma{constructor(e,t,n){super(),this.field=e,this.op=t,this.value=n}static create(e,t,n){return e.isKeyField()?"in"===t||"not-in"===t?this.createKeyFieldInFilter(e,t,n):new Ea(e,t,n):"array-contains"===t?new Ca(e,n):"in"===t?new Sa(e,n):"not-in"===t?new ka(e,n):"array-contains-any"===t?new Aa(e,n):new ga(e,t,n)}static createKeyFieldInFilter(e,t,n){return"in"===t?new Ta(e,n):new Ia(e,n)}matches(e){const t=e.data.field(this.field);return"!="===this.op?null!==t&&void 0===t.nullValue&&this.matchesComparison(Wi(t,this.value)):null!==t&&Gi(this.value)===Gi(t)&&this.matchesComparison(Wi(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return 0===e;case"!=":return 0!==e;case">":return e>0;case">=":return e>=0;default:return gr(47266,{operator:this.op})}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class ya extends ma{constructor(e,t){super(),this.filters=e,this.op=t,this.Pe=null}static create(e,t){return new ya(e,t)}matches(e){return va(this)?void 0===this.filters.find(t=>!t.matches(e)):void 0!==this.filters.find(t=>t.matches(e))}getFlattenedFilters(){return null!==this.Pe||(this.Pe=this.filters.reduce((e,t)=>e.concat(t.getFlattenedFilters()),[])),this.Pe}getFilters(){return Object.assign([],this.filters)}}function va(e){return"and"===e.op}function wa(e){return function(e){for(const t of e.filters)if(t instanceof ya)return!1;return!0}(e)&&va(e)}function ba(e){if(e instanceof ga)return e.field.canonicalString()+e.op.toString()+Xi(e.value);if(wa(e))return e.filters.map(e=>ba(e)).join(",");{const t=e.filters.map(e=>ba(e)).join(",");return`${e.op}(${t})`}}function xa(e,t){return e instanceof ga?(n=e,(s=t)instanceof ga&&n.op===s.op&&n.field.isEqual(s.field)&&Hi(n.value,s.value)):e instanceof ya?function(e,t){return t instanceof ya&&e.op===t.op&&e.filters.length===t.filters.length&&e.filters.reduce((e,n,s)=>e&&xa(n,t.filters[s]),!0)}(e,t):void gr(19439);var n,s}function _a(e){return e instanceof ga?`${(t=e).field.canonicalString()} ${t.op} ${Xi(t.value)}`:e instanceof ya?function(e){return e.op.toString()+" {"+e.getFilters().map(_a).join(" ,")+"}"}(e):"Filter";var t}class Ea extends ga{constructor(e,t,n){super(e,t,n),this.key=zr.fromName(n.referenceValue)}matches(e){const t=zr.comparator(e.key,this.key);return this.matchesComparison(t)}}class Ta extends ga{constructor(e,t){super(e,"in",t),this.keys=Na("in",t)}matches(e){return this.keys.some(t=>t.isEqual(e.key))}}class Ia extends ga{constructor(e,t){super(e,"not-in",t),this.keys=Na("not-in",t)}matches(e){return!this.keys.some(t=>t.isEqual(e.key))}}function Na(e,t){return(t.arrayValue?.values||[]).map(e=>zr.fromName(e.referenceValue))}class Ca extends ga{constructor(e,t){super(e,"array-contains",t)}matches(e){const t=e.data.field(this.field);return na(t)&&Ki(t.arrayValue,this.value)}}class Sa extends ga{constructor(e,t){super(e,"in",t)}matches(e){const t=e.data.field(this.field);return null!==t&&Ki(this.value.arrayValue,t)}}class ka extends ga{constructor(e,t){super(e,"not-in",t)}matches(e){if(Ki(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const t=e.data.field(this.field);return null!==t&&void 0===t.nullValue&&!Ki(this.value.arrayValue,t)}}class Aa extends ga{constructor(e,t){super(e,"array-contains-any",t)}matches(e){const t=e.data.field(this.field);return!(!na(t)||!t.arrayValue.values)&&t.arrayValue.values.some(e=>Ki(this.value.arrayValue,e))}}class Ra{constructor(e,t=null,n=[],s=[],r=null,i=null,a=null){this.path=e,this.collectionGroup=t,this.orderBy=n,this.filters=s,this.limit=r,this.startAt=i,this.endAt=a,this.Te=null}}function ja(e,t=null,n=[],s=[],r=null,i=null,a=null){return new Ra(e,t,n,s,r,i,a)}function Da(e){const t=wr(e);if(null===t.Te){let e=t.path.canonicalString();null!==t.collectionGroup&&(e+="|cg:"+t.collectionGroup),e+="|f:",e+=t.filters.map(e=>ba(e)).join(","),e+="|ob:",e+=t.orderBy.map(e=>{return(t=e).field.canonicalString()+t.dir;var t}).join(","),hi(t.limit)||(e+="|l:",e+=t.limit),t.startAt&&(e+="|lb:",e+=t.startAt.inclusive?"b:":"a:",e+=t.startAt.position.map(e=>Xi(e)).join(",")),t.endAt&&(e+="|ub:",e+=t.endAt.inclusive?"a:":"b:",e+=t.endAt.position.map(e=>Xi(e)).join(",")),t.Te=e}return t.Te}function Oa(e,t){if(e.limit!==t.limit)return!1;if(e.orderBy.length!==t.orderBy.length)return!1;for(let n=0;n<e.orderBy.length;n++)if(!fa(e.orderBy[n],t.orderBy[n]))return!1;if(e.filters.length!==t.filters.length)return!1;for(let n=0;n<e.filters.length;n++)if(!xa(e.filters[n],t.filters[n]))return!1;return e.collectionGroup===t.collectionGroup&&!!e.path.isEqual(t.path)&&!!da(e.startAt,t.startAt)&&da(e.endAt,t.endAt)}function Pa(e){return zr.isDocumentKey(e.path)&&null===e.collectionGroup&&0===e.filters.length}class La{constructor(e,t=null,n=[],s=[],r=null,i="F",a=null,o=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=n,this.filters=s,this.limit=r,this.limitType=i,this.startAt=a,this.endAt=o,this.Ie=null,this.Ee=null,this.de=null,this.startAt,this.endAt}}function Ma(e){return new La(e)}function Ua(e){return 0===e.filters.length&&null===e.limit&&null==e.startAt&&null==e.endAt&&(0===e.explicitOrderBy.length||1===e.explicitOrderBy.length&&e.explicitOrderBy[0].field.isKeyField())}function Fa(e){return null!==e.collectionGroup}function Va(e){const t=wr(e);if(null===t.Ie){t.Ie=[];const e=new Set;for(const s of t.explicitOrderBy)t.Ie.push(s),e.add(s.field.canonicalString());const n=t.explicitOrderBy.length>0?t.explicitOrderBy[t.explicitOrderBy.length-1].dir:"asc";(function(e){let t=new xi(qr.comparator);return e.filters.forEach(e=>{e.getFlattenedFilters().forEach(e=>{e.isInequality()&&(t=t.add(e.field))})}),t})(t).forEach(s=>{e.has(s.canonicalString())||s.isKeyField()||t.Ie.push(new pa(s,n))}),e.has(qr.keyField().canonicalString())||t.Ie.push(new pa(qr.keyField(),n))}return t.Ie}function $a(e){const t=wr(e);return t.Ee||(t.Ee=function(e,t){if("F"===e.limitType)return ja(e.path,e.collectionGroup,t,e.filters,e.limit,e.startAt,e.endAt);{t=t.map(e=>{const t="desc"===e.dir?"asc":"desc";return new pa(e.field,t)});const n=e.endAt?new ua(e.endAt.position,e.endAt.inclusive):null,s=e.startAt?new ua(e.startAt.position,e.startAt.inclusive):null;return ja(e.path,e.collectionGroup,t,e.filters,e.limit,n,s)}}(t,Va(e))),t.Ee}function Ba(e,t){const n=e.filters.concat([t]);return new La(e.path,e.collectionGroup,e.explicitOrderBy.slice(),n,e.limit,e.limitType,e.startAt,e.endAt)}function qa(e,t,n){return new La(e.path,e.collectionGroup,e.explicitOrderBy.slice(),e.filters.slice(),t,n,e.startAt,e.endAt)}function za(e,t){return Oa($a(e),$a(t))&&e.limitType===t.limitType}function Ga(e){return`${Da($a(e))}|lt:${e.limitType}`}function Ha(e){return`Query(target=${function(e){let t=e.path.canonicalString();return null!==e.collectionGroup&&(t+=" collectionGroup="+e.collectionGroup),e.filters.length>0&&(t+=`, filters: [${e.filters.map(e=>_a(e)).join(", ")}]`),hi(e.limit)||(t+=", limit: "+e.limit),e.orderBy.length>0&&(t+=`, orderBy: [${e.orderBy.map(e=>{return`${(t=e).field.canonicalString()} (${t.dir})`;var t}).join(", ")}]`),e.startAt&&(t+=", startAt: ",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map(e=>Xi(e)).join(",")),e.endAt&&(t+=", endAt: ",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map(e=>Xi(e)).join(",")),`Target(${t})`}($a(e))}; limitType=${e.limitType})`}function Ka(e,t){return t.isFoundDocument()&&function(e,t){const n=t.key.path;return null!==e.collectionGroup?t.key.hasCollectionId(e.collectionGroup)&&e.path.isPrefixOf(n):zr.isDocumentKey(e.path)?e.path.isEqual(n):e.path.isImmediateParentOf(n)}(e,t)&&function(e,t){for(const n of Va(e))if(!n.field.isKeyField()&&null===t.data.field(n.field))return!1;return!0}(e,t)&&function(e,t){for(const n of e.filters)if(!n.matches(t))return!1;return!0}(e,t)&&(s=t,!((n=e).startAt&&!function(e,t,n){const s=ha(e,t,n);return e.inclusive?s<=0:s<0}(n.startAt,Va(n),s)||n.endAt&&!function(e,t,n){const s=ha(e,t,n);return e.inclusive?s>=0:s>0}(n.endAt,Va(n),s)));var n,s}function Wa(e){return(t,n)=>{let s=!1;for(const r of Va(e)){const e=Qa(r,t,n);if(0!==e)return e;s=s||r.field.isKeyField()}return 0}}function Qa(e,t,n){const s=e.field.isKeyField()?zr.comparator(t.key,n.key):function(e,t,n){const s=t.data.field(e),r=n.data.field(e);return null!==s&&null!==r?Wi(s,r):gr(42886)}(e.field,t,n);switch(e.dir){case"asc":return s;case"desc":return-1*s;default:return gr(19790,{direction:e.dir})}}class Ya{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){const t=this.mapKeyFn(e),n=this.inner[t];if(void 0!==n)for(const[s,r]of n)if(this.equalsFn(s,e))return r}has(e){return void 0!==this.get(e)}set(e,t){const n=this.mapKeyFn(e),s=this.inner[n];if(void 0===s)return this.inner[n]=[[e,t]],void this.innerSize++;for(let r=0;r<s.length;r++)if(this.equalsFn(s[r][0],e))return void(s[r]=[e,t]);s.push([e,t]),this.innerSize++}delete(e){const t=this.mapKeyFn(e),n=this.inner[t];if(void 0===n)return!1;for(let s=0;s<n.length;s++)if(this.equalsFn(n[s][0],e))return 1===n.length?delete this.inner[t]:n.splice(s,1),this.innerSize--,!0;return!1}forEach(e){gi(this.inner,(t,n)=>{for(const[s,r]of n)e(s,r)})}isEmpty(){return yi(this.inner)}size(){return this.innerSize}}const Xa=new vi(zr.comparator);function Ja(){return Xa}const Za=new vi(zr.comparator);function eo(...e){let t=Za;for(const n of e)t=t.insert(n.key,n);return t}function to(e){let t=Za;return e.forEach((e,n)=>t=t.insert(e,n.overlayedDocument)),t}function no(){return ro()}function so(){return ro()}function ro(){return new Ya(e=>e.toString(),(e,t)=>e.isEqual(t))}const io=new vi(zr.comparator),ao=new xi(zr.comparator);function oo(...e){let t=ao;for(const n of e)t=t.add(n);return t}const co=new xi(Dr);function lo(e,t){if(e.useProto3Json){if(isNaN(t))return{doubleValue:"NaN"};if(t===1/0)return{doubleValue:"Infinity"};if(t===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:di(t)?"-0":t}}function uo(e){return{integerValue:""+e}}function ho(e,t){return function(e){return"number"==typeof e&&Number.isInteger(e)&&!di(e)&&e<=Number.MAX_SAFE_INTEGER&&e>=Number.MIN_SAFE_INTEGER}(t)?uo(t):lo(e,t)}class po{constructor(){this._=void 0}}function fo(e,t,n){return e instanceof yo?function(e,t){const n={fields:{[Ri]:{stringValue:Ai},[Di]:{timestampValue:{seconds:e.seconds,nanos:e.nanoseconds}}}};return t&&Oi(t)&&(t=Pi(t)),t&&(n.fields[ji]=t),{mapValue:n}}(n,t):e instanceof vo?wo(e,t):e instanceof bo?xo(e,t):function(e,t){const n=go(e,t),s=Eo(n)+Eo(e.Ae);return ta(n)&&ta(e.Ae)?uo(s):lo(e.serializer,s)}(e,t)}function mo(e,t,n){return e instanceof vo?wo(e,t):e instanceof bo?xo(e,t):n}function go(e,t){return e instanceof _o?ta(n=t)||(s=n)&&"doubleValue"in s?t:{integerValue:0}:null;var n,s}class yo extends po{}class vo extends po{constructor(e){super(),this.elements=e}}function wo(e,t){const n=To(t);for(const s of e.elements)n.some(e=>Hi(e,s))||n.push(s);return{arrayValue:{values:n}}}class bo extends po{constructor(e){super(),this.elements=e}}function xo(e,t){let n=To(t);for(const s of e.elements)n=n.filter(e=>!Hi(e,s));return{arrayValue:{values:n}}}class _o extends po{constructor(e,t){super(),this.serializer=e,this.Ae=t}}function Eo(e){return Si(e.integerValue||e.doubleValue)}function To(e){return na(e)&&e.arrayValue.values?e.arrayValue.values.slice():[]}class Io{constructor(e,t){this.version=e,this.transformResults=t}}class No{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new No}static exists(e){return new No(void 0,e)}static updateTime(e){return new No(e)}get isNone(){return void 0===this.updateTime&&void 0===this.exists}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function Co(e,t){return void 0!==e.updateTime?t.isFoundDocument()&&t.version.isEqual(e.updateTime):void 0===e.exists||e.exists===t.isFoundDocument()}class So{}function ko(e,t){if(!e.hasLocalMutations||t&&0===t.fields.length)return null;if(null===t)return e.isNoDocument()?new Fo(e.key,No.none()):new Oo(e.key,e.data,No.none());{const n=e.data,s=oa.empty();let r=new xi(qr.comparator);for(let e of t.fields)if(!r.has(e)){let t=n.field(e);null===t&&e.length>1&&(e=e.popLast(),t=n.field(e)),null===t?s.delete(e):s.set(e,t),r=r.add(e)}return new Po(e.key,s,new Ei(r.toArray()),No.none())}}function Ao(e,t,n){var s;e instanceof Oo?function(e,t,n){const s=e.value.clone(),r=Mo(e.fieldTransforms,t,n.transformResults);s.setAll(r),t.convertToFoundDocument(n.version,s).setHasCommittedMutations()}(e,t,n):e instanceof Po?function(e,t,n){if(!Co(e.precondition,t))return void t.convertToUnknownDocument(n.version);const s=Mo(e.fieldTransforms,t,n.transformResults),r=t.data;r.setAll(Lo(e)),r.setAll(s),t.convertToFoundDocument(n.version,r).setHasCommittedMutations()}(e,t,n):(s=n,t.convertToNoDocument(s.version).setHasCommittedMutations())}function Ro(e,t,n,s){return e instanceof Oo?function(e,t,n,s){if(!Co(e.precondition,t))return n;const r=e.value.clone(),i=Uo(e.fieldTransforms,s,t);return r.setAll(i),t.convertToFoundDocument(t.version,r).setHasLocalMutations(),null}(e,t,n,s):e instanceof Po?function(e,t,n,s){if(!Co(e.precondition,t))return n;const r=Uo(e.fieldTransforms,s,t),i=t.data;return i.setAll(Lo(e)),i.setAll(r),t.convertToFoundDocument(t.version,i).setHasLocalMutations(),null===n?null:n.unionWith(e.fieldMask.fields).unionWith(e.fieldTransforms.map(e=>e.field))}(e,t,n,s):(r=t,i=n,Co(e.precondition,r)?(r.convertToNoDocument(r.version).setHasLocalMutations(),null):i);var r,i}function jo(e,t){let n=null;for(const s of e.fieldTransforms){const e=t.data.field(s.field),r=go(s.transform,e||null);null!=r&&(null===n&&(n=oa.empty()),n.set(s.field,r))}return n||null}function Do(e,t){return e.type===t.type&&!!e.key.isEqual(t.key)&&!!e.precondition.isEqual(t.precondition)&&(n=e.fieldTransforms,s=t.fieldTransforms,!!(void 0===n&&void 0===s||n&&s&&Ur(n,s,(e,t)=>function(e,t){return e.field.isEqual(t.field)&&(n=e.transform,s=t.transform,n instanceof vo&&s instanceof vo||n instanceof bo&&s instanceof bo?Ur(n.elements,s.elements,Hi):n instanceof _o&&s instanceof _o?Hi(n.Ae,s.Ae):n instanceof yo&&s instanceof yo);var n,s}(e,t)))&&(0===e.type?e.value.isEqual(t.value):1!==e.type||e.data.isEqual(t.data)&&e.fieldMask.isEqual(t.fieldMask)));var n,s}class Oo extends So{constructor(e,t,n,s=[]){super(),this.key=e,this.value=t,this.precondition=n,this.fieldTransforms=s,this.type=0}getFieldMask(){return null}}class Po extends So{constructor(e,t,n,s,r=[]){super(),this.key=e,this.data=t,this.fieldMask=n,this.precondition=s,this.fieldTransforms=r,this.type=1}getFieldMask(){return this.fieldMask}}function Lo(e){const t=new Map;return e.fieldMask.fields.forEach(n=>{if(!n.isEmpty()){const s=e.data.field(n);t.set(n,s)}}),t}function Mo(e,t,n){const s=new Map;vr(e.length===n.length,32656,{Re:n.length,Ve:e.length});for(let r=0;r<n.length;r++){const i=e[r],a=i.transform,o=t.data.field(i.field);s.set(i.field,mo(a,o,n[r]))}return s}function Uo(e,t,n){const s=new Map;for(const r of e){const e=r.transform,i=n.data.field(r.field);s.set(r.field,fo(e,i,t))}return s}class Fo extends So{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class Vo extends So{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}class $o{constructor(e,t,n,s){this.batchId=e,this.localWriteTime=t,this.baseMutations=n,this.mutations=s}applyToRemoteDocument(e,t){const n=t.mutationResults;for(let s=0;s<this.mutations.length;s++){const t=this.mutations[s];t.key.isEqual(e.key)&&Ao(t,e,n[s])}}applyToLocalView(e,t){for(const n of this.baseMutations)n.key.isEqual(e.key)&&(t=Ro(n,e,t,this.localWriteTime));for(const n of this.mutations)n.key.isEqual(e.key)&&(t=Ro(n,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){const n=so();return this.mutations.forEach(s=>{const r=e.get(s.key),i=r.overlayedDocument;let a=this.applyToLocalView(i,r.mutatedFields);a=t.has(s.key)?null:a;const o=ko(i,a);null!==o&&n.set(s.key,o),i.isValidDocument()||i.convertToNoDocument(ni.min())}),n}keys(){return this.mutations.reduce((e,t)=>e.add(t.key),oo())}isEqual(e){return this.batchId===e.batchId&&Ur(this.mutations,e.mutations,(e,t)=>Do(e,t))&&Ur(this.baseMutations,e.baseMutations,(e,t)=>Do(e,t))}}class Bo{constructor(e,t,n,s){this.batch=e,this.commitVersion=t,this.mutationResults=n,this.docVersions=s}static from(e,t,n){vr(e.mutations.length===n.length,58842,{me:e.mutations.length,fe:n.length});let s=function(){return io}();const r=e.mutations;for(let i=0;i<r.length;i++)s=s.insert(r[i].key,n[i].version);return new Bo(e,t,n,s)}}class qo{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return null!==e&&this.mutation===e.mutation}toString(){return`Overlay{\n      largestBatchId: ${this.largestBatchId},\n      mutation: ${this.mutation.toString()}\n    }`}}class zo{constructor(e,t){this.count=e,this.unchangedNames=t}}var Go,Ho;function Ko(e){if(void 0===e)return pr("GRPC error has no .code"),br.UNKNOWN;switch(e){case Go.OK:return br.OK;case Go.CANCELLED:return br.CANCELLED;case Go.UNKNOWN:return br.UNKNOWN;case Go.DEADLINE_EXCEEDED:return br.DEADLINE_EXCEEDED;case Go.RESOURCE_EXHAUSTED:return br.RESOURCE_EXHAUSTED;case Go.INTERNAL:return br.INTERNAL;case Go.UNAVAILABLE:return br.UNAVAILABLE;case Go.UNAUTHENTICATED:return br.UNAUTHENTICATED;case Go.INVALID_ARGUMENT:return br.INVALID_ARGUMENT;case Go.NOT_FOUND:return br.NOT_FOUND;case Go.ALREADY_EXISTS:return br.ALREADY_EXISTS;case Go.PERMISSION_DENIED:return br.PERMISSION_DENIED;case Go.FAILED_PRECONDITION:return br.FAILED_PRECONDITION;case Go.ABORTED:return br.ABORTED;case Go.OUT_OF_RANGE:return br.OUT_OF_RANGE;case Go.UNIMPLEMENTED:return br.UNIMPLEMENTED;case Go.DATA_LOSS:return br.DATA_LOSS;default:return gr(39323,{code:e})}}(Ho=Go||(Go={}))[Ho.OK=0]="OK",Ho[Ho.CANCELLED=1]="CANCELLED",Ho[Ho.UNKNOWN=2]="UNKNOWN",Ho[Ho.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",Ho[Ho.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",Ho[Ho.NOT_FOUND=5]="NOT_FOUND",Ho[Ho.ALREADY_EXISTS=6]="ALREADY_EXISTS",Ho[Ho.PERMISSION_DENIED=7]="PERMISSION_DENIED",Ho[Ho.UNAUTHENTICATED=16]="UNAUTHENTICATED",Ho[Ho.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",Ho[Ho.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",Ho[Ho.ABORTED=10]="ABORTED",Ho[Ho.OUT_OF_RANGE=11]="OUT_OF_RANGE",Ho[Ho.UNIMPLEMENTED=12]="UNIMPLEMENTED",Ho[Ho.INTERNAL=13]="INTERNAL",Ho[Ho.UNAVAILABLE=14]="UNAVAILABLE",Ho[Ho.DATA_LOSS=15]="DATA_LOSS";const Wo=new Ws([4294967295,4294967295],0);function Qo(e){const t=(new TextEncoder).encode(e),n=new Qs;return n.update(t),new Uint8Array(n.digest())}function Yo(e){const t=new DataView(e.buffer),n=t.getUint32(0,!0),s=t.getUint32(4,!0),r=t.getUint32(8,!0),i=t.getUint32(12,!0);return[new Ws([n,s],0),new Ws([r,i],0)]}class Xo{constructor(e,t,n){if(this.bitmap=e,this.padding=t,this.hashCount=n,t<0||t>=8)throw new Jo(`Invalid padding: ${t}`);if(n<0)throw new Jo(`Invalid hash count: ${n}`);if(e.length>0&&0===this.hashCount)throw new Jo(`Invalid hash count: ${n}`);if(0===e.length&&0!==t)throw new Jo(`Invalid padding when bitmap length is 0: ${t}`);this.ge=8*e.length-t,this.pe=Ws.fromNumber(this.ge)}ye(e,t,n){let s=e.add(t.multiply(Ws.fromNumber(n)));return 1===s.compare(Wo)&&(s=new Ws([s.getBits(0),s.getBits(1)],0)),s.modulo(this.pe).toNumber()}we(e){return!!(this.bitmap[Math.floor(e/8)]&1<<e%8)}mightContain(e){if(0===this.ge)return!1;const t=Qo(e),[n,s]=Yo(t);for(let r=0;r<this.hashCount;r++){const e=this.ye(n,s,r);if(!this.we(e))return!1}return!0}static create(e,t,n){const s=e%8==0?0:8-e%8,r=new Uint8Array(Math.ceil(e/8)),i=new Xo(r,s,t);return n.forEach(e=>i.insert(e)),i}insert(e){if(0===this.ge)return;const t=Qo(e),[n,s]=Yo(t);for(let r=0;r<this.hashCount;r++){const e=this.ye(n,s,r);this.Se(e)}}Se(e){const t=Math.floor(e/8),n=e%8;this.bitmap[t]|=1<<n}}class Jo extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}class Zo{constructor(e,t,n,s,r){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=n,this.documentUpdates=s,this.resolvedLimboDocuments=r}static createSynthesizedRemoteEventForCurrentChange(e,t,n){const s=new Map;return s.set(e,ec.createSynthesizedTargetChangeForCurrentChange(e,t,n)),new Zo(ni.min(),s,new vi(Dr),Ja(),oo())}}class ec{constructor(e,t,n,s,r){this.resumeToken=e,this.current=t,this.addedDocuments=n,this.modifiedDocuments=s,this.removedDocuments=r}static createSynthesizedTargetChangeForCurrentChange(e,t,n){return new ec(n,t,oo(),oo(),oo())}}class tc{constructor(e,t,n,s){this.be=e,this.removedTargetIds=t,this.key=n,this.De=s}}class nc{constructor(e,t){this.targetId=e,this.Ce=t}}class sc{constructor(e,t,n=Ii.EMPTY_BYTE_STRING,s=null){this.state=e,this.targetIds=t,this.resumeToken=n,this.cause=s}}class rc{constructor(){this.ve=0,this.Fe=oc(),this.Me=Ii.EMPTY_BYTE_STRING,this.xe=!1,this.Oe=!0}get current(){return this.xe}get resumeToken(){return this.Me}get Ne(){return 0!==this.ve}get Be(){return this.Oe}Le(e){e.approximateByteSize()>0&&(this.Oe=!0,this.Me=e)}ke(){let e=oo(),t=oo(),n=oo();return this.Fe.forEach((s,r)=>{switch(r){case 0:e=e.add(s);break;case 2:t=t.add(s);break;case 1:n=n.add(s);break;default:gr(38017,{changeType:r})}}),new ec(this.Me,this.xe,e,t,n)}qe(){this.Oe=!1,this.Fe=oc()}Qe(e,t){this.Oe=!0,this.Fe=this.Fe.insert(e,t)}$e(e){this.Oe=!0,this.Fe=this.Fe.remove(e)}Ue(){this.ve+=1}Ke(){this.ve-=1,vr(this.ve>=0,3241,{ve:this.ve})}We(){this.Oe=!0,this.xe=!0}}class ic{constructor(e){this.Ge=e,this.ze=new Map,this.je=Ja(),this.Je=ac(),this.He=ac(),this.Ye=new vi(Dr)}Ze(e){for(const t of e.be)e.De&&e.De.isFoundDocument()?this.Xe(t,e.De):this.et(t,e.key,e.De);for(const t of e.removedTargetIds)this.et(t,e.key,e.De)}tt(e){this.forEachTarget(e,t=>{const n=this.nt(t);switch(e.state){case 0:this.rt(t)&&n.Le(e.resumeToken);break;case 1:n.Ke(),n.Ne||n.qe(),n.Le(e.resumeToken);break;case 2:n.Ke(),n.Ne||this.removeTarget(t);break;case 3:this.rt(t)&&(n.We(),n.Le(e.resumeToken));break;case 4:this.rt(t)&&(this.it(t),n.Le(e.resumeToken));break;default:gr(56790,{state:e.state})}})}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.ze.forEach((e,n)=>{this.rt(n)&&t(n)})}st(e){const t=e.targetId,n=e.Ce.count,s=this.ot(t);if(s){const r=s.target;if(Pa(r))if(0===n){const e=new zr(r.path);this.et(t,e,la.newNoDocument(e,ni.min()))}else vr(1===n,20013,{expectedCount:n});else{const s=this._t(t);if(s!==n){const n=this.ut(e),r=n?this.ct(n,e,s):1;if(0!==r){this.it(t);const e=2===r?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Ye=this.Ye.insert(t,e)}}}}}ut(e){const t=e.Ce.unchangedNames;if(!t||!t.bits)return null;const{bits:{bitmap:n="",padding:s=0},hashCount:r=0}=t;let i,a;try{i=ki(n).toUint8Array()}catch(o){if(o instanceof Ti)return fr("Decoding the base64 bloom filter in existence filter failed ("+o.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw o}try{a=new Xo(i,s,r)}catch(o){return fr(o instanceof Jo?"BloomFilter error: ":"Applying bloom filter failed: ",o),null}return 0===a.ge?null:a}ct(e,t,n){return t.Ce.count===n-this.Pt(e,t.targetId)?0:2}Pt(e,t){const n=this.Ge.getRemoteKeysForTarget(t);let s=0;return n.forEach(n=>{const r=this.Ge.ht(),i=`projects/${r.projectId}/databases/${r.database}/documents/${n.path.canonicalString()}`;e.mightContain(i)||(this.et(t,n,null),s++)}),s}Tt(e){const t=new Map;this.ze.forEach((n,s)=>{const r=this.ot(s);if(r){if(n.current&&Pa(r.target)){const t=new zr(r.target.path);this.It(t).has(s)||this.Et(s,t)||this.et(s,t,la.newNoDocument(t,e))}n.Be&&(t.set(s,n.ke()),n.qe())}});let n=oo();this.He.forEach((e,t)=>{let s=!0;t.forEachWhile(e=>{const t=this.ot(e);return!t||"TargetPurposeLimboResolution"===t.purpose||(s=!1,!1)}),s&&(n=n.add(e))}),this.je.forEach((t,n)=>n.setReadTime(e));const s=new Zo(e,t,this.Ye,this.je,n);return this.je=Ja(),this.Je=ac(),this.He=ac(),this.Ye=new vi(Dr),s}Xe(e,t){if(!this.rt(e))return;const n=this.Et(e,t.key)?2:0;this.nt(e).Qe(t.key,n),this.je=this.je.insert(t.key,t),this.Je=this.Je.insert(t.key,this.It(t.key).add(e)),this.He=this.He.insert(t.key,this.dt(t.key).add(e))}et(e,t,n){if(!this.rt(e))return;const s=this.nt(e);this.Et(e,t)?s.Qe(t,1):s.$e(t),this.He=this.He.insert(t,this.dt(t).delete(e)),this.He=this.He.insert(t,this.dt(t).add(e)),n&&(this.je=this.je.insert(t,n))}removeTarget(e){this.ze.delete(e)}_t(e){const t=this.nt(e).ke();return this.Ge.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}Ue(e){this.nt(e).Ue()}nt(e){let t=this.ze.get(e);return t||(t=new rc,this.ze.set(e,t)),t}dt(e){let t=this.He.get(e);return t||(t=new xi(Dr),this.He=this.He.insert(e,t)),t}It(e){let t=this.Je.get(e);return t||(t=new xi(Dr),this.Je=this.Je.insert(e,t)),t}rt(e){const t=null!==this.ot(e);return t||dr("WatchChangeAggregator","Detected inactive target",e),t}ot(e){const t=this.ze.get(e);return t&&t.Ne?null:this.Ge.At(e)}it(e){this.ze.set(e,new rc),this.Ge.getRemoteKeysForTarget(e).forEach(t=>{this.et(e,t,null)})}Et(e,t){return this.Ge.getRemoteKeysForTarget(e).has(t)}}function ac(){return new vi(zr.comparator)}function oc(){return new vi(zr.comparator)}const cc=(()=>({asc:"ASCENDING",desc:"DESCENDING"}))(),lc=(()=>({"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"}))(),uc=(()=>({and:"AND",or:"OR"}))();class hc{constructor(e,t){this.databaseId=e,this.useProto3Json=t}}function dc(e,t){return e.useProto3Json||hi(t)?t:{value:t}}function pc(e,t){return e.useProto3Json?`${new Date(1e3*t.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+t.nanoseconds).slice(-9)}Z`:{seconds:""+t.seconds,nanos:t.nanoseconds}}function fc(e,t){return e.useProto3Json?t.toBase64():t.toUint8Array()}function mc(e,t){return pc(e,t.toTimestamp())}function gc(e){return vr(!!e,49232),ni.fromTimestamp(function(e){const t=Ci(e);return new ti(t.seconds,t.nanos)}(e))}function yc(e,t){return vc(e,t).canonicalString()}function vc(e,t){const n=(s=e,new $r(["projects",s.projectId,"databases",s.database])).child("documents");var s;return void 0===t?n:n.child(t)}function wc(e){const t=$r.fromString(e);return vr(Mc(t),10190,{key:t.toString()}),t}function bc(e,t){return yc(e.databaseId,t.path)}function xc(e,t){const n=wc(t);if(n.get(1)!==e.databaseId.projectId)throw new xr(br.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+n.get(1)+" vs "+e.databaseId.projectId);if(n.get(3)!==e.databaseId.database)throw new xr(br.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+n.get(3)+" vs "+e.databaseId.database);return new zr(Tc(n))}function _c(e,t){return yc(e.databaseId,t)}function Ec(e){return new $r(["projects",e.databaseId.projectId,"databases",e.databaseId.database]).canonicalString()}function Tc(e){return vr(e.length>4&&"documents"===e.get(4),29091,{key:e.toString()}),e.popFirst(5)}function Ic(e,t,n){return{name:bc(e,t),fields:n.value.mapValue.fields}}function Nc(e,t){return{documents:[_c(e,t.path)]}}function Cc(e,t){const n={structuredQuery:{}},s=t.path;let r;null!==t.collectionGroup?(r=s,n.structuredQuery.from=[{collectionId:t.collectionGroup,allDescendants:!0}]):(r=s.popLast(),n.structuredQuery.from=[{collectionId:s.lastSegment()}]),n.parent=_c(e,r);const i=function(e){if(0!==e.length)return Pc(ya.create(e,"and"))}(t.filters);i&&(n.structuredQuery.where=i);const a=function(e){if(0!==e.length)return e.map(e=>{return{field:Dc((t=e).field),direction:Ac(t.dir)};var t})}(t.orderBy);a&&(n.structuredQuery.orderBy=a);const o=dc(e,t.limit);return null!==o&&(n.structuredQuery.limit=o),t.startAt&&(n.structuredQuery.startAt={before:(c=t.startAt).inclusive,values:c.position}),t.endAt&&(n.structuredQuery.endAt=function(e){return{before:!e.inclusive,values:e.position}}(t.endAt)),{ft:n,parent:r};var c}function Sc(e){let t=function(e){const t=wc(e);return 4===t.length?$r.emptyPath():Tc(t)}(e.parent);const n=e.structuredQuery,s=n.from?n.from.length:0;let r=null;if(s>0){vr(1===s,65062);const e=n.from[0];e.allDescendants?r=e.collectionId:t=t.child(e.collectionId)}let i=[];n.where&&(i=function(e){const t=kc(e);return t instanceof ya&&wa(t)?t.getFilters():[t]}(n.where));let a=[];n.orderBy&&(a=n.orderBy.map(e=>{return new pa(Oc((t=e).field),function(e){switch(e){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(t.direction));var t}));let o=null;n.limit&&(o=function(e){let t;return t="object"==typeof e?e.value:e,hi(t)?null:t}(n.limit));let c=null;n.startAt&&(c=function(e){const t=!!e.before,n=e.values||[];return new ua(n,t)}(n.startAt));let l=null;return n.endAt&&(l=function(e){const t=!e.before,n=e.values||[];return new ua(n,t)}(n.endAt)),function(e,t,n,s,r,i,a,o){return new La(e,t,n,s,r,i,a,o)}(t,r,a,i,o,"F",c,l)}function kc(e){return void 0!==e.unaryFilter?function(e){switch(e.unaryFilter.op){case"IS_NAN":const t=Oc(e.unaryFilter.field);return ga.create(t,"==",{doubleValue:NaN});case"IS_NULL":const n=Oc(e.unaryFilter.field);return ga.create(n,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const s=Oc(e.unaryFilter.field);return ga.create(s,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const r=Oc(e.unaryFilter.field);return ga.create(r,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":return gr(61313);default:return gr(60726)}}(e):void 0!==e.fieldFilter?(t=e,ga.create(Oc(t.fieldFilter.field),function(e){switch(e){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":return gr(58110);default:return gr(50506)}}(t.fieldFilter.op),t.fieldFilter.value)):void 0!==e.compositeFilter?function(e){return ya.create(e.compositeFilter.filters.map(e=>kc(e)),function(e){switch(e){case"AND":return"and";case"OR":return"or";default:return gr(1026)}}(e.compositeFilter.op))}(e):gr(30097,{filter:e});var t}function Ac(e){return cc[e]}function Rc(e){return lc[e]}function jc(e){return uc[e]}function Dc(e){return{fieldPath:e.canonicalString()}}function Oc(e){return qr.fromServerFormat(e.fieldPath)}function Pc(e){return e instanceof ga?function(e){if("=="===e.op){if(ra(e.value))return{unaryFilter:{field:Dc(e.field),op:"IS_NAN"}};if(sa(e.value))return{unaryFilter:{field:Dc(e.field),op:"IS_NULL"}}}else if("!="===e.op){if(ra(e.value))return{unaryFilter:{field:Dc(e.field),op:"IS_NOT_NAN"}};if(sa(e.value))return{unaryFilter:{field:Dc(e.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:Dc(e.field),op:Rc(e.op),value:e.value}}}(e):e instanceof ya?function(e){const t=e.getFilters().map(e=>Pc(e));return 1===t.length?t[0]:{compositeFilter:{op:jc(e.op),filters:t}}}(e):gr(54877,{filter:e})}function Lc(e){const t=[];return e.fields.forEach(e=>t.push(e.canonicalString())),{fieldPaths:t}}function Mc(e){return e.length>=4&&"projects"===e.get(0)&&"databases"===e.get(2)}class Uc{constructor(e,t,n,s,r=ni.min(),i=ni.min(),a=Ii.EMPTY_BYTE_STRING,o=null){this.target=e,this.targetId=t,this.purpose=n,this.sequenceNumber=s,this.snapshotVersion=r,this.lastLimboFreeSnapshotVersion=i,this.resumeToken=a,this.expectedCount=o}withSequenceNumber(e){return new Uc(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new Uc(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new Uc(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new Uc(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}class Fc{constructor(e){this.yt=e}}function Vc(e){const t=Sc({parent:e.parent,structuredQuery:e.structuredQuery});return"LAST"===e.limitType?qa(t,t.limit,"L"):t}class $c{constructor(){this.Cn=new Bc}addToCollectionParentIndex(e,t){return this.Cn.add(t),ci.resolve()}getCollectionParents(e,t){return ci.resolve(this.Cn.getEntries(t))}addFieldIndex(e,t){return ci.resolve()}deleteFieldIndex(e,t){return ci.resolve()}deleteAllFieldIndexes(e){return ci.resolve()}createTargetIndexes(e,t){return ci.resolve()}getDocumentsMatchingTarget(e,t){return ci.resolve(null)}getIndexType(e,t){return ci.resolve(0)}getFieldIndexes(e,t){return ci.resolve([])}getNextCollectionGroupToUpdate(e){return ci.resolve(null)}getMinOffset(e,t){return ci.resolve(ri.min())}getMinOffsetFromCollectionGroup(e,t){return ci.resolve(ri.min())}updateCollectionGroup(e,t,n){return ci.resolve()}updateIndexEntries(e,t){return ci.resolve()}}class Bc{constructor(){this.index={}}add(e){const t=e.lastSegment(),n=e.popLast(),s=this.index[t]||new xi($r.comparator),r=!s.has(n);return this.index[t]=s.add(n),r}has(e){const t=e.lastSegment(),n=e.popLast(),s=this.index[t];return s&&s.has(n)}getEntries(e){return(this.index[e]||new xi($r.comparator)).toArray()}}const qc={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},zc=41943040;class Gc{static withCacheSize(e){return new Gc(e,Gc.DEFAULT_COLLECTION_PERCENTILE,Gc.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(e,t,n){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=n}}Gc.DEFAULT_COLLECTION_PERCENTILE=10,Gc.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,Gc.DEFAULT=new Gc(zc,Gc.DEFAULT_COLLECTION_PERCENTILE,Gc.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),Gc.DISABLED=new Gc(-1,0,0);class Hc{constructor(e){this.ar=e}next(){return this.ar+=2,this.ar}static ur(){return new Hc(0)}static cr(){return new Hc(-1)}}const Kc="LruGarbageCollector";function Wc([e,t],[n,s]){const r=Dr(e,n);return 0===r?Dr(t,s):r}class Qc{constructor(e){this.Ir=e,this.buffer=new xi(Wc),this.Er=0}dr(){return++this.Er}Ar(e){const t=[e,this.dr()];if(this.buffer.size<this.Ir)this.buffer=this.buffer.add(t);else{const e=this.buffer.last();Wc(t,e)<0&&(this.buffer=this.buffer.delete(e).add(t))}}get maxValue(){return this.buffer.last()[0]}}class Yc{constructor(e,t,n){this.garbageCollector=e,this.asyncQueue=t,this.localStore=n,this.Rr=null}start(){-1!==this.garbageCollector.params.cacheSizeCollectionThreshold&&this.Vr(6e4)}stop(){this.Rr&&(this.Rr.cancel(),this.Rr=null)}get started(){return null!==this.Rr}Vr(e){dr(Kc,`Garbage collection scheduled in ${e}ms`),this.Rr=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,async()=>{this.Rr=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(e){li(e)?dr(Kc,"Ignoring IndexedDB error during garbage collection: ",e):await oi(e)}await this.Vr(3e5)})}}class Xc{constructor(e,t){this.mr=e,this.params=t}calculateTargetCount(e,t){return this.mr.gr(e).next(e=>Math.floor(t/100*e))}nthSequenceNumber(e,t){if(0===t)return ci.resolve(ui.ce);const n=new Qc(t);return this.mr.forEachTarget(e,e=>n.Ar(e.sequenceNumber)).next(()=>this.mr.pr(e,e=>n.Ar(e))).next(()=>n.maxValue)}removeTargets(e,t,n){return this.mr.removeTargets(e,t,n)}removeOrphanedDocuments(e,t){return this.mr.removeOrphanedDocuments(e,t)}collect(e,t){return-1===this.params.cacheSizeCollectionThreshold?(dr("LruGarbageCollector","Garbage collection skipped; disabled"),ci.resolve(qc)):this.getCacheSize(e).next(n=>n<this.params.cacheSizeCollectionThreshold?(dr("LruGarbageCollector",`Garbage collection skipped; Cache size ${n} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),qc):this.yr(e,t))}getCacheSize(e){return this.mr.getCacheSize(e)}yr(e,t){let n,s,r,i,a,o,c;const l=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next(t=>(t>this.params.maximumSequenceNumbersToCollect?(dr("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${t}`),s=this.params.maximumSequenceNumbersToCollect):s=t,i=Date.now(),this.nthSequenceNumber(e,s))).next(s=>(n=s,a=Date.now(),this.removeTargets(e,n,t))).next(t=>(r=t,o=Date.now(),this.removeOrphanedDocuments(e,n))).next(e=>(c=Date.now(),hr()<=lt.DEBUG&&dr("LruGarbageCollector",`LRU Garbage Collection\n\tCounted targets in ${i-l}ms\n\tDetermined least recently used ${s} in `+(a-i)+`ms\n\tRemoved ${r} targets in `+(o-a)+`ms\n\tRemoved ${e} documents in `+(c-o)+`ms\nTotal Duration: ${c-l}ms`),ci.resolve({didRun:!0,sequenceNumbersCollected:s,targetsRemoved:r,documentsRemoved:e})))}}class Jc{constructor(){this.changes=new Ya(e=>e.toString(),(e,t)=>e.isEqual(t)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,la.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();const n=this.changes.get(t);return void 0!==n?ci.resolve(n):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}class Zc{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}}class el{constructor(e,t,n,s){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=n,this.indexManager=s}getDocument(e,t){let n=null;return this.documentOverlayCache.getOverlay(e,t).next(s=>(n=s,this.remoteDocumentCache.getEntry(e,t))).next(e=>(null!==n&&Ro(n.mutation,e,Ei.empty(),ti.now()),e))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next(t=>this.getLocalViewOfDocuments(e,t,oo()).next(()=>t))}getLocalViewOfDocuments(e,t,n=oo()){const s=no();return this.populateOverlays(e,s,t).next(()=>this.computeViews(e,t,s,n).next(e=>{let t=eo();return e.forEach((e,n)=>{t=t.insert(e,n.overlayedDocument)}),t}))}getOverlayedDocuments(e,t){const n=no();return this.populateOverlays(e,n,t).next(()=>this.computeViews(e,t,n,oo()))}populateOverlays(e,t,n){const s=[];return n.forEach(e=>{t.has(e)||s.push(e)}),this.documentOverlayCache.getOverlays(e,s).next(e=>{e.forEach((e,n)=>{t.set(e,n)})})}computeViews(e,t,n,s){let r=Ja();const i=ro(),a=ro();return t.forEach((e,t)=>{const a=n.get(t.key);s.has(t.key)&&(void 0===a||a.mutation instanceof Po)?r=r.insert(t.key,t):void 0!==a?(i.set(t.key,a.mutation.getFieldMask()),Ro(a.mutation,t,a.mutation.getFieldMask(),ti.now())):i.set(t.key,Ei.empty())}),this.recalculateAndSaveOverlays(e,r).next(e=>(e.forEach((e,t)=>i.set(e,t)),t.forEach((e,t)=>a.set(e,new Zc(t,i.get(e)??null))),a))}recalculateAndSaveOverlays(e,t){const n=ro();let s=new vi((e,t)=>e-t),r=oo();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next(e=>{for(const r of e)r.keys().forEach(e=>{const i=t.get(e);if(null===i)return;let a=n.get(e)||Ei.empty();a=r.applyToLocalView(i,a),n.set(e,a);const o=(s.get(r.batchId)||oo()).add(e);s=s.insert(r.batchId,o)})}).next(()=>{const i=[],a=s.getReverseIterator();for(;a.hasNext();){const s=a.getNext(),o=s.key,c=s.value,l=so();c.forEach(e=>{if(!r.has(e)){const s=ko(t.get(e),n.get(e));null!==s&&l.set(e,s),r=r.add(e)}}),i.push(this.documentOverlayCache.saveOverlays(e,o,l))}return ci.waitFor(i)}).next(()=>n)}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next(t=>this.recalculateAndSaveOverlays(e,t))}getDocumentsMatchingQuery(e,t,n,s){return r=t,zr.isDocumentKey(r.path)&&null===r.collectionGroup&&0===r.filters.length?this.getDocumentsMatchingDocumentQuery(e,t.path):Fa(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,n,s):this.getDocumentsMatchingCollectionQuery(e,t,n,s);var r}getNextDocuments(e,t,n,s){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,n,s).next(r=>{const i=s-r.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,n.largestBatchId,s-r.size):ci.resolve(no());let a=-1,o=r;return i.next(t=>ci.forEach(t,(t,n)=>(a<n.largestBatchId&&(a=n.largestBatchId),r.get(t)?ci.resolve():this.remoteDocumentCache.getEntry(e,t).next(e=>{o=o.insert(t,e)}))).next(()=>this.populateOverlays(e,t,r)).next(()=>this.computeViews(e,o,t,oo())).next(e=>({batchId:a,changes:to(e)})))})}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new zr(t)).next(e=>{let t=eo();return e.isFoundDocument()&&(t=t.insert(e.key,e)),t})}getDocumentsMatchingCollectionGroupQuery(e,t,n,s){const r=t.collectionGroup;let i=eo();return this.indexManager.getCollectionParents(e,r).next(a=>ci.forEach(a,a=>{const o=(c=t,l=a.child(r),new La(l,null,c.explicitOrderBy.slice(),c.filters.slice(),c.limit,c.limitType,c.startAt,c.endAt));var c,l;return this.getDocumentsMatchingCollectionQuery(e,o,n,s).next(e=>{e.forEach((e,t)=>{i=i.insert(e,t)})})}).next(()=>i))}getDocumentsMatchingCollectionQuery(e,t,n,s){let r;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,n.largestBatchId).next(i=>(r=i,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,n,r,s))).next(e=>{r.forEach((t,n)=>{const s=n.getKey();null===e.get(s)&&(e=e.insert(s,la.newInvalidDocument(s)))});let n=eo();return e.forEach((e,s)=>{const i=r.get(e);void 0!==i&&Ro(i.mutation,s,Ei.empty(),ti.now()),Ka(t,s)&&(n=n.insert(e,s))}),n})}}class tl{constructor(e){this.serializer=e,this.Lr=new Map,this.kr=new Map}getBundleMetadata(e,t){return ci.resolve(this.Lr.get(t))}saveBundleMetadata(e,t){return this.Lr.set(t.id,{id:(n=t).id,version:n.version,createTime:gc(n.createTime)}),ci.resolve();var n}getNamedQuery(e,t){return ci.resolve(this.kr.get(t))}saveNamedQuery(e,t){return this.kr.set(t.name,{name:(n=t).name,query:Vc(n.bundledQuery),readTime:gc(n.readTime)}),ci.resolve();var n}}class nl{constructor(){this.overlays=new vi(zr.comparator),this.qr=new Map}getOverlay(e,t){return ci.resolve(this.overlays.get(t))}getOverlays(e,t){const n=no();return ci.forEach(t,t=>this.getOverlay(e,t).next(e=>{null!==e&&n.set(t,e)})).next(()=>n)}saveOverlays(e,t,n){return n.forEach((n,s)=>{this.St(e,t,s)}),ci.resolve()}removeOverlaysForBatchId(e,t,n){const s=this.qr.get(n);return void 0!==s&&(s.forEach(e=>this.overlays=this.overlays.remove(e)),this.qr.delete(n)),ci.resolve()}getOverlaysForCollection(e,t,n){const s=no(),r=t.length+1,i=new zr(t.child("")),a=this.overlays.getIteratorFrom(i);for(;a.hasNext();){const e=a.getNext().value,i=e.getKey();if(!t.isPrefixOf(i.path))break;i.path.length===r&&e.largestBatchId>n&&s.set(e.getKey(),e)}return ci.resolve(s)}getOverlaysForCollectionGroup(e,t,n,s){let r=new vi((e,t)=>e-t);const i=this.overlays.getIterator();for(;i.hasNext();){const e=i.getNext().value;if(e.getKey().getCollectionGroup()===t&&e.largestBatchId>n){let t=r.get(e.largestBatchId);null===t&&(t=no(),r=r.insert(e.largestBatchId,t)),t.set(e.getKey(),e)}}const a=no(),o=r.getIterator();for(;o.hasNext()&&(o.getNext().value.forEach((e,t)=>a.set(e,t)),!(a.size()>=s)););return ci.resolve(a)}St(e,t,n){const s=this.overlays.get(n.key);if(null!==s){const e=this.qr.get(s.largestBatchId).delete(n.key);this.qr.set(s.largestBatchId,e)}this.overlays=this.overlays.insert(n.key,new qo(t,n));let r=this.qr.get(t);void 0===r&&(r=oo(),this.qr.set(t,r)),this.qr.set(t,r.add(n.key))}}class sl{constructor(){this.sessionToken=Ii.EMPTY_BYTE_STRING}getSessionToken(e){return ci.resolve(this.sessionToken)}setSessionToken(e,t){return this.sessionToken=t,ci.resolve()}}class rl{constructor(){this.Qr=new xi(il.$r),this.Ur=new xi(il.Kr)}isEmpty(){return this.Qr.isEmpty()}addReference(e,t){const n=new il(e,t);this.Qr=this.Qr.add(n),this.Ur=this.Ur.add(n)}Wr(e,t){e.forEach(e=>this.addReference(e,t))}removeReference(e,t){this.Gr(new il(e,t))}zr(e,t){e.forEach(e=>this.removeReference(e,t))}jr(e){const t=new zr(new $r([])),n=new il(t,e),s=new il(t,e+1),r=[];return this.Ur.forEachInRange([n,s],e=>{this.Gr(e),r.push(e.key)}),r}Jr(){this.Qr.forEach(e=>this.Gr(e))}Gr(e){this.Qr=this.Qr.delete(e),this.Ur=this.Ur.delete(e)}Hr(e){const t=new zr(new $r([])),n=new il(t,e),s=new il(t,e+1);let r=oo();return this.Ur.forEachInRange([n,s],e=>{r=r.add(e.key)}),r}containsKey(e){const t=new il(e,0),n=this.Qr.firstAfterOrEqual(t);return null!==n&&e.isEqual(n.key)}}class il{constructor(e,t){this.key=e,this.Yr=t}static $r(e,t){return zr.comparator(e.key,t.key)||Dr(e.Yr,t.Yr)}static Kr(e,t){return Dr(e.Yr,t.Yr)||zr.comparator(e.key,t.key)}}class al{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.tr=1,this.Zr=new xi(il.$r)}checkEmpty(e){return ci.resolve(0===this.mutationQueue.length)}addMutationBatch(e,t,n,s){const r=this.tr;this.tr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const i=new $o(r,t,n,s);this.mutationQueue.push(i);for(const a of s)this.Zr=this.Zr.add(new il(a.key,r)),this.indexManager.addToCollectionParentIndex(e,a.key.path.popLast());return ci.resolve(i)}lookupMutationBatch(e,t){return ci.resolve(this.Xr(t))}getNextMutationBatchAfterBatchId(e,t){const n=t+1,s=this.ei(n),r=s<0?0:s;return ci.resolve(this.mutationQueue.length>r?this.mutationQueue[r]:null)}getHighestUnacknowledgedBatchId(){return ci.resolve(0===this.mutationQueue.length?-1:this.tr-1)}getAllMutationBatches(e){return ci.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){const n=new il(t,0),s=new il(t,Number.POSITIVE_INFINITY),r=[];return this.Zr.forEachInRange([n,s],e=>{const t=this.Xr(e.Yr);r.push(t)}),ci.resolve(r)}getAllMutationBatchesAffectingDocumentKeys(e,t){let n=new xi(Dr);return t.forEach(e=>{const t=new il(e,0),s=new il(e,Number.POSITIVE_INFINITY);this.Zr.forEachInRange([t,s],e=>{n=n.add(e.Yr)})}),ci.resolve(this.ti(n))}getAllMutationBatchesAffectingQuery(e,t){const n=t.path,s=n.length+1;let r=n;zr.isDocumentKey(r)||(r=r.child(""));const i=new il(new zr(r),0);let a=new xi(Dr);return this.Zr.forEachWhile(e=>{const t=e.key.path;return!!n.isPrefixOf(t)&&(t.length===s&&(a=a.add(e.Yr)),!0)},i),ci.resolve(this.ti(a))}ti(e){const t=[];return e.forEach(e=>{const n=this.Xr(e);null!==n&&t.push(n)}),t}removeMutationBatch(e,t){vr(0===this.ni(t.batchId,"removed"),55003),this.mutationQueue.shift();let n=this.Zr;return ci.forEach(t.mutations,s=>{const r=new il(s.key,t.batchId);return n=n.delete(r),this.referenceDelegate.markPotentiallyOrphaned(e,s.key)}).next(()=>{this.Zr=n})}ir(e){}containsKey(e,t){const n=new il(t,0),s=this.Zr.firstAfterOrEqual(n);return ci.resolve(t.isEqual(s&&s.key))}performConsistencyCheck(e){return this.mutationQueue.length,ci.resolve()}ni(e,t){return this.ei(e)}ei(e){return 0===this.mutationQueue.length?0:e-this.mutationQueue[0].batchId}Xr(e){const t=this.ei(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}class ol{constructor(e){this.ri=e,this.docs=new vi(zr.comparator),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){const n=t.key,s=this.docs.get(n),r=s?s.size:0,i=this.ri(t);return this.docs=this.docs.insert(n,{document:t.mutableCopy(),size:i}),this.size+=i-r,this.indexManager.addToCollectionParentIndex(e,n.path.popLast())}removeEntry(e){const t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){const n=this.docs.get(t);return ci.resolve(n?n.document.mutableCopy():la.newInvalidDocument(t))}getEntries(e,t){let n=Ja();return t.forEach(e=>{const t=this.docs.get(e);n=n.insert(e,t?t.document.mutableCopy():la.newInvalidDocument(e))}),ci.resolve(n)}getDocumentsMatchingQuery(e,t,n,s){let r=Ja();const i=t.path,a=new zr(i.child("__id-9223372036854775808__")),o=this.docs.getIteratorFrom(a);for(;o.hasNext();){const{key:e,value:{document:a}}=o.getNext();if(!i.isPrefixOf(e.path))break;e.path.length>i.length+1||ii(si(a),n)<=0||(s.has(a.key)||Ka(t,a))&&(r=r.insert(a.key,a.mutableCopy()))}return ci.resolve(r)}getAllFromCollectionGroup(e,t,n,s){gr(9500)}ii(e,t){return ci.forEach(this.docs,e=>t(e))}newChangeBuffer(e){return new cl(this)}getSize(e){return ci.resolve(this.size)}}class cl extends Jc{constructor(e){super(),this.Nr=e}applyChanges(e){const t=[];return this.changes.forEach((n,s)=>{s.isValidDocument()?t.push(this.Nr.addEntry(e,s)):this.Nr.removeEntry(n)}),ci.waitFor(t)}getFromCache(e,t){return this.Nr.getEntry(e,t)}getAllFromCache(e,t){return this.Nr.getEntries(e,t)}}class ll{constructor(e){this.persistence=e,this.si=new Ya(e=>Da(e),Oa),this.lastRemoteSnapshotVersion=ni.min(),this.highestTargetId=0,this.oi=0,this._i=new rl,this.targetCount=0,this.ai=Hc.ur()}forEachTarget(e,t){return this.si.forEach((e,n)=>t(n)),ci.resolve()}getLastRemoteSnapshotVersion(e){return ci.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return ci.resolve(this.oi)}allocateTargetId(e){return this.highestTargetId=this.ai.next(),ci.resolve(this.highestTargetId)}setTargetsMetadata(e,t,n){return n&&(this.lastRemoteSnapshotVersion=n),t>this.oi&&(this.oi=t),ci.resolve()}Pr(e){this.si.set(e.target,e);const t=e.targetId;t>this.highestTargetId&&(this.ai=new Hc(t),this.highestTargetId=t),e.sequenceNumber>this.oi&&(this.oi=e.sequenceNumber)}addTargetData(e,t){return this.Pr(t),this.targetCount+=1,ci.resolve()}updateTargetData(e,t){return this.Pr(t),ci.resolve()}removeTargetData(e,t){return this.si.delete(t.target),this._i.jr(t.targetId),this.targetCount-=1,ci.resolve()}removeTargets(e,t,n){let s=0;const r=[];return this.si.forEach((i,a)=>{a.sequenceNumber<=t&&null===n.get(a.targetId)&&(this.si.delete(i),r.push(this.removeMatchingKeysForTargetId(e,a.targetId)),s++)}),ci.waitFor(r).next(()=>s)}getTargetCount(e){return ci.resolve(this.targetCount)}getTargetData(e,t){const n=this.si.get(t)||null;return ci.resolve(n)}addMatchingKeys(e,t,n){return this._i.Wr(t,n),ci.resolve()}removeMatchingKeys(e,t,n){this._i.zr(t,n);const s=this.persistence.referenceDelegate,r=[];return s&&t.forEach(t=>{r.push(s.markPotentiallyOrphaned(e,t))}),ci.waitFor(r)}removeMatchingKeysForTargetId(e,t){return this._i.jr(t),ci.resolve()}getMatchingKeysForTargetId(e,t){const n=this._i.Hr(t);return ci.resolve(n)}containsKey(e,t){return ci.resolve(this._i.containsKey(t))}}class ul{constructor(e,t){this.ui={},this.overlays={},this.ci=new ui(0),this.li=!1,this.li=!0,this.hi=new sl,this.referenceDelegate=e(this),this.Pi=new ll(this),this.indexManager=new $c,this.remoteDocumentCache=new ol(e=>this.referenceDelegate.Ti(e)),this.serializer=new Fc(t),this.Ii=new tl(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.li=!1,Promise.resolve()}get started(){return this.li}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new nl,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let n=this.ui[e.toKey()];return n||(n=new al(t,this.referenceDelegate),this.ui[e.toKey()]=n),n}getGlobalsCache(){return this.hi}getTargetCache(){return this.Pi}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Ii}runTransaction(e,t,n){dr("MemoryPersistence","Starting transaction:",e);const s=new hl(this.ci.next());return this.referenceDelegate.Ei(),n(s).next(e=>this.referenceDelegate.di(s).next(()=>e)).toPromise().then(e=>(s.raiseOnCommittedEvent(),e))}Ai(e,t){return ci.or(Object.values(this.ui).map(n=>()=>n.containsKey(e,t)))}}class hl extends ai{constructor(e){super(),this.currentSequenceNumber=e}}class dl{constructor(e){this.persistence=e,this.Ri=new rl,this.Vi=null}static mi(e){return new dl(e)}get fi(){if(this.Vi)return this.Vi;throw gr(60996)}addReference(e,t,n){return this.Ri.addReference(n,t),this.fi.delete(n.toString()),ci.resolve()}removeReference(e,t,n){return this.Ri.removeReference(n,t),this.fi.add(n.toString()),ci.resolve()}markPotentiallyOrphaned(e,t){return this.fi.add(t.toString()),ci.resolve()}removeTarget(e,t){this.Ri.jr(t.targetId).forEach(e=>this.fi.add(e.toString()));const n=this.persistence.getTargetCache();return n.getMatchingKeysForTargetId(e,t.targetId).next(e=>{e.forEach(e=>this.fi.add(e.toString()))}).next(()=>n.removeTargetData(e,t))}Ei(){this.Vi=new Set}di(e){const t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return ci.forEach(this.fi,n=>{const s=zr.fromPath(n);return this.gi(e,s).next(e=>{e||t.removeEntry(s,ni.min())})}).next(()=>(this.Vi=null,t.apply(e)))}updateLimboDocument(e,t){return this.gi(e,t).next(e=>{e?this.fi.delete(t.toString()):this.fi.add(t.toString())})}Ti(e){return 0}gi(e,t){return ci.or([()=>ci.resolve(this.Ri.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Ai(e,t)])}}class pl{constructor(e,t){this.persistence=e,this.pi=new Ya(e=>function(e){let t="";for(let n=0;n<e.length;n++)t.length>0&&(t=fi(t)),t=pi(e.get(n),t);return fi(t)}(e.path),(e,t)=>e.isEqual(t)),this.garbageCollector=function(e,t){return new Xc(e,t)}(this,t)}static mi(e,t){return new pl(e,t)}Ei(){}di(e){return ci.resolve()}forEachTarget(e,t){return this.persistence.getTargetCache().forEachTarget(e,t)}gr(e){const t=this.wr(e);return this.persistence.getTargetCache().getTargetCount(e).next(e=>t.next(t=>e+t))}wr(e){let t=0;return this.pr(e,e=>{t++}).next(()=>t)}pr(e,t){return ci.forEach(this.pi,(n,s)=>this.br(e,n,s).next(e=>e?ci.resolve():t(s)))}removeTargets(e,t,n){return this.persistence.getTargetCache().removeTargets(e,t,n)}removeOrphanedDocuments(e,t){let n=0;const s=this.persistence.getRemoteDocumentCache(),r=s.newChangeBuffer();return s.ii(e,s=>this.br(e,s,t).next(e=>{e||(n++,r.removeEntry(s,ni.min()))})).next(()=>r.apply(e)).next(()=>n)}markPotentiallyOrphaned(e,t){return this.pi.set(t,e.currentSequenceNumber),ci.resolve()}removeTarget(e,t){const n=t.withSequenceNumber(e.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(e,n)}addReference(e,t,n){return this.pi.set(n,e.currentSequenceNumber),ci.resolve()}removeReference(e,t,n){return this.pi.set(n,e.currentSequenceNumber),ci.resolve()}updateLimboDocument(e,t){return this.pi.set(t,e.currentSequenceNumber),ci.resolve()}Ti(e){let t=e.key.toString().length;return e.isFoundDocument()&&(t+=Zi(e.data.value)),t}br(e,t,n){return ci.or([()=>this.persistence.Ai(e,t),()=>this.persistence.getTargetCache().containsKey(e,t),()=>{const e=this.pi.get(t);return ci.resolve(void 0!==e&&e>n)}])}getCacheSize(e){return this.persistence.getRemoteDocumentCache().getSize(e)}}class fl{constructor(e,t,n,s){this.targetId=e,this.fromCache=t,this.Es=n,this.ds=s}static As(e,t){let n=oo(),s=oo();for(const r of t.docChanges)switch(r.type){case 0:n=n.add(r.doc.key);break;case 1:s=s.add(r.doc.key)}return new fl(e,t.fromCache,n,s)}}class ml{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}class gl{constructor(){this.Rs=!1,this.Vs=!1,this.fs=100,this.gs=qe()?8:function(e){const t=e.match(/Android ([\d.]+)/i),n=t?t[1].split(".").slice(0,2).join("."):"-1";return Number(n)}($e())>0?6:4}initialize(e,t){this.ps=e,this.indexManager=t,this.Rs=!0}getDocumentsMatchingQuery(e,t,n,s){const r={result:null};return this.ys(e,t).next(e=>{r.result=e}).next(()=>{if(!r.result)return this.ws(e,t,s,n).next(e=>{r.result=e})}).next(()=>{if(r.result)return;const n=new ml;return this.Ss(e,t,n).next(s=>{if(r.result=s,this.Vs)return this.bs(e,t,n,s.size)})}).next(()=>r.result)}bs(e,t,n,s){return n.documentReadCount<this.fs?(hr()<=lt.DEBUG&&dr("QueryEngine","SDK will not create cache indexes for query:",Ha(t),"since it only creates cache indexes for collection contains","more than or equal to",this.fs,"documents"),ci.resolve()):(hr()<=lt.DEBUG&&dr("QueryEngine","Query:",Ha(t),"scans",n.documentReadCount,"local documents and returns",s,"documents as results."),n.documentReadCount>this.gs*s?(hr()<=lt.DEBUG&&dr("QueryEngine","The SDK decides to create cache indexes for query:",Ha(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,$a(t))):ci.resolve())}ys(e,t){if(Ua(t))return ci.resolve(null);let n=$a(t);return this.indexManager.getIndexType(e,n).next(s=>0===s?null:(null!==t.limit&&1===s&&(t=qa(t,null,"F"),n=$a(t)),this.indexManager.getDocumentsMatchingTarget(e,n).next(s=>{const r=oo(...s);return this.ps.getDocuments(e,r).next(s=>this.indexManager.getMinOffset(e,n).next(n=>{const i=this.Ds(t,s);return this.Cs(t,i,r,n.readTime)?this.ys(e,qa(t,null,"F")):this.vs(e,i,t,n)}))})))}ws(e,t,n,s){return Ua(t)||s.isEqual(ni.min())?ci.resolve(null):this.ps.getDocuments(e,n).next(r=>{const i=this.Ds(t,r);return this.Cs(t,i,n,s)?ci.resolve(null):(hr()<=lt.DEBUG&&dr("QueryEngine","Re-using previous result from %s to execute query: %s",s.toString(),Ha(t)),this.vs(e,i,t,function(e,t){const n=e.toTimestamp().seconds,s=e.toTimestamp().nanoseconds+1,r=ni.fromTimestamp(1e9===s?new ti(n+1,0):new ti(n,s));return new ri(r,zr.empty(),t)}(s,-1)).next(e=>e))})}Ds(e,t){let n=new xi(Wa(e));return t.forEach((t,s)=>{Ka(e,s)&&(n=n.add(s))}),n}Cs(e,t,n,s){if(null===e.limit)return!1;if(n.size!==t.size)return!0;const r="F"===e.limitType?t.last():t.first();return!!r&&(r.hasPendingWrites||r.version.compareTo(s)>0)}Ss(e,t,n){return hr()<=lt.DEBUG&&dr("QueryEngine","Using full collection scan to execute query:",Ha(t)),this.ps.getDocumentsMatchingQuery(e,t,ri.min(),n)}vs(e,t,n,s){return this.ps.getDocumentsMatchingQuery(e,n,s).next(e=>(t.forEach(t=>{e=e.insert(t.key,t)}),e))}}const yl="LocalStore";class vl{constructor(e,t,n,s){this.persistence=e,this.Fs=t,this.serializer=s,this.Ms=new vi(Dr),this.xs=new Ya(e=>Da(e),Oa),this.Os=new Map,this.Ns=e.getRemoteDocumentCache(),this.Pi=e.getTargetCache(),this.Ii=e.getBundleCache(),this.Bs(n)}Bs(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new el(this.Ns,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.Ns.setIndexManager(this.indexManager),this.Fs.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",t=>e.collect(t,this.Ms))}}async function wl(e,t){const n=wr(e);return await n.persistence.runTransaction("Handle user change","readonly",e=>{let s;return n.mutationQueue.getAllMutationBatches(e).next(r=>(s=r,n.Bs(t),n.mutationQueue.getAllMutationBatches(e))).next(t=>{const r=[],i=[];let a=oo();for(const e of s){r.push(e.batchId);for(const t of e.mutations)a=a.add(t.key)}for(const e of t){i.push(e.batchId);for(const t of e.mutations)a=a.add(t.key)}return n.localDocuments.getDocuments(e,a).next(e=>({Ls:e,removedBatchIds:r,addedBatchIds:i}))})})}function bl(e){const t=wr(e);return t.persistence.runTransaction("Get last remote snapshot version","readonly",e=>t.Pi.getLastRemoteSnapshotVersion(e))}function xl(e,t){const n=wr(e),s=t.snapshotVersion;let r=n.Ms;return n.persistence.runTransaction("Apply remote event","readwrite-primary",e=>{const i=n.Ns.newChangeBuffer({trackRemovals:!0});r=n.Ms;const a=[];t.targetChanges.forEach((i,o)=>{const c=r.get(o);if(!c)return;a.push(n.Pi.removeMatchingKeys(e,i.removedDocuments,o).next(()=>n.Pi.addMatchingKeys(e,i.addedDocuments,o)));let l=c.withSequenceNumber(e.currentSequenceNumber);null!==t.targetMismatches.get(o)?l=l.withResumeToken(Ii.EMPTY_BYTE_STRING,ni.min()).withLastLimboFreeSnapshotVersion(ni.min()):i.resumeToken.approximateByteSize()>0&&(l=l.withResumeToken(i.resumeToken,s)),r=r.insert(o,l),function(e,t,n){if(0===e.resumeToken.approximateByteSize())return!0;if(t.snapshotVersion.toMicroseconds()-e.snapshotVersion.toMicroseconds()>=3e8)return!0;return n.addedDocuments.size+n.modifiedDocuments.size+n.removedDocuments.size>0}(c,l,i)&&a.push(n.Pi.updateTargetData(e,l))});let o=Ja(),c=oo();if(t.documentUpdates.forEach(s=>{t.resolvedLimboDocuments.has(s)&&a.push(n.persistence.referenceDelegate.updateLimboDocument(e,s))}),a.push(function(e,t,n){let s=oo(),r=oo();return n.forEach(e=>s=s.add(e)),t.getEntries(e,s).next(e=>{let s=Ja();return n.forEach((n,i)=>{const a=e.get(n);i.isFoundDocument()!==a.isFoundDocument()&&(r=r.add(n)),i.isNoDocument()&&i.version.isEqual(ni.min())?(t.removeEntry(n,i.readTime),s=s.insert(n,i)):!a.isValidDocument()||i.version.compareTo(a.version)>0||0===i.version.compareTo(a.version)&&a.hasPendingWrites?(t.addEntry(i),s=s.insert(n,i)):dr(yl,"Ignoring outdated watch update for ",n,". Current version:",a.version," Watch version:",i.version)}),{ks:s,qs:r}})}(e,i,t.documentUpdates).next(e=>{o=e.ks,c=e.qs})),!s.isEqual(ni.min())){const t=n.Pi.getLastRemoteSnapshotVersion(e).next(t=>n.Pi.setTargetsMetadata(e,e.currentSequenceNumber,s));a.push(t)}return ci.waitFor(a).next(()=>i.apply(e)).next(()=>n.localDocuments.getLocalViewOfDocuments(e,o,c)).next(()=>o)}).then(e=>(n.Ms=r,e))}function _l(e,t){const n=wr(e);return n.persistence.runTransaction("Get next mutation batch","readonly",e=>(void 0===t&&(t=-1),n.mutationQueue.getNextMutationBatchAfterBatchId(e,t)))}async function El(e,t,n){const s=wr(e),r=s.Ms.get(t),i=n?"readwrite":"readwrite-primary";try{n||await s.persistence.runTransaction("Release target",i,e=>s.persistence.referenceDelegate.removeTarget(e,r))}catch(a){if(!li(a))throw a;dr(yl,`Failed to update sequence numbers for target ${t}: ${a}`)}s.Ms=s.Ms.remove(t),s.xs.delete(r.target)}function Tl(e,t,n){const s=wr(e);let r=ni.min(),i=oo();return s.persistence.runTransaction("Execute query","readwrite",e=>function(e,t,n){const s=wr(e),r=s.xs.get(n);return void 0!==r?ci.resolve(s.Ms.get(r)):s.Pi.getTargetData(t,n)}(s,e,$a(t)).next(t=>{if(t)return r=t.lastLimboFreeSnapshotVersion,s.Pi.getMatchingKeysForTargetId(e,t.targetId).next(e=>{i=e})}).next(()=>s.Fs.getDocumentsMatchingQuery(e,t,n?r:ni.min(),n?i:oo())).next(e=>(function(e,t,n){let s=e.Os.get(t)||ni.min();n.forEach((e,t)=>{t.readTime.compareTo(s)>0&&(s=t.readTime)}),e.Os.set(t,s)}(s,function(e){return e.collectionGroup||(e.path.length%2==1?e.path.lastSegment():e.path.get(e.path.length-2))}(t),e),{documents:e,Qs:i})))}class Il{constructor(){this.activeTargetIds=co}zs(e){this.activeTargetIds=this.activeTargetIds.add(e)}js(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Gs(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class Nl{constructor(){this.Mo=new Il,this.xo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,n){}addLocalQueryTarget(e,t=!0){return t&&this.Mo.zs(e),this.xo[e]||"not-current"}updateQueryState(e,t,n){this.xo[e]=t}removeLocalQueryTarget(e){this.Mo.js(e)}isLocalQueryTarget(e){return this.Mo.activeTargetIds.has(e)}clearQueryState(e){delete this.xo[e]}getAllActiveQueryTargets(){return this.Mo.activeTargetIds}isActiveQueryTarget(e){return this.Mo.activeTargetIds.has(e)}start(){return this.Mo=new Il,Promise.resolve()}handleUserChange(e,t,n){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}class Cl{Oo(e){}shutdown(){}}const Sl="ConnectivityMonitor";class kl{constructor(){this.No=()=>this.Bo(),this.Lo=()=>this.ko(),this.qo=[],this.Qo()}Oo(e){this.qo.push(e)}shutdown(){window.removeEventListener("online",this.No),window.removeEventListener("offline",this.Lo)}Qo(){window.addEventListener("online",this.No),window.addEventListener("offline",this.Lo)}Bo(){dr(Sl,"Network connectivity changed: AVAILABLE");for(const e of this.qo)e(0)}ko(){dr(Sl,"Network connectivity changed: UNAVAILABLE");for(const e of this.qo)e(1)}static v(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener}}let Al=null;function Rl(){return null===Al?Al=268435456+Math.round(2147483648*Math.random()):Al++,"0x"+Al.toString(16)}const jl="RestConnection",Dl={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class Ol{get $o(){return!1}constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;const t=e.ssl?"https":"http",n=encodeURIComponent(this.databaseId.projectId),s=encodeURIComponent(this.databaseId.database);this.Uo=t+"://"+e.host,this.Ko=`projects/${n}/databases/${s}`,this.Wo=this.databaseId.database===Ui?`project_id=${n}`:`project_id=${n}&database_id=${s}`}Go(e,t,n,s,r){const i=Rl(),a=this.zo(e,t.toUriEncodedString());dr(jl,`Sending RPC '${e}' ${i}:`,a,n);const o={"google-cloud-resource-prefix":this.Ko,"x-goog-request-params":this.Wo};this.jo(o,s,r);const{host:c}=new URL(a),l=Pe(c);return this.Jo(e,a,o,n,l).then(t=>(dr(jl,`Received RPC '${e}' ${i}: `,t),t),t=>{throw fr(jl,`RPC '${e}' ${i} failed with error: `,t,"url: ",a,"request:",n),t})}Ho(e,t,n,s,r,i){return this.Go(e,t,n,s,r)}jo(e,t,n){e["X-Goog-Api-Client"]="gl-js/ fire/"+lr,e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),t&&t.headers.forEach((t,n)=>e[n]=t),n&&n.headers.forEach((t,n)=>e[n]=t)}zo(e,t){const n=Dl[e];return`${this.Uo}/v1/${t}:${n}`}terminate(){}}class Pl{constructor(e){this.Yo=e.Yo,this.Zo=e.Zo}Xo(e){this.e_=e}t_(e){this.n_=e}r_(e){this.i_=e}onMessage(e){this.s_=e}close(){this.Zo()}send(e){this.Yo(e)}o_(){this.e_()}__(){this.n_()}a_(e){this.i_(e)}u_(e){this.s_(e)}}const Ll="WebChannelConnection";class Ml extends Ol{constructor(e){super(e),this.c_=[],this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}Jo(e,t,n,s,r){const i=Rl();return new Promise((r,a)=>{const o=new Xs;o.setWithCredentials(!0),o.listenOnce(Zs.COMPLETE,()=>{try{switch(o.getLastErrorCode()){case er.NO_ERROR:const t=o.getResponseJson();dr(Ll,`XHR for RPC '${e}' ${i} received:`,JSON.stringify(t)),r(t);break;case er.TIMEOUT:dr(Ll,`RPC '${e}' ${i} timed out`),a(new xr(br.DEADLINE_EXCEEDED,"Request time out"));break;case er.HTTP_ERROR:const n=o.getStatus();if(dr(Ll,`RPC '${e}' ${i} failed with status:`,n,"response text:",o.getResponseText()),n>0){let e=o.getResponseJson();Array.isArray(e)&&(e=e[0]);const t=e?.error;if(t&&t.status&&t.message){const e=function(e){const t=e.toLowerCase().replace(/_/g,"-");return Object.values(br).indexOf(t)>=0?t:br.UNKNOWN}(t.status);a(new xr(e,t.message))}else a(new xr(br.UNKNOWN,"Server responded with status "+o.getStatus()))}else a(new xr(br.UNAVAILABLE,"Connection failed."));break;default:gr(9055,{l_:e,streamId:i,h_:o.getLastErrorCode(),P_:o.getLastError()})}}finally{dr(Ll,`RPC '${e}' ${i} completed.`)}});const c=JSON.stringify(s);dr(Ll,`RPC '${e}' ${i} sending request:`,s),o.send(t,"POST",c,n,15)})}T_(e,t,n){const s=Rl(),r=[this.Uo,"/","google.firestore.v1.Firestore","/",e,"/channel"],i=rr(),a=sr(),o={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},c=this.longPollingOptions.timeoutSeconds;void 0!==c&&(o.longPollingTimeout=Math.round(1e3*c)),this.useFetchStreams&&(o.useFetchStreams=!0),this.jo(o.initMessageHeaders,t,n),o.encodeInitMessageHeaders=!0;const l=r.join("");dr(Ll,`Creating RPC '${e}' stream ${s}: ${l}`,o);const u=i.createWebChannel(l,o);this.I_(u);let h=!1,d=!1;const p=new Pl({Yo:t=>{d?dr(Ll,`Not sending because RPC '${e}' stream ${s} is closed:`,t):(h||(dr(Ll,`Opening RPC '${e}' stream ${s} transport.`),u.open(),h=!0),dr(Ll,`RPC '${e}' stream ${s} sending:`,t),u.send(t))},Zo:()=>u.close()}),f=(e,t,n)=>{e.listen(t,e=>{try{n(e)}catch(t){setTimeout(()=>{throw t},0)}})};return f(u,Js.EventType.OPEN,()=>{d||(dr(Ll,`RPC '${e}' stream ${s} transport opened.`),p.o_())}),f(u,Js.EventType.CLOSE,()=>{d||(d=!0,dr(Ll,`RPC '${e}' stream ${s} transport closed`),p.a_(),this.E_(u))}),f(u,Js.EventType.ERROR,t=>{d||(d=!0,fr(Ll,`RPC '${e}' stream ${s} transport errored. Name:`,t.name,"Message:",t.message),p.a_(new xr(br.UNAVAILABLE,"The operation could not be completed")))}),f(u,Js.EventType.MESSAGE,t=>{if(!d){const n=t.data[0];vr(!!n,16349);const r=n,i=r?.error||r[0]?.error;if(i){dr(Ll,`RPC '${e}' stream ${s} received error:`,i);const t=i.status;let n=function(e){const t=Go[e];if(void 0!==t)return Ko(t)}(t),r=i.message;void 0===n&&(n=br.INTERNAL,r="Unknown error status: "+t+" with message "+i.message),d=!0,p.a_(new xr(n,r)),u.close()}else dr(Ll,`RPC '${e}' stream ${s} received:`,n),p.u_(n)}}),f(a,nr.STAT_EVENT,t=>{t.stat===tr.PROXY?dr(Ll,`RPC '${e}' stream ${s} detected buffering proxy`):t.stat===tr.NOPROXY&&dr(Ll,`RPC '${e}' stream ${s} detected no buffering proxy`)}),setTimeout(()=>{p.__()},0),p}terminate(){this.c_.forEach(e=>e.close()),this.c_=[]}I_(e){this.c_.push(e)}E_(e){this.c_=this.c_.filter(t=>t===e)}}function Ul(){return"undefined"!=typeof document?document:null}function Fl(e){return new hc(e,!0)}class Vl{constructor(e,t,n=1e3,s=1.5,r=6e4){this.Mi=e,this.timerId=t,this.d_=n,this.A_=s,this.R_=r,this.V_=0,this.m_=null,this.f_=Date.now(),this.reset()}reset(){this.V_=0}g_(){this.V_=this.R_}p_(e){this.cancel();const t=Math.floor(this.V_+this.y_()),n=Math.max(0,Date.now()-this.f_),s=Math.max(0,t-n);s>0&&dr("ExponentialBackoff",`Backing off for ${s} ms (base delay: ${this.V_} ms, delay with jitter: ${t} ms, last attempt: ${n} ms ago)`),this.m_=this.Mi.enqueueAfterDelay(this.timerId,s,()=>(this.f_=Date.now(),e())),this.V_*=this.A_,this.V_<this.d_&&(this.V_=this.d_),this.V_>this.R_&&(this.V_=this.R_)}w_(){null!==this.m_&&(this.m_.skipDelay(),this.m_=null)}cancel(){null!==this.m_&&(this.m_.cancel(),this.m_=null)}y_(){return(Math.random()-.5)*this.V_}}const $l="PersistentStream";class Bl{constructor(e,t,n,s,r,i,a,o){this.Mi=e,this.S_=n,this.b_=s,this.connection=r,this.authCredentialsProvider=i,this.appCheckCredentialsProvider=a,this.listener=o,this.state=0,this.D_=0,this.C_=null,this.v_=null,this.stream=null,this.F_=0,this.M_=new Vl(e,t)}x_(){return 1===this.state||5===this.state||this.O_()}O_(){return 2===this.state||3===this.state}start(){this.F_=0,4!==this.state?this.auth():this.N_()}async stop(){this.x_()&&await this.close(0)}B_(){this.state=0,this.M_.reset()}L_(){this.O_()&&null===this.C_&&(this.C_=this.Mi.enqueueAfterDelay(this.S_,6e4,()=>this.k_()))}q_(e){this.Q_(),this.stream.send(e)}async k_(){if(this.O_())return this.close(0)}Q_(){this.C_&&(this.C_.cancel(),this.C_=null)}U_(){this.v_&&(this.v_.cancel(),this.v_=null)}async close(e,t){this.Q_(),this.U_(),this.M_.cancel(),this.D_++,4!==e?this.M_.reset():t&&t.code===br.RESOURCE_EXHAUSTED?(pr(t.toString()),pr("Using maximum backoff delay to prevent overloading the backend."),this.M_.g_()):t&&t.code===br.UNAUTHENTICATED&&3!==this.state&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),null!==this.stream&&(this.K_(),this.stream.close(),this.stream=null),this.state=e,await this.listener.r_(t)}K_(){}auth(){this.state=1;const e=this.W_(this.D_),t=this.D_;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([e,n])=>{this.D_===t&&this.G_(e,n)},t=>{e(()=>{const e=new xr(br.UNKNOWN,"Fetching auth token failed: "+t.message);return this.z_(e)})})}G_(e,t){const n=this.W_(this.D_);this.stream=this.j_(e,t),this.stream.Xo(()=>{n(()=>this.listener.Xo())}),this.stream.t_(()=>{n(()=>(this.state=2,this.v_=this.Mi.enqueueAfterDelay(this.b_,1e4,()=>(this.O_()&&(this.state=3),Promise.resolve())),this.listener.t_()))}),this.stream.r_(e=>{n(()=>this.z_(e))}),this.stream.onMessage(e=>{n(()=>1==++this.F_?this.J_(e):this.onNext(e))})}N_(){this.state=5,this.M_.p_(async()=>{this.state=0,this.start()})}z_(e){return dr($l,`close with error: ${e}`),this.stream=null,this.close(4,e)}W_(e){return t=>{this.Mi.enqueueAndForget(()=>this.D_===e?t():(dr($l,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class ql extends Bl{constructor(e,t,n,s,r,i){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,n,s,i),this.serializer=r}j_(e,t){return this.connection.T_("Listen",e,t)}J_(e){return this.onNext(e)}onNext(e){this.M_.reset();const t=function(e,t){let n;if("targetChange"in t){t.targetChange;const r="NO_CHANGE"===(s=t.targetChange.targetChangeType||"NO_CHANGE")?0:"ADD"===s?1:"REMOVE"===s?2:"CURRENT"===s?3:"RESET"===s?4:gr(39313,{state:s}),i=t.targetChange.targetIds||[],a=function(e,t){return e.useProto3Json?(vr(void 0===t||"string"==typeof t,58123),Ii.fromBase64String(t||"")):(vr(void 0===t||t instanceof Buffer||t instanceof Uint8Array,16193),Ii.fromUint8Array(t||new Uint8Array))}(e,t.targetChange.resumeToken),o=t.targetChange.cause,c=o&&function(e){const t=void 0===e.code?br.UNKNOWN:Ko(e.code);return new xr(t,e.message||"")}(o);n=new sc(r,i,a,c||null)}else if("documentChange"in t){t.documentChange;const s=t.documentChange;s.document,s.document.name,s.document.updateTime;const r=xc(e,s.document.name),i=gc(s.document.updateTime),a=s.document.createTime?gc(s.document.createTime):ni.min(),o=new oa({mapValue:{fields:s.document.fields}}),c=la.newFoundDocument(r,i,a,o),l=s.targetIds||[],u=s.removedTargetIds||[];n=new tc(l,u,c.key,c)}else if("documentDelete"in t){t.documentDelete;const s=t.documentDelete;s.document;const r=xc(e,s.document),i=s.readTime?gc(s.readTime):ni.min(),a=la.newNoDocument(r,i),o=s.removedTargetIds||[];n=new tc([],o,a.key,a)}else if("documentRemove"in t){t.documentRemove;const s=t.documentRemove;s.document;const r=xc(e,s.document),i=s.removedTargetIds||[];n=new tc([],i,r,null)}else{if(!("filter"in t))return gr(11601,{Rt:t});{t.filter;const e=t.filter;e.targetId;const{count:s=0,unchangedNames:r}=e,i=new zo(s,r),a=e.targetId;n=new nc(a,i)}}var s;return n}(this.serializer,e),n=function(e){if(!("targetChange"in e))return ni.min();const t=e.targetChange;return t.targetIds&&t.targetIds.length?ni.min():t.readTime?gc(t.readTime):ni.min()}(e);return this.listener.H_(t,n)}Y_(e){const t={};t.database=Ec(this.serializer),t.addTarget=function(e,t){let n;const s=t.target;if(n=Pa(s)?{documents:Nc(e,s)}:{query:Cc(e,s).ft},n.targetId=t.targetId,t.resumeToken.approximateByteSize()>0){n.resumeToken=fc(e,t.resumeToken);const s=dc(e,t.expectedCount);null!==s&&(n.expectedCount=s)}else if(t.snapshotVersion.compareTo(ni.min())>0){n.readTime=pc(e,t.snapshotVersion.toTimestamp());const s=dc(e,t.expectedCount);null!==s&&(n.expectedCount=s)}return n}(this.serializer,e);const n=function(e,t){const n=function(e){switch(e){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return gr(28987,{purpose:e})}}(t.purpose);return null==n?null:{"goog-listen-tags":n}}(this.serializer,e);n&&(t.labels=n),this.q_(t)}Z_(e){const t={};t.database=Ec(this.serializer),t.removeTarget=e,this.q_(t)}}class zl extends Bl{constructor(e,t,n,s,r,i){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,n,s,i),this.serializer=r}get X_(){return this.F_>0}start(){this.lastStreamToken=void 0,super.start()}K_(){this.X_&&this.ea([])}j_(e,t){return this.connection.T_("Write",e,t)}J_(e){return vr(!!e.streamToken,31322),this.lastStreamToken=e.streamToken,vr(!e.writeResults||0===e.writeResults.length,55816),this.listener.ta()}onNext(e){vr(!!e.streamToken,12678),this.lastStreamToken=e.streamToken,this.M_.reset();const t=function(e,t){return e&&e.length>0?(vr(void 0!==t,14353),e.map(e=>function(e,t){let n=e.updateTime?gc(e.updateTime):gc(t);return n.isEqual(ni.min())&&(n=gc(t)),new Io(n,e.transformResults||[])}(e,t))):[]}(e.writeResults,e.commitTime),n=gc(e.commitTime);return this.listener.na(n,t)}ra(){const e={};e.database=Ec(this.serializer),this.q_(e)}ea(e){const t={streamToken:this.lastStreamToken,writes:e.map(e=>function(e,t){let n;if(t instanceof Oo)n={update:Ic(e,t.key,t.value)};else if(t instanceof Fo)n={delete:bc(e,t.key)};else if(t instanceof Po)n={update:Ic(e,t.key,t.data),updateMask:Lc(t.fieldMask)};else{if(!(t instanceof Vo))return gr(16599,{Vt:t.type});n={verify:bc(e,t.key)}}return t.fieldTransforms.length>0&&(n.updateTransforms=t.fieldTransforms.map(e=>function(e,t){const n=t.transform;if(n instanceof yo)return{fieldPath:t.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(n instanceof vo)return{fieldPath:t.field.canonicalString(),appendMissingElements:{values:n.elements}};if(n instanceof bo)return{fieldPath:t.field.canonicalString(),removeAllFromArray:{values:n.elements}};if(n instanceof _o)return{fieldPath:t.field.canonicalString(),increment:n.Ae};throw gr(20930,{transform:t.transform})}(0,e))),t.precondition.isNone||(n.currentDocument=(s=e,void 0!==(r=t.precondition).updateTime?{updateTime:mc(s,r.updateTime)}:void 0!==r.exists?{exists:r.exists}:gr(27497))),n;var s,r}(this.serializer,e))};this.q_(t)}}class Gl{}class Hl extends Gl{constructor(e,t,n,s){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=n,this.serializer=s,this.ia=!1}sa(){if(this.ia)throw new xr(br.FAILED_PRECONDITION,"The client has already been terminated.")}Go(e,t,n,s){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([r,i])=>this.connection.Go(e,vc(t,n),s,r,i)).catch(e=>{throw"FirebaseError"===e.name?(e.code===br.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),e):new xr(br.UNKNOWN,e.toString())})}Ho(e,t,n,s,r){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([i,a])=>this.connection.Ho(e,vc(t,n),s,i,a,r)).catch(e=>{throw"FirebaseError"===e.name?(e.code===br.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),e):new xr(br.UNKNOWN,e.toString())})}terminate(){this.ia=!0,this.connection.terminate()}}class Kl{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.oa=0,this._a=null,this.aa=!0}ua(){0===this.oa&&(this.ca("Unknown"),this._a=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this._a=null,this.la("Backend didn't respond within 10 seconds."),this.ca("Offline"),Promise.resolve())))}ha(e){"Online"===this.state?this.ca("Unknown"):(this.oa++,this.oa>=1&&(this.Pa(),this.la(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.ca("Offline")))}set(e){this.Pa(),this.oa=0,"Online"===e&&(this.aa=!1),this.ca(e)}ca(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}la(e){const t=`Could not reach Cloud Firestore backend. ${e}\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.aa?(pr(t),this.aa=!1):dr("OnlineStateTracker",t)}Pa(){null!==this._a&&(this._a.cancel(),this._a=null)}}const Wl="RemoteStore";class Ql{constructor(e,t,n,s,r){this.localStore=e,this.datastore=t,this.asyncQueue=n,this.remoteSyncer={},this.Ta=[],this.Ia=new Map,this.Ea=new Set,this.da=[],this.Aa=r,this.Aa.Oo(e=>{n.enqueueAndForget(async()=>{ru(this)&&(dr(Wl,"Restarting streams for network reachability change."),await async function(e){const t=wr(e);t.Ea.add(4),await Xl(t),t.Ra.set("Unknown"),t.Ea.delete(4),await Yl(t)}(this))})}),this.Ra=new Kl(n,s)}}async function Yl(e){if(ru(e))for(const t of e.da)await t(!0)}async function Xl(e){for(const t of e.da)await t(!1)}function Jl(e,t){const n=wr(e);n.Ia.has(t.targetId)||(n.Ia.set(t.targetId,t),su(n)?nu(n):_u(n).O_()&&eu(n,t))}function Zl(e,t){const n=wr(e),s=_u(n);n.Ia.delete(t),s.O_()&&tu(n,t),0===n.Ia.size&&(s.O_()?s.L_():ru(n)&&n.Ra.set("Unknown"))}function eu(e,t){if(e.Va.Ue(t.targetId),t.resumeToken.approximateByteSize()>0||t.snapshotVersion.compareTo(ni.min())>0){const n=e.remoteSyncer.getRemoteKeysForTarget(t.targetId).size;t=t.withExpectedCount(n)}_u(e).Y_(t)}function tu(e,t){e.Va.Ue(t),_u(e).Z_(t)}function nu(e){e.Va=new ic({getRemoteKeysForTarget:t=>e.remoteSyncer.getRemoteKeysForTarget(t),At:t=>e.Ia.get(t)||null,ht:()=>e.datastore.serializer.databaseId}),_u(e).start(),e.Ra.ua()}function su(e){return ru(e)&&!_u(e).x_()&&e.Ia.size>0}function ru(e){return 0===wr(e).Ea.size}function iu(e){e.Va=void 0}async function au(e){e.Ra.set("Online")}async function ou(e){e.Ia.forEach((t,n)=>{eu(e,t)})}async function cu(e,t){iu(e),su(e)?(e.Ra.ha(t),nu(e)):e.Ra.set("Unknown")}async function lu(e,t,n){if(e.Ra.set("Online"),t instanceof sc&&2===t.state&&t.cause)try{await async function(e,t){const n=t.cause;for(const s of t.targetIds)e.Ia.has(s)&&(await e.remoteSyncer.rejectListen(s,n),e.Ia.delete(s),e.Va.removeTarget(s))}(e,t)}catch(s){dr(Wl,"Failed to remove targets %s: %s ",t.targetIds.join(","),s),await uu(e,s)}else if(t instanceof tc?e.Va.Ze(t):t instanceof nc?e.Va.st(t):e.Va.tt(t),!n.isEqual(ni.min()))try{const t=await bl(e.localStore);n.compareTo(t)>=0&&await function(e,t){const n=e.Va.Tt(t);return n.targetChanges.forEach((n,s)=>{if(n.resumeToken.approximateByteSize()>0){const r=e.Ia.get(s);r&&e.Ia.set(s,r.withResumeToken(n.resumeToken,t))}}),n.targetMismatches.forEach((t,n)=>{const s=e.Ia.get(t);if(!s)return;e.Ia.set(t,s.withResumeToken(Ii.EMPTY_BYTE_STRING,s.snapshotVersion)),tu(e,t);const r=new Uc(s.target,t,n,s.sequenceNumber);eu(e,r)}),e.remoteSyncer.applyRemoteEvent(n)}(e,n)}catch(r){dr(Wl,"Failed to raise snapshot:",r),await uu(e,r)}}async function uu(e,t,n){if(!li(t))throw t;e.Ea.add(1),await Xl(e),e.Ra.set("Offline"),n||(n=()=>bl(e.localStore)),e.asyncQueue.enqueueRetryable(async()=>{dr(Wl,"Retrying IndexedDB access"),await n(),e.Ea.delete(1),await Yl(e)})}function hu(e,t){return t().catch(n=>uu(e,n,t))}async function du(e){const t=wr(e),n=Eu(t);let s=t.Ta.length>0?t.Ta[t.Ta.length-1].batchId:-1;for(;pu(t);)try{const e=await _l(t.localStore,s);if(null===e){0===t.Ta.length&&n.L_();break}s=e.batchId,fu(t,e)}catch(r){await uu(t,r)}mu(t)&&gu(t)}function pu(e){return ru(e)&&e.Ta.length<10}function fu(e,t){e.Ta.push(t);const n=Eu(e);n.O_()&&n.X_&&n.ea(t.mutations)}function mu(e){return ru(e)&&!Eu(e).x_()&&e.Ta.length>0}function gu(e){Eu(e).start()}async function yu(e){Eu(e).ra()}async function vu(e){const t=Eu(e);for(const n of e.Ta)t.ea(n.mutations)}async function wu(e,t,n){const s=e.Ta.shift(),r=Bo.from(s,t,n);await hu(e,()=>e.remoteSyncer.applySuccessfulWrite(r)),await du(e)}async function bu(e,t){t&&Eu(e).X_&&await async function(e,t){if(function(e){switch(e){case br.OK:return gr(64938);case br.CANCELLED:case br.UNKNOWN:case br.DEADLINE_EXCEEDED:case br.RESOURCE_EXHAUSTED:case br.INTERNAL:case br.UNAVAILABLE:case br.UNAUTHENTICATED:return!1;case br.INVALID_ARGUMENT:case br.NOT_FOUND:case br.ALREADY_EXISTS:case br.PERMISSION_DENIED:case br.FAILED_PRECONDITION:case br.ABORTED:case br.OUT_OF_RANGE:case br.UNIMPLEMENTED:case br.DATA_LOSS:return!0;default:return gr(15467,{code:e})}}(n=t.code)&&n!==br.ABORTED){const n=e.Ta.shift();Eu(e).B_(),await hu(e,()=>e.remoteSyncer.rejectFailedWrite(n.batchId,t)),await du(e)}var n}(e,t),mu(e)&&gu(e)}async function xu(e,t){const n=wr(e);n.asyncQueue.verifyOperationInProgress(),dr(Wl,"RemoteStore received new credentials");const s=ru(n);n.Ea.add(3),await Xl(n),s&&n.Ra.set("Unknown"),await n.remoteSyncer.handleCredentialChange(t),n.Ea.delete(3),await Yl(n)}function _u(e){return e.ma||(e.ma=function(e,t,n){const s=wr(e);return s.sa(),new ql(t,s.connection,s.authCredentials,s.appCheckCredentials,s.serializer,n)}(e.datastore,e.asyncQueue,{Xo:au.bind(null,e),t_:ou.bind(null,e),r_:cu.bind(null,e),H_:lu.bind(null,e)}),e.da.push(async t=>{t?(e.ma.B_(),su(e)?nu(e):e.Ra.set("Unknown")):(await e.ma.stop(),iu(e))})),e.ma}function Eu(e){return e.fa||(e.fa=function(e,t,n){const s=wr(e);return s.sa(),new zl(t,s.connection,s.authCredentials,s.appCheckCredentials,s.serializer,n)}(e.datastore,e.asyncQueue,{Xo:()=>Promise.resolve(),t_:yu.bind(null,e),r_:bu.bind(null,e),ta:vu.bind(null,e),na:wu.bind(null,e)}),e.da.push(async t=>{t?(e.fa.B_(),await du(e)):(await e.fa.stop(),e.Ta.length>0&&(dr(Wl,`Stopping write stream with ${e.Ta.length} pending writes`),e.Ta=[]))})),e.fa}class Tu{constructor(e,t,n,s,r){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=n,this.op=s,this.removalCallback=r,this.deferred=new _r,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(e=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,t,n,s,r){const i=Date.now()+n,a=new Tu(e,t,i,s,r);return a.start(n),a}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new xr(br.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>null!==this.timerHandle?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function Iu(e,t){if(pr("AsyncQueue",`${t}: ${e}`),li(e))return new xr(br.UNAVAILABLE,`${t}: ${e}`);throw e}class Nu{static emptySet(e){return new Nu(e.comparator)}constructor(e){this.comparator=e?(t,n)=>e(t,n)||zr.comparator(t.key,n.key):(e,t)=>zr.comparator(e.key,t.key),this.keyedMap=eo(),this.sortedSet=new vi(this.comparator)}has(e){return null!=this.keyedMap.get(e)}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((t,n)=>(e(t),!1))}add(e){const t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){const t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof Nu))return!1;if(this.size!==e.size)return!1;const t=this.sortedSet.getIterator(),n=e.sortedSet.getIterator();for(;t.hasNext();){const e=t.getNext().key,s=n.getNext().key;if(!e.isEqual(s))return!1}return!0}toString(){const e=[];return this.forEach(t=>{e.push(t.toString())}),0===e.length?"DocumentSet ()":"DocumentSet (\n  "+e.join("  \n")+"\n)"}copy(e,t){const n=new Nu;return n.comparator=this.comparator,n.keyedMap=e,n.sortedSet=t,n}}class Cu{constructor(){this.ga=new vi(zr.comparator)}track(e){const t=e.doc.key,n=this.ga.get(t);n?0!==e.type&&3===n.type?this.ga=this.ga.insert(t,e):3===e.type&&1!==n.type?this.ga=this.ga.insert(t,{type:n.type,doc:e.doc}):2===e.type&&2===n.type?this.ga=this.ga.insert(t,{type:2,doc:e.doc}):2===e.type&&0===n.type?this.ga=this.ga.insert(t,{type:0,doc:e.doc}):1===e.type&&0===n.type?this.ga=this.ga.remove(t):1===e.type&&2===n.type?this.ga=this.ga.insert(t,{type:1,doc:n.doc}):0===e.type&&1===n.type?this.ga=this.ga.insert(t,{type:2,doc:e.doc}):gr(63341,{Rt:e,pa:n}):this.ga=this.ga.insert(t,e)}ya(){const e=[];return this.ga.inorderTraversal((t,n)=>{e.push(n)}),e}}class Su{constructor(e,t,n,s,r,i,a,o,c){this.query=e,this.docs=t,this.oldDocs=n,this.docChanges=s,this.mutatedKeys=r,this.fromCache=i,this.syncStateChanged=a,this.excludesMetadataChanges=o,this.hasCachedResults=c}static fromInitialDocuments(e,t,n,s,r){const i=[];return t.forEach(e=>{i.push({type:0,doc:e})}),new Su(e,t,Nu.emptySet(t),i,n,s,!0,!1,r)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&za(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const t=this.docChanges,n=e.docChanges;if(t.length!==n.length)return!1;for(let s=0;s<t.length;s++)if(t[s].type!==n[s].type||!t[s].doc.isEqual(n[s].doc))return!1;return!0}}class ku{constructor(){this.wa=void 0,this.Sa=[]}ba(){return this.Sa.some(e=>e.Da())}}class Au{constructor(){this.queries=Ru(),this.onlineState="Unknown",this.Ca=new Set}terminate(){!function(e,t){const n=wr(e),s=n.queries;n.queries=Ru(),s.forEach((e,n)=>{for(const s of n.Sa)s.onError(t)})}(this,new xr(br.ABORTED,"Firestore shutting down"))}}function Ru(){return new Ya(e=>Ga(e),za)}function ju(e,t){const n=wr(e);let s=!1;for(const r of t){const e=r.query,t=n.queries.get(e);if(t){for(const e of t.Sa)e.Fa(r)&&(s=!0);t.wa=r}}s&&Ou(n)}function Du(e,t,n){const s=wr(e),r=s.queries.get(t);if(r)for(const i of r.Sa)i.onError(n);s.queries.delete(t)}function Ou(e){e.Ca.forEach(e=>{e.next()})}var Pu,Lu;(Lu=Pu||(Pu={})).Ma="default",Lu.Cache="cache";class Mu{constructor(e,t,n){this.query=e,this.xa=t,this.Oa=!1,this.Na=null,this.onlineState="Unknown",this.options=n||{}}Fa(e){if(!this.options.includeMetadataChanges){const t=[];for(const n of e.docChanges)3!==n.type&&t.push(n);e=new Su(e.query,e.docs,e.oldDocs,t,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.Oa?this.Ba(e)&&(this.xa.next(e),t=!0):this.La(e,this.onlineState)&&(this.ka(e),t=!0),this.Na=e,t}onError(e){this.xa.error(e)}va(e){this.onlineState=e;let t=!1;return this.Na&&!this.Oa&&this.La(this.Na,e)&&(this.ka(this.Na),t=!0),t}La(e,t){if(!e.fromCache)return!0;if(!this.Da())return!0;const n="Offline"!==t;return(!this.options.qa||!n)&&(!e.docs.isEmpty()||e.hasCachedResults||"Offline"===t)}Ba(e){if(e.docChanges.length>0)return!0;const t=this.Na&&this.Na.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&!0===this.options.includeMetadataChanges}ka(e){e=Su.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.Oa=!0,this.xa.next(e)}Da(){return this.options.source!==Pu.Cache}}class Uu{constructor(e){this.key=e}}class Fu{constructor(e){this.key=e}}class Vu{constructor(e,t){this.query=e,this.Ya=t,this.Za=null,this.hasCachedResults=!1,this.current=!1,this.Xa=oo(),this.mutatedKeys=oo(),this.eu=Wa(e),this.tu=new Nu(this.eu)}get nu(){return this.Ya}ru(e,t){const n=t?t.iu:new Cu,s=t?t.tu:this.tu;let r=t?t.mutatedKeys:this.mutatedKeys,i=s,a=!1;const o="F"===this.query.limitType&&s.size===this.query.limit?s.last():null,c="L"===this.query.limitType&&s.size===this.query.limit?s.first():null;if(e.inorderTraversal((e,t)=>{const l=s.get(e),u=Ka(this.query,t)?t:null,h=!!l&&this.mutatedKeys.has(l.key),d=!!u&&(u.hasLocalMutations||this.mutatedKeys.has(u.key)&&u.hasCommittedMutations);let p=!1;l&&u?l.data.isEqual(u.data)?h!==d&&(n.track({type:3,doc:u}),p=!0):this.su(l,u)||(n.track({type:2,doc:u}),p=!0,(o&&this.eu(u,o)>0||c&&this.eu(u,c)<0)&&(a=!0)):!l&&u?(n.track({type:0,doc:u}),p=!0):l&&!u&&(n.track({type:1,doc:l}),p=!0,(o||c)&&(a=!0)),p&&(u?(i=i.add(u),r=d?r.add(e):r.delete(e)):(i=i.delete(e),r=r.delete(e)))}),null!==this.query.limit)for(;i.size>this.query.limit;){const e="F"===this.query.limitType?i.last():i.first();i=i.delete(e.key),r=r.delete(e.key),n.track({type:1,doc:e})}return{tu:i,iu:n,Cs:a,mutatedKeys:r}}su(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,n,s){const r=this.tu;this.tu=e.tu,this.mutatedKeys=e.mutatedKeys;const i=e.iu.ya();i.sort((e,t)=>function(e,t){const n=e=>{switch(e){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return gr(20277,{Rt:e})}};return n(e)-n(t)}(e.type,t.type)||this.eu(e.doc,t.doc)),this.ou(n),s=s??!1;const a=t&&!s?this._u():[],o=0===this.Xa.size&&this.current&&!s?1:0,c=o!==this.Za;return this.Za=o,0!==i.length||c?{snapshot:new Su(this.query,e.tu,r,i,e.mutatedKeys,0===o,c,!1,!!n&&n.resumeToken.approximateByteSize()>0),au:a}:{au:a}}va(e){return this.current&&"Offline"===e?(this.current=!1,this.applyChanges({tu:this.tu,iu:new Cu,mutatedKeys:this.mutatedKeys,Cs:!1},!1)):{au:[]}}uu(e){return!this.Ya.has(e)&&!!this.tu.has(e)&&!this.tu.get(e).hasLocalMutations}ou(e){e&&(e.addedDocuments.forEach(e=>this.Ya=this.Ya.add(e)),e.modifiedDocuments.forEach(e=>{}),e.removedDocuments.forEach(e=>this.Ya=this.Ya.delete(e)),this.current=e.current)}_u(){if(!this.current)return[];const e=this.Xa;this.Xa=oo(),this.tu.forEach(e=>{this.uu(e.key)&&(this.Xa=this.Xa.add(e.key))});const t=[];return e.forEach(e=>{this.Xa.has(e)||t.push(new Fu(e))}),this.Xa.forEach(n=>{e.has(n)||t.push(new Uu(n))}),t}cu(e){this.Ya=e.Qs,this.Xa=oo();const t=this.ru(e.documents);return this.applyChanges(t,!0)}lu(){return Su.fromInitialDocuments(this.query,this.tu,this.mutatedKeys,0===this.Za,this.hasCachedResults)}}const $u="SyncEngine";class Bu{constructor(e,t,n){this.query=e,this.targetId=t,this.view=n}}class qu{constructor(e){this.key=e,this.hu=!1}}class zu{constructor(e,t,n,s,r,i){this.localStore=e,this.remoteStore=t,this.eventManager=n,this.sharedClientState=s,this.currentUser=r,this.maxConcurrentLimboResolutions=i,this.Pu={},this.Tu=new Ya(e=>Ga(e),za),this.Iu=new Map,this.Eu=new Set,this.du=new vi(zr.comparator),this.Au=new Map,this.Ru=new rl,this.Vu={},this.mu=new Map,this.fu=Hc.cr(),this.onlineState="Unknown",this.gu=void 0}get isPrimaryClient(){return!0===this.gu}}async function Gu(e,t,n=!0){const s=dh(e);let r;const i=s.Tu.get(t);return i?(s.sharedClientState.addLocalQueryTarget(i.targetId),r=i.view.lu()):r=await Ku(s,t,n,!0),r}async function Hu(e,t){const n=dh(e);await Ku(n,t,!0,!1)}async function Ku(e,t,n,s){const r=await function(e,t){const n=wr(e);return n.persistence.runTransaction("Allocate target","readwrite",e=>{let s;return n.Pi.getTargetData(e,t).next(r=>r?(s=r,ci.resolve(s)):n.Pi.allocateTargetId(e).next(r=>(s=new Uc(t,r,"TargetPurposeListen",e.currentSequenceNumber),n.Pi.addTargetData(e,s).next(()=>s))))}).then(e=>{const s=n.Ms.get(e.targetId);return(null===s||e.snapshotVersion.compareTo(s.snapshotVersion)>0)&&(n.Ms=n.Ms.insert(e.targetId,e),n.xs.set(t,e.targetId)),e})}(e.localStore,$a(t)),i=r.targetId,a=e.sharedClientState.addLocalQueryTarget(i,n);let o;return s&&(o=await async function(e,t,n,s,r){e.pu=(t,n,s)=>async function(e,t,n,s){let r=t.view.ru(n);r.Cs&&(r=await Tl(e.localStore,t.query,!1).then(({documents:e})=>t.view.ru(e,r)));const i=s&&s.targetChanges.get(t.targetId),a=s&&null!=s.targetMismatches.get(t.targetId),o=t.view.applyChanges(r,e.isPrimaryClient,i,a);return ah(e,t.targetId,o.au),o.snapshot}(e,t,n,s);const i=await Tl(e.localStore,t,!0),a=new Vu(t,i.Qs),o=a.ru(i.documents),c=ec.createSynthesizedTargetChangeForCurrentChange(n,s&&"Offline"!==e.onlineState,r),l=a.applyChanges(o,e.isPrimaryClient,c);ah(e,n,l.au);const u=new Bu(t,n,a);return e.Tu.set(t,u),e.Iu.has(n)?e.Iu.get(n).push(t):e.Iu.set(n,[t]),l.snapshot}(e,t,i,"current"===a,r.resumeToken)),e.isPrimaryClient&&n&&Jl(e.remoteStore,r),o}async function Wu(e,t,n){const s=wr(e),r=s.Tu.get(t),i=s.Iu.get(r.targetId);if(i.length>1)return s.Iu.set(r.targetId,i.filter(e=>!za(e,t))),void s.Tu.delete(t);s.isPrimaryClient?(s.sharedClientState.removeLocalQueryTarget(r.targetId),s.sharedClientState.isActiveQueryTarget(r.targetId)||await El(s.localStore,r.targetId,!1).then(()=>{s.sharedClientState.clearQueryState(r.targetId),n&&Zl(s.remoteStore,r.targetId),rh(s,r.targetId)}).catch(oi)):(rh(s,r.targetId),await El(s.localStore,r.targetId,!0))}async function Qu(e,t){const n=wr(e),s=n.Tu.get(t),r=n.Iu.get(s.targetId);n.isPrimaryClient&&1===r.length&&(n.sharedClientState.removeLocalQueryTarget(s.targetId),Zl(n.remoteStore,s.targetId))}async function Yu(e,t,n){const s=function(e){const t=wr(e);return t.remoteStore.remoteSyncer.applySuccessfulWrite=eh.bind(null,t),t.remoteStore.remoteSyncer.rejectFailedWrite=th.bind(null,t),t}(e);try{const e=await function(e,t){const n=wr(e),s=ti.now(),r=t.reduce((e,t)=>e.add(t.key),oo());let i,a;return n.persistence.runTransaction("Locally write mutations","readwrite",e=>{let o=Ja(),c=oo();return n.Ns.getEntries(e,r).next(e=>{o=e,o.forEach((e,t)=>{t.isValidDocument()||(c=c.add(e))})}).next(()=>n.localDocuments.getOverlayedDocuments(e,o)).next(r=>{i=r;const a=[];for(const e of t){const t=jo(e,i.get(e.key).overlayedDocument);null!=t&&a.push(new Po(e.key,t,ca(t.value.mapValue),No.exists(!0)))}return n.mutationQueue.addMutationBatch(e,s,a,t)}).next(t=>{a=t;const s=t.applyToLocalDocumentSet(i,c);return n.documentOverlayCache.saveOverlays(e,t.batchId,s)})}).then(()=>({batchId:a.batchId,changes:to(i)}))}(s.localStore,t);s.sharedClientState.addPendingMutation(e.batchId),function(e,t,n){let s=e.Vu[e.currentUser.toKey()];s||(s=new vi(Dr)),s=s.insert(t,n),e.Vu[e.currentUser.toKey()]=s}(s,e.batchId,n),await lh(s,e.changes),await du(s.remoteStore)}catch(r){const e=Iu(r,"Failed to persist write");n.reject(e)}}async function Xu(e,t){const n=wr(e);try{const e=await xl(n.localStore,t);t.targetChanges.forEach((e,t)=>{const s=n.Au.get(t);s&&(vr(e.addedDocuments.size+e.modifiedDocuments.size+e.removedDocuments.size<=1,22616),e.addedDocuments.size>0?s.hu=!0:e.modifiedDocuments.size>0?vr(s.hu,14607):e.removedDocuments.size>0&&(vr(s.hu,42227),s.hu=!1))}),await lh(n,e,t)}catch(s){await oi(s)}}function Ju(e,t,n){const s=wr(e);if(s.isPrimaryClient&&0===n||!s.isPrimaryClient&&1===n){const e=[];s.Tu.forEach((n,s)=>{const r=s.view.va(t);r.snapshot&&e.push(r.snapshot)}),function(e,t){const n=wr(e);n.onlineState=t;let s=!1;n.queries.forEach((e,n)=>{for(const r of n.Sa)r.va(t)&&(s=!0)}),s&&Ou(n)}(s.eventManager,t),e.length&&s.Pu.H_(e),s.onlineState=t,s.isPrimaryClient&&s.sharedClientState.setOnlineState(t)}}async function Zu(e,t,n){const s=wr(e);s.sharedClientState.updateQueryState(t,"rejected",n);const r=s.Au.get(t),i=r&&r.key;if(i){let e=new vi(zr.comparator);e=e.insert(i,la.newNoDocument(i,ni.min()));const n=oo().add(i),r=new Zo(ni.min(),new Map,new vi(Dr),e,n);await Xu(s,r),s.du=s.du.remove(i),s.Au.delete(t),ch(s)}else await El(s.localStore,t,!1).then(()=>rh(s,t,n)).catch(oi)}async function eh(e,t){const n=wr(e),s=t.batch.batchId;try{const e=await function(e,t){const n=wr(e);return n.persistence.runTransaction("Acknowledge batch","readwrite-primary",e=>{const s=t.batch.keys(),r=n.Ns.newChangeBuffer({trackRemovals:!0});return function(e,t,n,s){const r=n.batch,i=r.keys();let a=ci.resolve();return i.forEach(e=>{a=a.next(()=>s.getEntry(t,e)).next(t=>{const i=n.docVersions.get(e);vr(null!==i,48541),t.version.compareTo(i)<0&&(r.applyToRemoteDocument(t,n),t.isValidDocument()&&(t.setReadTime(n.commitVersion),s.addEntry(t)))})}),a.next(()=>e.mutationQueue.removeMutationBatch(t,r))}(n,e,t,r).next(()=>r.apply(e)).next(()=>n.mutationQueue.performConsistencyCheck(e)).next(()=>n.documentOverlayCache.removeOverlaysForBatchId(e,s,t.batch.batchId)).next(()=>n.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(e,function(e){let t=oo();for(let n=0;n<e.mutationResults.length;++n)e.mutationResults[n].transformResults.length>0&&(t=t.add(e.batch.mutations[n].key));return t}(t))).next(()=>n.localDocuments.getDocuments(e,s))})}(n.localStore,t);sh(n,s,null),nh(n,s),n.sharedClientState.updateMutationState(s,"acknowledged"),await lh(n,e)}catch(r){await oi(r)}}async function th(e,t,n){const s=wr(e);try{const e=await function(e,t){const n=wr(e);return n.persistence.runTransaction("Reject batch","readwrite-primary",e=>{let s;return n.mutationQueue.lookupMutationBatch(e,t).next(t=>(vr(null!==t,37113),s=t.keys(),n.mutationQueue.removeMutationBatch(e,t))).next(()=>n.mutationQueue.performConsistencyCheck(e)).next(()=>n.documentOverlayCache.removeOverlaysForBatchId(e,s,t)).next(()=>n.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(e,s)).next(()=>n.localDocuments.getDocuments(e,s))})}(s.localStore,t);sh(s,t,n),nh(s,t),s.sharedClientState.updateMutationState(t,"rejected",n),await lh(s,e)}catch(r){await oi(r)}}function nh(e,t){(e.mu.get(t)||[]).forEach(e=>{e.resolve()}),e.mu.delete(t)}function sh(e,t,n){const s=wr(e);let r=s.Vu[s.currentUser.toKey()];if(r){const e=r.get(t);e&&(n?e.reject(n):e.resolve(),r=r.remove(t)),s.Vu[s.currentUser.toKey()]=r}}function rh(e,t,n=null){e.sharedClientState.removeLocalQueryTarget(t);for(const s of e.Iu.get(t))e.Tu.delete(s),n&&e.Pu.yu(s,n);e.Iu.delete(t),e.isPrimaryClient&&e.Ru.jr(t).forEach(t=>{e.Ru.containsKey(t)||ih(e,t)})}function ih(e,t){e.Eu.delete(t.path.canonicalString());const n=e.du.get(t);null!==n&&(Zl(e.remoteStore,n),e.du=e.du.remove(t),e.Au.delete(n),ch(e))}function ah(e,t,n){for(const s of n)s instanceof Uu?(e.Ru.addReference(s.key,t),oh(e,s)):s instanceof Fu?(dr($u,"Document no longer in limbo: "+s.key),e.Ru.removeReference(s.key,t),e.Ru.containsKey(s.key)||ih(e,s.key)):gr(19791,{wu:s})}function oh(e,t){const n=t.key,s=n.path.canonicalString();e.du.get(n)||e.Eu.has(s)||(dr($u,"New document in limbo: "+n),e.Eu.add(s),ch(e))}function ch(e){for(;e.Eu.size>0&&e.du.size<e.maxConcurrentLimboResolutions;){const t=e.Eu.values().next().value;e.Eu.delete(t);const n=new zr($r.fromString(t)),s=e.fu.next();e.Au.set(s,new qu(n)),e.du=e.du.insert(n,s),Jl(e.remoteStore,new Uc($a(Ma(n.path)),s,"TargetPurposeLimboResolution",ui.ce))}}async function lh(e,t,n){const s=wr(e),r=[],i=[],a=[];s.Tu.isEmpty()||(s.Tu.forEach((e,o)=>{a.push(s.pu(o,t,n).then(e=>{if((e||n)&&s.isPrimaryClient){const t=e?!e.fromCache:n?.targetChanges.get(o.targetId)?.current;s.sharedClientState.updateQueryState(o.targetId,t?"current":"not-current")}if(e){r.push(e);const t=fl.As(o.targetId,e);i.push(t)}}))}),await Promise.all(a),s.Pu.H_(r),await async function(e,t){const n=wr(e);try{await n.persistence.runTransaction("notifyLocalViewChanges","readwrite",e=>ci.forEach(t,t=>ci.forEach(t.Es,s=>n.persistence.referenceDelegate.addReference(e,t.targetId,s)).next(()=>ci.forEach(t.ds,s=>n.persistence.referenceDelegate.removeReference(e,t.targetId,s)))))}catch(s){if(!li(s))throw s;dr(yl,"Failed to update sequence numbers: "+s)}for(const r of t){const e=r.targetId;if(!r.fromCache){const t=n.Ms.get(e),s=t.snapshotVersion,r=t.withLastLimboFreeSnapshotVersion(s);n.Ms=n.Ms.insert(e,r)}}}(s.localStore,i))}async function uh(e,t){const n=wr(e);if(!n.currentUser.isEqual(t)){dr($u,"User change. New user:",t.toKey());const e=await wl(n.localStore,t);n.currentUser=t,r="'waitForPendingWrites' promise is rejected due to a user change.",(s=n).mu.forEach(e=>{e.forEach(e=>{e.reject(new xr(br.CANCELLED,r))})}),s.mu.clear(),n.sharedClientState.handleUserChange(t,e.removedBatchIds,e.addedBatchIds),await lh(n,e.Ls)}var s,r}function hh(e,t){const n=wr(e),s=n.Au.get(t);if(s&&s.hu)return oo().add(s.key);{let e=oo();const s=n.Iu.get(t);if(!s)return e;for(const t of s){const s=n.Tu.get(t);e=e.unionWith(s.view.nu)}return e}}function dh(e){const t=wr(e);return t.remoteStore.remoteSyncer.applyRemoteEvent=Xu.bind(null,t),t.remoteStore.remoteSyncer.getRemoteKeysForTarget=hh.bind(null,t),t.remoteStore.remoteSyncer.rejectListen=Zu.bind(null,t),t.Pu.H_=ju.bind(null,t.eventManager),t.Pu.yu=Du.bind(null,t.eventManager),t}class ph{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(e){this.serializer=Fl(e.databaseInfo.databaseId),this.sharedClientState=this.Du(e),this.persistence=this.Cu(e),await this.persistence.start(),this.localStore=this.vu(e),this.gcScheduler=this.Fu(e,this.localStore),this.indexBackfillerScheduler=this.Mu(e,this.localStore)}Fu(e,t){return null}Mu(e,t){return null}vu(e){return function(e,t,n,s){return new vl(e,t,n,s)}(this.persistence,new gl,e.initialUser,this.serializer)}Cu(e){return new ul(dl.mi,this.serializer)}Du(e){return new Nl}async terminate(){this.gcScheduler?.stop(),this.indexBackfillerScheduler?.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}ph.provider={build:()=>new ph};class fh extends ph{constructor(e){super(),this.cacheSizeBytes=e}Fu(e,t){vr(this.persistence.referenceDelegate instanceof pl,46915);const n=this.persistence.referenceDelegate.garbageCollector;return new Yc(n,e.asyncQueue,t)}Cu(e){const t=void 0!==this.cacheSizeBytes?Gc.withCacheSize(this.cacheSizeBytes):Gc.DEFAULT;return new ul(e=>pl.mi(e,t),this.serializer)}}class mh{async initialize(e,t){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(t),this.remoteStore=this.createRemoteStore(t),this.eventManager=this.createEventManager(t),this.syncEngine=this.createSyncEngine(t,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=e=>Ju(this.syncEngine,e,1),this.remoteStore.remoteSyncer.handleCredentialChange=uh.bind(null,this.syncEngine),await async function(e,t){const n=wr(e);t?(n.Ea.delete(2),await Yl(n)):t||(n.Ea.add(2),await Xl(n),n.Ra.set("Unknown"))}(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return new Au}createDatastore(e){const t=Fl(e.databaseInfo.databaseId),n=(s=e.databaseInfo,new Ml(s));var s;return function(e,t,n,s){return new Hl(e,t,n,s)}(e.authCredentials,e.appCheckCredentials,n,t)}createRemoteStore(e){return t=this.localStore,n=this.datastore,s=e.asyncQueue,r=e=>Ju(this.syncEngine,e,0),i=kl.v()?new kl:new Cl,new Ql(t,n,s,r,i);var t,n,s,r,i}createSyncEngine(e,t){return function(e,t,n,s,r,i,a){const o=new zu(e,t,n,s,r,i);return a&&(o.gu=!0),o}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}async terminate(){await async function(e){const t=wr(e);dr(Wl,"RemoteStore shutting down."),t.Ea.add(5),await Xl(t),t.Aa.shutdown(),t.Ra.set("Unknown")}(this.remoteStore),this.datastore?.terminate(),this.eventManager?.terminate()}}mh.provider={build:()=>new mh};class gh{constructor(e){this.observer=e,this.muted=!1}next(e){this.muted||this.observer.next&&this.Ou(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.Ou(this.observer.error,e):pr("Uncaught Error in snapshot listener:",e.toString()))}Nu(){this.muted=!0}Ou(e,t){setTimeout(()=>{this.muted||e(t)},0)}}const yh="FirestoreClient";class vh{constructor(e,t,n,s,r){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=n,this.databaseInfo=s,this.user=cr.UNAUTHENTICATED,this.clientId=jr.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=r,this.authCredentials.start(n,async e=>{dr(yh,"Received user=",e.uid),await this.authCredentialListener(e),this.user=e}),this.appCheckCredentials.start(n,e=>(dr(yh,"Received new app check token=",e),this.appCheckCredentialListener(e,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();const e=new _r;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(t){const n=Iu(t,"Failed to shutdown persistence");e.reject(n)}}),e.promise}}async function wh(e,t){e.asyncQueue.verifyOperationInProgress(),dr(yh,"Initializing OfflineComponentProvider");const n=e.configuration;await t.initialize(n);let s=n.initialUser;e.setCredentialChangeListener(async e=>{s.isEqual(e)||(await wl(t.localStore,e),s=e)}),t.persistence.setDatabaseDeletedListener(()=>e.terminate()),e._offlineComponents=t}async function bh(e,t){e.asyncQueue.verifyOperationInProgress();const n=await async function(e){if(!e._offlineComponents)if(e._uninitializedComponentsProvider){dr(yh,"Using user provided OfflineComponentProvider");try{await wh(e,e._uninitializedComponentsProvider._offline)}catch(t){const r=t;if(!("FirebaseError"===(n=r).name?n.code===br.FAILED_PRECONDITION||n.code===br.UNIMPLEMENTED:!("undefined"!=typeof DOMException&&n instanceof DOMException)||22===n.code||20===n.code||11===n.code))throw r;fr("Error using user provided cache. Falling back to memory cache: "+r),await wh(e,new ph)}}else dr(yh,"Using default OfflineComponentProvider"),await wh(e,new fh(void 0));var n;return e._offlineComponents}(e);dr(yh,"Initializing OnlineComponentProvider"),await t.initialize(n,e.configuration),e.setCredentialChangeListener(e=>xu(t.remoteStore,e)),e.setAppCheckTokenChangeListener((e,n)=>xu(t.remoteStore,n)),e._onlineComponents=t}async function xh(e){return e._onlineComponents||(e._uninitializedComponentsProvider?(dr(yh,"Using user provided OnlineComponentProvider"),await bh(e,e._uninitializedComponentsProvider._online)):(dr(yh,"Using default OnlineComponentProvider"),await bh(e,new mh))),e._onlineComponents}async function _h(e){const t=await xh(e),n=t.eventManager;return n.onListen=Gu.bind(null,t.syncEngine),n.onUnlisten=Wu.bind(null,t.syncEngine),n.onFirstRemoteStoreListen=Hu.bind(null,t.syncEngine),n.onLastRemoteStoreUnlisten=Qu.bind(null,t.syncEngine),n}function Eh(e){const t={};return void 0!==e.timeoutSeconds&&(t.timeoutSeconds=e.timeoutSeconds),t}const Th=new Map,Ih="firestore.googleapis.com",Nh=!0;class Ch{constructor(e){if(void 0===e.host){if(void 0!==e.ssl)throw new xr(br.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=Ih,this.ssl=Nh}else this.host=e.host,this.ssl=e.ssl??Nh;if(this.isUsingEmulator=void 0!==e.emulatorOptions,this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,void 0===e.cacheSizeBytes)this.cacheSizeBytes=zc;else{if(-1!==e.cacheSizeBytes&&e.cacheSizeBytes<1048576)throw new xr(br.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}(function(e,t,n,s){if(!0===t&&!0===s)throw new xr(br.INVALID_ARGUMENT,`${e} and ${n} cannot be used together.`)})("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:void 0===e.experimentalAutoDetectLongPolling?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=Eh(e.experimentalLongPollingOptions??{}),function(e){if(void 0!==e.timeoutSeconds){if(isNaN(e.timeoutSeconds))throw new xr(br.INVALID_ARGUMENT,`invalid long polling timeout: ${e.timeoutSeconds} (must not be NaN)`);if(e.timeoutSeconds<5)throw new xr(br.INVALID_ARGUMENT,`invalid long polling timeout: ${e.timeoutSeconds} (minimum allowed value is 5)`);if(e.timeoutSeconds>30)throw new xr(br.INVALID_ARGUMENT,`invalid long polling timeout: ${e.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&(t=this.experimentalLongPollingOptions,n=e.experimentalLongPollingOptions,t.timeoutSeconds===n.timeoutSeconds)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams;var t,n}}class Sh{constructor(e,t,n,s){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=n,this._app=s,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new Ch({}),this._settingsFrozen=!1,this._emulatorOptions={},this._terminateTask="notTerminated"}get app(){if(!this._app)throw new xr(br.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return"notTerminated"!==this._terminateTask}_setSettings(e){if(this._settingsFrozen)throw new xr(br.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new Ch(e),this._emulatorOptions=e.emulatorOptions||{},void 0!==e.credentials&&(this._authCredentials=function(e){if(!e)return new Tr;switch(e.type){case"firstParty":return new Sr(e.sessionIndex||"0",e.iamToken||null,e.authTokenFactory||null);case"provider":return e.client;default:throw new xr(br.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_getEmulatorOptions(){return this._emulatorOptions}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return"notTerminated"===this._terminateTask&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){"notTerminated"===this._terminateTask?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(e){const t=Th.get(e);t&&(dr("ComponentProvider","Removing Datastore"),Th.delete(e),t.terminate())}(this),Promise.resolve()}}class kh{constructor(e,t,n){this.converter=t,this._query=n,this.type="query",this.firestore=e}withConverter(e){return new kh(this.firestore,e,this._query)}}class Ah{constructor(e,t,n){this.converter=t,this._key=n,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new Rh(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new Ah(this.firestore,e,this._key)}toJSON(){return{type:Ah._jsonSchemaVersion,referencePath:this._key.toString()}}static fromJSON(e,t,n){if(Jr(t,Ah._jsonSchema))return new Ah(e,n||null,new zr($r.fromString(t.referencePath)))}}Ah._jsonSchemaVersion="firestore/documentReference/1.0",Ah._jsonSchema={type:Xr("string",Ah._jsonSchemaVersion),referencePath:Xr("string")};class Rh extends kh{constructor(e,t,n){super(e,t,Ma(n)),this._path=n,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new Ah(this.firestore,null,new zr(e))}withConverter(e){return new Rh(this.firestore,e,this._path)}}function jh(e,t,...n){if(e=rt(e),Gr("collection","path",t),e instanceof Sh){const s=$r.fromString(t,...n);return Kr(s),new Rh(e,null,s)}{if(!(e instanceof Ah||e instanceof Rh))throw new xr(br.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const s=e._path.child($r.fromString(t,...n));return Kr(s),new Rh(e.firestore,null,s)}}function Dh(e,t,...n){if(e=rt(e),1===arguments.length&&(t=jr.newId()),Gr("doc","path",t),e instanceof Sh){const s=$r.fromString(t,...n);return Hr(s),new Ah(e,null,new zr(s))}{if(!(e instanceof Ah||e instanceof Rh))throw new xr(br.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const s=e._path.child($r.fromString(t,...n));return Hr(s),new Ah(e.firestore,e instanceof Rh?e.converter:null,new zr(s))}}const Oh="AsyncQueue";class Ph{constructor(e=Promise.resolve()){this.Xu=[],this.ec=!1,this.tc=[],this.nc=null,this.rc=!1,this.sc=!1,this.oc=[],this.M_=new Vl(this,"async_queue_retry"),this._c=()=>{const e=Ul();e&&dr(Oh,"Visibility state changed to "+e.visibilityState),this.M_.w_()},this.ac=e;const t=Ul();t&&"function"==typeof t.addEventListener&&t.addEventListener("visibilitychange",this._c)}get isShuttingDown(){return this.ec}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.uc(),this.cc(e)}enterRestrictedMode(e){if(!this.ec){this.ec=!0,this.sc=e||!1;const t=Ul();t&&"function"==typeof t.removeEventListener&&t.removeEventListener("visibilitychange",this._c)}}enqueue(e){if(this.uc(),this.ec)return new Promise(()=>{});const t=new _r;return this.cc(()=>this.ec&&this.sc?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.Xu.push(e),this.lc()))}async lc(){if(0!==this.Xu.length){try{await this.Xu[0](),this.Xu.shift(),this.M_.reset()}catch(e){if(!li(e))throw e;dr(Oh,"Operation failed with retryable error: "+e)}this.Xu.length>0&&this.M_.p_(()=>this.lc())}}cc(e){const t=this.ac.then(()=>(this.rc=!0,e().catch(e=>{throw this.nc=e,this.rc=!1,pr("INTERNAL UNHANDLED ERROR: ",Lh(e)),e}).then(e=>(this.rc=!1,e))));return this.ac=t,t}enqueueAfterDelay(e,t,n){this.uc(),this.oc.indexOf(e)>-1&&(t=0);const s=Tu.createAndSchedule(this,e,t,n,e=>this.hc(e));return this.tc.push(s),s}uc(){this.nc&&gr(47125,{Pc:Lh(this.nc)})}verifyOperationInProgress(){}async Tc(){let e;do{e=this.ac,await e}while(e!==this.ac)}Ic(e){for(const t of this.tc)if(t.timerId===e)return!0;return!1}Ec(e){return this.Tc().then(()=>{this.tc.sort((e,t)=>e.targetTimeMs-t.targetTimeMs);for(const t of this.tc)if(t.skipDelay(),"all"!==e&&t.timerId===e)break;return this.Tc()})}dc(e){this.oc.push(e)}hc(e){const t=this.tc.indexOf(e);this.tc.splice(t,1)}}function Lh(e){let t=e.message||"";return e.stack&&(t=e.stack.includes(e.message)?e.stack:e.message+"\n"+e.stack),t}function Mh(e){return function(e,t){if("object"!=typeof e||null===e)return!1;const n=e;for(const s of t)if(s in n&&"function"==typeof n[s])return!0;return!1}(e,["next","error","complete"])}class Uh extends Sh{constructor(e,t,n,s){super(e,t,n,s),this.type="firestore",this._queue=new Ph,this._persistenceKey=s?.name||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){const e=this._firestoreClient.terminate();this._queue=new Ph(e),this._firestoreClient=void 0,await e}}}function Fh(e){if(e._terminated)throw new xr(br.FAILED_PRECONDITION,"The client has already been terminated.");return e._firestoreClient||function(e){const t=e._freezeSettings(),n=(s=e._databaseId,r=e._app?.options.appId||"",i=e._persistenceKey,a=t,new Mi(s,r,i,a.host,a.ssl,a.experimentalForceLongPolling,a.experimentalAutoDetectLongPolling,Eh(a.experimentalLongPollingOptions),a.useFetchStreams,a.isUsingEmulator));var s,r,i,a;e._componentsProvider||t.localCache?._offlineComponentProvider&&t.localCache?._onlineComponentProvider&&(e._componentsProvider={_offline:t.localCache._offlineComponentProvider,_online:t.localCache._onlineComponentProvider}),e._firestoreClient=new vh(e._authCredentials,e._appCheckCredentials,e._queue,n,e._componentsProvider&&function(e){const t=e?._online.build();return{_offline:e?._offline.build(t),_online:t}}(e._componentsProvider))}(e),e._firestoreClient}class Vh{constructor(e){this._byteString=e}static fromBase64String(e){try{return new Vh(Ii.fromBase64String(e))}catch(t){throw new xr(br.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(e){return new Vh(Ii.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}toJSON(){return{type:Vh._jsonSchemaVersion,bytes:this.toBase64()}}static fromJSON(e){if(Jr(e,Vh._jsonSchema))return Vh.fromBase64String(e.bytes)}}Vh._jsonSchemaVersion="firestore/bytes/1.0",Vh._jsonSchema={type:Xr("string",Vh._jsonSchemaVersion),bytes:Xr("string")};class $h{constructor(...e){for(let t=0;t<e.length;++t)if(0===e[t].length)throw new xr(br.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new qr(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}class Bh{constructor(e){this._methodName=e}}class qh{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new xr(br.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new xr(br.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}_compareTo(e){return Dr(this._lat,e._lat)||Dr(this._long,e._long)}toJSON(){return{latitude:this._lat,longitude:this._long,type:qh._jsonSchemaVersion}}static fromJSON(e){if(Jr(e,qh._jsonSchema))return new qh(e.latitude,e.longitude)}}qh._jsonSchemaVersion="firestore/geoPoint/1.0",qh._jsonSchema={type:Xr("string",qh._jsonSchemaVersion),latitude:Xr("number"),longitude:Xr("number")};class zh{constructor(e){this._values=(e||[]).map(e=>e)}toArray(){return this._values.map(e=>e)}isEqual(e){return function(e,t){if(e.length!==t.length)return!1;for(let n=0;n<e.length;++n)if(e[n]!==t[n])return!1;return!0}(this._values,e._values)}toJSON(){return{type:zh._jsonSchemaVersion,vectorValues:this._values}}static fromJSON(e){if(Jr(e,zh._jsonSchema)){if(Array.isArray(e.vectorValues)&&e.vectorValues.every(e=>"number"==typeof e))return new zh(e.vectorValues);throw new xr(br.INVALID_ARGUMENT,"Expected 'vectorValues' field to be a number array")}}}zh._jsonSchemaVersion="firestore/vectorValue/1.0",zh._jsonSchema={type:Xr("string",zh._jsonSchemaVersion),vectorValues:Xr("object")};const Gh=/^__.*__$/;class Hh{constructor(e,t,n){this.data=e,this.fieldMask=t,this.fieldTransforms=n}toMutation(e,t){return null!==this.fieldMask?new Po(e,this.data,this.fieldMask,t,this.fieldTransforms):new Oo(e,this.data,t,this.fieldTransforms)}}class Kh{constructor(e,t,n){this.data=e,this.fieldMask=t,this.fieldTransforms=n}toMutation(e,t){return new Po(e,this.data,this.fieldMask,t,this.fieldTransforms)}}function Wh(e){switch(e){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw gr(40011,{Ac:e})}}class Qh{constructor(e,t,n,s,r,i){this.settings=e,this.databaseId=t,this.serializer=n,this.ignoreUndefinedProperties=s,void 0===r&&this.Rc(),this.fieldTransforms=r||[],this.fieldMask=i||[]}get path(){return this.settings.path}get Ac(){return this.settings.Ac}Vc(e){return new Qh({...this.settings,...e},this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}mc(e){const t=this.path?.child(e),n=this.Vc({path:t,fc:!1});return n.gc(e),n}yc(e){const t=this.path?.child(e),n=this.Vc({path:t,fc:!1});return n.Rc(),n}wc(e){return this.Vc({path:void 0,fc:!0})}Sc(e){return od(e,this.settings.methodName,this.settings.bc||!1,this.path,this.settings.Dc)}contains(e){return void 0!==this.fieldMask.find(t=>e.isPrefixOf(t))||void 0!==this.fieldTransforms.find(t=>e.isPrefixOf(t.field))}Rc(){if(this.path)for(let e=0;e<this.path.length;e++)this.gc(this.path.get(e))}gc(e){if(0===e.length)throw this.Sc("Document fields must not be empty");if(Wh(this.Ac)&&Gh.test(e))throw this.Sc('Document fields cannot begin and end with "__"')}}class Yh{constructor(e,t,n){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=n||Fl(e)}Cc(e,t,n,s=!1){return new Qh({Ac:e,methodName:t,Dc:n,path:qr.emptyPath(),fc:!1,bc:s},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function Xh(e){const t=e._freezeSettings(),n=Fl(e._databaseId);return new Yh(e._databaseId,!!t.ignoreUndefinedProperties,n)}function Jh(e,t,n,s,r,i={}){const a=e.Cc(i.merge||i.mergeFields?2:0,t,n,r);sd("Data must be an object, but it was:",a,s);const o=td(s,a);let c,l;if(i.merge)c=new Ei(a.fieldMask),l=a.fieldTransforms;else if(i.mergeFields){const e=[];for(const s of i.mergeFields){const r=rd(t,s,n);if(!a.contains(r))throw new xr(br.INVALID_ARGUMENT,`Field '${r}' is specified in your field mask but missing from your input data.`);cd(e,r)||e.push(r)}c=new Ei(e),l=a.fieldTransforms.filter(e=>c.covers(e.field))}else c=null,l=a.fieldTransforms;return new Hh(new oa(o),c,l)}class Zh extends Bh{_toFieldTransform(e){if(2!==e.Ac)throw 1===e.Ac?e.Sc(`${this._methodName}() can only appear at the top level of your update data`):e.Sc(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof Zh}}function ed(e,t){if(nd(e=rt(e)))return sd("Unsupported field value:",t,e),td(e,t);if(e instanceof Bh)return function(e,t){if(!Wh(t.Ac))throw t.Sc(`${e._methodName}() can only be used with update() and set()`);if(!t.path)throw t.Sc(`${e._methodName}() is not currently supported inside arrays`);const n=e._toFieldTransform(t);n&&t.fieldTransforms.push(n)}(e,t),null;if(void 0===e&&t.ignoreUndefinedProperties)return null;if(t.path&&t.fieldMask.push(t.path),e instanceof Array){if(t.settings.fc&&4!==t.Ac)throw t.Sc("Nested arrays are not supported");return function(e,t){const n=[];let s=0;for(const r of e){let e=ed(r,t.wc(s));null==e&&(e={nullValue:"NULL_VALUE"}),n.push(e),s++}return{arrayValue:{values:n}}}(e,t)}return function(e,t){if(null===(e=rt(e)))return{nullValue:"NULL_VALUE"};if("number"==typeof e)return ho(t.serializer,e);if("boolean"==typeof e)return{booleanValue:e};if("string"==typeof e)return{stringValue:e};if(e instanceof Date){const n=ti.fromDate(e);return{timestampValue:pc(t.serializer,n)}}if(e instanceof ti){const n=new ti(e.seconds,1e3*Math.floor(e.nanoseconds/1e3));return{timestampValue:pc(t.serializer,n)}}if(e instanceof qh)return{geoPointValue:{latitude:e.latitude,longitude:e.longitude}};if(e instanceof Vh)return{bytesValue:fc(t.serializer,e._byteString)};if(e instanceof Ah){const n=t.databaseId,s=e.firestore._databaseId;if(!s.isEqual(n))throw t.Sc(`Document reference is for database ${s.projectId}/${s.database} but should be for database ${n.projectId}/${n.database}`);return{referenceValue:yc(e.firestore._databaseId||t.databaseId,e._key.path)}}if(e instanceof zh)return n=e,s=t,{mapValue:{fields:{[Vi]:{stringValue:qi},[zi]:{arrayValue:{values:n.toArray().map(e=>{if("number"!=typeof e)throw s.Sc("VectorValues must only contain numeric values.");return lo(s.serializer,e)})}}}}};var n,s;throw t.Sc(`Unsupported field value: ${Qr(e)}`)}(e,t)}function td(e,t){const n={};return yi(e)?t.path&&t.path.length>0&&t.fieldMask.push(t.path):gi(e,(e,s)=>{const r=ed(s,t.mc(e));null!=r&&(n[e]=r)}),{mapValue:{fields:n}}}function nd(e){return!("object"!=typeof e||null===e||e instanceof Array||e instanceof Date||e instanceof ti||e instanceof qh||e instanceof Vh||e instanceof Ah||e instanceof Bh||e instanceof zh)}function sd(e,t,n){if(!nd(n)||!Wr(n)){const s=Qr(n);throw"an object"===s?t.Sc(e+" a custom object"):t.Sc(e+" "+s)}}function rd(e,t,n){if((t=rt(t))instanceof $h)return t._internalPath;if("string"==typeof t)return ad(e,t);throw od("Field path arguments must be of type string or ",e,!1,void 0,n)}const id=new RegExp("[~\\*/\\[\\]]");function ad(e,t,n){if(t.search(id)>=0)throw od(`Invalid field path (${t}). Paths must not contain '~', '*', '/', '[', or ']'`,e,!1,void 0,n);try{return new $h(...t.split("."))._internalPath}catch(s){throw od(`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,e,!1,void 0,n)}}function od(e,t,n,s,r){const i=s&&!s.isEmpty(),a=void 0!==r;let o=`Function ${t}() called with invalid data`;n&&(o+=" (via `toFirestore()`)"),o+=". ";let c="";return(i||a)&&(c+=" (found",i&&(c+=` in field ${s}`),a&&(c+=` in document ${r}`),c+=")"),new xr(br.INVALID_ARGUMENT,o+e+c)}function cd(e,t){return e.some(e=>e.isEqual(t))}class ld{constructor(e,t,n,s,r){this._firestore=e,this._userDataWriter=t,this._key=n,this._document=s,this._converter=r}get id(){return this._key.path.lastSegment()}get ref(){return new Ah(this._firestore,this._converter,this._key)}exists(){return null!==this._document}data(){if(this._document){if(this._converter){const e=new ud(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const t=this._document.data.field(hd("DocumentSnapshot.get",e));if(null!==t)return this._userDataWriter.convertValue(t)}}}class ud extends ld{data(){return super.data()}}function hd(e,t){return"string"==typeof t?ad(e,t):t instanceof $h?t._internalPath:t._delegate._internalPath}class dd{}class pd extends dd{}class fd extends pd{constructor(e,t,n){super(),this._field=e,this._op=t,this._value=n,this.type="where"}static _create(e,t,n){return new fd(e,t,n)}_apply(e){const t=this._parse(e);return wd(e._query,t),new kh(e.firestore,e.converter,Ba(e._query,t))}_parse(e){const t=Xh(e.firestore),n=function(e,t,n,s,r,i,a){let o;if(r.isKeyField()){if("array-contains"===i||"array-contains-any"===i)throw new xr(br.INVALID_ARGUMENT,`Invalid Query. You can't perform '${i}' queries on documentId().`);if("in"===i||"not-in"===i){vd(a,i);const t=[];for(const n of a)t.push(yd(s,e,n));o={arrayValue:{values:t}}}else o=yd(s,e,a)}else"in"!==i&&"not-in"!==i&&"array-contains-any"!==i||vd(a,i),o=function(e,t,n,s=!1){return ed(n,e.Cc(s?4:3,t))}(n,t,a,"in"===i||"not-in"===i);return ga.create(r,i,o)}(e._query,"where",t,e.firestore._databaseId,this._field,this._op,this._value);return n}}class md extends dd{constructor(e,t){super(),this.type=e,this._queryConstraints=t}static _create(e,t){return new md(e,t)}_parse(e){const t=this._queryConstraints.map(t=>t._parse(e)).filter(e=>e.getFilters().length>0);return 1===t.length?t[0]:ya.create(t,this._getOperator())}_apply(e){const t=this._parse(e);return 0===t.getFilters().length?e:(function(e,t){let n=e;const s=t.getFlattenedFilters();for(const r of s)wd(n,r),n=Ba(n,r)}(e._query,t),new kh(e.firestore,e.converter,Ba(e._query,t)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return"and"===this.type?"and":"or"}}class gd extends pd{constructor(e,t){super(),this._field=e,this._direction=t,this.type="orderBy"}static _create(e,t){return new gd(e,t)}_apply(e){const t=function(e,t,n){if(null!==e.startAt)throw new xr(br.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(null!==e.endAt)throw new xr(br.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new pa(t,n)}(e._query,this._field,this._direction);return new kh(e.firestore,e.converter,function(e,t){const n=e.explicitOrderBy.concat([t]);return new La(e.path,e.collectionGroup,n,e.filters.slice(),e.limit,e.limitType,e.startAt,e.endAt)}(e._query,t))}}function yd(e,t,n){if("string"==typeof(n=rt(n))){if(""===n)throw new xr(br.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!Fa(t)&&-1!==n.indexOf("/"))throw new xr(br.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${n}' contains a '/' character.`);const s=t.path.child($r.fromString(n));if(!zr.isDocumentKey(s))throw new xr(br.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${s}' is not because it has an odd number of segments (${s.length}).`);return ea(e,new zr(s))}if(n instanceof Ah)return ea(e,n._key);throw new xr(br.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${Qr(n)}.`)}function vd(e,t){if(!Array.isArray(e)||0===e.length)throw new xr(br.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${t.toString()}' filters.`)}function wd(e,t){const n=function(e,t){for(const n of e)for(const e of n.getFlattenedFilters())if(t.indexOf(e.op)>=0)return e.op;return null}(e.filters,function(e){switch(e){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(t.op));if(null!==n)throw n===t.op?new xr(br.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${t.op.toString()}' filter.`):new xr(br.INVALID_ARGUMENT,`Invalid query. You cannot use '${t.op.toString()}' filters with '${n.toString()}' filters.`)}class bd{convertValue(e,t="none"){switch(Gi(e)){case 0:return null;case 1:return e.booleanValue;case 2:return Si(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(ki(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 11:return this.convertObject(e.mapValue,t);case 10:return this.convertVectorValue(e.mapValue);default:throw gr(62114,{value:e})}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){const n={};return gi(e,(e,s)=>{n[e]=this.convertValue(s,t)}),n}convertVectorValue(e){const t=e.fields?.[zi].arrayValue?.values?.map(e=>Si(e.doubleValue));return new zh(t)}convertGeoPoint(e){return new qh(Si(e.latitude),Si(e.longitude))}convertArray(e,t){return(e.values||[]).map(e=>this.convertValue(e,t))}convertServerTimestamp(e,t){switch(t){case"previous":const n=Pi(e);return null==n?null:this.convertValue(n,t);case"estimate":return this.convertTimestamp(Li(e));default:return null}}convertTimestamp(e){const t=Ci(e);return new ti(t.seconds,t.nanos)}convertDocumentKey(e,t){const n=$r.fromString(e);vr(Mc(n),9688,{name:e});const s=new Fi(n.get(1),n.get(3)),r=new zr(n.popFirst(5));return s.isEqual(t)||pr(`Document ${r} contains a document reference within a different database (${s.projectId}/${s.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),r}}function xd(e,t,n){let s;return s=e?n&&(n.merge||n.mergeFields)?e.toFirestore(t,n):e.toFirestore(t):t,s}class _d{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class Ed extends ld{constructor(e,t,n,s,r,i){super(e,t,n,s,i),this._firestore=e,this._firestoreImpl=e,this.metadata=r}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const t=new Td(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){const n=this._document.data.field(hd("DocumentSnapshot.get",e));if(null!==n)return this._userDataWriter.convertValue(n,t.serverTimestamps)}}toJSON(){if(this.metadata.hasPendingWrites)throw new xr(br.FAILED_PRECONDITION,"DocumentSnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const e=this._document,t={};return t.type=Ed._jsonSchemaVersion,t.bundle="",t.bundleSource="DocumentSnapshot",t.bundleName=this._key.toString(),e&&e.isValidDocument()&&e.isFoundDocument()?(this._userDataWriter.convertObjectMap(e.data.value.mapValue.fields,"previous"),t.bundle=(this._firestore,this.ref.path,"NOT SUPPORTED"),t):t}}Ed._jsonSchemaVersion="firestore/documentSnapshot/1.0",Ed._jsonSchema={type:Xr("string",Ed._jsonSchemaVersion),bundleSource:Xr("string","DocumentSnapshot"),bundleName:Xr("string"),bundle:Xr("string")};class Td extends Ed{data(e={}){return super.data(e)}}class Id{constructor(e,t,n,s){this._firestore=e,this._userDataWriter=t,this._snapshot=s,this.metadata=new _d(s.hasPendingWrites,s.fromCache),this.query=n}get docs(){const e=[];return this.forEach(t=>e.push(t)),e}get size(){return this._snapshot.docs.size}get empty(){return 0===this.size}forEach(e,t){this._snapshot.docs.forEach(n=>{e.call(t,new Td(this._firestore,this._userDataWriter,n.key,n,new _d(this._snapshot.mutatedKeys.has(n.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){const t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new xr(br.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=function(e,t){if(e._snapshot.oldDocs.isEmpty()){let t=0;return e._snapshot.docChanges.map(n=>{const s=new Td(e._firestore,e._userDataWriter,n.doc.key,n.doc,new _d(e._snapshot.mutatedKeys.has(n.doc.key),e._snapshot.fromCache),e.query.converter);return n.doc,{type:"added",doc:s,oldIndex:-1,newIndex:t++}})}{let n=e._snapshot.oldDocs;return e._snapshot.docChanges.filter(e=>t||3!==e.type).map(t=>{const s=new Td(e._firestore,e._userDataWriter,t.doc.key,t.doc,new _d(e._snapshot.mutatedKeys.has(t.doc.key),e._snapshot.fromCache),e.query.converter);let r=-1,i=-1;return 0!==t.type&&(r=n.indexOf(t.doc.key),n=n.delete(t.doc.key)),1!==t.type&&(n=n.add(t.doc),i=n.indexOf(t.doc.key)),{type:Nd(t.type),doc:s,oldIndex:r,newIndex:i}})}}(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}toJSON(){if(this.metadata.hasPendingWrites)throw new xr(br.FAILED_PRECONDITION,"QuerySnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const e={};e.type=Id._jsonSchemaVersion,e.bundleSource="QuerySnapshot",e.bundleName=jr.newId(),this._firestore._databaseId.database,this._firestore._databaseId.projectId;const t=[],n=[],s=[];return this.docs.forEach(e=>{null!==e._document&&(t.push(e._document),n.push(this._userDataWriter.convertObjectMap(e._document.data.value.mapValue.fields,"previous")),s.push(e.ref.path))}),e.bundle=(this._firestore,this.query._query,e.bundleName,"NOT SUPPORTED"),e}}function Nd(e){switch(e){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return gr(61501,{type:e})}}Id._jsonSchemaVersion="firestore/querySnapshot/1.0",Id._jsonSchema={type:Xr("string",Id._jsonSchemaVersion),bundleSource:Xr("string","QuerySnapshot"),bundleName:Xr("string"),bundle:Xr("string")};class Cd extends bd{constructor(e){super(),this.firestore=e}convertBytes(e){return new Vh(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new Ah(this.firestore,null,t)}}function Sd(e,t,n){e=Yr(e,Ah);const s=Yr(e.firestore,Uh),r=xd(e.converter,t,n);return Dd(s,[Jh(Xh(s),"setDoc",e._key,r,null!==e.converter,n).toMutation(e._key,No.none())])}function kd(e,t,n,...s){e=Yr(e,Ah);const r=Yr(e.firestore,Uh),i=Xh(r);let a;return a="string"==typeof(t=rt(t))||t instanceof $h?function(e,t,n,s,r,i){const a=e.Cc(1,t,n),o=[rd(t,s,n)],c=[r];if(i.length%2!=0)throw new xr(br.INVALID_ARGUMENT,`Function ${t}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let d=0;d<i.length;d+=2)o.push(rd(t,i[d])),c.push(i[d+1]);const l=[],u=oa.empty();for(let d=o.length-1;d>=0;--d)if(!cd(l,o[d])){const e=o[d];let t=c[d];t=rt(t);const n=a.yc(e);if(t instanceof Zh)l.push(e);else{const s=ed(t,n);null!=s&&(l.push(e),u.set(e,s))}}const h=new Ei(l);return new Kh(u,h,a.fieldTransforms)}(i,"updateDoc",e._key,t,n,s):function(e,t,n,s){const r=e.Cc(1,t,n);sd("Data must be an object, but it was:",r,s);const i=[],a=oa.empty();gi(s,(e,s)=>{const o=ad(t,e,n);s=rt(s);const c=r.yc(o);if(s instanceof Zh)i.push(o);else{const e=ed(s,c);null!=e&&(i.push(o),a.set(o,e))}});const o=new Ei(i);return new Kh(a,o,r.fieldTransforms)}(i,"updateDoc",e._key,t),Dd(r,[a.toMutation(e._key,No.exists(!0))])}function Ad(e){return Dd(Yr(e.firestore,Uh),[new Fo(e._key,No.none())])}function Rd(e,t){const n=Yr(e.firestore,Uh),s=Dh(e),r=xd(e.converter,t);return Dd(n,[Jh(Xh(e.firestore),"addDoc",s._key,r,null!==e.converter,{}).toMutation(s._key,No.exists(!1))]).then(()=>s)}function jd(e,...t){e=rt(e);let n={includeMetadataChanges:!1,source:"default"},s=0;"object"!=typeof t[s]||Mh(t[s])||(n=t[s++]);const r={includeMetadataChanges:n.includeMetadataChanges,source:n.source};if(Mh(t[s])){const e=t[s];t[s]=e.next?.bind(e),t[s+1]=e.error?.bind(e),t[s+2]=e.complete?.bind(e)}let i,a,o;if(e instanceof Ah)a=Yr(e.firestore,Uh),o=Ma(e._key.path),i={next:n=>{t[s]&&t[s](function(e,t,n){const s=n.docs.get(t._key),r=new Cd(e);return new Ed(e,r,t._key,s,new _d(n.hasPendingWrites,n.fromCache),t.converter)}(a,e,n))},error:t[s+1],complete:t[s+2]};else{const n=Yr(e,kh);a=Yr(n.firestore,Uh),o=n._query;const r=new Cd(a);i={next:e=>{t[s]&&t[s](new Id(a,r,n,e))},error:t[s+1],complete:t[s+2]},function(e){if("L"===e.limitType&&0===e.explicitOrderBy.length)throw new xr(br.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}(e._query)}return function(e,t,n,s){const r=new gh(s),i=new Mu(t,r,n);return e.asyncQueue.enqueueAndForget(async()=>async function(t,n){const s=wr(t);let r=3;const i=n.query;let a=s.queries.get(i);a?!a.ba()&&n.Da()&&(r=2):(a=new ku,r=n.Da()?0:1);try{switch(r){case 0:a.wa=await s.onListen(i,!0);break;case 1:a.wa=await s.onListen(i,!1);break;case 2:await s.onFirstRemoteStoreListen(i)}}catch(e){const s=Iu(e,`Initialization of query '${Ha(n.query)}' failed`);return void n.onError(s)}s.queries.set(i,a),a.Sa.push(n),n.va(s.onlineState),a.wa&&n.Fa(a.wa)&&Ou(s)}(await _h(e),i)),()=>{r.Nu(),e.asyncQueue.enqueueAndForget(async()=>async function(e,t){const n=wr(e),s=t.query;let r=3;const i=n.queries.get(s);if(i){const e=i.Sa.indexOf(t);e>=0&&(i.Sa.splice(e,1),0===i.Sa.length?r=t.Da()?0:1:!i.ba()&&t.Da()&&(r=2))}switch(r){case 0:return n.queries.delete(s),n.onUnlisten(s,!0);case 1:return n.queries.delete(s),n.onUnlisten(s,!1);case 2:return n.onLastRemoteStoreUnlisten(s);default:return}}(await _h(e),i))}}(Fh(a),o,r,i)}function Dd(e,t){return function(e,t){const n=new _r;return e.asyncQueue.enqueueAndForget(async()=>Yu(await function(e){return xh(e).then(e=>e.syncEngine)}(e),t,n)),n.promise}(Fh(e),t)}function Od(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}!function(e,t=!0){lr=xn,gn(new it("firestore",(e,{instanceIdentifier:n,options:s})=>{const r=e.getProvider("app").getImmediate(),i=new Uh(new Nr(e.getProvider("auth-internal")),new Ar(r,e.getProvider("app-check-internal")),function(e,t){if(!Object.prototype.hasOwnProperty.apply(e.options,["projectId"]))throw new xr(br.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new Fi(e.options.projectId,t)}(r,n),r);return s={useFetchStreams:t,...s},i._setSettings(s),i},"PUBLIC").setMultipleInstances(!0)),Tn(ar,or,e),Tn(ar,or,"esm2020")}();const Pd=Od,Ld=new We("auth","Firebase",{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}),Md=new mt("@firebase/auth");function Ud(e,...t){Md.logLevel<=lt.ERROR&&Md.error(`Auth (${xn}): ${e}`,...t)}function Fd(e,...t){throw zd(e,...t)}function Vd(e,...t){return zd(e,...t)}function $d(e,t,n){const s={...Pd(),[t]:n};return new We("auth","Firebase",s).create(t,{appName:e.name})}function Bd(e){return $d(e,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function qd(e,t,n){if(!(t instanceof n))throw n.name!==t.constructor.name&&Fd(e,"argument-error"),$d(e,"argument-error",`Type of ${t.constructor.name} does not match expected instance.Did you pass a reference from a different Auth SDK?`)}function zd(e,...t){if("string"!=typeof e){const n=t[0],s=[...t.slice(1)];return s[0]&&(s[0].appName=e.name),e._errorFactory.create(n,...s)}return Ld.create(e,...t)}function Gd(e,t,...n){if(!e)throw zd(t,...n)}function Hd(e){const t="INTERNAL ASSERTION FAILED: "+e;throw Ud(t),new Error(t)}function Kd(e,t){e||Hd(t)}function Wd(){return"undefined"!=typeof self&&self.location?.href||""}function Qd(){return"undefined"!=typeof self&&self.location?.protocol||null}function Yd(){return"undefined"==typeof navigator||!navigator||!("onLine"in navigator)||"boolean"!=typeof navigator.onLine||"http:"!==Qd()&&"https:"!==Qd()&&!Be()&&!("connection"in navigator)||navigator.onLine}class Xd{constructor(e,t){this.shortDelay=e,this.longDelay=t,Kd(t>e,"Short delay should be less than long delay!"),this.isMobile="undefined"!=typeof window&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test($e())||"object"==typeof navigator&&"ReactNative"===navigator.product}get(){return Yd()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}function Jd(e,t){Kd(e.emulator,"Emulator should always be set here");const{url:n}=e.emulator;return t?`${n}${t.startsWith("/")?t.slice(1):t}`:n}class Zd{static initialize(e,t,n){this.fetchImpl=e,t&&(this.headersImpl=t),n&&(this.responseImpl=n)}static fetch(){return this.fetchImpl?this.fetchImpl:"undefined"!=typeof self&&"fetch"in self?self.fetch:"undefined"!=typeof globalThis&&globalThis.fetch?globalThis.fetch:"undefined"!=typeof fetch?fetch:void Hd("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){return this.headersImpl?this.headersImpl:"undefined"!=typeof self&&"Headers"in self?self.Headers:"undefined"!=typeof globalThis&&globalThis.Headers?globalThis.Headers:"undefined"!=typeof Headers?Headers:void Hd("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){return this.responseImpl?this.responseImpl:"undefined"!=typeof self&&"Response"in self?self.Response:"undefined"!=typeof globalThis&&globalThis.Response?globalThis.Response:"undefined"!=typeof Response?Response:void Hd("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}const ep={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"},tp=["/v1/accounts:signInWithCustomToken","/v1/accounts:signInWithEmailLink","/v1/accounts:signInWithIdp","/v1/accounts:signInWithPassword","/v1/accounts:signInWithPhoneNumber","/v1/token"],np=new Xd(3e4,6e4);function sp(e,t){return e.tenantId&&!t.tenantId?{...t,tenantId:e.tenantId}:t}async function rp(e,t,n,s,r={}){return ip(e,r,async()=>{let r={},i={};s&&("GET"===t?i=s:r={body:JSON.stringify(s)});const a=Je({key:e.config.apiKey,...i}).slice(1),o=await e._getAdditionalHeaders();o["Content-Type"]="application/json",e.languageCode&&(o["X-Firebase-Locale"]=e.languageCode);const c={method:t,headers:o,...r};return"undefined"!=typeof navigator&&"Cloudflare-Workers"===navigator.userAgent||(c.referrerPolicy="no-referrer"),e.emulatorConfig&&Pe(e.emulatorConfig.host)&&(c.credentials="include"),Zd.fetch()(await op(e,e.config.apiHost,n,a),c)})}async function ip(e,t,n){e._canInitEmulator=!1;const s={...ep,...t};try{const t=new lp(e),r=await Promise.race([n(),t.promise]);t.clearNetworkTimeout();const i=await r.json();if("needConfirmation"in i)throw up(e,"account-exists-with-different-credential",i);if(r.ok&&!("errorMessage"in i))return i;{const t=r.ok?i.errorMessage:i.error.message,[n,a]=t.split(" : ");if("FEDERATED_USER_ID_ALREADY_LINKED"===n)throw up(e,"credential-already-in-use",i);if("EMAIL_EXISTS"===n)throw up(e,"email-already-in-use",i);if("USER_DISABLED"===n)throw up(e,"user-disabled",i);const o=s[n]||n.toLowerCase().replace(/[_\s]+/g,"-");if(a)throw $d(e,o,a);Fd(e,o)}}catch(r){if(r instanceof Ke)throw r;Fd(e,"network-request-failed",{message:String(r)})}}async function ap(e,t,n,s,r={}){const i=await rp(e,t,n,s,r);return"mfaPendingCredential"in i&&Fd(e,"multi-factor-auth-required",{_serverResponse:i}),i}async function op(e,t,n,s){const r=`${t}${n}?${s}`,i=e,a=i.config.emulator?Jd(e.config,r):`${e.config.apiScheme}://${r}`;if(tp.includes(n)&&(await i._persistenceManagerAvailable,"COOKIE"===i._getPersistenceType())){return i._getPersistence()._getFinalTarget(a).toString()}return a}function cp(e){switch(e){case"ENFORCE":return"ENFORCE";case"AUDIT":return"AUDIT";case"OFF":return"OFF";default:return"ENFORCEMENT_STATE_UNSPECIFIED"}}class lp{clearNetworkTimeout(){clearTimeout(this.timer)}constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((e,t)=>{this.timer=setTimeout(()=>t(Vd(this.auth,"network-request-failed")),np.get())})}}function up(e,t,n){const s={appName:e.name};n.email&&(s.email=n.email),n.phoneNumber&&(s.phoneNumber=n.phoneNumber);const r=Vd(e,t,s);return r.customData._tokenResponse=n,r}function hp(e){return void 0!==e&&void 0!==e.enterprise}class dp{constructor(e){if(this.siteKey="",this.recaptchaEnforcementState=[],void 0===e.recaptchaKey)throw new Error("recaptchaKey undefined");this.siteKey=e.recaptchaKey.split("/")[3],this.recaptchaEnforcementState=e.recaptchaEnforcementState}getProviderEnforcementState(e){if(!this.recaptchaEnforcementState||0===this.recaptchaEnforcementState.length)return null;for(const t of this.recaptchaEnforcementState)if(t.provider&&t.provider===e)return cp(t.enforcementState);return null}isProviderEnabled(e){return"ENFORCE"===this.getProviderEnforcementState(e)||"AUDIT"===this.getProviderEnforcementState(e)}isAnyProviderEnabled(){return this.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")||this.isProviderEnabled("PHONE_PROVIDER")}}async function pp(e,t){return rp(e,"POST","/v1/accounts:lookup",t)}function fp(e){if(e)try{const t=new Date(Number(e));if(!isNaN(t.getTime()))return t.toUTCString()}catch(t){}}function mp(e){return 1e3*Number(e)}function gp(e){const[t,n,s]=e.split(".");if(void 0===t||void 0===n||void 0===s)return Ud("JWT malformed, contained fewer than 3 sections"),null;try{const e=Ce(n);return e?JSON.parse(e):(Ud("Failed to decode base64 JWT payload"),null)}catch(r){return Ud("Caught error parsing JWT payload as JSON",r?.toString()),null}}function yp(e){const t=gp(e);return Gd(t,"internal-error"),Gd(void 0!==t.exp,"internal-error"),Gd(void 0!==t.iat,"internal-error"),Number(t.exp)-Number(t.iat)}async function vp(e,t,n=!1){if(n)return t;try{return await t}catch(s){throw s instanceof Ke&&function({code:e}){return"auth/user-disabled"===e||"auth/user-token-expired"===e}(s)&&e.auth.currentUser===e&&await e.auth.signOut(),s}}class wp{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,null!==this.timerId&&clearTimeout(this.timerId))}getInterval(e){if(e){const e=this.errorBackoff;return this.errorBackoff=Math.min(2*this.errorBackoff,96e4),e}{this.errorBackoff=3e4;const e=(this.user.stsTokenManager.expirationTime??0)-Date.now()-3e5;return Math.max(0,e)}}schedule(e=!1){if(!this.isRunning)return;const t=this.getInterval(e);this.timerId=setTimeout(async()=>{await this.iteration()},t)}async iteration(){try{await this.user.getIdToken(!0)}catch(e){return void("auth/network-request-failed"===e?.code&&this.schedule(!0))}this.schedule()}}class bp{constructor(e,t){this.createdAt=e,this.lastLoginAt=t,this._initializeTime()}_initializeTime(){this.lastSignInTime=fp(this.lastLoginAt),this.creationTime=fp(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}async function xp(e){const t=e.auth,n=await e.getIdToken(),s=await vp(e,pp(t,{idToken:n}));Gd(s?.users.length,t,"internal-error");const r=s.users[0];e._notifyReloadListener(r);const i=r.providerUserInfo?.length?_p(r.providerUserInfo):[],a=(o=e.providerData,c=i,[...o.filter(e=>!c.some(t=>t.providerId===e.providerId)),...c]);var o,c;const l=e.isAnonymous,u=!(e.email&&r.passwordHash||a?.length),h=!!l&&u,d={uid:r.localId,displayName:r.displayName||null,photoURL:r.photoUrl||null,email:r.email||null,emailVerified:r.emailVerified||!1,phoneNumber:r.phoneNumber||null,tenantId:r.tenantId||null,providerData:a,metadata:new bp(r.createdAt,r.lastLoginAt),isAnonymous:h};Object.assign(e,d)}function _p(e){return e.map(({providerId:e,...t})=>({providerId:e,uid:t.rawId||"",displayName:t.displayName||null,email:t.email||null,phoneNumber:t.phoneNumber||null,photoURL:t.photoUrl||null}))}class Ep{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){Gd(e.idToken,"internal-error"),Gd(void 0!==e.idToken,"internal-error"),Gd(void 0!==e.refreshToken,"internal-error");const t="expiresIn"in e&&void 0!==e.expiresIn?Number(e.expiresIn):yp(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,t)}updateFromIdToken(e){Gd(0!==e.length,"internal-error");const t=yp(e);this.updateTokensAndExpiration(e,null,t)}async getToken(e,t=!1){return t||!this.accessToken||this.isExpired?(Gd(this.refreshToken,e,"user-token-expired"),this.refreshToken?(await this.refresh(e,this.refreshToken),this.accessToken):null):this.accessToken}clearRefreshToken(){this.refreshToken=null}async refresh(e,t){const{accessToken:n,refreshToken:s,expiresIn:r}=await async function(e,t){const n=await ip(e,{},async()=>{const n=Je({grant_type:"refresh_token",refresh_token:t}).slice(1),{tokenApiHost:s,apiKey:r}=e.config,i=await op(e,s,"/v1/token",`key=${r}`),a=await e._getAdditionalHeaders();a["Content-Type"]="application/x-www-form-urlencoded";const o={method:"POST",headers:a,body:n};return e.emulatorConfig&&Pe(e.emulatorConfig.host)&&(o.credentials="include"),Zd.fetch()(i,o)});return{accessToken:n.access_token,expiresIn:n.expires_in,refreshToken:n.refresh_token}}(e,t);this.updateTokensAndExpiration(n,s,Number(r))}updateTokensAndExpiration(e,t,n){this.refreshToken=t||null,this.accessToken=e||null,this.expirationTime=Date.now()+1e3*n}static fromJSON(e,t){const{refreshToken:n,accessToken:s,expirationTime:r}=t,i=new Ep;return n&&(Gd("string"==typeof n,"internal-error",{appName:e}),i.refreshToken=n),s&&(Gd("string"==typeof s,"internal-error",{appName:e}),i.accessToken=s),r&&(Gd("number"==typeof r,"internal-error",{appName:e}),i.expirationTime=r),i}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new Ep,this.toJSON())}_performRefresh(){return Hd("not implemented")}}function Tp(e,t){Gd("string"==typeof e||void 0===e,"internal-error",{appName:t})}class Ip{constructor({uid:e,auth:t,stsTokenManager:n,...s}){this.providerId="firebase",this.proactiveRefresh=new wp(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=e,this.auth=t,this.stsTokenManager=n,this.accessToken=n.accessToken,this.displayName=s.displayName||null,this.email=s.email||null,this.emailVerified=s.emailVerified||!1,this.phoneNumber=s.phoneNumber||null,this.photoURL=s.photoURL||null,this.isAnonymous=s.isAnonymous||!1,this.tenantId=s.tenantId||null,this.providerData=s.providerData?[...s.providerData]:[],this.metadata=new bp(s.createdAt||void 0,s.lastLoginAt||void 0)}async getIdToken(e){const t=await vp(this,this.stsTokenManager.getToken(this.auth,e));return Gd(t,this.auth,"internal-error"),this.accessToken!==t&&(this.accessToken=t,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),t}getIdTokenResult(e){return async function(e,t=!1){const n=rt(e),s=await n.getIdToken(t),r=gp(s);Gd(r&&r.exp&&r.auth_time&&r.iat,n.auth,"internal-error");const i="object"==typeof r.firebase?r.firebase:void 0,a=i?.sign_in_provider;return{claims:r,token:s,authTime:fp(mp(r.auth_time)),issuedAtTime:fp(mp(r.iat)),expirationTime:fp(mp(r.exp)),signInProvider:a||null,signInSecondFactor:i?.sign_in_second_factor||null}}(this,e)}reload(){return async function(e){const t=rt(e);await xp(t),await t.auth._persistUserIfCurrent(t),t.auth._notifyListenersIfCurrent(t)}(this)}_assign(e){this!==e&&(Gd(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(e=>({...e})),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){const t=new Ip({...this,auth:e,stsTokenManager:this.stsTokenManager._clone()});return t.metadata._copy(this.metadata),t}_onReload(e){Gd(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e,t=!1){let n=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),n=!0),t&&await xp(this),await this.auth._persistUserIfCurrent(this),n&&this.auth._notifyListenersIfCurrent(this)}async delete(){if(vn(this.auth.app))return Promise.reject(Bd(this.auth));const e=await this.getIdToken();return await vp(this,async function(e,t){return rp(e,"POST","/v1/accounts:delete",t)}(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return{uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>({...e})),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId,...this.metadata.toJSON(),apiKey:this.auth.config.apiKey,appName:this.auth.name}}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,t){const n=t.displayName??void 0,s=t.email??void 0,r=t.phoneNumber??void 0,i=t.photoURL??void 0,a=t.tenantId??void 0,o=t._redirectEventId??void 0,c=t.createdAt??void 0,l=t.lastLoginAt??void 0,{uid:u,emailVerified:h,isAnonymous:d,providerData:p,stsTokenManager:f}=t;Gd(u&&f,e,"internal-error");const m=Ep.fromJSON(this.name,f);Gd("string"==typeof u,e,"internal-error"),Tp(n,e.name),Tp(s,e.name),Gd("boolean"==typeof h,e,"internal-error"),Gd("boolean"==typeof d,e,"internal-error"),Tp(r,e.name),Tp(i,e.name),Tp(a,e.name),Tp(o,e.name),Tp(c,e.name),Tp(l,e.name);const g=new Ip({uid:u,auth:e,email:s,emailVerified:h,displayName:n,isAnonymous:d,photoURL:i,phoneNumber:r,tenantId:a,stsTokenManager:m,createdAt:c,lastLoginAt:l});return p&&Array.isArray(p)&&(g.providerData=p.map(e=>({...e}))),o&&(g._redirectEventId=o),g}static async _fromIdTokenResponse(e,t,n=!1){const s=new Ep;s.updateFromServerResponse(t);const r=new Ip({uid:t.localId,auth:e,stsTokenManager:s,isAnonymous:n});return await xp(r),r}static async _fromGetAccountInfoResponse(e,t,n){const s=t.users[0];Gd(void 0!==s.localId,"internal-error");const r=void 0!==s.providerUserInfo?_p(s.providerUserInfo):[],i=!(s.email&&s.passwordHash||r?.length),a=new Ep;a.updateFromIdToken(n);const o=new Ip({uid:s.localId,auth:e,stsTokenManager:a,isAnonymous:i}),c={uid:s.localId,displayName:s.displayName||null,photoURL:s.photoUrl||null,email:s.email||null,emailVerified:s.emailVerified||!1,phoneNumber:s.phoneNumber||null,tenantId:s.tenantId||null,providerData:r,metadata:new bp(s.createdAt,s.lastLoginAt),isAnonymous:!(s.email&&s.passwordHash||r?.length)};return Object.assign(o,c),o}}const Np=new Map;function Cp(e){Kd(e instanceof Function,"Expected a class definition");let t=Np.get(e);return t?(Kd(t instanceof e,"Instance stored in cache mismatched with class"),t):(t=new e,Np.set(e,t),t)}class Sp{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,t){this.storage[e]=t}async _get(e){const t=this.storage[e];return void 0===t?null:t}async _remove(e){delete this.storage[e]}_addListener(e,t){}_removeListener(e,t){}}Sp.type="NONE";const kp=Sp;function Ap(e,t,n){return`firebase:${e}:${t}:${n}`}class Rp{constructor(e,t,n){this.persistence=e,this.auth=t,this.userKey=n;const{config:s,name:r}=this.auth;this.fullUserKey=Ap(this.userKey,s.apiKey,r),this.fullPersistenceKey=Ap("persistence",s.apiKey,r),this.boundEventHandler=t._onStorageEvent.bind(t),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){const e=await this.persistence._get(this.fullUserKey);if(!e)return null;if("string"==typeof e){const t=await pp(this.auth,{idToken:e}).catch(()=>{});return t?Ip._fromGetAccountInfoResponse(this.auth,t,e):null}return Ip._fromJSON(this.auth,e)}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;const t=await this.getCurrentUser();return await this.removeCurrentUser(),this.persistence=e,t?this.setCurrentUser(t):void 0}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,t,n="authUser"){if(!t.length)return new Rp(Cp(kp),e,n);const s=(await Promise.all(t.map(async e=>{if(await e._isAvailable())return e}))).filter(e=>e);let r=s[0]||Cp(kp);const i=Ap(n,e.config.apiKey,e.name);let a=null;for(const c of t)try{const t=await c._get(i);if(t){let n;if("string"==typeof t){const s=await pp(e,{idToken:t}).catch(()=>{});if(!s)break;n=await Ip._fromGetAccountInfoResponse(e,s,t)}else n=Ip._fromJSON(e,t);c!==r&&(a=n),r=c;break}}catch{}const o=s.filter(e=>e._shouldAllowMigration);return r._shouldAllowMigration&&o.length?(r=o[0],a&&await r._set(i,a.toJSON()),await Promise.all(t.map(async e=>{if(e!==r)try{await e._remove(i)}catch{}})),new Rp(r,e,n)):new Rp(r,e,n)}}function jp(e){const t=e.toLowerCase();if(t.includes("opera/")||t.includes("opr/")||t.includes("opios/"))return"Opera";if(Lp(t))return"IEMobile";if(t.includes("msie")||t.includes("trident/"))return"IE";if(t.includes("edge/"))return"Edge";if(Dp(t))return"Firefox";if(t.includes("silk/"))return"Silk";if(Up(t))return"Blackberry";if(Fp(t))return"Webos";if(Op(t))return"Safari";if((t.includes("chrome/")||Pp(t))&&!t.includes("edge/"))return"Chrome";if(Mp(t))return"Android";{const t=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,n=e.match(t);if(2===n?.length)return n[1]}return"Other"}function Dp(e=$e()){return/firefox\//i.test(e)}function Op(e=$e()){const t=e.toLowerCase();return t.includes("safari/")&&!t.includes("chrome/")&&!t.includes("crios/")&&!t.includes("android")}function Pp(e=$e()){return/crios\//i.test(e)}function Lp(e=$e()){return/iemobile/i.test(e)}function Mp(e=$e()){return/android/i.test(e)}function Up(e=$e()){return/blackberry/i.test(e)}function Fp(e=$e()){return/webos/i.test(e)}function Vp(e=$e()){return/iphone|ipad|ipod/i.test(e)||/macintosh/i.test(e)&&/mobile/i.test(e)}function $p(){return function(){const e=$e();return e.indexOf("MSIE ")>=0||e.indexOf("Trident/")>=0}()&&10===document.documentMode}function Bp(e=$e()){return Vp(e)||Mp(e)||Fp(e)||Up(e)||/windows phone/i.test(e)||Lp(e)}function qp(e,t=[]){let n;switch(e){case"Browser":n=jp($e());break;case"Worker":n=`${jp($e())}-${e}`;break;default:n=e}const s=t.length?t.join(","):"FirebaseCore-web";return`${n}/JsCore/${xn}/${s}`}class zp{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,t){const n=t=>new Promise((n,s)=>{try{n(e(t))}catch(r){s(r)}});n.onAbort=t,this.queue.push(n);const s=this.queue.length-1;return()=>{this.queue[s]=()=>Promise.resolve()}}async runMiddleware(e){if(this.auth.currentUser===e)return;const t=[];try{for(const n of this.queue)await n(e),n.onAbort&&t.push(n.onAbort)}catch(n){t.reverse();for(const e of t)try{e()}catch(s){}throw this.auth._errorFactory.create("login-blocked",{originalMessage:n?.message})}}}class Gp{constructor(e){const t=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=t.minPasswordLength??6,t.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=t.maxPasswordLength),void 0!==t.containsLowercaseCharacter&&(this.customStrengthOptions.containsLowercaseLetter=t.containsLowercaseCharacter),void 0!==t.containsUppercaseCharacter&&(this.customStrengthOptions.containsUppercaseLetter=t.containsUppercaseCharacter),void 0!==t.containsNumericCharacter&&(this.customStrengthOptions.containsNumericCharacter=t.containsNumericCharacter),void 0!==t.containsNonAlphanumericCharacter&&(this.customStrengthOptions.containsNonAlphanumericCharacter=t.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,"ENFORCEMENT_STATE_UNSPECIFIED"===this.enforcementState&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=e.allowedNonAlphanumericCharacters?.join("")??"",this.forceUpgradeOnSignin=e.forceUpgradeOnSignin??!1,this.schemaVersion=e.schemaVersion}validatePassword(e){const t={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,t),this.validatePasswordCharacterOptions(e,t),t.isValid&&(t.isValid=t.meetsMinPasswordLength??!0),t.isValid&&(t.isValid=t.meetsMaxPasswordLength??!0),t.isValid&&(t.isValid=t.containsLowercaseLetter??!0),t.isValid&&(t.isValid=t.containsUppercaseLetter??!0),t.isValid&&(t.isValid=t.containsNumericCharacter??!0),t.isValid&&(t.isValid=t.containsNonAlphanumericCharacter??!0),t}validatePasswordLengthOptions(e,t){const n=this.customStrengthOptions.minPasswordLength,s=this.customStrengthOptions.maxPasswordLength;n&&(t.meetsMinPasswordLength=e.length>=n),s&&(t.meetsMaxPasswordLength=e.length<=s)}validatePasswordCharacterOptions(e,t){let n;this.updatePasswordCharacterOptionsStatuses(t,!1,!1,!1,!1);for(let s=0;s<e.length;s++)n=e.charAt(s),this.updatePasswordCharacterOptionsStatuses(t,n>="a"&&n<="z",n>="A"&&n<="Z",n>="0"&&n<="9",this.allowedNonAlphanumericCharacters.includes(n))}updatePasswordCharacterOptionsStatuses(e,t,n,s,r){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=t)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=n)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=s)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=r))}}class Hp{constructor(e,t,n,s){this.app=e,this.heartbeatServiceProvider=t,this.appCheckServiceProvider=n,this.config=s,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new Wp(this),this.idTokenSubscription=new Wp(this),this.beforeStateQueue=new zp(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=Ld,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this._resolvePersistenceManagerAvailable=void 0,this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=s.sdkClientVersion,this._persistenceManagerAvailable=new Promise(e=>this._resolvePersistenceManagerAvailable=e)}_initializeWithPersistence(e,t){return t&&(this._popupRedirectResolver=Cp(t)),this._initializationPromise=this.queue(async()=>{if(!this._deleted&&(this.persistenceManager=await Rp.create(this,e),this._resolvePersistenceManagerAvailable?.(),!this._deleted)){if(this._popupRedirectResolver?._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch(n){}await this.initializeCurrentUser(t),this.lastNotifiedUid=this.currentUser?.uid||null,this._deleted||(this._isInitialized=!0)}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const e=await this.assertedPersistence.getCurrentUser();return this.currentUser||e?this.currentUser&&e&&this.currentUser.uid===e.uid?(this._currentUser._assign(e),void(await this.currentUser.getIdToken())):void(await this._updateCurrentUser(e,!0)):void 0}async initializeCurrentUserFromIdToken(e){try{const t=await pp(this,{idToken:e}),n=await Ip._fromGetAccountInfoResponse(this,t,e);await this.directlySetCurrentUser(n)}catch(t){await this.directlySetCurrentUser(null)}}async initializeCurrentUser(e){if(vn(this.app)){const e=this.app.settings.authIdToken;return e?new Promise(t=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(e).then(t,t))}):this.directlySetCurrentUser(null)}const t=await this.assertedPersistence.getCurrentUser();let n=t,s=!1;if(e&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const t=this.redirectUser?._redirectEventId,r=n?._redirectEventId,i=await this.tryRedirectSignIn(e);t&&t!==r||!i?.user||(n=i.user,s=!0)}if(!n)return this.directlySetCurrentUser(null);if(!n._redirectEventId){if(s)try{await this.beforeStateQueue.runMiddleware(n)}catch(r){n=t,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(r))}return n?this.reloadAndSetCurrentUserOrClear(n):this.directlySetCurrentUser(null)}return Gd(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===n._redirectEventId?this.directlySetCurrentUser(n):this.reloadAndSetCurrentUserOrClear(n)}async tryRedirectSignIn(e){let t=null;try{t=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch(n){await this._setRedirectUser(null)}return t}async reloadAndSetCurrentUserOrClear(e){try{await xp(e)}catch(t){if("auth/network-request-failed"!==t?.code)return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=function(){if("undefined"==typeof navigator)return null;const e=navigator;return e.languages&&e.languages[0]||e.language||null}()}async _delete(){this._deleted=!0}async updateCurrentUser(e){if(vn(this.app))return Promise.reject(Bd(this));const t=e?rt(e):null;return t&&Gd(t.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(t&&t._clone(this))}async _updateCurrentUser(e,t=!1){if(!this._deleted)return e&&Gd(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),t||await this.beforeStateQueue.runMiddleware(e),this.queue(async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()})}async signOut(){return vn(this.app)?Promise.reject(Bd(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(e){return vn(this.app)?Promise.reject(Bd(this)):this.queue(async()=>{await this.assertedPersistence.setPersistence(Cp(e))})}_getRecaptchaConfig(){return null==this.tenantId?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(e){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();const t=this._getPasswordPolicyInternal();return t.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):t.validatePassword(e)}_getPasswordPolicyInternal(){return null===this.tenantId?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){const e=await async function(e,t={}){return rp(e,"GET","/v2/passwordPolicy",sp(e,t))}(this),t=new Gp(e);null===this.tenantId?this._projectPasswordPolicy=t:this._tenantPasswordPolicies[this.tenantId]=t}_getPersistenceType(){return this.assertedPersistence.persistence.type}_getPersistence(){return this.assertedPersistence.persistence}_updateErrorMap(e){this._errorFactory=new We("auth","Firebase",e())}onAuthStateChanged(e,t,n){return this.registerStateListener(this.authStateSubscription,e,t,n)}beforeAuthStateChanged(e,t){return this.beforeStateQueue.pushCallback(e,t)}onIdTokenChanged(e,t,n){return this.registerStateListener(this.idTokenSubscription,e,t,n)}authStateReady(){return new Promise((e,t)=>{if(this.currentUser)e();else{const n=this.onAuthStateChanged(()=>{n(),e()},t)}})}async revokeAccessToken(e){if(this.currentUser){const t={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:e,idToken:await this.currentUser.getIdToken()};null!=this.tenantId&&(t.tenantId=this.tenantId),await async function(e,t){return rp(e,"POST","/v2/accounts:revokeToken",sp(e,t))}(this,t)}}toJSON(){return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:this._currentUser?.toJSON()}}async _setRedirectUser(e,t){const n=await this.getOrInitRedirectPersistenceManager(t);return null===e?n.removeCurrentUser():n.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){const t=e&&Cp(e)||this._popupRedirectResolver;Gd(t,this,"argument-error"),this.redirectPersistenceManager=await Rp.create(this,[Cp(t._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){return this._isInitialized&&await this.queue(async()=>{}),this._currentUser?._redirectEventId===e?this._currentUser:this.redirectUser?._redirectEventId===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(e))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const e=this.currentUser?.uid??null;this.lastNotifiedUid!==e&&(this.lastNotifiedUid=e,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,t,n,s){if(this._deleted)return()=>{};const r="function"==typeof t?t:t.next.bind(t);let i=!1;const a=this._isInitialized?Promise.resolve():this._initializationPromise;if(Gd(a,this,"internal-error"),a.then(()=>{i||r(this.currentUser)}),"function"==typeof t){const r=e.addObserver(t,n,s);return()=>{i=!0,r()}}{const n=e.addObserver(t);return()=>{i=!0,n()}}}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return Gd(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){e&&!this.frameworks.includes(e)&&(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=qp(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){const e={"X-Client-Version":this.clientVersion};this.app.options.appId&&(e["X-Firebase-gmpid"]=this.app.options.appId);const t=await(this.heartbeatServiceProvider.getImmediate({optional:!0})?.getHeartbeatsHeader());t&&(e["X-Firebase-Client"]=t);const n=await this._getAppCheckToken();return n&&(e["X-Firebase-AppCheck"]=n),e}async _getAppCheckToken(){if(vn(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;const e=await(this.appCheckServiceProvider.getImmediate({optional:!0})?.getToken());return e?.error&&function(e,...t){Md.logLevel<=lt.WARN&&Md.warn(`Auth (${xn}): ${e}`,...t)}(`Error while retrieving App Check token: ${e.error}`),e?.token}}function Kp(e){return rt(e)}class Wp{constructor(e){this.auth=e,this.observer=null,this.addObserver=function(e,t){const n=new tt(e,t);return n.subscribe.bind(n)}(e=>this.observer=e)}get next(){return Gd(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}let Qp={async loadJS(){throw new Error("Unable to load external scripts")},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function Yp(e){return Qp.loadJS(e)}class Xp{constructor(){this.enterprise=new Jp}ready(e){e()}execute(e,t){return Promise.resolve("token")}render(e,t){return""}}class Jp{ready(e){e()}execute(e,t){return Promise.resolve("token")}render(e,t){return""}}const Zp="NO_RECAPTCHA";class ef{constructor(e){this.type="recaptcha-enterprise",this.auth=Kp(e)}async verify(e="verify",t=!1){async function n(e){if(!t){if(null==e.tenantId&&null!=e._agentRecaptchaConfig)return e._agentRecaptchaConfig.siteKey;if(null!=e.tenantId&&void 0!==e._tenantRecaptchaConfigs[e.tenantId])return e._tenantRecaptchaConfigs[e.tenantId].siteKey}return new Promise(async(t,n)=>{(async function(e,t){return rp(e,"GET","/v2/recaptchaConfig",sp(e,t))})(e,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then(s=>{if(void 0!==s.recaptchaKey){const n=new dp(s);return null==e.tenantId?e._agentRecaptchaConfig=n:e._tenantRecaptchaConfigs[e.tenantId]=n,t(n.siteKey)}n(new Error("recaptcha Enterprise site key undefined"))}).catch(e=>{n(e)})})}function s(t,n,s){const r=window.grecaptcha;hp(r)?r.enterprise.ready(()=>{r.enterprise.execute(t,{action:e}).then(e=>{n(e)}).catch(()=>{n(Zp)})}):s(Error("No reCAPTCHA enterprise script loaded."))}if(this.auth.settings.appVerificationDisabledForTesting){return(new Xp).execute("siteKey",{action:"verify"})}return new Promise((e,r)=>{n(this.auth).then(n=>{if(!t&&hp(window.grecaptcha))s(n,e,r);else{if("undefined"==typeof window)return void r(new Error("RecaptchaVerifier is only supported in browser"));let t=Qp.recaptchaEnterpriseScript;0!==t.length&&(t+=n),Yp(t).then(()=>{s(n,e,r)}).catch(e=>{r(e)})}}).catch(e=>{r(e)})})}}async function tf(e,t,n,s=!1,r=!1){const i=new ef(e);let a;if(r)a=Zp;else try{a=await i.verify(n)}catch(c){a=await i.verify(n,!0)}const o={...t};if("mfaSmsEnrollment"===n||"mfaSmsSignIn"===n){if("phoneEnrollmentInfo"in o){const e=o.phoneEnrollmentInfo.phoneNumber,t=o.phoneEnrollmentInfo.recaptchaToken;Object.assign(o,{phoneEnrollmentInfo:{phoneNumber:e,recaptchaToken:t,captchaResponse:a,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}else if("phoneSignInInfo"in o){const e=o.phoneSignInInfo.recaptchaToken;Object.assign(o,{phoneSignInInfo:{recaptchaToken:e,captchaResponse:a,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}return o}return s?Object.assign(o,{captchaResp:a}):Object.assign(o,{captchaResponse:a}),Object.assign(o,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(o,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"}),o}async function nf(e,t,n,s,r){if(e._getRecaptchaConfig()?.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")){const r=await tf(e,t,n,"getOobCode"===n);return s(e,r)}return s(e,t).catch(async r=>{if("auth/missing-recaptcha-token"===r.code){const r=await tf(e,t,n,"getOobCode"===n);return s(e,r)}return Promise.reject(r)})}function sf(e,t,n){const s=Kp(e);Gd(/^https?:\/\//.test(t),s,"invalid-emulator-scheme");const r=rf(t),{host:i,port:a}=function(e){const t=rf(e),n=/(\/\/)?([^?#/]+)/.exec(e.substr(t.length));if(!n)return{host:"",port:null};const s=n[2].split("@").pop()||"",r=/^(\[[^\]]+\])(:|$)/.exec(s);if(r){const e=r[1];return{host:e,port:af(s.substr(e.length+1))}}{const[e,t]=s.split(":");return{host:e,port:af(t)}}}(t),o=null===a?"":`:${a}`,c={url:`${r}//${i}${o}/`},l=Object.freeze({host:i,port:a,protocol:r.replace(":",""),options:Object.freeze({disableWarnings:!1})});if(!s._canInitEmulator)return Gd(s.config.emulator&&s.emulatorConfig,s,"emulator-config-failed"),void Gd(Ye(c,s.config.emulator)&&Ye(l,s.emulatorConfig),s,"emulator-config-failed");s.config.emulator=c,s.emulatorConfig=l,s.settings.appVerificationDisabledForTesting=!0,Pe(i)?(Le(`${r}//${i}${o}`),Ve("Auth",!0)):function(){function e(){const e=document.createElement("p"),t=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",t.position="fixed",t.width="100%",t.backgroundColor="#ffffff",t.border=".1em solid #000000",t.color="#b50000",t.bottom="0px",t.left="0px",t.margin="0px",t.zIndex="10000",t.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}"undefined"!=typeof console&&console.info;"undefined"!=typeof window&&"undefined"!=typeof document&&("loading"===document.readyState?window.addEventListener("DOMContentLoaded",e):e())}()}function rf(e){const t=e.indexOf(":");return t<0?"":e.substr(0,t+1)}function af(e){if(!e)return null;const t=Number(e);return isNaN(t)?null:t}class of{constructor(e,t){this.providerId=e,this.signInMethod=t}toJSON(){return Hd("not implemented")}_getIdTokenResponse(e){return Hd("not implemented")}_linkToIdToken(e,t){return Hd("not implemented")}_getReauthenticationResolver(e){return Hd("not implemented")}}async function cf(e,t){return rp(e,"POST","/v1/accounts:signUp",t)}async function lf(e,t){return ap(e,"POST","/v1/accounts:signInWithPassword",sp(e,t))}class uf extends of{constructor(e,t,n,s=null){super("password",n),this._email=e,this._password=t,this._tenantId=s}static _fromEmailAndPassword(e,t){return new uf(e,t,"password")}static _fromEmailAndCode(e,t,n=null){return new uf(e,t,"emailLink",n)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(e){const t="string"==typeof e?JSON.parse(e):e;if(t?.email&&t?.password){if("password"===t.signInMethod)return this._fromEmailAndPassword(t.email,t.password);if("emailLink"===t.signInMethod)return this._fromEmailAndCode(t.email,t.password,t.tenantId)}return null}async _getIdTokenResponse(e){switch(this.signInMethod){case"password":return nf(e,{returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"},"signInWithPassword",lf);case"emailLink":return async function(e,t){return ap(e,"POST","/v1/accounts:signInWithEmailLink",sp(e,t))}(e,{email:this._email,oobCode:this._password});default:Fd(e,"internal-error")}}async _linkToIdToken(e,t){switch(this.signInMethod){case"password":return nf(e,{idToken:t,returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"},"signUpPassword",cf);case"emailLink":return async function(e,t){return ap(e,"POST","/v1/accounts:signInWithEmailLink",sp(e,t))}(e,{idToken:t,email:this._email,oobCode:this._password});default:Fd(e,"internal-error")}}_getReauthenticationResolver(e){return this._getIdTokenResponse(e)}}async function hf(e,t){return ap(e,"POST","/v1/accounts:signInWithIdp",sp(e,t))}class df extends of{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){const t=new df(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(t.idToken=e.idToken),e.accessToken&&(t.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(t.nonce=e.nonce),e.pendingToken&&(t.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(t.accessToken=e.oauthToken,t.secret=e.oauthTokenSecret):Fd("argument-error"),t}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){const t="string"==typeof e?JSON.parse(e):e,{providerId:n,signInMethod:s,...r}=t;if(!n||!s)return null;const i=new df(n,s);return i.idToken=r.idToken||void 0,i.accessToken=r.accessToken||void 0,i.secret=r.secret,i.nonce=r.nonce,i.pendingToken=r.pendingToken||null,i}_getIdTokenResponse(e){return hf(e,this.buildRequest())}_linkToIdToken(e,t){const n=this.buildRequest();return n.idToken=t,hf(e,n)}_getReauthenticationResolver(e){const t=this.buildRequest();return t.autoCreate=!1,hf(e,t)}buildRequest(){const e={requestUri:"http://localhost",returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{const t={};this.idToken&&(t.id_token=this.idToken),this.accessToken&&(t.access_token=this.accessToken),this.secret&&(t.oauth_token_secret=this.secret),t.providerId=this.providerId,this.nonce&&!this.pendingToken&&(t.nonce=this.nonce),e.postBody=Je(t)}return e}}class pf{constructor(e){const t=Ze(et(e)),n=t.apiKey??null,s=t.oobCode??null,r=function(e){switch(e){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}(t.mode??null);Gd(n&&s&&r,"argument-error"),this.apiKey=n,this.operation=r,this.code=s,this.continueUrl=t.continueUrl??null,this.languageCode=t.lang??null,this.tenantId=t.tenantId??null}static parseLink(e){const t=function(e){const t=Ze(et(e)).link,n=t?Ze(et(t)).deep_link_id:null,s=Ze(et(e)).deep_link_id;return(s?Ze(et(s)).link:null)||s||n||t||e}(e);try{return new pf(t)}catch{return null}}}class ff{constructor(){this.providerId=ff.PROVIDER_ID}static credential(e,t){return uf._fromEmailAndPassword(e,t)}static credentialWithLink(e,t){const n=pf.parseLink(t);return Gd(n,"argument-error"),uf._fromEmailAndCode(e,n.code,n.tenantId)}}ff.PROVIDER_ID="password",ff.EMAIL_PASSWORD_SIGN_IN_METHOD="password",ff.EMAIL_LINK_SIGN_IN_METHOD="emailLink";class mf{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}class gf extends mf{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}class yf extends gf{constructor(){super("facebook.com")}static credential(e){return df._fromParams({providerId:yf.PROVIDER_ID,signInMethod:yf.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return yf.credentialFromTaggedObject(e)}static credentialFromError(e){return yf.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e))return null;if(!e.oauthAccessToken)return null;try{return yf.credential(e.oauthAccessToken)}catch{return null}}}yf.FACEBOOK_SIGN_IN_METHOD="facebook.com",yf.PROVIDER_ID="facebook.com";class vf extends gf{constructor(){super("google.com"),this.addScope("profile")}static credential(e,t){return df._fromParams({providerId:vf.PROVIDER_ID,signInMethod:vf.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:t})}static credentialFromResult(e){return vf.credentialFromTaggedObject(e)}static credentialFromError(e){return vf.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:t,oauthAccessToken:n}=e;if(!t&&!n)return null;try{return vf.credential(t,n)}catch{return null}}}vf.GOOGLE_SIGN_IN_METHOD="google.com",vf.PROVIDER_ID="google.com";class wf extends gf{constructor(){super("github.com")}static credential(e){return df._fromParams({providerId:wf.PROVIDER_ID,signInMethod:wf.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return wf.credentialFromTaggedObject(e)}static credentialFromError(e){return wf.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e))return null;if(!e.oauthAccessToken)return null;try{return wf.credential(e.oauthAccessToken)}catch{return null}}}wf.GITHUB_SIGN_IN_METHOD="github.com",wf.PROVIDER_ID="github.com";class bf extends gf{constructor(){super("twitter.com")}static credential(e,t){return df._fromParams({providerId:bf.PROVIDER_ID,signInMethod:bf.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:t})}static credentialFromResult(e){return bf.credentialFromTaggedObject(e)}static credentialFromError(e){return bf.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthAccessToken:t,oauthTokenSecret:n}=e;if(!t||!n)return null;try{return bf.credential(t,n)}catch{return null}}}async function xf(e,t){return ap(e,"POST","/v1/accounts:signUp",sp(e,t))}bf.TWITTER_SIGN_IN_METHOD="twitter.com",bf.PROVIDER_ID="twitter.com";class _f{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,t,n,s=!1){const r=await Ip._fromIdTokenResponse(e,n,s),i=Ef(n);return new _f({user:r,providerId:i,_tokenResponse:n,operationType:t})}static async _forOperation(e,t,n){await e._updateTokensIfNecessary(n,!0);const s=Ef(n);return new _f({user:e,providerId:s,_tokenResponse:n,operationType:t})}}function Ef(e){return e.providerId?e.providerId:"phoneNumber"in e?"phone":null}class Tf extends Ke{constructor(e,t,n,s){super(t.code,t.message),this.operationType=n,this.user=s,Object.setPrototypeOf(this,Tf.prototype),this.customData={appName:e.name,tenantId:e.tenantId??void 0,_serverResponse:t.customData._serverResponse,operationType:n}}static _fromErrorAndOperation(e,t,n,s){return new Tf(e,t,n,s)}}function If(e,t,n,s){return("reauthenticate"===t?n._getReauthenticationResolver(e):n._getIdTokenResponse(e)).catch(n=>{if("auth/multi-factor-auth-required"===n.code)throw Tf._fromErrorAndOperation(e,n,t,s);throw n})}async function Nf(e,t,n=!1){if(vn(e.app))return Promise.reject(Bd(e));const s="signIn",r=await If(e,s,t),i=await _f._fromIdTokenResponse(e,s,r);return n||await e._updateCurrentUser(i.user),i}async function Cf(e){const t=Kp(e);t._getPasswordPolicyInternal()&&await t._updatePasswordPolicy()}function Sf(e,t,n){return vn(e.app)?Promise.reject(Bd(e)):async function(e,t){return Nf(Kp(e),t)}(rt(e),ff.credential(t,n)).catch(async t=>{throw"auth/password-does-not-meet-requirements"===t.code&&Cf(e),t})}const kf="__sak";class Af{constructor(e,t){this.storageRetriever=e,this.type=t}_isAvailable(){try{return this.storage?(this.storage.setItem(kf,"1"),this.storage.removeItem(kf),Promise.resolve(!0)):Promise.resolve(!1)}catch{return Promise.resolve(!1)}}_set(e,t){return this.storage.setItem(e,JSON.stringify(t)),Promise.resolve()}_get(e){const t=this.storage.getItem(e);return Promise.resolve(t?JSON.parse(t):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}class Rf extends Af{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(e,t)=>this.onStorageEvent(e,t),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=Bp(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(const t of Object.keys(this.listeners)){const n=this.storage.getItem(t),s=this.localCache[t];n!==s&&e(t,s,n)}}onStorageEvent(e,t=!1){if(!e.key)return void this.forAllChangedKeys((e,t,n)=>{this.notifyListeners(e,n)});const n=e.key;t?this.detachListener():this.stopPolling();const s=()=>{const e=this.storage.getItem(n);(t||this.localCache[n]!==e)&&this.notifyListeners(n,e)},r=this.storage.getItem(n);$p()&&r!==e.newValue&&e.newValue!==e.oldValue?setTimeout(s,10):s()}notifyListeners(e,t){this.localCache[e]=t;const n=this.listeners[e];if(n)for(const s of Array.from(n))s(t?JSON.parse(t):t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((e,t,n)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:t,newValue:n}),!0)})},1e3)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,t){0===Object.keys(this.listeners).length&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),0===this.listeners[e].size&&delete this.listeners[e]),0===Object.keys(this.listeners).length&&(this.detachListener(),this.stopPolling())}async _set(e,t){await super._set(e,t),this.localCache[e]=JSON.stringify(t)}async _get(e){const t=await super._get(e);return this.localCache[e]=JSON.stringify(t),t}async _remove(e){await super._remove(e),delete this.localCache[e]}}Rf.type="LOCAL";const jf=Rf;class Df extends Af{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(e,t){}_removeListener(e,t){}}Df.type="SESSION";const Of=Df;class Pf{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){const t=this.receivers.find(t=>t.isListeningto(e));if(t)return t;const n=new Pf(e);return this.receivers.push(n),n}isListeningto(e){return this.eventTarget===e}async handleEvent(e){const t=e,{eventId:n,eventType:s,data:r}=t.data,i=this.handlersMap[s];if(!i?.size)return;t.ports[0].postMessage({status:"ack",eventId:n,eventType:s});const a=Array.from(i).map(async e=>e(t.origin,r)),o=await function(e){return Promise.all(e.map(async e=>{try{return{fulfilled:!0,value:await e}}catch(t){return{fulfilled:!1,reason:t}}}))}(a);t.ports[0].postMessage({status:"done",eventId:n,eventType:s,response:o})}_subscribe(e,t){0===Object.keys(this.handlersMap).length&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(t)}_unsubscribe(e,t){this.handlersMap[e]&&t&&this.handlersMap[e].delete(t),t&&0!==this.handlersMap[e].size||delete this.handlersMap[e],0===Object.keys(this.handlersMap).length&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}function Lf(e="",t=10){let n="";for(let s=0;s<t;s++)n+=Math.floor(10*Math.random());return e+n}Pf.receivers=[];class Mf{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,t,n=50){const s="undefined"!=typeof MessageChannel?new MessageChannel:null;if(!s)throw new Error("connection_unavailable");let r,i;return new Promise((a,o)=>{const c=Lf("",20);s.port1.start();const l=setTimeout(()=>{o(new Error("unsupported_event"))},n);i={messageChannel:s,onMessage(e){const t=e;if(t.data.eventId===c)switch(t.data.status){case"ack":clearTimeout(l),r=setTimeout(()=>{o(new Error("timeout"))},3e3);break;case"done":clearTimeout(r),a(t.data.response);break;default:clearTimeout(l),clearTimeout(r),o(new Error("invalid_response"))}}},this.handlers.add(i),s.port1.addEventListener("message",i.onMessage),this.target.postMessage({eventType:e,eventId:c,data:t},[s.port2])}).finally(()=>{i&&this.removeMessageHandler(i)})}}function Uf(){return window}function Ff(){return void 0!==Uf().WorkerGlobalScope&&"function"==typeof Uf().importScripts}const Vf="firebaseLocalStorageDb",$f="firebaseLocalStorage",Bf="fbase_key";class qf{constructor(e){this.request=e}toPromise(){return new Promise((e,t)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{t(this.request.error)})})}}function zf(e,t){return e.transaction([$f],t?"readwrite":"readonly").objectStore($f)}function Gf(){const e=indexedDB.open(Vf,1);return new Promise((t,n)=>{e.addEventListener("error",()=>{n(e.error)}),e.addEventListener("upgradeneeded",()=>{const t=e.result;try{t.createObjectStore($f,{keyPath:Bf})}catch(s){n(s)}}),e.addEventListener("success",async()=>{const n=e.result;n.objectStoreNames.contains($f)?t(n):(n.close(),await function(){const e=indexedDB.deleteDatabase(Vf);return new qf(e).toPromise()}(),t(await Gf()))})})}async function Hf(e,t,n){const s=zf(e,!0).put({[Bf]:t,value:n});return new qf(s).toPromise()}function Kf(e,t){const n=zf(e,!0).delete(t);return new qf(n).toPromise()}class Wf{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db||(this.db=await Gf()),this.db}async _withRetries(e){let t=0;for(;;)try{const t=await this._openDb();return await e(t)}catch(n){if(t++>3)throw n;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return Ff()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=Pf._getInstance(Ff()?self:null),this.receiver._subscribe("keyChanged",async(e,t)=>({keyProcessed:(await this._poll()).includes(t.key)})),this.receiver._subscribe("ping",async(e,t)=>["keyChanged"])}async initializeSender(){if(this.activeServiceWorker=await async function(){if(!navigator?.serviceWorker)return null;try{return(await navigator.serviceWorker.ready).active}catch{return null}}(),!this.activeServiceWorker)return;this.sender=new Mf(this.activeServiceWorker);const e=await this.sender._send("ping",{},800);e&&e[0]?.fulfilled&&e[0]?.value.includes("keyChanged")&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(e){if(this.sender&&this.activeServiceWorker&&(navigator?.serviceWorker?.controller||null)===this.activeServiceWorker)try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch{}}async _isAvailable(){try{if(!indexedDB)return!1;const e=await Gf();return await Hf(e,kf,"1"),await Kf(e,kf),!0}catch{}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(e,t){return this._withPendingWrite(async()=>(await this._withRetries(n=>Hf(n,e,t)),this.localCache[e]=t,this.notifyServiceWorker(e)))}async _get(e){const t=await this._withRetries(t=>async function(e,t){const n=zf(e,!1).get(t),s=await new qf(n).toPromise();return void 0===s?null:s.value}(t,e));return this.localCache[e]=t,t}async _remove(e){return this._withPendingWrite(async()=>(await this._withRetries(t=>Kf(t,e)),delete this.localCache[e],this.notifyServiceWorker(e)))}async _poll(){const e=await this._withRetries(e=>{const t=zf(e,!1).getAll();return new qf(t).toPromise()});if(!e)return[];if(0!==this.pendingWrites)return[];const t=[],n=new Set;if(0!==e.length)for(const{fbase_key:s,value:r}of e)n.add(s),JSON.stringify(this.localCache[s])!==JSON.stringify(r)&&(this.notifyListeners(s,r),t.push(s));for(const s of Object.keys(this.localCache))this.localCache[s]&&!n.has(s)&&(this.notifyListeners(s,null),t.push(s));return t}notifyListeners(e,t){this.localCache[e]=t;const n=this.listeners[e];if(n)for(const s of Array.from(n))s(t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),800)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,t){0===Object.keys(this.listeners).length&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),0===this.listeners[e].size&&delete this.listeners[e]),0===Object.keys(this.listeners).length&&this.stopPolling()}}Wf.type="LOCAL";const Qf=Wf;function Yf(e,t){return t?Cp(t):(Gd(e._popupRedirectResolver,e,"argument-error"),e._popupRedirectResolver)}new Xd(3e4,6e4);class Xf extends of{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return hf(e,this._buildIdpRequest())}_linkToIdToken(e,t){return hf(e,this._buildIdpRequest(t))}_getReauthenticationResolver(e){return hf(e,this._buildIdpRequest())}_buildIdpRequest(e){const t={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(t.idToken=e),t}}function Jf(e){return Nf(e.auth,new Xf(e),e.bypassAuthState)}function Zf(e){const{auth:t,user:n}=e;return Gd(n,t,"internal-error"),async function(e,t,n=!1){const{auth:s}=e;if(vn(s.app))return Promise.reject(Bd(s));const r="reauthenticate";try{const i=await vp(e,If(s,r,t,e),n);Gd(i.idToken,s,"internal-error");const a=gp(i.idToken);Gd(a,s,"internal-error");const{sub:o}=a;return Gd(e.uid===o,s,"user-mismatch"),_f._forOperation(e,r,i)}catch(i){throw"auth/user-not-found"===i?.code&&Fd(s,"user-mismatch"),i}}(n,new Xf(e),e.bypassAuthState)}async function em(e){const{auth:t,user:n}=e;return Gd(n,t,"internal-error"),async function(e,t,n=!1){const s=await vp(e,t._linkToIdToken(e.auth,await e.getIdToken()),n);return _f._forOperation(e,"link",s)}(n,new Xf(e),e.bypassAuthState)}class tm{constructor(e,t,n,s,r=!1){this.auth=e,this.resolver=n,this.user=s,this.bypassAuthState=r,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(t)?t:[t]}execute(){return new Promise(async(e,t)=>{this.pendingPromise={resolve:e,reject:t};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(n){this.reject(n)}})}async onAuthEvent(e){const{urlResponse:t,sessionId:n,postBody:s,tenantId:r,error:i,type:a}=e;if(i)return void this.reject(i);const o={auth:this.auth,requestUri:t,sessionId:n,tenantId:r||void 0,postBody:s||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(a)(o))}catch(c){this.reject(c)}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return Jf;case"linkViaPopup":case"linkViaRedirect":return em;case"reauthViaPopup":case"reauthViaRedirect":return Zf;default:Fd(this.auth,"internal-error")}}resolve(e){Kd(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){Kd(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}const nm=new Xd(2e3,1e4);class sm extends tm{constructor(e,t,n,s,r){super(e,t,s,r),this.provider=n,this.authWindow=null,this.pollId=null,sm.currentPopupAction&&sm.currentPopupAction.cancel(),sm.currentPopupAction=this}async executeNotNull(){const e=await this.execute();return Gd(e,this.auth,"internal-error"),e}async onExecution(){Kd(1===this.filter.length,"Popup operations only handle one event");const e=Lf();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],e),this.authWindow.associatedEvent=e,this.resolver._originValidation(this.auth).catch(e=>{this.reject(e)}),this.resolver._isIframeWebStorageSupported(this.auth,e=>{e||this.reject(Vd(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){return this.authWindow?.associatedEvent||null}cancel(){this.reject(Vd(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,sm.currentPopupAction=null}pollUserCancellation(){const e=()=>{this.authWindow?.window?.closed?this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(Vd(this.auth,"popup-closed-by-user"))},8e3):this.pollId=window.setTimeout(e,nm.get())};e()}}sm.currentPopupAction=null;const rm=new Map;class im extends tm{constructor(e,t,n=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],t,void 0,n),this.eventId=null}async execute(){let e=rm.get(this.auth._key());if(!e){try{const t=await async function(e,t){const n=cm(t),s=om(e);if(!(await s._isAvailable()))return!1;const r="true"===await s._get(n);return await s._remove(n),r}(this.resolver,this.auth)?await super.execute():null;e=()=>Promise.resolve(t)}catch(t){e=()=>Promise.reject(t)}rm.set(this.auth._key(),e)}return this.bypassAuthState||rm.set(this.auth._key(),()=>Promise.resolve(null)),e()}async onAuthEvent(e){if("signInViaRedirect"===e.type)return super.onAuthEvent(e);if("unknown"!==e.type){if(e.eventId){const t=await this.auth._redirectUserForId(e.eventId);if(t)return this.user=t,super.onAuthEvent(e);this.resolve(null)}}else this.resolve(null)}async onExecution(){}cleanUp(){}}function am(e,t){rm.set(e._key(),t)}function om(e){return Cp(e._redirectPersistence)}function cm(e){return Ap("pendingRedirect",e.config.apiKey,e.name)}function lm(e,t,n){return async function(e,t,n){if(vn(e.app))return Promise.reject(Bd(e));const s=Kp(e);qd(e,t,mf),await s._initializationPromise;const r=Yf(s,n);return await async function(e,t){return om(e)._set(cm(t),"true")}(r,s),r._openRedirect(s,t,"signInViaRedirect")}(e,t,n)}async function um(e,t,n=!1){if(vn(e.app))return Promise.reject(Bd(e));const s=Kp(e),r=Yf(s,t),i=new im(s,r,n),a=await i.execute();return a&&!n&&(delete a.user._redirectEventId,await s._persistUserIfCurrent(a.user),await s._setRedirectUser(null,t)),a}class hm{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let t=!1;return this.consumers.forEach(n=>{this.isEventForConsumer(e,n)&&(t=!0,this.sendToConsumer(e,n),this.saveEventToCache(e))}),this.hasHandledPotentialRedirect||!function(e){switch(e.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return pm(e);default:return!1}}(e)||(this.hasHandledPotentialRedirect=!0,t||(this.queuedRedirectEvent=e,t=!0)),t}sendToConsumer(e,t){if(e.error&&!pm(e)){const n=e.error.code?.split("auth/")[1]||"internal-error";t.onError(Vd(this.auth,n))}else t.onAuthEvent(e)}isEventForConsumer(e,t){const n=null===t.eventId||!!e.eventId&&e.eventId===t.eventId;return t.filter.includes(e.type)&&n}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=6e5&&this.cachedEventUids.clear(),this.cachedEventUids.has(dm(e))}saveEventToCache(e){this.cachedEventUids.add(dm(e)),this.lastProcessedEventTime=Date.now()}}function dm(e){return[e.type,e.eventId,e.sessionId,e.tenantId].filter(e=>e).join("-")}function pm({type:e,error:t}){return"unknown"===e&&"auth/no-auth-event"===t?.code}const fm=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,mm=/^https?/;async function gm(e){if(e.config.emulator)return;const{authorizedDomains:t}=await async function(e,t={}){return rp(e,"GET","/v1/projects",t)}(e);for(const n of t)try{if(ym(n))return}catch{}Fd(e,"unauthorized-domain")}function ym(e){const t=Wd(),{protocol:n,hostname:s}=new URL(t);if(e.startsWith("chrome-extension://")){const r=new URL(e);return""===r.hostname&&""===s?"chrome-extension:"===n&&e.replace("chrome-extension://","")===t.replace("chrome-extension://",""):"chrome-extension:"===n&&r.hostname===s}if(!mm.test(n))return!1;if(fm.test(e))return s===e;const r=e.replace(/\./g,"\\.");return new RegExp("^(.+\\."+r+"|"+r+")$","i").test(s)}const vm=new Xd(3e4,6e4);function wm(){const e=Uf().___jsl;if(e?.H)for(const t of Object.keys(e.H))if(e.H[t].r=e.H[t].r||[],e.H[t].L=e.H[t].L||[],e.H[t].r=[...e.H[t].L],e.CP)for(let n=0;n<e.CP.length;n++)e.CP[n]=null}function bm(e){return new Promise((t,n)=>{function s(){wm(),gapi.load("gapi.iframes",{callback:()=>{t(gapi.iframes.getContext())},ontimeout:()=>{wm(),n(Vd(e,"network-request-failed"))},timeout:vm.get()})}if(Uf().gapi?.iframes?.Iframe)t(gapi.iframes.getContext());else{if(!Uf().gapi?.load){const t=`__${"iframefcb"}${Math.floor(1e6*Math.random())}`;return Uf()[t]=()=>{gapi.load?s():n(Vd(e,"network-request-failed"))},Yp(`${Qp.gapiScript}?onload=${t}`).catch(e=>n(e))}s()}}).catch(e=>{throw xm=null,e})}let xm=null;const _m=new Xd(5e3,15e3),Em={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},Tm=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function Im(e){const t=e.config;Gd(t.authDomain,e,"auth-domain-config-required");const n=t.emulator?Jd(t,"emulator/auth/iframe"):`https://${e.config.authDomain}/__/auth/iframe`,s={apiKey:t.apiKey,appName:e.name,v:xn},r=Tm.get(e.config.apiHost);r&&(s.eid=r);const i=e._getFrameworks();return i.length&&(s.fw=i.join(",")),`${n}?${Je(s).slice(1)}`}async function Nm(e){const t=await function(e){return xm=xm||bm(e),xm}(e),n=Uf().gapi;return Gd(n,e,"internal-error"),t.open({where:document.body,url:Im(e),messageHandlersFilter:n.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:Em,dontclear:!0},t=>new Promise(async(n,s)=>{await t.restyle({setHideOnLeave:!1});const r=Vd(e,"network-request-failed"),i=Uf().setTimeout(()=>{s(r)},_m.get());function a(){Uf().clearTimeout(i),n(t)}t.ping(a).then(a,()=>{s(r)})}))}const Cm={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"};class Sm{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch(e){}}}function km(e,t,n,s=500,r=600){const i=Math.max((window.screen.availHeight-r)/2,0).toString(),a=Math.max((window.screen.availWidth-s)/2,0).toString();let o="";const c={...Cm,width:s.toString(),height:r.toString(),top:i,left:a},l=$e().toLowerCase();n&&(o=Pp(l)?"_blank":n),Dp(l)&&(t=t||"http://localhost",c.scrollbars="yes");const u=Object.entries(c).reduce((e,[t,n])=>`${e}${t}=${n},`,"");if(function(e=$e()){return Vp(e)&&!!window.navigator?.standalone}(l)&&"_self"!==o)return function(e,t){const n=document.createElement("a");n.href=e,n.target=t;const s=document.createEvent("MouseEvent");s.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),n.dispatchEvent(s)}(t||"",o),new Sm(null);const h=window.open(t||"",o,u);Gd(h,e,"popup-blocked");try{h.focus()}catch(d){}return new Sm(h)}const Am="__/auth/handler",Rm="emulator/auth/handler",jm=encodeURIComponent("fac");async function Dm(e,t,n,s,r,i){Gd(e.config.authDomain,e,"auth-domain-config-required"),Gd(e.config.apiKey,e,"invalid-api-key");const a={apiKey:e.config.apiKey,appName:e.name,authType:n,redirectUrl:s,v:xn,eventId:r};if(t instanceof mf){t.setDefaultLanguage(e.languageCode),a.providerId=t.providerId||"",function(e){for(const t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}(t.getCustomParameters())||(a.customParameters=JSON.stringify(t.getCustomParameters()));for(const[e,t]of Object.entries({}))a[e]=t}if(t instanceof gf){const e=t.getScopes().filter(e=>""!==e);e.length>0&&(a.scopes=e.join(","))}e.tenantId&&(a.tid=e.tenantId);const o=a;for(const u of Object.keys(o))void 0===o[u]&&delete o[u];const c=await e._getAppCheckToken(),l=c?`#${jm}=${encodeURIComponent(c)}`:"";return`${function({config:e}){if(!e.emulator)return`https://${e.authDomain}/${Am}`;return Jd(e,Rm)}(e)}?${Je(o).slice(1)}${l}`}const Om="webStorageSupport";const Pm=class{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=Of,this._completeRedirectFn=um,this._overrideRedirectResult=am}async _openPopup(e,t,n,s){Kd(this.eventManagers[e._key()]?.manager,"_initialize() not called before _openPopup()");return km(e,await Dm(e,t,n,Wd(),s),Lf())}async _openRedirect(e,t,n,s){await this._originValidation(e);return function(e){Uf().location.href=e}(await Dm(e,t,n,Wd(),s)),new Promise(()=>{})}_initialize(e){const t=e._key();if(this.eventManagers[t]){const{manager:e,promise:n}=this.eventManagers[t];return e?Promise.resolve(e):(Kd(n,"If manager is not set, promise should be"),n)}const n=this.initAndGetManager(e);return this.eventManagers[t]={promise:n},n.catch(()=>{delete this.eventManagers[t]}),n}async initAndGetManager(e){const t=await Nm(e),n=new hm(e);return t.register("authEvent",t=>{Gd(t?.authEvent,e,"invalid-auth-event");return{status:n.onEvent(t.authEvent)?"ACK":"ERROR"}},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:n},this.iframes[e._key()]=t,n}_isIframeWebStorageSupported(e,t){this.iframes[e._key()].send(Om,{type:Om},n=>{const s=n?.[0]?.[Om];void 0!==s&&t(!!s),Fd(e,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){const t=e._key();return this.originValidationPromises[t]||(this.originValidationPromises[t]=gm(e)),this.originValidationPromises[t]}get _shouldInitProactively(){return Bp()||Op()||Vp()}};var Lm="@firebase/auth",Mm="1.11.1";class Um{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){return this.assertAuthConfigured(),this.auth.currentUser?.uid||null}async getToken(e){if(this.assertAuthConfigured(),await this.auth._initializationPromise,!this.auth.currentUser)return null;return{accessToken:await this.auth.currentUser.getIdToken(e)}}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;const t=this.auth.onIdTokenChanged(t=>{e(t?.stsTokenManager.accessToken||null)});this.internalListeners.set(e,t),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();const t=this.internalListeners.get(e);t&&(this.internalListeners.delete(e),t(),this.updateProactiveRefresh())}assertAuthConfigured(){Gd(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}const Fm=De("authIdTokenMaxAge")||300;let Vm=null;function $m(e=En()){const t=yn(e,"auth");if(t.isInitialized())return t.getImmediate();const n=function(e,t){const n=yn(e,"auth");if(n.isInitialized()){const e=n.getImmediate();if(Ye(n.getOptions(),t??{}))return e;Fd(e,"already-initialized")}return n.initialize({options:t})}(e,{popupRedirectResolver:Pm,persistence:[Qf,jf,Of]}),s=De("authTokenSyncURL");if(s&&"boolean"==typeof isSecureContext&&isSecureContext){const e=new URL(s,location.origin);if(location.origin===e.origin){const t=(r=e.toString(),async e=>{const t=e&&await e.getIdTokenResult(),n=t&&((new Date).getTime()-Date.parse(t.issuedAtTime))/1e3;if(n&&n>Fm)return;const s=t?.token;Vm!==s&&(Vm=s,await fetch(r,{method:s?"POST":"DELETE",headers:s?{Authorization:`Bearer ${s}`}:{}}))});!function(e,t,n){rt(e).beforeAuthStateChanged(t,n)}(n,t,()=>t(n.currentUser)),function(e,t,n,s){rt(e).onIdTokenChanged(t,n,s)}(n,e=>t(e))}}var r;const i=Ae("auth");return i&&sf(n,`http://${i}`),n}var Bm;Qp={loadJS:e=>new Promise((t,n)=>{const s=document.createElement("script");s.setAttribute("src",e),s.onload=t,s.onerror=e=>{const t=Vd("internal-error");t.customData=e,n(t)},s.type="text/javascript",s.charset="UTF-8",(document.getElementsByTagName("head")?.[0]??document).appendChild(s)}),gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="},Bm="Browser",gn(new it("auth",(e,{options:t})=>{const n=e.getProvider("app").getImmediate(),s=e.getProvider("heartbeat"),r=e.getProvider("app-check-internal"),{apiKey:i,authDomain:a}=n.options;Gd(i&&!i.includes(":"),"invalid-api-key",{appName:n.name});const o={apiKey:i,authDomain:a,clientPlatform:Bm,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:qp(Bm)},c=new Hp(n,s,r,o);return function(e,t){const n=t?.persistence||[],s=(Array.isArray(n)?n:[n]).map(Cp);t?.errorMap&&e._updateErrorMap(t.errorMap),e._initializeWithPersistence(s,t?.popupRedirectResolver)}(c,t),c},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,t,n)=>{e.getProvider("auth-internal").initialize()})),gn(new it("auth-internal",e=>{const t=Kp(e.getProvider("auth").getImmediate());return new Um(t)},"PRIVATE").setInstantiationMode("EXPLICIT")),Tn(Lm,Mm,function(e){switch(e){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}(Bm)),Tn(Lm,Mm,"esm2020");const qm="firebasestorage.googleapis.com",zm="storageBucket";class Gm extends Ke{constructor(e,t,n=0){super(Ym(e),`Firebase Storage: ${t} (${Ym(e)})`),this.status_=n,this.customData={serverResponse:null},this._baseMessage=this.message,Object.setPrototypeOf(this,Gm.prototype)}get status(){return this.status_}set status(e){this.status_=e}_codeEquals(e){return Ym(e)===this.code}get serverResponse(){return this.customData.serverResponse}set serverResponse(e){this.customData.serverResponse=e,this.customData.serverResponse?this.message=`${this._baseMessage}\n${this.customData.serverResponse}`:this.message=this._baseMessage}}var Hm,Km,Wm,Qm;function Ym(e){return"storage/"+e}function Xm(){return new Gm(Hm.UNKNOWN,"An unknown error occurred, please check the error payload for server response.")}function Jm(e){return new Gm(Hm.INVALID_ARGUMENT,e)}function Zm(){return new Gm(Hm.APP_DELETED,"The Firebase app was deleted.")}function eg(e,t){return new Gm(Hm.INVALID_FORMAT,"String does not match format '"+e+"': "+t)}function tg(e){throw new Gm(Hm.INTERNAL_ERROR,"Internal error: "+e)}(Km=Hm||(Hm={})).UNKNOWN="unknown",Km.OBJECT_NOT_FOUND="object-not-found",Km.BUCKET_NOT_FOUND="bucket-not-found",Km.PROJECT_NOT_FOUND="project-not-found",Km.QUOTA_EXCEEDED="quota-exceeded",Km.UNAUTHENTICATED="unauthenticated",Km.UNAUTHORIZED="unauthorized",Km.UNAUTHORIZED_APP="unauthorized-app",Km.RETRY_LIMIT_EXCEEDED="retry-limit-exceeded",Km.INVALID_CHECKSUM="invalid-checksum",Km.CANCELED="canceled",Km.INVALID_EVENT_NAME="invalid-event-name",Km.INVALID_URL="invalid-url",Km.INVALID_DEFAULT_BUCKET="invalid-default-bucket",Km.NO_DEFAULT_BUCKET="no-default-bucket",Km.CANNOT_SLICE_BLOB="cannot-slice-blob",Km.SERVER_FILE_WRONG_SIZE="server-file-wrong-size",Km.NO_DOWNLOAD_URL="no-download-url",Km.INVALID_ARGUMENT="invalid-argument",Km.INVALID_ARGUMENT_COUNT="invalid-argument-count",Km.APP_DELETED="app-deleted",Km.INVALID_ROOT_OPERATION="invalid-root-operation",Km.INVALID_FORMAT="invalid-format",Km.INTERNAL_ERROR="internal-error",Km.UNSUPPORTED_ENVIRONMENT="unsupported-environment";class ng{constructor(e,t){this.bucket=e,this.path_=t}get path(){return this.path_}get isRoot(){return 0===this.path.length}fullServerUrl(){const e=encodeURIComponent;return"/b/"+e(this.bucket)+"/o/"+e(this.path)}bucketOnlyServerUrl(){return"/b/"+encodeURIComponent(this.bucket)+"/o"}static makeFromBucketSpec(e,t){let n;try{n=ng.makeFromUrl(e,t)}catch(r){return new ng(e,"")}if(""===n.path)return n;throw s=e,new Gm(Hm.INVALID_DEFAULT_BUCKET,"Invalid default bucket '"+s+"'.");var s}static makeFromUrl(e,t){let n=null;const s="([A-Za-z0-9.\\-_]+)";const r=new RegExp("^gs://"+s+"(/(.*))?$","i");function i(e){e.path_=decodeURIComponent(e.path)}const a=t.replace(/[.]/g,"\\."),o=[{regex:r,indices:{bucket:1,path:3},postModify:function(e){"/"===e.path.charAt(e.path.length-1)&&(e.path_=e.path_.slice(0,-1))}},{regex:new RegExp(`^https?://${a}/v[A-Za-z0-9_]+/b/${s}/o(/([^?#]*).*)?$`,"i"),indices:{bucket:1,path:3},postModify:i},{regex:new RegExp(`^https?://${t===qm?"(?:storage.googleapis.com|storage.cloud.google.com)":t}/${s}/([^?#]*)`,"i"),indices:{bucket:1,path:2},postModify:i}];for(let c=0;c<o.length;c++){const t=o[c],s=t.regex.exec(e);if(s){const e=s[t.indices.bucket];let r=s[t.indices.path];r||(r=""),n=new ng(e,r),t.postModify(n);break}}if(null==n)throw function(e){return new Gm(Hm.INVALID_URL,"Invalid URL '"+e+"'.")}(e);return n}}class sg{constructor(e){this.promise_=Promise.reject(e)}getPromise(){return this.promise_}cancel(e=!1){}}function rg(e){return"string"==typeof e||e instanceof String}function ig(e){return ag()&&e instanceof Blob}function ag(){return"undefined"!=typeof Blob}function og(e,t,n,s){if(s<t)throw Jm(`Invalid value for '${e}'. Expected ${t} or greater.`);if(s>n)throw Jm(`Invalid value for '${e}'. Expected ${n} or less.`)}function cg(e,t,n){let s=t;return null==n&&(s=`https://${t}`),`${n}://${s}/v0${e}`}function lg(e){const t=encodeURIComponent;let n="?";for(const s in e)if(e.hasOwnProperty(s)){n=n+(t(s)+"="+t(e[s]))+"&"}return n=n.slice(0,-1),n}(Qm=Wm||(Wm={}))[Qm.NO_ERROR=0]="NO_ERROR",Qm[Qm.NETWORK_ERROR=1]="NETWORK_ERROR",Qm[Qm.ABORT=2]="ABORT";class ug{constructor(e,t,n,s,r,i,a,o,c,l,u,h=!0,d=!1){this.url_=e,this.method_=t,this.headers_=n,this.body_=s,this.successCodes_=r,this.additionalRetryCodes_=i,this.callback_=a,this.errorCallback_=o,this.timeout_=c,this.progressCallback_=l,this.connectionFactory_=u,this.retry=h,this.isUsingEmulator=d,this.pendingConnection_=null,this.backoffId_=null,this.canceled_=!1,this.appDelete_=!1,this.promise_=new Promise((e,t)=>{this.resolve_=e,this.reject_=t,this.start_()})}start_(){const e=(e,t)=>{if(t)return void e(!1,new hg(!1,null,!0));const n=this.connectionFactory_();this.pendingConnection_=n;const s=e=>{const t=e.loaded,n=e.lengthComputable?e.total:-1;null!==this.progressCallback_&&this.progressCallback_(t,n)};null!==this.progressCallback_&&n.addUploadProgressListener(s),n.send(this.url_,this.method_,this.isUsingEmulator,this.body_,this.headers_).then(()=>{null!==this.progressCallback_&&n.removeUploadProgressListener(s),this.pendingConnection_=null;const t=n.getErrorCode()===Wm.NO_ERROR,r=n.getStatus();if(!t||function(e,t){const n=e>=500&&e<600,s=-1!==[408,429].indexOf(e),r=-1!==t.indexOf(e);return n||s||r}(r,this.additionalRetryCodes_)&&this.retry){const t=n.getErrorCode()===Wm.ABORT;return void e(!1,new hg(!1,null,t))}const i=-1!==this.successCodes_.indexOf(r);e(!0,new hg(i,n))})},t=(e,t)=>{const n=this.resolve_,s=this.reject_,r=t.connection;if(t.wasSuccessCode)try{const e=this.callback_(r,r.getResponse());!function(e){return void 0!==e}(e)?n():n(e)}catch(i){s(i)}else if(null!==r){const e=Xm();e.serverResponse=r.getErrorText(),this.errorCallback_?s(this.errorCallback_(r,e)):s(e)}else if(t.canceled){s(this.appDelete_?Zm():new Gm(Hm.CANCELED,"User canceled the upload/download."))}else{s(new Gm(Hm.RETRY_LIMIT_EXCEEDED,"Max retry time for operation exceeded, please try again."))}};this.canceled_?t(0,new hg(!1,null,!0)):this.backoffId_=function(e,t,n){let s=1,r=null,i=null,a=!1,o=0;function c(){return 2===o}let l=!1;function u(...e){l||(l=!0,t.apply(null,e))}function h(t){r=setTimeout(()=>{r=null,e(p,c())},t)}function d(){i&&clearTimeout(i)}function p(e,...t){if(l)return void d();if(e)return d(),void u.call(null,e,...t);if(c()||a)return d(),void u.call(null,e,...t);let n;s<64&&(s*=2),1===o?(o=2,n=0):n=1e3*(s+Math.random()),h(n)}let f=!1;function m(e){f||(f=!0,d(),l||(null!==r?(e||(o=2),clearTimeout(r),h(0)):e||(o=1)))}return h(0),i=setTimeout(()=>{a=!0,m(!0)},n),m}(e,t,this.timeout_)}getPromise(){return this.promise_}cancel(e){this.canceled_=!0,this.appDelete_=e||!1,null!==this.backoffId_&&(0,this.backoffId_)(!1),null!==this.pendingConnection_&&this.pendingConnection_.abort()}}class hg{constructor(e,t,n){this.wasSuccessCode=e,this.connection=t,this.canceled=!!n}}function dg(...e){const t="undefined"!=typeof BlobBuilder?BlobBuilder:"undefined"!=typeof WebKitBlobBuilder?WebKitBlobBuilder:void 0;if(void 0!==t){const n=new t;for(let t=0;t<e.length;t++)n.append(e[t]);return n.getBlob()}if(ag())return new Blob(e);throw new Gm(Hm.UNSUPPORTED_ENVIRONMENT,"This browser doesn't seem to support creating Blobs")}function pg(e){if("undefined"==typeof atob)throw t="base-64",new Gm(Hm.UNSUPPORTED_ENVIRONMENT,`${t} is missing. Make sure to install the required polyfills. See https://firebase.google.com/docs/web/environments-js-sdk#polyfills for more information.`);var t;return atob(e)}const fg="raw",mg="base64",gg="base64url",yg="data_url";class vg{constructor(e,t){this.data=e,this.contentType=t||null}}function wg(e,t){switch(e){case fg:return new vg(bg(t));case mg:case gg:return new vg(xg(e,t));case yg:return new vg(function(e){const t=new _g(e);return t.base64?xg(mg,t.rest):function(e){let t;try{t=decodeURIComponent(e)}catch(n){throw eg(yg,"Malformed data URL.")}return bg(t)}(t.rest)}(t),new _g(t).contentType)}throw Xm()}function bg(e){const t=[];for(let n=0;n<e.length;n++){let s=e.charCodeAt(n);if(s<=127)t.push(s);else if(s<=2047)t.push(192|s>>6,128|63&s);else if(55296==(64512&s)){if(n<e.length-1&&56320==(64512&e.charCodeAt(n+1))){s=65536|(1023&s)<<10|1023&e.charCodeAt(++n),t.push(240|s>>18,128|s>>12&63,128|s>>6&63,128|63&s)}else t.push(239,191,189)}else 56320==(64512&s)?t.push(239,191,189):t.push(224|s>>12,128|s>>6&63,128|63&s)}return new Uint8Array(t)}function xg(e,t){switch(e){case mg:{const n=-1!==t.indexOf("-"),s=-1!==t.indexOf("_");if(n||s){throw eg(e,"Invalid character '"+(n?"-":"_")+"' found: is it base64url encoded?")}break}case gg:{const n=-1!==t.indexOf("+"),s=-1!==t.indexOf("/");if(n||s){throw eg(e,"Invalid character '"+(n?"+":"/")+"' found: is it base64 encoded?")}t=t.replace(/-/g,"+").replace(/_/g,"/");break}}let n;try{n=pg(t)}catch(r){if(r.message.includes("polyfill"))throw r;throw eg(e,"Invalid character found")}const s=new Uint8Array(n.length);for(let i=0;i<n.length;i++)s[i]=n.charCodeAt(i);return s}class _g{constructor(e){this.base64=!1,this.contentType=null;const t=e.match(/^data:([^,]+)?,/);if(null===t)throw eg(yg,"Must be formatted 'data:[<mediatype>][;base64],<data>");const n=t[1]||null;null!=n&&(this.base64=function(e,t){if(!(e.length>=t.length))return!1;return e.substring(e.length-t.length)===t}(n,";base64"),this.contentType=this.base64?n.substring(0,n.length-7):n),this.rest=e.substring(e.indexOf(",")+1)}}class Eg{constructor(e,t){let n=0,s="";ig(e)?(this.data_=e,n=e.size,s=e.type):e instanceof ArrayBuffer?(t?this.data_=new Uint8Array(e):(this.data_=new Uint8Array(e.byteLength),this.data_.set(new Uint8Array(e))),n=this.data_.length):e instanceof Uint8Array&&(t?this.data_=e:(this.data_=new Uint8Array(e.length),this.data_.set(e)),n=e.length),this.size_=n,this.type_=s}size(){return this.size_}type(){return this.type_}slice(e,t){if(ig(this.data_)){const i=this.data_,a=(s=e,r=t,(n=i).webkitSlice?n.webkitSlice(s,r):n.mozSlice?n.mozSlice(s,r):n.slice?n.slice(s,r):null);return null===a?null:new Eg(a)}{const n=new Uint8Array(this.data_.buffer,e,t-e);return new Eg(n,!0)}var n,s,r}static getBlob(...e){if(ag()){const t=e.map(e=>e instanceof Eg?e.data_:e);return new Eg(dg.apply(null,t))}{const t=e.map(e=>rg(e)?wg(fg,e).data:e.data_);let n=0;t.forEach(e=>{n+=e.byteLength});const s=new Uint8Array(n);let r=0;return t.forEach(e=>{for(let t=0;t<e.length;t++)s[r++]=e[t]}),new Eg(s,!0)}}uploadData(){return this.data_}}function Tg(e){let t;try{t=JSON.parse(e)}catch(n){return null}return function(e){return"object"==typeof e&&!Array.isArray(e)}(t)?t:null}function Ig(e){const t=e.lastIndexOf("/",e.length-2);return-1===t?e:e.slice(t+1)}function Ng(e,t){return t}class Cg{constructor(e,t,n,s){this.server=e,this.local=t||e,this.writable=!!n,this.xform=s||Ng}}let Sg=null;function kg(){if(Sg)return Sg;const e=[];e.push(new Cg("bucket")),e.push(new Cg("generation")),e.push(new Cg("metageneration")),e.push(new Cg("name","fullPath",!0));const t=new Cg("name");t.xform=function(e,t){return function(e){return!rg(e)||e.length<2?e:Ig(e)}(t)},e.push(t);const n=new Cg("size");return n.xform=function(e,t){return void 0!==t?Number(t):t},e.push(n),e.push(new Cg("timeCreated")),e.push(new Cg("updated")),e.push(new Cg("md5Hash",null,!0)),e.push(new Cg("cacheControl",null,!0)),e.push(new Cg("contentDisposition",null,!0)),e.push(new Cg("contentEncoding",null,!0)),e.push(new Cg("contentLanguage",null,!0)),e.push(new Cg("contentType",null,!0)),e.push(new Cg("metadata","customMetadata",!0)),Sg=e,Sg}function Ag(e,t,n){const s={type:"file"},r=n.length;for(let i=0;i<r;i++){const e=n[i];s[e.local]=e.xform(s,t[e.server])}return function(e,t){Object.defineProperty(e,"ref",{get:function(){const n=e.bucket,s=e.fullPath,r=new ng(n,s);return t._makeStorageReference(r)}})}(s,e),s}function Rg(e,t,n){const s=Tg(t);if(null===s)return null;return Ag(e,s,n)}class jg{constructor(e,t,n,s){this.url=e,this.method=t,this.handler=n,this.timeout=s,this.urlParams={},this.headers={},this.body=null,this.errorHandler=null,this.progressCallback=null,this.successCodes=[200],this.additionalRetryCodes=[]}}function Dg(e){if(!e)throw Xm()}function Og(e,t){return function(n,s){const r=Rg(e,s,t);return Dg(null!==r),function(e,t,n,s){const r=Tg(t);if(null===r)return null;if(!rg(r.downloadTokens))return null;const i=r.downloadTokens;if(0===i.length)return null;const a=encodeURIComponent;return i.split(",").map(t=>{const r=e.bucket,i=e.fullPath;return cg("/b/"+a(r)+"/o/"+a(i),n,s)+lg({alt:"media",token:t})})[0]}(r,s,e.host,e._protocol)}}function Pg(e){return function(t,n){let s;var r,i;return 401===t.getStatus()?s=t.getErrorText().includes("Firebase App Check token is invalid")?new Gm(Hm.UNAUTHORIZED_APP,"This app does not have permission to access Firebase Storage on this project."):new Gm(Hm.UNAUTHENTICATED,"User is not authenticated, please authenticate using Firebase Authentication and try again."):402===t.getStatus()?(i=e.bucket,s=new Gm(Hm.QUOTA_EXCEEDED,"Quota for bucket '"+i+"' exceeded, please view quota on https://firebase.google.com/pricing/.")):403===t.getStatus()?(r=e.path,s=new Gm(Hm.UNAUTHORIZED,"User does not have permission to access '"+r+"'.")):s=n,s.status=t.getStatus(),s.serverResponse=n.serverResponse,s}}function Lg(e){const t=Pg(e);return function(n,s){let r=t(n,s);var i;return 404===n.getStatus()&&(i=e.path,r=new Gm(Hm.OBJECT_NOT_FOUND,"Object '"+i+"' does not exist.")),r.serverResponse=s.serverResponse,r}}function Mg(e,t,n,s,r){const i=t.bucketOnlyServerUrl(),a={"X-Goog-Upload-Protocol":"multipart"};const o=function(){let e="";for(let t=0;t<2;t++)e+=Math.random().toString().slice(2);return e}();a["Content-Type"]="multipart/related; boundary="+o;const c=function(e,t,n){const s=Object.assign({},n);return s.fullPath=e.path,s.size=t.size(),s.contentType||(s.contentType=function(e,t){return e&&e.contentType||t&&t.type()||"application/octet-stream"}(null,t)),s}(t,s,r),l=function(e,t){const n={},s=t.length;for(let r=0;r<s;r++){const s=t[r];s.writable&&(n[s.server]=e[s.local])}return JSON.stringify(n)}(c,n),u="--"+o+"\r\nContent-Type: application/json; charset=utf-8\r\n\r\n"+l+"\r\n--"+o+"\r\nContent-Type: "+c.contentType+"\r\n\r\n",h="\r\n--"+o+"--",d=Eg.getBlob(u,s,h);if(null===d)throw new Gm(Hm.CANNOT_SLICE_BLOB,"Cannot slice blob for upload. Please retry the upload.");const p={name:c.fullPath},f=cg(i,e.host,e._protocol),m=e.maxUploadRetryTime,g=new jg(f,"POST",function(e,t){return function(n,s){const r=Rg(e,s,t);return Dg(null!==r),r}}(e,n),m);return g.urlParams=p,g.headers=a,g.body=d.uploadData(),g.errorHandler=Pg(t),g}class Ug{constructor(){this.sent_=!1,this.xhr_=new XMLHttpRequest,this.initXhr(),this.errorCode_=Wm.NO_ERROR,this.sendPromise_=new Promise(e=>{this.xhr_.addEventListener("abort",()=>{this.errorCode_=Wm.ABORT,e()}),this.xhr_.addEventListener("error",()=>{this.errorCode_=Wm.NETWORK_ERROR,e()}),this.xhr_.addEventListener("load",()=>{e()})})}send(e,t,n,s,r){if(this.sent_)throw tg("cannot .send() more than once");if(Pe(e)&&n&&(this.xhr_.withCredentials=!0),this.sent_=!0,this.xhr_.open(t,e,!0),void 0!==r)for(const i in r)r.hasOwnProperty(i)&&this.xhr_.setRequestHeader(i,r[i].toString());return void 0!==s?this.xhr_.send(s):this.xhr_.send(),this.sendPromise_}getErrorCode(){if(!this.sent_)throw tg("cannot .getErrorCode() before sending");return this.errorCode_}getStatus(){if(!this.sent_)throw tg("cannot .getStatus() before sending");try{return this.xhr_.status}catch(e){return-1}}getResponse(){if(!this.sent_)throw tg("cannot .getResponse() before sending");return this.xhr_.response}getErrorText(){if(!this.sent_)throw tg("cannot .getErrorText() before sending");return this.xhr_.statusText}abort(){this.xhr_.abort()}getResponseHeader(e){return this.xhr_.getResponseHeader(e)}addUploadProgressListener(e){null!=this.xhr_.upload&&this.xhr_.upload.addEventListener("progress",e)}removeUploadProgressListener(e){null!=this.xhr_.upload&&this.xhr_.upload.removeEventListener("progress",e)}}class Fg extends Ug{initXhr(){this.xhr_.responseType="text"}}function Vg(){return new Fg}class $g{constructor(e,t){this._service=e,this._location=t instanceof ng?t:ng.makeFromUrl(t,e.host)}toString(){return"gs://"+this._location.bucket+"/"+this._location.path}_newRef(e,t){return new $g(e,t)}get root(){const e=new ng(this._location.bucket,"");return this._newRef(this._service,e)}get bucket(){return this._location.bucket}get fullPath(){return this._location.path}get name(){return Ig(this._location.path)}get storage(){return this._service}get parent(){const e=function(e){if(0===e.length)return null;const t=e.lastIndexOf("/");return-1===t?"":e.slice(0,t)}(this._location.path);if(null===e)return null;const t=new ng(this._location.bucket,e);return new $g(this._service,t)}_throwIfRoot(e){if(""===this._location.path)throw function(e){return new Gm(Hm.INVALID_ROOT_OPERATION,"The operation '"+e+"' cannot be performed on a root reference, create a non-root reference using child, such as .child('file.png').")}(e)}}function Bg(e){e._throwIfRoot("getDownloadURL");const t=function(e,t,n){const s=cg(t.fullServerUrl(),e.host,e._protocol),r=e.maxOperationRetryTime,i=new jg(s,"GET",Og(e,n),r);return i.errorHandler=Lg(t),i}(e.storage,e._location,kg());return e.storage.makeRequestWithTokens(t,Vg).then(e=>{if(null===e)throw new Gm(Hm.NO_DOWNLOAD_URL,"The given file does not have any download URLs.");return e})}function qg(e,t){if(e instanceof Hg){const n=e;if(null==n._bucket)throw new Gm(Hm.NO_DEFAULT_BUCKET,"No default bucket found. Did you set the '"+zm+"' property when initializing the app?");const s=new $g(n,n._bucket);return null!=t?qg(s,t):s}return void 0!==t?function(e,t){const n=function(e,t){const n=t.split("/").filter(e=>e.length>0).join("/");return 0===e.length?n:e+"/"+n}(e._location.path,t),s=new ng(e._location.bucket,n);return new $g(e.storage,s)}(e,t):e}function zg(e,t){if(t&&/^[A-Za-z]+:\/\//.test(t)){if(e instanceof Hg)return new $g(e,t);throw Jm("To use ref(service, url), the first argument must be a Storage instance.")}return qg(e,t)}function Gg(e,t){const n=t?.[zm];return null==n?null:ng.makeFromBucketSpec(n,e)}class Hg{constructor(e,t,n,s,r,i=!1){this.app=e,this._authProvider=t,this._appCheckProvider=n,this._url=s,this._firebaseVersion=r,this._isUsingEmulator=i,this._bucket=null,this._host=qm,this._protocol="https",this._appId=null,this._deleted=!1,this._maxOperationRetryTime=12e4,this._maxUploadRetryTime=6e5,this._requests=new Set,this._bucket=null!=s?ng.makeFromBucketSpec(s,this._host):Gg(this._host,this.app.options)}get host(){return this._host}set host(e){this._host=e,null!=this._url?this._bucket=ng.makeFromBucketSpec(this._url,e):this._bucket=Gg(e,this.app.options)}get maxUploadRetryTime(){return this._maxUploadRetryTime}set maxUploadRetryTime(e){og("time",0,Number.POSITIVE_INFINITY,e),this._maxUploadRetryTime=e}get maxOperationRetryTime(){return this._maxOperationRetryTime}set maxOperationRetryTime(e){og("time",0,Number.POSITIVE_INFINITY,e),this._maxOperationRetryTime=e}async _getAuthToken(){if(this._overrideAuthToken)return this._overrideAuthToken;const e=this._authProvider.getImmediate({optional:!0});if(e){const t=await e.getToken();if(null!==t)return t.accessToken}return null}async _getAppCheckToken(){if(vn(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;const e=this._appCheckProvider.getImmediate({optional:!0});if(e){return(await e.getToken()).token}return null}_delete(){return this._deleted||(this._deleted=!0,this._requests.forEach(e=>e.cancel()),this._requests.clear()),Promise.resolve()}_makeStorageReference(e){return new $g(this,e)}_makeRequest(e,t,n,s,r=!0){if(this._deleted)return new sg(Zm());{const i=function(e,t,n,s,r,i,a=!0,o=!1){const c=lg(e.urlParams),l=e.url+c,u=Object.assign({},e.headers);return function(e,t){t&&(e["X-Firebase-GMPID"]=t)}(u,t),function(e,t){null!==t&&t.length>0&&(e.Authorization="Firebase "+t)}(u,n),function(e,t){e["X-Firebase-Storage-Version"]="webjs/"+(t??"AppManager")}(u,i),function(e,t){null!==t&&(e["X-Firebase-AppCheck"]=t)}(u,s),new ug(l,e.method,u,e.body,e.successCodes,e.additionalRetryCodes,e.handler,e.errorHandler,e.timeout,e.progressCallback,r,a,o)}(e,this._appId,n,s,t,this._firebaseVersion,r,this._isUsingEmulator);return this._requests.add(i),i.getPromise().then(()=>this._requests.delete(i),()=>this._requests.delete(i)),i}}async makeRequestWithTokens(e,t){const[n,s]=await Promise.all([this._getAuthToken(),this._getAppCheckToken()]);return this._makeRequest(e,t,n,s).getPromise()}}const Kg="@firebase/storage",Wg="0.14.0",Qg="storage";function Yg(e,t,n){return function(e,t,n){e._throwIfRoot("uploadBytes");const s=Mg(e.storage,e._location,kg(),new Eg(t,!0),n);return e.storage.makeRequestWithTokens(s,Vg).then(t=>({metadata:t,ref:e}))}(e=rt(e),t,n)}function Xg(e,{instanceIdentifier:t}){const n=e.getProvider("app").getImmediate(),s=e.getProvider("auth-internal"),r=e.getProvider("app-check-internal");return new Hg(n,s,r,t,xn)}gn(new it(Qg,Xg,"PUBLIC").setMultipleInstances(!0)),Tn(Kg,Wg,""),Tn(Kg,Wg,"esm2020");const Jg={apiKey:"AIzaSyClXQJGhOfvJmbvGve_CdGIYuDrgjlpjf4",authDomain:"budget-expense-app-c8262.firebaseapp.com",projectId:"budget-expense-app-c8262",storageBucket:"budget-expense-app-c8262.firebasestorage.app",messagingSenderId:"281688261944",appId:"1:281688261944:web:b02d31529d1fc84bfeadcd"};let Zg=null,ey=null,ty=null,ny=null,sy=null;if(!(["apiKey","authDomain","projectId","storageBucket","messagingSenderId","appId"].filter(e=>!Jg[e]||Jg[e]?.includes("YOUR_")).length>0))try{Zg=_n(Jg),ty=function(e){const t="object"==typeof e?e:En(),n="string"==typeof e?e:Ui,s=yn(t,"firestore").getImmediate({identifier:n});if(!s._initialized){const e=Re("firestore");e&&function(e,t,n,s={}){e=Yr(e,Sh);const r=Pe(t),i=e._getSettings(),a={...i,emulatorOptions:e._getEmulatorOptions()},o=`${t}:${n}`;r&&(Le(`https://${o}`),Ve("Firestore",!0)),i.host!==Ih&&i.host!==o&&fr("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used.");const c={...i,host:o,ssl:r,emulatorOptions:s};if(!Ye(c,a)&&(e._setSettings(c),s.mockUserToken)){let t,n;if("string"==typeof s.mockUserToken)t=s.mockUserToken,n=cr.MOCK_USER;else{t=Me(s.mockUserToken,e._app?.options.projectId);const r=s.mockUserToken.sub||s.mockUserToken.user_id;if(!r)throw new xr(br.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");n=new cr(r)}e._authCredentials=new Ir(new Er(t,n))}}(s,...e)}return s}(Zg),ny=$m(Zg),sy=function(e=En(),t){const n=yn(e=rt(e),Qg).getImmediate({identifier:t}),s=Re("storage");return s&&function(e,t,n,s={}){!function(e,t,n,s={}){e.host=`${t}:${n}`;const r=Pe(t);r&&(Le(`https://${e.host}/b`),Ve("Storage",!0)),e._isUsingEmulator=!0,e._protocol=r?"https":"http";const{mockUserToken:i}=s;i&&(e._overrideAuthToken="string"==typeof i?i:Me(i,e.app.options.projectId))}(e,t,n,s)}(n,...s),n}(Zg),"undefined"!=typeof window&&async function(){if(Be())return!1;if(!He())return!1;if(!ze())return!1;try{return await Ge()}catch(e){return!1}}().then(e=>{e&&Zg&&(ey=zs(Zg))})}catch(Fy){}const ry=["Food & Dining","Transportation","Entertainment","Bills & Utilities","Shopping","Healthcare","Education","Other"],iy=["Salary","Freelance","Investment","Other"],ay=({isOpen:e,onClose:t,onSubmit:n,initialData:r,isEditing:i=!1,darkMode:a,userId:o,expenseCategories:c=ry,incomeCategories:l=iy})=>{const u={type:"expense",amount:"",category:"Food & Dining",description:"",date:(new Date).toISOString().split("T")[0],receipt:null,isRecurring:!1,recurringFrequency:"monthly"},[h,d]=s.useState(u),[p,f]=s.useState({}),[m,g]=s.useState(!1),[y,v]=s.useState(null);s.useEffect(()=>{e&&(d(r||u),f({}),v(r?.receipt||null))},[e,r]),s.useEffect(()=>{const e="expense"===h.type?c:l;e.includes(h.category)||d(t=>({...t,category:e[0]}))},[h.type,c,l]);const w=e=>{const{name:t,value:n,type:s}=e.target;d("checkbox"===s?n=>({...n,[t]:e.target.checked}):e=>({...e,[t]:n})),p[t]&&f(e=>({...e,[t]:""}))},b=async e=>{const t=e.target.files?.[0];if(!t)return;if(t.size>5242880)return void f(e=>({...e,receipt:"File size must be less than 5MB"}));if(!t.type.startsWith("image/"))return void f(e=>({...e,receipt:"Please upload an image file"}));const n=new FileReader;if(n.onloadend=()=>{v(n.result)},n.readAsDataURL(t),o&&sy){g(!0);try{const e=Date.now(),n=`receipts/${o}/${e}_${t.name}`,i=(r=n,zg(rt(sy),r));await Yg(i,t);const a=await(s=i,Bg(s=rt(s)));d(e=>({...e,receipt:a})),f(e=>({...e,receipt:""}))}catch(Fy){f(e=>({...e,receipt:"Failed to upload receipt. Please try again."})),v(null)}finally{g(!1)}}else d(e=>({...e,receipt:n.result}));var s,r},x=e=>{e.preventDefault(),(()=>{const e={};return(!h.amount||parseFloat(h.amount)<=0)&&(e.amount="Please enter a valid amount"),h.description.trim()||(e.description="Please enter a description"),h.date||(e.date="Please select a date"),f(e),0===Object.keys(e).length})()&&n(h)};if(!e)return null;const E="expense"===h.type?c:l,T=a?"bg-gray-800":"bg-white",I=a?"text-white":"text-gray-900",N=a?"text-gray-400":"text-gray-600",C=a?"bg-gray-700 border-gray-600 text-white placeholder-gray-400":"bg-white border-gray-300 text-gray-900 placeholder-gray-500",S="block text-sm font-medium mb-2 "+(a?"text-gray-300":"text-gray-700");return pe.jsx("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center p-4 z-50",children:pe.jsxs("div",{className:`${T} rounded-2xl shadow-2xl w-full max-w-md max-h-[90vh] overflow-hidden flex flex-col`,children:[pe.jsxs("div",{className:"flex justify-between items-center p-6 border-b "+(a?"border-gray-700":"border-gray-200"),children:[pe.jsx("h2",{className:`text-xl md:text-2xl font-bold ${I}`,children:i?"Edit Transaction":"Add Transaction"}),pe.jsx("button",{onClick:t,className:"p-2 rounded-lg transition-colors "+(a?"hover:bg-gray-700 text-gray-400":"hover:bg-gray-100 text-gray-500"),"aria-label":"Close modal",children:pe.jsx(_,{className:"w-6 h-6"})})]}),pe.jsxs("form",{onSubmit:x,className:"flex-1 overflow-y-auto p-6 space-y-5",children:[pe.jsxs("div",{children:[pe.jsx("label",{className:S,children:"Type"}),pe.jsxs("div",{className:"flex gap-2",children:[pe.jsx("button",{type:"button",onClick:()=>d(e=>({...e,type:"expense"})),className:"flex-1 py-3 px-4 rounded-xl font-medium transition-all "+("expense"===h.type?"bg-red-500 text-white shadow-lg":a?"bg-gray-700 text-gray-300 hover:bg-gray-600":"bg-gray-100 text-gray-600 hover:bg-gray-200"),children:"Expense"}),pe.jsx("button",{type:"button",onClick:()=>d(e=>({...e,type:"income"})),className:"flex-1 py-3 px-4 rounded-xl font-medium transition-all "+("income"===h.type?"bg-green-500 text-white shadow-lg":a?"bg-gray-700 text-gray-300 hover:bg-gray-600":"bg-gray-100 text-gray-600 hover:bg-gray-200"),children:"Income"})]})]}),pe.jsxs("div",{children:[pe.jsx("label",{htmlFor:"amount",className:S,children:"Amount"}),pe.jsxs("div",{className:"relative",children:[pe.jsx("span",{className:`absolute left-4 top-1/2 -translate-y-1/2 ${N}`,children:"$"}),pe.jsx("input",{type:"number",id:"amount",name:"amount",value:h.amount,onChange:w,step:"0.01",min:"0",placeholder:"0.00",className:`w-full pl-8 pr-4 py-3 rounded-xl border-2 focus:ring-2 focus:ring-indigo-500 focus:border-transparent transition-all ${C} ${p.amount?"border-red-500":""}`})]}),p.amount&&pe.jsx("p",{className:"mt-1 text-sm text-red-500",children:p.amount})]}),pe.jsxs("div",{children:[pe.jsx("label",{htmlFor:"category",className:S,children:"Category"}),pe.jsx("select",{id:"category",name:"category",value:h.category,onChange:w,className:`w-full px-4 py-3 rounded-xl border-2 focus:ring-2 focus:ring-indigo-500 focus:border-transparent transition-all ${C}`,children:E.map(e=>pe.jsx("option",{value:e,children:e},e))})]}),pe.jsxs("div",{children:[pe.jsx("label",{htmlFor:"description",className:S,children:"Description"}),pe.jsx("input",{type:"text",id:"description",name:"description",value:h.description,onChange:w,placeholder:"What was this for?",maxLength:100,className:`w-full px-4 py-3 rounded-xl border-2 focus:ring-2 focus:ring-indigo-500 focus:border-transparent transition-all ${C} ${p.description?"border-red-500":""}`}),p.description&&pe.jsx("p",{className:"mt-1 text-sm text-red-500",children:p.description})]}),pe.jsxs("div",{children:[pe.jsx("label",{htmlFor:"date",className:S,children:"Date"}),pe.jsx("input",{type:"date",id:"date",name:"date",value:h.date,onChange:w,className:`w-full px-4 py-3 rounded-xl border-2 focus:ring-2 focus:ring-indigo-500 focus:border-transparent transition-all ${C} ${p.date?"border-red-500":""}`}),p.date&&pe.jsx("p",{className:"mt-1 text-sm text-red-500",children:p.date})]}),pe.jsxs("div",{className:"flex items-center justify-between p-4 rounded-xl "+(a?"bg-gray-700":"bg-gray-50"),children:[pe.jsxs("div",{className:"flex items-center gap-3",children:[pe.jsx(L,{className:`w-5 h-5 ${N}`}),pe.jsxs("div",{children:[pe.jsx("p",{className:`font-medium ${I}`,children:"Recurring"}),pe.jsx("p",{className:`text-sm ${N}`,children:"Repeats automatically"})]})]}),pe.jsxs("label",{className:"relative inline-flex items-center cursor-pointer",children:[pe.jsx("input",{type:"checkbox",name:"isRecurring",checked:h.isRecurring,onChange:w,className:"sr-only peer"}),pe.jsx("div",{className:"w-11 h-6 bg-gray-300 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-indigo-300 dark:peer-focus:ring-indigo-800 rounded-full peer dark:bg-gray-600 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all dark:border-gray-600 peer-checked:bg-indigo-600"})]})]}),h.isRecurring&&pe.jsxs("div",{children:[pe.jsx("label",{htmlFor:"recurringFrequency",className:S,children:"Frequency"}),pe.jsxs("select",{id:"recurringFrequency",name:"recurringFrequency",value:h.recurringFrequency,onChange:w,className:`w-full px-4 py-3 rounded-xl border-2 focus:ring-2 focus:ring-indigo-500 focus:border-transparent transition-all ${C}`,children:[pe.jsx("option",{value:"weekly",children:"Weekly"}),pe.jsx("option",{value:"monthly",children:"Monthly"}),pe.jsx("option",{value:"yearly",children:"Yearly"})]})]}),pe.jsxs("div",{children:[pe.jsx("label",{className:S,children:"Receipt (Optional)"}),y||h.receipt?pe.jsxs("div",{className:"relative",children:[m&&pe.jsx("div",{className:"absolute inset-0 bg-black/50 rounded-xl flex items-center justify-center z-10",children:pe.jsxs("div",{className:"flex items-center gap-2 text-white",children:[pe.jsx(V,{className:"w-5 h-5 animate-spin"}),pe.jsx("span",{children:"Uploading..."})]})}),pe.jsx("img",{src:y||h.receipt||"",alt:"Receipt preview",className:"w-full h-40 object-cover rounded-xl"}),pe.jsx("button",{type:"button",onClick:()=>{d(e=>({...e,receipt:null})),v(null)},disabled:m,className:"absolute top-2 right-2 p-1.5 bg-red-500 text-white rounded-full hover:bg-red-600 transition-colors shadow-lg disabled:opacity-50","aria-label":"Remove receipt",children:pe.jsx(_,{className:"w-4 h-4"})})]}):pe.jsxs("div",{className:"flex gap-2",children:[pe.jsxs("label",{className:"flex-1 flex items-center justify-center gap-2 px-4 py-3 rounded-xl cursor-pointer transition-all "+(a?"bg-indigo-900/50 text-indigo-300 hover:bg-indigo-900/70":"bg-indigo-100 text-indigo-700 hover:bg-indigo-200"),children:[pe.jsx($,{className:"w-5 h-5"}),pe.jsx("span",{className:"font-medium",children:"Camera"}),pe.jsx("input",{type:"file",accept:"image/*",capture:"environment",onChange:b,className:"hidden"})]}),pe.jsxs("label",{className:"flex-1 flex items-center justify-center gap-2 px-4 py-3 rounded-xl cursor-pointer transition-all "+(a?"bg-purple-900/50 text-purple-300 hover:bg-purple-900/70":"bg-purple-100 text-purple-700 hover:bg-purple-200"),children:[pe.jsx(B,{className:"w-5 h-5"}),pe.jsx("span",{className:"font-medium",children:"Upload"}),pe.jsx("input",{type:"file",accept:"image/*",onChange:b,className:"hidden"})]})]}),p.receipt&&pe.jsx("p",{className:"mt-1 text-sm text-red-500",children:p.receipt})]})]}),pe.jsx("div",{className:"p-6 border-t "+(a?"border-gray-700":"border-gray-200"),children:pe.jsxs("div",{className:"flex gap-3",children:[pe.jsx("button",{type:"button",onClick:t,className:"flex-1 py-3 px-4 rounded-xl font-semibold transition-all "+(a?"bg-gray-700 text-gray-300 hover:bg-gray-600":"bg-gray-100 text-gray-700 hover:bg-gray-200"),children:"Cancel"}),pe.jsx("button",{type:"submit",onClick:x,className:"flex-1 py-3 px-4 rounded-xl font-semibold bg-gradient-to-r from-indigo-600 to-purple-600 text-white hover:shadow-lg hover:scale-[1.02] transition-all",children:i?"Update":"Add Transaction"})]})})]})})},oy=({transactions:e,budgetLimit:t,categoryBudgets:n,darkMode:s,currencySymbol:r})=>{const i=s?"bg-gray-800":"bg-white",a=s?"text-white":"text-gray-900",o=s?"text-gray-400":"text-gray-600",c=new Date,l=c.getMonth(),u=c.getFullYear(),h=0===l?11:l-1,d=0===l?u-1:u,p=e.filter(e=>"expense"===e.type&&(e=>{const t=new Date(e);return t.getMonth()===l&&t.getFullYear()===u})(e.date)),f=e.filter(e=>"expense"===e.type&&(e=>{const t=new Date(e);return t.getMonth()===h&&t.getFullYear()===d})(e.date)),m=p.reduce((e,t)=>e+t.amount,0),g=f.reduce((e,t)=>e+t.amount,0),y=p.reduce((e,t)=>(e[t.category]=(e[t.category]||0)+t.amount,e),{}),v=f.reduce((e,t)=>(e[t.category]=(e[t.category]||0)+t.amount,e),{}),b=[];if(g>0){const e=(m-g)/g*100;e>20?b.push({type:"warning",icon:pe.jsx(E,{className:"w-5 h-5"}),title:"Spending increased significantly",description:`You've spent ${Math.abs(e).toFixed(0)}% more this month compared to last month.`,value:`+${r}${(m-g).toFixed(2)}`}):e<-10&&b.push({type:"success",icon:pe.jsx(T,{className:"w-5 h-5"}),title:"Great job saving!",description:`You've spent ${Math.abs(e).toFixed(0)}% less this month compared to last month.`,value:`-${r}${Math.abs(m-g).toFixed(2)}`})}Object.keys(y).forEach(e=>{const t=y[e],s=v[e]||0,i=n[e]||0;if(s>0){const n=(t-s)/s*100;n>30&&b.push({type:"warning",icon:pe.jsx(q,{className:"w-5 h-5"}),title:`${e} spending up`,description:`You've spent ${n.toFixed(0)}% more on ${e} this month.`,value:`+${r}${(t-s).toFixed(2)}`})}i>0&&t>.9*i&&t<=i&&b.push({type:"info",icon:pe.jsx(w,{className:"w-5 h-5"}),title:`${e} near budget limit`,description:`You've used ${(t/i*100).toFixed(0)}% of your ${e} budget.`,value:`${r}${(i-t).toFixed(2)} left`}),i>0&&t>i&&b.push({type:"warning",icon:pe.jsx(q,{className:"w-5 h-5"}),title:`${e} over budget!`,description:`You've exceeded your ${e} budget by ${r}${(t-i).toFixed(2)}.`,value:`${r}${t.toFixed(2)} / ${r}${i.toFixed(2)}`})});const x=Object.entries(y).sort((e,t)=>t[1]-e[1])[0];if(x&&b.push({type:"info",icon:pe.jsx(j,{className:"w-5 h-5"}),title:"Top spending category",description:`${x[0]} is your biggest expense this month.`,value:`${r}${x[1].toFixed(2)}`}),t>0){const e=m/t*100,n=new Date(u,l+1,0).getDate();e<c.getDate()/n*100-10&&b.push({type:"success",icon:pe.jsx(z,{className:"w-5 h-5"}),title:"On track with budget!",description:"You're spending less than expected for this point in the month.",value:`${e.toFixed(0)}% used`})}y["Food & Dining"]>500&&b.push({type:"tip",icon:pe.jsx(j,{className:"w-5 h-5"}),title:"Tip: Reduce dining expenses",description:"Consider meal prepping to save on food costs."}),y.Entertainment>200&&b.push({type:"tip",icon:pe.jsx(j,{className:"w-5 h-5"}),title:"Tip: Entertainment savings",description:"Look for free events or subscription alternatives."});return 0===b.length?pe.jsxs("div",{className:`${i} rounded-2xl shadow-lg p-6`,children:[pe.jsx("h3",{className:`text-lg font-semibold mb-4 ${a}`,children:"ðŸ’¡ Spending Insights"}),pe.jsx("p",{className:o,children:"Add more transactions to see personalized spending insights and tips."})]}):pe.jsxs("div",{className:`${i} rounded-2xl shadow-lg p-6`,children:[pe.jsx("h3",{className:`text-lg font-semibold mb-4 ${a}`,children:"ðŸ’¡ Spending Insights"}),pe.jsx("div",{className:"space-y-3",children:b.slice(0,5).map((e,t)=>{const n=(e=>{switch(e){case"warning":return{bg:s?"bg-red-900/30":"bg-red-50",border:s?"border-red-800":"border-red-200",icon:"text-red-500",text:s?"text-red-300":"text-red-700"};case"success":return{bg:s?"bg-green-900/30":"bg-green-50",border:s?"border-green-800":"border-green-200",icon:"text-green-500",text:s?"text-green-300":"text-green-700"};case"info":return{bg:s?"bg-blue-900/30":"bg-blue-50",border:s?"border-blue-800":"border-blue-200",icon:"text-blue-500",text:s?"text-blue-300":"text-blue-700"};case"tip":return{bg:s?"bg-purple-900/30":"bg-purple-50",border:s?"border-purple-800":"border-purple-200",icon:"text-purple-500",text:s?"text-purple-300":"text-purple-700"}}})(e.type);return pe.jsx("div",{className:`p-4 rounded-xl border ${n.bg} ${n.border}`,children:pe.jsxs("div",{className:"flex items-start gap-3",children:[pe.jsx("div",{className:`flex-shrink-0 ${n.icon}`,children:e.icon}),pe.jsxs("div",{className:"flex-1 min-w-0",children:[pe.jsxs("div",{className:"flex items-center justify-between gap-2",children:[pe.jsx("h4",{className:`font-medium ${n.text}`,children:e.title}),e.value&&pe.jsx("span",{className:`text-sm font-semibold ${n.text}`,children:e.value})]}),pe.jsx("p",{className:`text-sm mt-1 ${o}`,children:e.description})]})]})},t)})})]})},cy=["#FF6B6B","#4ECDC4","#45B7D1","#FFA07A","#98D8C8","#F7DC6F","#BB8FCE","#85C1E2"],ly=({active:e,payload:t,label:n,darkMode:s})=>e&&t&&t.length?pe.jsxs("div",{className:`px-4 py-3 rounded-lg shadow-lg ${s?"bg-gray-800 text-white":"bg-white text-gray-800"} border ${s?"border-gray-700":"border-gray-200"}`,children:[n&&pe.jsx("p",{className:"font-medium mb-1",children:n}),t.map((e,t)=>pe.jsxs("p",{className:"text-sm",style:{color:e.color},children:[e.name,": $",e.value?.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})]},t))]}):null,uy=({data:e,darkMode:t})=>{if(0===e.length)return pe.jsxs("div",{className:"flex flex-col items-center justify-center h-64 "+(t?"text-gray-400":"text-gray-500"),children:[pe.jsx("div",{className:"text-5xl mb-3",children:"ðŸ“Š"}),pe.jsx("p",{className:"text-lg font-medium",children:"No expense data"}),pe.jsx("p",{className:"text-sm",children:"Start tracking to see your spending breakdown"})]});const n=Math.PI/180;return pe.jsx(r,{width:"100%",height:300,children:pe.jsxs(i,{children:[pe.jsx(a,{data:e,cx:"50%",cy:"50%",labelLine:!1,label:({cx:e,cy:t,midAngle:s,innerRadius:r,outerRadius:i,percent:a})=>{const o=r+.5*(i-r),c=e+o*Math.cos(-s*n),l=t+o*Math.sin(-s*n);return a<.05?null:pe.jsx("text",{x:c,y:l,fill:"white",textAnchor:c>e?"start":"end",dominantBaseline:"central",className:"text-xs font-medium",children:`${(100*a).toFixed(0)}%`})},outerRadius:100,innerRadius:40,fill:"#8884d8",dataKey:"value",animationBegin:0,animationDuration:800,children:e.map((e,n)=>pe.jsx(o,{fill:e.color||cy[n%cy.length],stroke:t?"#1f2937":"#fff",strokeWidth:2},`cell-${n}`))}),pe.jsx(c,{content:pe.jsx(ly,{darkMode:t})}),pe.jsx(l,{layout:"horizontal",verticalAlign:"bottom",align:"center",wrapperStyle:{paddingTop:"20px"},formatter:e=>pe.jsx("span",{className:t?"text-gray-300":"text-gray-600",children:e})})]})})},hy=({data:e,darkMode:t})=>{if(0===e.length)return pe.jsxs("div",{className:"flex flex-col items-center justify-center h-64 "+(t?"text-gray-400":"text-gray-500"),children:[pe.jsx("div",{className:"text-5xl mb-3",children:"ðŸ“ˆ"}),pe.jsx("p",{className:"text-lg font-medium",children:"No data available"}),pe.jsx("p",{className:"text-sm",children:"Add transactions to see your monthly comparison"})]});const n=e.map(e=>({...e,monthLabel:new Date(e.month+"-01").toLocaleDateString("en-US",{month:"short"})}));return pe.jsx(r,{width:"100%",height:300,children:pe.jsxs(u,{data:n,margin:{top:20,right:20,left:0,bottom:5},children:[pe.jsx(h,{strokeDasharray:"3 3",stroke:t?"#374151":"#e5e7eb",vertical:!1}),pe.jsx(d,{dataKey:"monthLabel",tick:{fill:t?"#9ca3af":"#6b7280",fontSize:12},axisLine:{stroke:t?"#374151":"#e5e7eb"},tickLine:!1}),pe.jsx(p,{tick:{fill:t?"#9ca3af":"#6b7280",fontSize:12},axisLine:!1,tickLine:!1,tickFormatter:e=>`$${e>=1e3?`${(e/1e3).toFixed(0)}k`:e}`}),pe.jsx(c,{content:pe.jsx(ly,{darkMode:t})}),pe.jsx(l,{wrapperStyle:{paddingTop:"10px"},formatter:e=>pe.jsx("span",{className:t?"text-gray-300":"text-gray-600",children:e.charAt(0).toUpperCase()+e.slice(1)})}),pe.jsx(f,{dataKey:"income",fill:"#4ade80",radius:[4,4,0,0],maxBarSize:40}),pe.jsx(f,{dataKey:"expenses",fill:"#f87171",radius:[4,4,0,0],maxBarSize:40})]})})},dy=({data:e,darkMode:t})=>{if(0===e.length)return pe.jsx("div",{className:"flex flex-col items-center justify-center h-48 "+(t?"text-gray-400":"text-gray-500"),children:pe.jsx("p",{className:"text-sm",children:"No budget data available"})});const n=e.filter(e=>e.budget>0).map(e=>({name:e.name,spent:e.value,budget:e.budget,percentage:Math.min(e.value/e.budget*100,100),remaining:Math.max(e.budget-e.value,0),color:e.color}));return 0===n.length?pe.jsx("div",{className:"flex flex-col items-center justify-center h-48 "+(t?"text-gray-400":"text-gray-500"),children:pe.jsx("p",{className:"text-sm",children:"Set category budgets in settings"})}):pe.jsx("div",{className:"space-y-4",children:n.map((e,n)=>pe.jsxs("div",{className:"space-y-1",children:[pe.jsxs("div",{className:"flex justify-between items-center text-sm",children:[pe.jsx("span",{className:t?"text-gray-300":"text-gray-700",children:e.name}),pe.jsxs("span",{className:t?"text-gray-400":"text-gray-500",children:["$",e.spent.toFixed(0)," / $",e.budget.toFixed(0)]})]}),pe.jsx("div",{className:"h-3 rounded-full overflow-hidden "+(t?"bg-gray-700":"bg-gray-200"),children:pe.jsx("div",{className:"h-full rounded-full transition-all duration-500 ease-out",style:{width:`${e.percentage}%`,backgroundColor:e.percentage>=100?"#ef4444":e.percentage>=80?"#f59e0b":e.color}})})]},n))})},py=({totalIncome:e,totalExpenses:t,transactionCount:n,averageExpense:s,darkMode:r})=>{const i=[{label:"Total Income",value:`$${e.toLocaleString("en-US",{minimumFractionDigits:2})}`,color:"text-green-500"},{label:"Total Expenses",value:`$${t.toLocaleString("en-US",{minimumFractionDigits:2})}`,color:"text-red-500"},{label:"Transactions",value:n.toString(),color:r?"text-indigo-400":"text-indigo-600"},{label:"Avg. Expense",value:`$${s.toLocaleString("en-US",{minimumFractionDigits:2})}`,color:r?"text-purple-400":"text-purple-600"}];return pe.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3",children:i.map((e,t)=>pe.jsxs("div",{className:"p-4 rounded-xl "+(r?"bg-gray-700":"bg-gray-50"),children:[pe.jsx("p",{className:"text-xs md:text-sm "+(r?"text-gray-400":"text-gray-500"),children:e.label}),pe.jsx("p",{className:`text-lg md:text-xl font-bold ${e.color}`,children:e.value})]},t))})},fy=({progress:e,size:t=80,strokeWidth:n=6,color:s="#6366f1",darkMode:r=!1,showPercentage:i=!1,children:a})=>{const o=(t-n)/2,c=2*o*Math.PI,l=Math.min(Math.max(e,0),100),u=c-l/100*c;return pe.jsxs("div",{className:"relative inline-flex items-center justify-center",children:[pe.jsxs("svg",{width:t,height:t,className:"transform -rotate-90",children:[pe.jsx("circle",{cx:t/2,cy:t/2,r:o,fill:"none",stroke:r?"#374151":"#e5e7eb",strokeWidth:n}),pe.jsx("circle",{cx:t/2,cy:t/2,r:o,fill:"none",stroke:"#6366f1"!==s?s:l>=100?"#ef4444":l>=80?"#f59e0b":"#6366f1",strokeWidth:n,strokeDasharray:c,strokeDashoffset:u,strokeLinecap:"round",className:"transition-all duration-500 ease-out"})]}),pe.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:a||(i?pe.jsxs("span",{className:"text-sm font-semibold "+(r?"text-white":"text-gray-700"),children:[Math.round(l),"%"]}):null)})]})},my=[10,25,50,100],gy=({goals:e,onAddGoal:t,onEditGoal:n,onDeleteGoal:r,onUpdateProgress:i,darkMode:a})=>{const[o,c]=s.useState(null),[l,u]=s.useState({}),h=e=>e.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2}),d=e=>e>=100?"#22c55e":e>=75?"#4ade80":e>=50?"#fbbf24":e>=25?"#fb923c":"#ef4444",p=(e,t)=>{i(e,t)},f=a?"bg-gray-800":"bg-white",m=a?"text-white":"text-gray-900",g=a?"text-gray-400":"text-gray-600",y=a?"border-gray-700":"border-gray-200",v=a?"bg-gray-700 border-gray-600 text-white":"bg-white border-gray-300 text-gray-900";return 0===e.length?pe.jsxs("div",{className:`${f} rounded-2xl shadow-xl p-8 text-center`,children:[pe.jsx("div",{className:"text-6xl mb-4",children:"ðŸŽ¯"}),pe.jsx("h3",{className:`text-xl font-bold ${m} mb-2`,children:"No savings goals yet"}),pe.jsx("p",{className:`${g} mb-6`,children:"Start setting goals to track your progress towards financial milestones"}),pe.jsxs("button",{onClick:t,className:"inline-flex items-center gap-2 px-6 py-3 bg-gradient-to-r from-indigo-600 to-purple-600 text-white rounded-xl font-semibold hover:shadow-lg hover:scale-105 transition-all",children:[pe.jsx(G,{className:"w-5 h-5"}),"Create Your First Goal"]})]}):pe.jsxs("div",{className:"space-y-4",children:[pe.jsxs("div",{className:"flex justify-between items-center mb-4",children:[pe.jsxs("div",{children:[pe.jsx("h2",{className:`text-xl md:text-2xl font-bold ${m}`,children:"Savings Goals"}),pe.jsx("p",{className:`text-sm ${g}`,children:"Track your progress towards financial goals"})]}),pe.jsxs("button",{onClick:t,className:"flex items-center gap-2 px-4 py-2 bg-gradient-to-r from-indigo-600 to-purple-600 text-white rounded-xl font-medium hover:shadow-lg hover:scale-105 transition-all",children:[pe.jsx(G,{className:"w-5 h-5"}),pe.jsx("span",{className:"hidden sm:inline",children:"Add Goal"})]})]}),pe.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:e.map(e=>{const t=e.currentAmount/e.targetAmount*100,s=(e=>{const t=new Date,n=new Date(e).getTime()-t.getTime();return Math.ceil(n/864e5)})(e.deadline),w=o===e.id,b=e.currentAmount>=e.targetAmount;return pe.jsxs("div",{className:`${f} rounded-2xl shadow-lg overflow-hidden transition-all duration-300 ${b?"ring-2 ring-green-500":""}`,children:[pe.jsxs("div",{className:"p-4 cursor-pointer",onClick:()=>c(w?null:e.id),children:[pe.jsxs("div",{className:"flex items-start gap-4",children:[pe.jsx("div",{className:"flex-shrink-0",children:pe.jsx(fy,{progress:t,size:70,strokeWidth:6,color:e.color||d(t),darkMode:a,children:pe.jsxs("span",{className:`text-xs font-bold ${m}`,children:[Math.min(t,100).toFixed(0),"%"]})})}),pe.jsxs("div",{className:"flex-1 min-w-0",children:[pe.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[pe.jsx("h3",{className:`font-bold ${m} truncate`,children:e.name}),b&&pe.jsx("span",{className:"px-2 py-0.5 bg-green-100 text-green-700 text-xs font-medium rounded-full",children:"Complete! ðŸŽ‰"})]}),pe.jsxs("div",{className:"flex items-center gap-2 text-sm mb-2",children:[pe.jsxs("span",{className:g,children:["$",h(e.currentAmount)]}),pe.jsx("span",{className:g,children:"/"}),pe.jsxs("span",{className:m,style:{color:e.color},children:["$",h(e.targetAmount)]})]}),pe.jsxs("div",{className:"flex items-center gap-3 text-xs",children:[pe.jsxs("span",{className:`flex items-center gap-1 ${s<0?"text-red-500":s<30?"text-yellow-500":g}`,children:[pe.jsx(H,{className:"w-3 h-3"}),s<0?`${Math.abs(s)} days overdue`:`${s} days left`]}),pe.jsxs("span",{className:g,children:["Due ",(x=e.deadline,new Date(x).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"}))]})]})]}),pe.jsxs("div",{className:"flex items-center gap-1",children:[pe.jsx("button",{onClick:t=>{t.stopPropagation(),n(e)},className:"p-2 rounded-lg transition-colors "+(a?"hover:bg-gray-700 text-gray-400":"hover:bg-gray-100 text-gray-500"),title:"Edit goal",children:pe.jsx(U,{className:"w-4 h-4"})}),pe.jsx("button",{onClick:t=>{t.stopPropagation(),r(e.id)},className:"p-2 rounded-lg transition-colors "+(a?"hover:bg-red-900/50 text-gray-400 hover:text-red-400":"hover:bg-red-50 text-gray-500 hover:text-red-500"),title:"Delete goal",children:pe.jsx(F,{className:"w-4 h-4"})})]})]}),pe.jsx("div",{className:"mt-3 h-2 rounded-full overflow-hidden "+(a?"bg-gray-700":"bg-gray-200"),children:pe.jsx("div",{className:"h-full rounded-full transition-all duration-500 ease-out",style:{width:`${Math.min(t,100)}%`,backgroundColor:e.color||d(t)}})})]}),w&&!b&&pe.jsxs("div",{className:`px-4 pb-4 pt-2 border-t ${y} animate-fade-in`,children:[pe.jsx("p",{className:`text-sm ${g} mb-3`,children:"Quick add to this goal:"}),pe.jsx("div",{className:"flex flex-wrap gap-2 mb-3",children:my.map(t=>pe.jsxs("button",{onClick:()=>p(e.id,t),className:"px-3 py-1.5 rounded-lg text-sm font-medium transition-all "+(a?"bg-gray-700 hover:bg-gray-600 text-gray-300":"bg-gray-100 hover:bg-gray-200 text-gray-700"),children:["+$",t]},t))}),pe.jsxs("div",{className:"flex gap-2",children:[pe.jsxs("div",{className:"flex-1 relative",children:[pe.jsx("span",{className:`absolute left-3 top-1/2 -translate-y-1/2 ${g}`,children:"$"}),pe.jsx("input",{type:"number",value:l[e.id]||"",onChange:t=>u(n=>({...n,[e.id]:t.target.value})),placeholder:"Custom amount",className:`w-full pl-7 pr-4 py-2 rounded-lg border ${v} focus:ring-2 focus:ring-indigo-500 focus:border-transparent`,min:"0",step:"0.01"})]}),pe.jsx("button",{onClick:()=>(e=>{const t=parseFloat(l[e]||"0");t>0&&(i(e,t),u(t=>({...t,[e]:""})))})(e.id),disabled:!l[e.id]||parseFloat(l[e.id])<=0,className:"px-4 py-2 bg-gradient-to-r from-indigo-600 to-purple-600 text-white rounded-lg font-medium hover:shadow-lg transition-all disabled:opacity-50 disabled:cursor-not-allowed",children:"Add"})]}),pe.jsx("button",{onClick:()=>p(e.id,-10),className:`mt-3 text-sm ${a?"text-gray-500 hover:text-gray-400":"text-gray-400 hover:text-gray-600"} transition-colors`,children:"Withdraw $10 from goal"})]}),w&&b&&pe.jsxs("div",{className:`px-4 pb-4 pt-2 border-t ${y} text-center`,children:[pe.jsx("div",{className:"text-4xl mb-2",children:"ðŸŽ‰"}),pe.jsx("p",{className:`font-medium ${m}`,children:"Congratulations! You've reached your goal!"}),pe.jsxs("p",{className:`text-sm ${g} mt-1`,children:["You saved $",h(e.currentAmount)," in total"]})]})]},e.id);var x})}),pe.jsx("div",{className:`${f} rounded-xl shadow-lg p-4 mt-6 ${y} border`,children:pe.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 text-center",children:[pe.jsxs("div",{children:[pe.jsx("p",{className:`text-sm ${g}`,children:"Total Goals"}),pe.jsx("p",{className:`text-xl font-bold ${m}`,children:e.length})]}),pe.jsxs("div",{children:[pe.jsx("p",{className:`text-sm ${g}`,children:"Total Saved"}),pe.jsxs("p",{className:"text-xl font-bold text-green-500",children:["$",h(e.reduce((e,t)=>e+t.currentAmount,0))]})]}),pe.jsxs("div",{children:[pe.jsx("p",{className:`text-sm ${g}`,children:"Total Target"}),pe.jsxs("p",{className:`text-xl font-bold ${m}`,children:["$",h(e.reduce((e,t)=>e+t.targetAmount,0))]})]}),pe.jsxs("div",{children:[pe.jsx("p",{className:`text-sm ${g}`,children:"Completed"}),pe.jsx("p",{className:"text-xl font-bold text-indigo-500",children:e.filter(e=>e.currentAmount>=e.targetAmount).length})]})]})})]})},yy="budget_tracker_dark_mode",vy=[{code:"USD",symbol:"$",name:"US Dollar"},{code:"EUR",symbol:"â‚¬",name:"Euro"},{code:"GBP",symbol:"Â£",name:"British Pound"},{code:"JPY",symbol:"Â¥",name:"Japanese Yen"},{code:"CAD",symbol:"C$",name:"Canadian Dollar"},{code:"AUD",symbol:"A$",name:"Australian Dollar"},{code:"CHF",symbol:"Fr",name:"Swiss Franc"},{code:"CNY",symbol:"Â¥",name:"Chinese Yuan"},{code:"INR",symbol:"â‚¹",name:"Indian Rupee"},{code:"NGN",symbol:"â‚¦",name:"Nigerian Naira"},{code:"ZAR",symbol:"R",name:"South African Rand"},{code:"BRL",symbol:"R$",name:"Brazilian Real"},{code:"MXN",symbol:"$",name:"Mexican Peso"},{code:"KRW",symbol:"â‚©",name:"South Korean Won"},{code:"SGD",symbol:"S$",name:"Singapore Dollar"},{code:"AED",symbol:"Ø¯.Ø¥",name:"UAE Dirham"}],wy="USD",by=["#FF6B6B","#4ECDC4","#45B7D1","#FFA07A","#98D8C8","#F7DC6F","#BB8FCE","#85C1E2"],xy=["Food & Dining","Transportation","Entertainment","Bills & Utilities","Shopping","Healthcare","Education","Other"],_y=["Salary","Freelance","Investment","Other"],Ey={"Food & Dining":{color:"#FF6B6B",budget:500},Transportation:{color:"#4ECDC4",budget:300},Entertainment:{color:"#45B7D1",budget:200},"Bills & Utilities":{color:"#FFA07A",budget:400},Shopping:{color:"#98D8C8",budget:300},Healthcare:{color:"#F7DC6F",budget:200},Education:{color:"#BB8FCE",budget:150},Other:{color:"#85C1E2",budget:100},Salary:{color:"#4ade80",budget:0},Freelance:{color:"#34d399",budget:0},Investment:{color:"#22c55e",budget:0}},Ty=2500,Iy=[{value:"today",label:"Today"},{value:"week",label:"This Week"},{value:"month",label:"This Month"},{value:"quarter",label:"This Quarter"},{value:"year",label:"This Year"},{value:"all",label:"All Time"}],Ny=["#FF6B6B","#4ECDC4","#45B7D1","#FFA07A","#98D8C8","#F7DC6F","#BB8FCE","#85C1E2","#4ade80","#f472b6","#a78bfa","#fb923c"],Cy=["Food & Dining","Transportation","Entertainment","Bills & Utilities","Shopping","Healthcare","Education","Other"],Sy=["Salary","Freelance","Investment","Other"],ky=({budgetLimit:e,setBudgetLimit:t,categoryBudgets:n,setCategoryBudgets:r,darkMode:i,onExportData:a,onClearData:o,onShowToast:c,userSettings:l,onUpdateSettings:u,expenseCategories:h,incomeCategories:d})=>{const[p,f]=s.useState(e.toString()),[m,g]=s.useState(Object.fromEntries(h.map(e=>[e,(n[e]||0).toString()]))),[y,v]=s.useState(!1),[w,b]=s.useState(l.currency||wy),[x,E]=s.useState(l.emailReports||!1),[T,N]=s.useState(l.reportEmail||""),[C,S]=s.useState(!1),[k,A]=s.useState(!1),[R,j]=s.useState(""),[D,O]=s.useState(by[0]),[P,L]=s.useState("");s.useEffect(()=>{g(Object.fromEntries(h.map(e=>[e,(n[e]||0).toString()])))},[h,n]),s.useEffect(()=>{b(l.currency||wy),E(l.emailReports||!1),N(l.reportEmail||"")},[l]);const M=i?"bg-gray-800":"bg-white",U=i?"text-white":"text-gray-900",V=i?"text-gray-400":"text-gray-600",$=i?"bg-gray-700 border-gray-600 text-white":"bg-white border-gray-300 text-gray-900",B=()=>{const e=vy.find(e=>e.code===w);return e?.symbol||"$"},q=e=>{if(!R.trim())return void c("Please enter a category name");if(("expense"===e?h:d).includes(R.trim()))return void c("Category already exists");const t={name:R.trim(),color:D,budget:"expense"===e?parseFloat(P)||0:void 0};if("expense"===e){const e=[...l.customExpenseCategories||[],t];u({customExpenseCategories:e})}else{const e=[...l.customIncomeCategories||[],{name:t.name,color:t.color}];u({customIncomeCategories:e})}j(""),O(by[0]),L(""),S(!1),A(!1),c(("expense"===e?"Expense":"Income")+" category added!")},z=(e,t)=>{if("expense"===e){const e=(l.customExpenseCategories||[]).filter(e=>e.name!==t);u({customExpenseCategories:e})}else{const e=(l.customIncomeCategories||[]).filter(e=>e.name!==t);u({customIncomeCategories:e})}c("Category deleted")},H=(e,t)=>("expense"===t?Cy:Sy).includes(e);return pe.jsxs("div",{className:"space-y-6",children:[pe.jsxs("div",{className:`${M} rounded-2xl shadow-lg p-6 transition-colors duration-300`,children:[pe.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[pe.jsx("div",{className:"p-2 rounded-lg "+(i?"bg-green-900/50":"bg-green-100"),children:pe.jsx(K,{className:"w-5 h-5 "+(i?"text-green-400":"text-green-600")})}),pe.jsxs("div",{children:[pe.jsx("h3",{className:`text-lg font-semibold ${U}`,children:"Currency"}),pe.jsx("p",{className:`text-sm ${V}`,children:"Select your preferred currency"})]})]}),pe.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-2",children:vy.map(e=>pe.jsxs("button",{onClick:()=>{return t=e.code,b(t),u({currency:t}),void c(`Currency changed to ${t}`);var t},className:"p-3 rounded-xl border-2 transition-all text-left "+(w===e.code?"border-indigo-500 bg-indigo-50 dark:bg-indigo-900/30":"border-transparent "+(i?"bg-gray-700 hover:bg-gray-600":"bg-gray-100 hover:bg-gray-200")),children:[pe.jsxs("div",{className:"flex items-center gap-2",children:[pe.jsx("span",{className:`text-lg font-bold ${w===e.code?"text-indigo-600":U}`,children:e.symbol}),pe.jsx("span",{className:`text-sm ${V}`,children:e.code})]}),pe.jsx("p",{className:`text-xs ${V} mt-1 truncate`,children:e.name})]},e.code))})]}),pe.jsxs("div",{className:`${M} rounded-2xl shadow-lg p-6 transition-colors duration-300`,children:[pe.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[pe.jsx("div",{className:"p-2 rounded-lg "+(i?"bg-indigo-900/50":"bg-indigo-100"),children:pe.jsx(I,{className:"w-5 h-5 "+(i?"text-indigo-400":"text-indigo-600")})}),pe.jsxs("div",{children:[pe.jsx("h3",{className:`text-lg font-semibold ${U}`,children:"Monthly Budget Limit"}),pe.jsx("p",{className:`text-sm ${V}`,children:"Set your overall spending limit"})]})]}),pe.jsxs("div",{className:"flex gap-3",children:[pe.jsxs("div",{className:"relative flex-1",children:[pe.jsx("span",{className:`absolute left-4 top-1/2 -translate-y-1/2 ${V}`,children:B()}),pe.jsx("input",{type:"number",value:p,onChange:e=>f(e.target.value),min:"0",step:"100",className:`w-full pl-8 pr-4 py-3 rounded-xl border-2 focus:ring-2 focus:ring-indigo-500 focus:border-transparent transition-all ${$}`,placeholder:"2500"})]}),pe.jsxs("button",{onClick:()=>{const e=parseFloat(p);!isNaN(e)&&e>=0?(t(e),c("Budget limit saved!")):c("Please enter a valid amount")},className:"px-6 py-3 bg-gradient-to-r from-indigo-600 to-purple-600 text-white rounded-xl font-medium hover:shadow-lg transition-all flex items-center gap-2",children:[pe.jsx(W,{className:"w-4 h-4"}),pe.jsx("span",{className:"hidden sm:inline",children:"Save"})]})]})]}),pe.jsxs("div",{className:`${M} rounded-2xl shadow-lg p-6 transition-colors duration-300`,children:[pe.jsxs("div",{className:"flex items-center justify-between mb-4",children:[pe.jsxs("div",{className:"flex items-center gap-3",children:[pe.jsx("div",{className:"p-2 rounded-lg "+(i?"bg-purple-900/50":"bg-purple-100"),children:pe.jsx(Q,{className:"w-5 h-5 "+(i?"text-purple-400":"text-purple-600")})}),pe.jsxs("div",{children:[pe.jsx("h3",{className:`text-lg font-semibold ${U}`,children:"Category Budgets"}),pe.jsx("p",{className:`text-sm ${V}`,children:"Set limits for each spending category"})]})]}),pe.jsx("button",{onClick:()=>{g({"Food & Dining":"500",Transportation:"300",Entertainment:"200","Bills & Utilities":"400",Shopping:"300",Healthcare:"200",Education:"150",Other:"100"})},className:"p-2 rounded-lg transition-colors "+(i?"hover:bg-gray-700 text-gray-400":"hover:bg-gray-100 text-gray-500"),title:"Reset to defaults",children:pe.jsx(Y,{className:"w-5 h-5"})})]}),pe.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4 mb-4",children:h.map(e=>pe.jsxs("div",{children:[pe.jsx("label",{className:`block text-sm font-medium mb-1 ${V}`,children:e}),pe.jsxs("div",{className:"relative",children:[pe.jsx("span",{className:`absolute left-3 top-1/2 -translate-y-1/2 ${V}`,children:B()}),pe.jsx("input",{type:"number",value:m[e]||"",onChange:t=>g(n=>({...n,[e]:t.target.value})),min:"0",step:"50",className:`w-full pl-7 pr-3 py-2 rounded-lg border focus:ring-2 focus:ring-indigo-500 focus:border-transparent transition-all text-sm ${$}`,placeholder:"0"})]})]},e))}),pe.jsxs("button",{onClick:()=>{const e={};let t=!0;h.forEach(n=>{const s=parseFloat(m[n]||"0");isNaN(s)||s<0?t=!1:e[n]=s}),t?(r(e),c("Category budgets saved!")):c("Please enter valid amounts for all categories")},className:"w-full py-3 bg-gradient-to-r from-purple-600 to-pink-600 text-white rounded-xl font-medium hover:shadow-lg transition-all flex items-center justify-center gap-2",children:[pe.jsx(W,{className:"w-4 h-4"}),"Save Category Budgets"]})]}),pe.jsxs("div",{className:`${M} rounded-2xl shadow-lg p-6 transition-colors duration-300`,children:[pe.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[pe.jsx("div",{className:"p-2 rounded-lg "+(i?"bg-orange-900/50":"bg-orange-100"),children:pe.jsx(G,{className:"w-5 h-5 "+(i?"text-orange-400":"text-orange-600")})}),pe.jsxs("div",{children:[pe.jsx("h3",{className:`text-lg font-semibold ${U}`,children:"Custom Categories"}),pe.jsx("p",{className:`text-sm ${V}`,children:"Add your own expense and income categories"})]})]}),pe.jsxs("div",{className:"mb-6",children:[pe.jsxs("div",{className:"flex items-center justify-between mb-3",children:[pe.jsx("h4",{className:`font-medium ${U}`,children:"Expense Categories"}),pe.jsxs("button",{onClick:()=>S(!C),className:"flex items-center gap-1 text-sm text-indigo-600 hover:text-indigo-700",children:[pe.jsx(G,{className:"w-4 h-4"}),"Add New"]})]}),C&&pe.jsxs("div",{className:"p-4 rounded-xl mb-3 "+(i?"bg-gray-700":"bg-gray-50"),children:[pe.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-3 mb-3",children:[pe.jsx("input",{type:"text",placeholder:"Category name",value:R,onChange:e=>j(e.target.value),className:`px-3 py-2 rounded-lg border ${$}`}),pe.jsx("input",{type:"number",placeholder:"Budget (optional)",value:P,onChange:e=>L(e.target.value),className:`px-3 py-2 rounded-lg border ${$}`}),pe.jsxs("div",{className:"flex items-center gap-2",children:[pe.jsx("span",{className:`text-sm ${V}`,children:"Color:"}),pe.jsx("div",{className:"flex gap-1 flex-wrap",children:by.slice(0,8).map(e=>pe.jsx("button",{onClick:()=>O(e),className:"w-6 h-6 rounded-full transition-transform "+(D===e?"scale-125 ring-2 ring-offset-2 ring-gray-400":""),style:{backgroundColor:e}},e))})]})]}),pe.jsxs("div",{className:"flex gap-2",children:[pe.jsx("button",{onClick:()=>q("expense"),className:"px-4 py-2 bg-indigo-600 text-white rounded-lg text-sm font-medium hover:bg-indigo-700",children:"Add Category"}),pe.jsx("button",{onClick:()=>S(!1),className:"px-4 py-2 rounded-lg text-sm font-medium "+(i?"bg-gray-600 text-gray-300":"bg-gray-200 text-gray-700"),children:"Cancel"})]})]}),pe.jsx("div",{className:"flex flex-wrap gap-2",children:h.map(e=>pe.jsxs("div",{className:"flex items-center gap-2 px-3 py-2 rounded-lg "+(i?"bg-gray-700":"bg-gray-100"),children:[pe.jsx("span",{className:`text-sm ${U}`,children:e}),!H(e,"expense")&&pe.jsx("button",{onClick:()=>z("expense",e),className:"text-red-500 hover:text-red-600",children:pe.jsx(_,{className:"w-4 h-4"})})]},e))})]}),pe.jsxs("div",{children:[pe.jsxs("div",{className:"flex items-center justify-between mb-3",children:[pe.jsx("h4",{className:`font-medium ${U}`,children:"Income Categories"}),pe.jsxs("button",{onClick:()=>A(!k),className:"flex items-center gap-1 text-sm text-indigo-600 hover:text-indigo-700",children:[pe.jsx(G,{className:"w-4 h-4"}),"Add New"]})]}),k&&pe.jsxs("div",{className:"p-4 rounded-xl mb-3 "+(i?"bg-gray-700":"bg-gray-50"),children:[pe.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3 mb-3",children:[pe.jsx("input",{type:"text",placeholder:"Category name",value:R,onChange:e=>j(e.target.value),className:`px-3 py-2 rounded-lg border ${$}`}),pe.jsxs("div",{className:"flex items-center gap-2",children:[pe.jsx("span",{className:`text-sm ${V}`,children:"Color:"}),pe.jsx("div",{className:"flex gap-1 flex-wrap",children:by.slice(0,8).map(e=>pe.jsx("button",{onClick:()=>O(e),className:"w-6 h-6 rounded-full transition-transform "+(D===e?"scale-125 ring-2 ring-offset-2 ring-gray-400":""),style:{backgroundColor:e}},e))})]})]}),pe.jsxs("div",{className:"flex gap-2",children:[pe.jsx("button",{onClick:()=>q("income"),className:"px-4 py-2 bg-green-600 text-white rounded-lg text-sm font-medium hover:bg-green-700",children:"Add Category"}),pe.jsx("button",{onClick:()=>A(!1),className:"px-4 py-2 rounded-lg text-sm font-medium "+(i?"bg-gray-600 text-gray-300":"bg-gray-200 text-gray-700"),children:"Cancel"})]})]}),pe.jsx("div",{className:"flex flex-wrap gap-2",children:d.map(e=>pe.jsxs("div",{className:"flex items-center gap-2 px-3 py-2 rounded-lg "+(i?"bg-gray-700":"bg-gray-100"),children:[pe.jsx("span",{className:`text-sm ${U}`,children:e}),!H(e,"income")&&pe.jsx("button",{onClick:()=>z("income",e),className:"text-red-500 hover:text-red-600",children:pe.jsx(_,{className:"w-4 h-4"})})]},e))})]})]}),pe.jsxs("div",{className:`${M} rounded-2xl shadow-lg p-6 transition-colors duration-300`,children:[pe.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[pe.jsx("div",{className:"p-2 rounded-lg "+(i?"bg-blue-900/50":"bg-blue-100"),children:pe.jsx(X,{className:"w-5 h-5 "+(i?"text-blue-400":"text-blue-600")})}),pe.jsxs("div",{children:[pe.jsx("h3",{className:`text-lg font-semibold ${U}`,children:"Monthly Reports"}),pe.jsx("p",{className:`text-sm ${V}`,children:"Receive spending summaries via email"})]})]}),pe.jsxs("div",{className:"space-y-4",children:[pe.jsxs("div",{className:"p-4 rounded-xl "+(i?"bg-gray-700":"bg-gray-50"),children:[pe.jsxs("div",{className:"flex items-center justify-between mb-4",children:[pe.jsxs("div",{children:[pe.jsx("p",{className:`font-medium ${U}`,children:"Enable Monthly Reports"}),pe.jsx("p",{className:`text-sm ${V}`,children:"Get a summary on the 1st of each month"})]}),pe.jsxs("label",{className:"relative inline-flex items-center cursor-pointer",children:[pe.jsx("input",{type:"checkbox",checked:x,onChange:e=>E(e.target.checked),className:"sr-only peer"}),pe.jsx("div",{className:"w-11 h-6 bg-gray-300 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-indigo-300 dark:peer-focus:ring-indigo-800 rounded-full peer dark:bg-gray-600 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all dark:border-gray-600 peer-checked:bg-indigo-600"})]})]}),x&&pe.jsxs("div",{children:[pe.jsx("label",{className:`block text-sm font-medium mb-2 ${V}`,children:"Email Address"}),pe.jsx("input",{type:"email",value:T,onChange:e=>N(e.target.value),placeholder:"your@email.com",className:`w-full px-4 py-2 rounded-lg border ${$}`})]})]}),pe.jsxs("button",{onClick:()=>{u({emailReports:x,reportEmail:T}),c("Email settings saved!")},className:"w-full py-3 bg-gradient-to-r from-blue-600 to-cyan-600 text-white rounded-xl font-medium hover:shadow-lg transition-all flex items-center justify-center gap-2",children:[pe.jsx(W,{className:"w-4 h-4"}),"Save Email Settings"]})]})]}),pe.jsxs("div",{className:`${M} rounded-2xl shadow-lg p-6 transition-colors duration-300`,children:[pe.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[pe.jsx("div",{className:"p-2 rounded-lg "+(i?"bg-yellow-900/50":"bg-yellow-100"),children:pe.jsx(J,{className:"w-5 h-5 "+(i?"text-yellow-400":"text-yellow-600")})}),pe.jsxs("div",{children:[pe.jsx("h3",{className:`text-lg font-semibold ${U}`,children:"Budget Alerts"}),pe.jsx("p",{className:`text-sm ${V}`,children:"Get notified when approaching limits"})]})]}),pe.jsx("div",{className:"p-4 rounded-xl "+(i?"bg-gray-700":"bg-gray-50"),children:pe.jsxs("div",{className:"flex items-center justify-between",children:[pe.jsxs("div",{children:[pe.jsx("p",{className:`font-medium ${U}`,children:"Enable Alerts"}),pe.jsx("p",{className:`text-sm ${V}`,children:"Show warnings at 80% of budget"})]}),pe.jsxs("label",{className:"relative inline-flex items-center cursor-pointer",children:[pe.jsx("input",{type:"checkbox",defaultChecked:!0,className:"sr-only peer"}),pe.jsx("div",{className:"w-11 h-6 bg-gray-300 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-indigo-300 dark:peer-focus:ring-indigo-800 rounded-full peer dark:bg-gray-600 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all dark:border-gray-600 peer-checked:bg-indigo-600"})]})]})})]}),pe.jsxs("div",{className:`${M} rounded-2xl shadow-lg p-6 transition-colors duration-300`,children:[pe.jsx("h3",{className:`text-lg font-semibold mb-4 ${U}`,children:"Data Management"}),pe.jsxs("div",{className:"space-y-3",children:[pe.jsxs("button",{onClick:a,className:"w-full py-3 px-4 rounded-xl font-medium transition-all flex items-center justify-center gap-2 "+(i?"bg-gray-700 text-gray-300 hover:bg-gray-600":"bg-gray-100 text-gray-700 hover:bg-gray-200"),children:[pe.jsx(Z,{className:"w-5 h-5"}),"Export Data as CSV"]}),y?pe.jsxs("div",{className:"p-4 rounded-xl border-2 "+(i?"border-red-800 bg-red-900/20":"border-red-200 bg-red-50"),children:[pe.jsx("p",{className:"text-sm mb-3 "+(i?"text-red-300":"text-red-700"),children:"Are you sure? This will permanently delete all your transactions, goals, and settings."}),pe.jsxs("div",{className:"flex gap-2",children:[pe.jsx("button",{onClick:()=>v(!1),className:"flex-1 py-2 px-4 rounded-lg font-medium "+(i?"bg-gray-700 text-gray-300 hover:bg-gray-600":"bg-gray-200 text-gray-700 hover:bg-gray-300"),children:"Cancel"}),pe.jsx("button",{onClick:()=>{o(),v(!1),c("All data has been cleared")},className:"flex-1 py-2 px-4 rounded-lg font-medium bg-red-600 text-white hover:bg-red-700",children:"Delete Everything"})]})]}):pe.jsxs("button",{onClick:()=>v(!0),className:"w-full py-3 px-4 rounded-xl font-medium transition-all flex items-center justify-center gap-2 "+(i?"bg-red-900/30 text-red-400 hover:bg-red-900/50":"bg-red-50 text-red-600 hover:bg-red-100"),children:[pe.jsx(F,{className:"w-5 h-5"}),"Clear All Data"]})]})]}),pe.jsxs("div",{className:`text-center py-4 ${V}`,children:[pe.jsx("p",{className:"text-sm",children:"Budget Tracker v2.0.0"}),pe.jsx("p",{className:"text-xs mt-1",children:"Built with React, Firebase & Tailwind CSS"})]})]})},Ay=Zg?$m(Zg):void 0,Ry=new vf;Ry.setCustomParameters({prompt:"select_account"});const jy=({onAuth:e,compact:t})=>{const[n,r]=s.useState(""),[i,a]=s.useState(""),[o,c]=s.useState(""),[l,u]=s.useState(!1),[h,d]=s.useState(!1),[p,f]=s.useState(!1),m=async t=>{if(t.preventDefault(),c(""),f(!0),!Ay)return c("Firebase app not initialized."),void f(!1);try{let t;t=l?await async function(e,t,n){if(vn(e.app))return Promise.reject(Bd(e));const s=Kp(e),r=nf(s,{returnSecureToken:!0,email:t,password:n,clientType:"CLIENT_TYPE_WEB"},"signUpPassword",xf),i=await r.catch(t=>{throw"auth/password-does-not-meet-requirements"===t.code&&Cf(e),t}),a=await _f._fromIdTokenResponse(s,"signIn",i);return await s._updateCurrentUser(a.user),a}(Ay,n,i):await Sf(Ay,n,i),e(t.user)}catch(s){"auth/email-already-in-use"===s.code?c("Email is already in use."):"auth/invalid-email"===s.code?c("Invalid email address."):"auth/weak-password"===s.code?c("Password should be at least 6 characters."):"auth/user-not-found"===s.code||"auth/wrong-password"===s.code?c("Incorrect email or password."):"auth/invalid-credential"===s.code?c("Invalid credentials. Please check your email and password."):c(s.message)}finally{f(!1)}};s.useEffect(()=>{if(!Ay)return;(async()=>{try{const t=await async function(e,t){return await Kp(e)._initializationPromise,um(e,t,!1)}(Ay);t?.user&&e(t.user)}catch(t){"auth/popup-closed-by-user"!==t.code&&c(t.message)}})()},[e]);const g=async()=>{if(Ay){f(!0),c("");try{const t=await async function(e,t,n){if(vn(e.app))return Promise.reject(Vd(e,"operation-not-supported-in-this-environment"));const s=Kp(e);qd(e,t,mf);const r=Yf(s,n);return new sm(s,"signInViaPopup",t,r).executeNotNull()}(Ay,Ry);e(t.user)}catch(t){if("auth/popup-closed-by-user"===t.code||"auth/popup-blocked"===t.code||"auth/cancelled-popup-request"===t.code)try{return void(await lm(Ay,Ry))}catch(n){c("Unable to sign in with Google. Please try again.")}else"auth/network-request-failed"===t.code?c("Network error. Please check your connection."):c(t.message||"Failed to sign in with Google.")}finally{f(!1)}}else c("Firebase app not initialized.")};return t?pe.jsxs("form",{onSubmit:m,className:"flex items-center gap-2",children:[pe.jsx("input",{type:"email",placeholder:"Email",value:n,onChange:e=>r(e.target.value),className:"px-2 py-1 border rounded text-xs w-28",required:!0}),pe.jsx("input",{type:"password",placeholder:"Password",value:i,onChange:e=>a(e.target.value),className:"px-2 py-1 border rounded text-xs w-20",required:!0}),pe.jsx("button",{type:"submit",className:"bg-indigo-600 text-white px-2 py-1 rounded text-xs",children:"Login"}),pe.jsx("button",{type:"button",onClick:g,className:"bg-red-500 text-white px-2 py-1 rounded text-xs",children:"Google"}),o&&pe.jsx("span",{className:"text-red-500 text-xs ml-2",children:o})]}):pe.jsxs("div",{className:"min-h-screen flex",children:[pe.jsxs("div",{className:"hidden lg:flex lg:w-1/2 bg-gradient-to-br from-indigo-600 via-purple-600 to-pink-500 p-12 flex-col justify-between relative overflow-hidden",children:[pe.jsxs("div",{className:"absolute top-0 left-0 w-full h-full opacity-10",children:[pe.jsx("div",{className:"absolute top-20 left-20 w-72 h-72 bg-white rounded-full blur-3xl"}),pe.jsx("div",{className:"absolute bottom-20 right-20 w-96 h-96 bg-white rounded-full blur-3xl"})]}),pe.jsxs("div",{className:"relative z-10",children:[pe.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[pe.jsx("div",{className:"p-3 bg-white/20 rounded-xl backdrop-blur-sm",children:pe.jsx(C,{className:"w-8 h-8 text-white"})}),pe.jsx("h1",{className:"text-3xl font-bold text-white",children:"Budget Tracker"})]}),pe.jsx("p",{className:"text-white/80 text-lg",children:"Take control of your financial future"})]}),pe.jsxs("div",{className:"relative z-10 space-y-8",children:[pe.jsxs("div",{className:"flex items-start gap-4",children:[pe.jsx("div",{className:"p-3 bg-white/20 rounded-xl backdrop-blur-sm flex-shrink-0",children:pe.jsx(E,{className:"w-6 h-6 text-white"})}),pe.jsxs("div",{children:[pe.jsx("h3",{className:"text-white font-semibold text-lg",children:"Track Expenses"}),pe.jsx("p",{className:"text-white/70",children:"Monitor your spending habits with detailed analytics and insights"})]})]}),pe.jsxs("div",{className:"flex items-start gap-4",children:[pe.jsx("div",{className:"p-3 bg-white/20 rounded-xl backdrop-blur-sm flex-shrink-0",children:pe.jsx(ee,{className:"w-6 h-6 text-white"})}),pe.jsxs("div",{children:[pe.jsx("h3",{className:"text-white font-semibold text-lg",children:"Set Savings Goals"}),pe.jsx("p",{className:"text-white/70",children:"Create and track progress towards your financial milestones"})]})]}),pe.jsxs("div",{className:"flex items-start gap-4",children:[pe.jsx("div",{className:"p-3 bg-white/20 rounded-xl backdrop-blur-sm flex-shrink-0",children:pe.jsx(C,{className:"w-6 h-6 text-white"})}),pe.jsxs("div",{children:[pe.jsx("h3",{className:"text-white font-semibold text-lg",children:"Budget Categories"}),pe.jsx("p",{className:"text-white/70",children:"Organize expenses by category with customizable budget limits"})]})]})]}),pe.jsx("div",{className:"relative z-10",children:pe.jsx("p",{className:"text-white/60 text-sm",children:"Â© 2025 Budget Tracker. All rights reserved."})})]}),pe.jsx("div",{className:"w-full lg:w-1/2 flex items-center justify-center p-8 bg-gradient-to-br from-gray-50 to-gray-100",children:pe.jsxs("div",{className:"w-full max-w-md",children:[pe.jsxs("div",{className:"lg:hidden flex items-center justify-center gap-3 mb-8",children:[pe.jsx("div",{className:"p-3 bg-gradient-to-br from-indigo-600 to-purple-600 rounded-xl",children:pe.jsx(C,{className:"w-8 h-8 text-white"})}),pe.jsx("h1",{className:"text-2xl font-bold bg-gradient-to-r from-indigo-600 to-purple-600 bg-clip-text text-transparent",children:"Budget Tracker"})]}),pe.jsxs("div",{className:"bg-white rounded-2xl shadow-xl p-8 border border-gray-100",children:[pe.jsxs("div",{className:"text-center mb-8",children:[pe.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:l?"Create Account":"Welcome Back"}),pe.jsx("p",{className:"text-gray-500 mt-2",children:l?"Start your journey to financial freedom":"Sign in to continue managing your finances"})]}),pe.jsxs("form",{onSubmit:m,className:"space-y-5",children:[pe.jsxs("div",{children:[pe.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Email Address"}),pe.jsxs("div",{className:"relative",children:[pe.jsx(X,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"}),pe.jsx("input",{type:"email",placeholder:"you@example.com",value:n,onChange:e=>r(e.target.value),className:"w-full pl-11 pr-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition-all outline-none",required:!0})]})]}),pe.jsxs("div",{children:[pe.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Password"}),pe.jsxs("div",{className:"relative",children:[pe.jsx(te,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"}),pe.jsx("input",{type:h?"text":"password",placeholder:"â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢",value:i,onChange:e=>a(e.target.value),className:"w-full pl-11 pr-12 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition-all outline-none",required:!0}),pe.jsx("button",{type:"button",onClick:()=>d(!h),className:"absolute right-3 top-1/2 -translate-y-1/2 text-gray-400 hover:text-gray-600 transition-colors",children:h?pe.jsx(ne,{className:"w-5 h-5"}):pe.jsx(M,{className:"w-5 h-5"})})]})]}),o&&pe.jsx("div",{className:"p-3 bg-red-50 border border-red-200 rounded-xl",children:pe.jsx("p",{className:"text-red-600 text-sm text-center",children:o})}),pe.jsx("button",{type:"submit",disabled:p,className:"w-full py-3 px-4 bg-gradient-to-r from-indigo-600 to-purple-600 text-white font-semibold rounded-xl hover:shadow-lg hover:scale-[1.02] transition-all disabled:opacity-50 disabled:cursor-not-allowed disabled:hover:scale-100 flex items-center justify-center gap-2",children:p?pe.jsx("div",{className:"w-5 h-5 border-2 border-white/30 border-t-white rounded-full animate-spin"}):pe.jsxs(pe.Fragment,{children:[l?"Create Account":"Sign In",pe.jsx(se,{className:"w-5 h-5"})]})})]}),pe.jsxs("div",{className:"flex items-center gap-4 my-6",children:[pe.jsx("div",{className:"flex-1 h-px bg-gray-200"}),pe.jsx("span",{className:"text-sm text-gray-400",children:"or continue with"}),pe.jsx("div",{className:"flex-1 h-px bg-gray-200"})]}),pe.jsxs("button",{type:"button",onClick:g,disabled:p,className:"w-full py-3 px-4 bg-white border border-gray-300 text-gray-700 font-medium rounded-xl hover:bg-gray-50 hover:shadow-md transition-all disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-3",children:[pe.jsxs("svg",{className:"w-5 h-5",viewBox:"0 0 24 24",children:[pe.jsx("path",{fill:"#4285F4",d:"M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"}),pe.jsx("path",{fill:"#34A853",d:"M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"}),pe.jsx("path",{fill:"#FBBC05",d:"M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"}),pe.jsx("path",{fill:"#EA4335",d:"M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"})]}),"Continue with Google"]}),pe.jsx("div",{className:"mt-6 text-center",children:pe.jsx("button",{type:"button",onClick:()=>{u(!l),c("")},className:"text-indigo-600 hover:text-indigo-700 font-medium transition-colors",children:l?"Already have an account? Sign in":"Don't have an account? Create one"})})]}),pe.jsx("p",{className:"lg:hidden text-center text-gray-400 text-sm mt-8",children:"Â© 2025 Budget Tracker. All rights reserved."})]})})]})},Dy=e=>{const t=[["Date","Type","Category","Description","Amount"].join(","),...e.map(e=>[e.date,e.type,e.category,`"${e.description}"`,e.amount].join(","))].join("\n"),n=new Blob([t],{type:"text/csv;charset=utf-8;"}),s=URL.createObjectURL(n),r=document.createElement("a");r.href=s,r.download=`budget-export-${((e=new Date)=>e.toISOString().split("T")[0])()}.csv`,document.body.appendChild(r),r.click(),document.body.removeChild(r),URL.revokeObjectURL(s)},Oy={currency:wy,emailReports:!1,reportEmail:"",customExpenseCategories:[],customIncomeCategories:[]},Py=()=>{const[e,t]=function(e,t){const[n,r]=s.useState(()=>{try{if("undefined"==typeof window)return t;const n=window.localStorage.getItem(e);return n?JSON.parse(n):t}catch(Fy){return t}});return s.useEffect(()=>{try{if("undefined"==typeof window)return;window.localStorage.setItem(e,JSON.stringify(n))}catch(Fy){}},[e,n]),[n,r]}(yy,!1),[n,r]=s.useState("home"),[i,a]=s.useState(!1),[o,c]=s.useState(!1),[l,u]=s.useState(null),[h,d]=s.useState(null),[p,f]=s.useState(null),[g,y]=s.useState(null),[v,w]=s.useState("all"),[b,x]=s.useState("all"),[E,T]=s.useState("month"),[I,N]=s.useState(""),[C,S]=s.useState(!1),[k,A]=s.useState({name:"",targetAmount:"",currentAmount:"",deadline:(new Date).toISOString().split("T")[0],color:Ny[0]}),[R,j]=s.useState(null),[D,O]=s.useState(!1),[P,L]=s.useState(Oy),M=s.useCallback((e,t)=>{y({message:e,onUndo:t})},[]),[U,F]=s.useState([]),[V,$]=s.useState(!0);m.useEffect(()=>{if(!ty||!R)return F([]),void $(!1);$(!0);const e=jd(function(e,t,...n){let s=[];t instanceof dd&&s.push(t),s=s.concat(n),function(e){const t=e.filter(e=>e instanceof md).length,n=e.filter(e=>e instanceof fd).length;if(t>1||t>0&&n>0)throw new xr(br.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(s);for(const r of s)e=r._apply(e);return e}(jh(ty,`users/${R.uid}/transactions`),function(e,t="asc"){const n=t,s=hd("orderBy",e);return gd._create(s,n)}("date","desc")),e=>{const t=e.docs.map(e=>{const t=e.data();return{id:e.id,type:t.type,amount:t.amount,category:t.category,description:t.description,date:t.date,receipt:t.receipt??null,isRecurring:t.isRecurring,recurringFrequency:t.recurringFrequency}});F(t),$(!1)});return()=>e()},[R]);const[B,q]=s.useState([]);m.useEffect(()=>{if(!ty||!R)return void q([]);const e=jd(jh(ty,`users/${R.uid}/goals`),e=>{const t=e.docs.map(e=>{const t=e.data();return{id:e.id,name:t.name,targetAmount:t.targetAmount,currentAmount:t.currentAmount,deadline:t.deadline,color:t.color}});q(t)});return()=>e()},[R]);const z=async(e,t)=>{ty&&R&&await kd(Dh(ty,`users/${R.uid}/goals`,e),t)},[H,K]=s.useState(Ty),[W,Q]=s.useState(Object.fromEntries(xy.map(e=>[e,Ey[e]?.budget||200])));m.useEffect(()=>{if(!ty||!R)return K(Ty),void Q(Object.fromEntries(xy.map(e=>[e,Ey[e]?.budget||200])));const e=jd(Dh(ty,`users/${R.uid}/settings`,"budgets"),e=>{if(e.exists()){const t=e.data();K(t.budgetLimit??Ty),Q(t.categoryBudgets??{})}});return()=>e()},[R]);const Y=async(e,t)=>{if(K(e),Q(t),!ty||!R)return;const n=Dh(ty,`users/${R.uid}/settings`,"budgets");try{await Sd(n,{budgetLimit:e,categoryBudgets:t},{merge:!0})}catch(Fy){}};m.useEffect(()=>{if(!ty||!R)return void L(Oy);const e=jd(Dh(ty,`users/${R.uid}/settings`,"preferences"),e=>{if(e.exists()){const t=e.data();L({currency:t.currency??wy,emailReports:t.emailReports??!1,reportEmail:t.reportEmail??"",customExpenseCategories:t.customExpenseCategories??[],customIncomeCategories:t.customIncomeCategories??[]})}});return()=>e()},[R]);const X=[...xy,...P.customExpenseCategories.map(e=>e.name)],ee=[..._y,...P.customIncomeCategories.map(e=>e.name)],te=(()=>{const e=vy.find(e=>e.code===P.currency);return e?.symbol||"$"})();if(m.useEffect(()=>{const e=function(e,t,n,s){return rt(e).onAuthStateChanged(t,n,s)}($m(Zg),e=>{j(e),O(!0)});return()=>e()},[]),!D)return pe.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gradient-to-br from-indigo-50 via-purple-50 to-pink-50",children:pe.jsxs("div",{className:"text-center",children:[pe.jsx("div",{className:"w-16 h-16 border-4 border-indigo-600 border-t-transparent rounded-full animate-spin mx-auto mb-4"}),pe.jsx("p",{className:"text-gray-600 font-medium",children:"Loading Budget Tracker..."})]})});if(!R)return pe.jsx(jy,{onAuth:j});const{start:ne,end:se}=(e=>{const t=new Date,n=new Date(t);let s=new Date(t);switch(e){case"today":s.setHours(0,0,0,0);break;case"week":s.setDate(t.getDate()-7);break;case"month":s.setMonth(t.getMonth()-1);break;case"quarter":s.setMonth(t.getMonth()-3);break;case"year":s.setFullYear(t.getFullYear()-1);break;default:s=new Date(0)}return{start:s,end:n}})(E),ce=U.filter(e=>{const t=new Date(e.date);return t>=ne&&t<=se}),le=ce.filter(e=>"income"===e.type).reduce((e,t)=>e+t.amount,0),ue=ce.filter(e=>"expense"===e.type).reduce((e,t)=>e+t.amount,0),he=le-ue,de=H>0?ue/H*100:0,fe=xy.map(e=>({name:e,value:ce.filter(t=>"expense"===t.type&&t.category===e).reduce((e,t)=>e+t.amount,0),budget:W[e]||0,color:Ey[e]?.color||"#85C1E2"})).filter(e=>e.value>0),me=U.filter(e=>{const t="all"===v||e.category===v,n="all"===b||e.type===b,s=new Date(e.date),r=s>=ne&&s<=se,i=""===I||e.description.toLowerCase().includes(I.toLowerCase())||e.category.toLowerCase().includes(I.toLowerCase());return t&&n&&r&&i}).sort((e,t)=>new Date(t.date).getTime()-new Date(e.date).getTime()),we=U.reduce((e,t)=>{const n=t.date.substring(0,7);return e[n]||(e[n]={month:n,income:0,expenses:0}),"income"===t.type?e[n].income+=t.amount:e[n].expenses+=t.amount,e},{}),be=Object.values(we).sort((e,t)=>e.month.localeCompare(t.month)).slice(-6),_e=xy.filter(e=>{const t=ce.filter(t=>"expense"===t.type&&t.category===e).reduce((e,t)=>e+t.amount,0),n=W[e]||0;return n>0&&t>.8*n}),Ee=e=>{u(e),a(!0)},Te=async e=>{U.find(t=>t.id===e)&&(await(async e=>{ty&&R&&await Ad(Dh(ty,`users/${R.uid}/transactions`,String(e)))})(e),M("Transaction deleted"))},Ie=()=>{Dy(U),M("Data exported!")},Ne=e?"bg-gray-900":"bg-gradient-to-br from-indigo-50 via-purple-50 to-pink-50",Ce=e?"bg-gray-800":"bg-white",Se=e?"text-white":"text-gray-900",ke=e?"text-gray-400":"text-gray-600",Ae=e?"border-gray-700":"border-gray-200",Re=e?"bg-gray-700 border-gray-600 text-white":"bg-white border-gray-300 text-gray-900";return pe.jsxs("div",{className:`min-h-screen ${Ne} pb-20 md:pb-8 transition-colors duration-300`,children:[pe.jsxs("div",{className:"max-w-7xl mx-auto p-4 md:p-6 lg:p-8",children:[pe.jsxs("div",{className:`${Ce} rounded-2xl shadow-xl p-4 md:p-6 mb-6 transition-colors duration-300`,children:[pe.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center gap-4",children:[pe.jsxs("div",{children:[pe.jsx("h1",{className:"text-2xl md:text-3xl lg:text-4xl font-bold bg-gradient-to-r from-indigo-600 to-purple-600 bg-clip-text text-transparent",children:"Budget Tracker"}),pe.jsx("p",{className:`${ke} text-sm md:text-base`,children:"Take control of your finances"})]}),pe.jsxs("div",{className:"flex items-center gap-2 md:gap-3",children:[R&&pe.jsxs("div",{className:"flex items-center gap-3",children:[pe.jsx("span",{className:`text-sm font-medium ${ke} hidden sm:inline`,children:R.displayName||R.email}),pe.jsx("button",{onClick:async()=>{const e=$m(Zg);await function(e){return rt(e).signOut()}(e),j(null)},className:"px-3 py-1.5 bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-200 rounded-lg text-sm font-medium hover:bg-gray-300 dark:hover:bg-gray-600 transition-colors",children:"Logout"})]}),pe.jsx("div",{className:"w-px h-6 bg-gray-300 dark:bg-gray-600 hidden sm:block"}),pe.jsx("button",{onClick:Ie,className:`p-2 rounded-lg ${e?"hover:bg-gray-700":"hover:bg-gray-100"} transition-colors`,title:"Export data",children:pe.jsx(Z,{className:`w-5 h-5 ${ke}`})}),pe.jsx("button",{onClick:()=>t(!e),className:`p-2 rounded-lg ${e?"hover:bg-gray-700 text-yellow-400":"hover:bg-gray-100 text-gray-600"} transition-colors`,title:"Toggle dark mode",children:e?pe.jsx(re,{className:"w-5 h-5"}):pe.jsx(ie,{className:"w-5 h-5"})})]})]}),_e.length>0&&pe.jsx("div",{className:`mt-4 p-3 rounded-lg ${e?"bg-yellow-900/30 border-yellow-700":"bg-yellow-50 border-yellow-200"} border`,children:pe.jsxs("div",{className:"flex items-center gap-2 text-yellow-600",children:[pe.jsx(J,{className:"w-4 h-4 flex-shrink-0"}),pe.jsxs("span",{className:"text-sm font-medium",children:["Budget alerts: ",_e.join(", ")," approaching limit"]})]})})]}),V&&pe.jsxs("div",{className:`${Ce} rounded-xl p-4 mb-6 shadow-lg flex items-center justify-center gap-3`,children:[pe.jsx("div",{className:"w-5 h-5 border-2 border-indigo-600 border-t-transparent rounded-full animate-spin"}),pe.jsx("span",{className:ke,children:"Loading your data..."})]}),pe.jsx("div",{className:`hidden md:flex gap-2 mb-6 ${Ce} rounded-xl p-2 shadow-lg transition-colors duration-300`,children:["home","transactions","analytics","goals","settings"].map(t=>pe.jsx("button",{onClick:()=>r(t),className:"flex-1 py-2 px-4 rounded-lg capitalize transition-all font-medium "+(n===t?"bg-gradient-to-r from-indigo-600 to-purple-600 text-white shadow-md":e?"text-gray-400 hover:bg-gray-700 hover:text-white":"text-gray-600 hover:bg-gray-100 hover:text-gray-900"),children:t},t))}),"home"===n&&pe.jsxs(pe.Fragment,{children:[pe.jsxs("div",{className:"flex flex-wrap justify-between items-center gap-3 mb-6",children:[pe.jsx("select",{value:E,onChange:e=>T(e.target.value),className:`px-3 py-2 rounded-lg border text-sm ${Re}`,children:Iy.map(e=>pe.jsx("option",{value:e.value,children:e.label},e.value))}),pe.jsxs("button",{onClick:()=>{u(null),a(!0)},className:"flex items-center gap-2 bg-gradient-to-r from-indigo-600 to-purple-600 text-white px-4 py-2 rounded-xl shadow-lg hover:shadow-xl hover:scale-105 transition-all font-medium",children:[pe.jsx(G,{className:"w-5 h-5"}),pe.jsx("span",{className:"hidden sm:inline",children:"Add Transaction"})]})]}),pe.jsx(ve,{totalIncome:le,totalExpenses:ue,remaining:he,budgetUsedPercent:de,darkMode:e}),pe.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6",children:[pe.jsxs("div",{className:`${Ce} rounded-2xl shadow-xl p-4 md:p-6 transition-colors duration-300`,children:[pe.jsx("h2",{className:`text-lg md:text-xl font-bold ${Se} mb-4`,children:"Expenses by Category"}),pe.jsx(uy,{data:fe,darkMode:e})]}),pe.jsxs("div",{className:`${Ce} rounded-2xl shadow-xl p-4 md:p-6 transition-colors duration-300`,children:[pe.jsx("h2",{className:`text-lg md:text-xl font-bold ${Se} mb-4`,children:"Income vs Expenses"}),pe.jsx(hy,{data:be,darkMode:e})]})]}),pe.jsxs("div",{className:`${Ce} rounded-2xl shadow-xl p-4 md:p-6 transition-colors duration-300`,children:[pe.jsxs("div",{className:"flex justify-between items-center mb-4",children:[pe.jsx("h2",{className:`text-lg md:text-xl font-bold ${Se}`,children:"Recent Transactions"}),pe.jsx("button",{onClick:()=>r("transactions"),className:"text-indigo-600 hover:text-indigo-700 text-sm font-medium",children:"View All â†’"})]}),pe.jsx(xe,{transactions:me.slice(0,5),onEdit:Ee,onDelete:Te,onViewReceipt:f,darkMode:e})]})]}),"transactions"===n&&pe.jsxs("div",{className:`${Ce} rounded-2xl shadow-xl p-4 md:p-6 transition-colors duration-300`,children:[pe.jsxs("div",{className:"flex flex-col md:flex-row gap-3 mb-6",children:[pe.jsxs("div",{className:"relative flex-1",children:[pe.jsx(ae,{className:`absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 ${ke}`}),pe.jsx("input",{type:"text",placeholder:"Search transactions...",value:I,onChange:e=>N(e.target.value),className:`w-full pl-10 pr-4 py-2 rounded-xl border ${Re} focus:ring-2 focus:ring-indigo-500`})]}),pe.jsxs("div",{className:"flex gap-2",children:[pe.jsxs("button",{onClick:()=>S(!C),className:`flex items-center gap-2 px-4 py-2 rounded-xl border ${C?"bg-indigo-100 border-indigo-300 text-indigo-700":e?"bg-gray-700 border-gray-600 text-gray-300":"bg-gray-100 border-gray-200 text-gray-700"} transition-colors`,children:[pe.jsx(oe,{className:"w-4 h-4"}),"Filters"]}),pe.jsxs("button",{onClick:()=>{u(null),a(!0)},className:"flex items-center gap-2 bg-gradient-to-r from-indigo-600 to-purple-600 text-white px-4 py-2 rounded-xl",children:[pe.jsx(G,{className:"w-5 h-5"}),pe.jsx("span",{className:"hidden sm:inline",children:"Add"})]})]})]}),C&&pe.jsxs("div",{className:"flex flex-wrap gap-3 mb-6 p-4 rounded-xl "+(e?"bg-gray-700":"bg-gray-50"),children:[pe.jsxs("select",{value:b,onChange:e=>x(e.target.value),className:`px-3 py-2 rounded-lg border text-sm ${Re}`,children:[pe.jsx("option",{value:"all",children:"All Types"}),pe.jsx("option",{value:"income",children:"Income"}),pe.jsx("option",{value:"expense",children:"Expense"})]}),pe.jsxs("select",{value:v,onChange:e=>w(e.target.value),className:`px-3 py-2 rounded-lg border text-sm ${Re}`,children:[pe.jsx("option",{value:"all",children:"All Categories"}),xy.map(e=>pe.jsx("option",{value:e,children:e},e))]}),pe.jsx("select",{value:E,onChange:e=>T(e.target.value),className:`px-3 py-2 rounded-lg border text-sm ${Re}`,children:Iy.map(e=>pe.jsx("option",{value:e.value,children:e.label},e.value))})]}),pe.jsx(xe,{transactions:me,onEdit:Ee,onDelete:Te,onViewReceipt:f,darkMode:e,searchQuery:I})]}),"analytics"===n&&pe.jsxs("div",{className:"space-y-6",children:[pe.jsxs("div",{className:`${Ce} rounded-2xl shadow-xl p-4 md:p-6 transition-colors duration-300`,children:[pe.jsx("h2",{className:`text-lg md:text-xl font-bold ${Se} mb-4`,children:"Summary Statistics"}),pe.jsx(py,{totalIncome:le,totalExpenses:ue,transactionCount:me.length,averageExpense:me.filter(e=>"expense"===e.type).length>0?ue/me.filter(e=>"expense"===e.type).length:0,darkMode:e})]}),pe.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[pe.jsxs("div",{className:`${Ce} rounded-2xl shadow-xl p-4 md:p-6 transition-colors duration-300`,children:[pe.jsx("h2",{className:`text-lg md:text-xl font-bold ${Se} mb-4`,children:"Spending Breakdown"}),pe.jsx(uy,{data:fe,darkMode:e})]}),pe.jsxs("div",{className:`${Ce} rounded-2xl shadow-xl p-4 md:p-6 transition-colors duration-300`,children:[pe.jsx("h2",{className:`text-lg md:text-xl font-bold ${Se} mb-4`,children:"Monthly Comparison"}),pe.jsx(hy,{data:be,darkMode:e})]})]}),pe.jsxs("div",{className:`${Ce} rounded-2xl shadow-xl p-4 md:p-6 transition-colors duration-300`,children:[pe.jsx("h2",{className:`text-lg md:text-xl font-bold ${Se} mb-4`,children:"Category Budget Progress"}),pe.jsx(dy,{data:fe,darkMode:e})]}),pe.jsx(oy,{transactions:U,categoryBudgets:W,budgetLimit:H,currencySymbol:te,darkMode:e})]}),"goals"===n&&pe.jsx(gy,{goals:B,onAddGoal:()=>{d(null),A({name:"",targetAmount:"",currentAmount:"",deadline:(new Date).toISOString().split("T")[0],color:Ny[0]}),c(!0)},onEditGoal:e=>{d(e),A({name:e.name,targetAmount:e.targetAmount.toString(),currentAmount:e.currentAmount.toString(),deadline:e.deadline,color:e.color}),c(!0)},onDeleteGoal:e=>{(async e=>{ty&&R&&await Ad(Dh(ty,`users/${R.uid}/goals`,e))})(e)},onUpdateProgress:async(e,t)=>{const n=B.find(t=>t.id===e);if(!n)return;const s=Math.min(Math.max(0,n.currentAmount+t),n.targetAmount);await z(e,{currentAmount:s}),M(t>0?"Added to goal!":"Removed from goal!")},darkMode:e}),"settings"===n&&pe.jsx(ky,{budgetLimit:H,setBudgetLimit:e=>Y(e,W),categoryBudgets:W,setCategoryBudgets:e=>Y(H,e),darkMode:e,onExportData:Ie,onClearData:()=>{F([]),q([]),K(Ty),Q(Object.fromEntries(xy.map(e=>[e,Ey[e]?.budget||200])))},onShowToast:M,userSettings:P,onUpdateSettings:async e=>{if(!ty||!R)return;const t=Dh(ty,`users/${R.uid}/settings`,"preferences");await Sd(t,e,{merge:!0})},expenseCategories:X,incomeCategories:ee})]}),pe.jsx(ge,{activeTab:n,setActiveTab:r,darkMode:e}),pe.jsx(ay,{isOpen:i,onClose:()=>{a(!1),u(null)},onSubmit:async e=>{if(l)await(async(e,t)=>{ty&&R&&await kd(Dh(ty,`users/${R.uid}/transactions`,String(e)),t)})(l.id,{...e,amount:parseFloat(e.amount)}),M("Transaction updated!"),u(null);else{const t={type:e.type,amount:Number(e.amount),category:e.category,description:e.description,date:e.date,receipt:e.receipt,isRecurring:e.isRecurring,recurringFrequency:e.recurringFrequency};await(async e=>{ty&&R&&await Rd(jh(ty,`users/${R.uid}/transactions`),e)})(t),M("Transaction added!")}a(!1)},initialData:l?{type:l.type,amount:l.amount.toString(),category:l.category,description:l.description,date:l.date,receipt:l.receipt,isRecurring:l.isRecurring||!1,recurringFrequency:l.recurringFrequency}:void 0,isEditing:!!l,darkMode:e,userId:R?.uid,expenseCategories:X,incomeCategories:ee}),o&&pe.jsx("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center p-4 z-50",children:pe.jsxs("div",{className:`${Ce} rounded-2xl shadow-2xl w-full max-w-md overflow-hidden`,children:[pe.jsxs("div",{className:`flex justify-between items-center p-6 border-b ${Ae}`,children:[pe.jsx("h2",{className:`text-xl font-bold ${Se}`,children:h?"Edit Goal":"Create Goal"}),pe.jsx("button",{onClick:()=>{c(!1),d(null)},className:"p-2 rounded-lg "+(e?"hover:bg-gray-700":"hover:bg-gray-100"),children:pe.jsx(_,{className:"w-5 h-5"})})]}),pe.jsxs("div",{className:"p-6 space-y-4",children:[pe.jsxs("div",{children:[pe.jsx("label",{className:`block text-sm font-medium mb-2 ${ke}`,children:"Goal Name"}),pe.jsx("input",{type:"text",value:k.name,onChange:e=>A({...k,name:e.target.value}),placeholder:"e.g., Vacation Fund",className:`w-full px-4 py-3 rounded-xl border ${Re} focus:ring-2 focus:ring-indigo-500`})]}),pe.jsxs("div",{children:[pe.jsx("label",{className:`block text-sm font-medium mb-2 ${ke}`,children:"Target Amount"}),pe.jsxs("div",{className:"relative",children:[pe.jsx("span",{className:`absolute left-4 top-1/2 -translate-y-1/2 ${ke}`,children:"$"}),pe.jsx("input",{type:"number",value:k.targetAmount,onChange:e=>A({...k,targetAmount:e.target.value}),placeholder:"0.00",min:"0",step:"100",className:`w-full pl-8 pr-4 py-3 rounded-xl border ${Re} focus:ring-2 focus:ring-indigo-500`})]})]}),pe.jsxs("div",{children:[pe.jsx("label",{className:`block text-sm font-medium mb-2 ${ke}`,children:"Current Amount (Optional)"}),pe.jsxs("div",{className:"relative",children:[pe.jsx("span",{className:`absolute left-4 top-1/2 -translate-y-1/2 ${ke}`,children:"$"}),pe.jsx("input",{type:"number",value:k.currentAmount,onChange:e=>A({...k,currentAmount:e.target.value}),placeholder:"0.00",min:"0",step:"10",className:`w-full pl-8 pr-4 py-3 rounded-xl border ${Re} focus:ring-2 focus:ring-indigo-500`})]})]}),pe.jsxs("div",{children:[pe.jsx("label",{className:`block text-sm font-medium mb-2 ${ke}`,children:"Target Date"}),pe.jsx("input",{type:"date",value:k.deadline,onChange:e=>A({...k,deadline:e.target.value}),className:`w-full px-4 py-3 rounded-xl border ${Re} focus:ring-2 focus:ring-indigo-500`})]}),pe.jsxs("div",{children:[pe.jsx("label",{className:`block text-sm font-medium mb-2 ${ke}`,children:"Color"}),pe.jsx("div",{className:"flex flex-wrap gap-2",children:Ny.map(e=>pe.jsx("button",{type:"button",onClick:()=>A({...k,color:e}),className:"w-8 h-8 rounded-full transition-transform "+(k.color===e?"scale-125 ring-2 ring-offset-2 ring-indigo-500":""),style:{backgroundColor:e}},e))})]})]}),pe.jsxs("div",{className:`p-6 border-t ${Ae} flex gap-3`,children:[pe.jsx("button",{onClick:()=>{c(!1),d(null)},className:"flex-1 py-3 rounded-xl font-medium "+(e?"bg-gray-700 text-gray-300":"bg-gray-100 text-gray-700"),children:"Cancel"}),pe.jsx("button",{onClick:()=>{if(k.name&&k.targetAmount){if(h)z(h.id,{...k,targetAmount:parseFloat(k.targetAmount),currentAmount:parseFloat(k.currentAmount)||0,deadline:k.deadline,color:k.color}),M("Goal updated!"),d(null);else{(async e=>{ty&&R&&await Rd(jh(ty,`users/${R.uid}/goals`),e)})({id:Date.now().toString(),name:k.name,targetAmount:parseFloat(k.targetAmount),currentAmount:parseFloat(k.currentAmount)||0,deadline:k.deadline,color:k.color}),M("Goal created!")}A({name:"",targetAmount:"",currentAmount:"",deadline:(new Date).toISOString().split("T")[0],color:Ny[0]}),c(!1)}else M("Please fill in goal name and target amount")},className:"flex-1 py-3 rounded-xl font-medium bg-gradient-to-r from-indigo-600 to-purple-600 text-white",children:h?"Update Goal":"Create Goal"})]})]})}),p&&pe.jsx("div",{className:"fixed inset-0 bg-black/80 flex items-center justify-center p-4 z-50",onClick:()=>f(null),children:pe.jsxs("div",{className:"relative max-w-4xl max-h-[90vh]",children:[pe.jsx("button",{onClick:()=>f(null),className:"absolute -top-12 right-0 text-white hover:text-gray-300 p-2",children:pe.jsx(_,{className:"w-8 h-8"})}),pe.jsx("img",{src:p,alt:"Receipt",className:"max-w-full max-h-[85vh] object-contain rounded-lg"})]})}),g&&pe.jsx(ye,{message:g.message,onUndo:g.onUndo,onClose:()=>y(null),darkMode:e})]})},Ly={};const My=function(e={}){const{immediate:t=!1,onNeedRefresh:n,onOfflineReady:s,onRegistered:r,onRegisteredSW:i,onRegisterError:a}=e;let o,c;return c=async function(){if("serviceWorker"in navigator){if(o=await function(e,t){let n=Promise.resolve();if(t&&t.length>0){let e=function(e){return Promise.all(e.map(e=>Promise.resolve(e).then(e=>({status:"fulfilled",value:e}),e=>({status:"rejected",reason:e}))))};document.getElementsByTagName("link");const s=document.querySelector("meta[property=csp-nonce]"),r=s?.nonce||s?.getAttribute("nonce");n=e(t.map(e=>{if((e=function(e){return"/"+e}(e))in Ly)return;Ly[e]=!0;const t=e.endsWith(".css"),n=t?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${e}"]${n}`))return;const s=document.createElement("link");return s.rel=t?"stylesheet":"modulepreload",t||(s.as="script"),s.crossOrigin="",s.href=e,r&&s.setAttribute("nonce",r),document.head.appendChild(s),t?new Promise((t,n)=>{s.addEventListener("load",t),s.addEventListener("error",()=>n(new Error(`Unable to preload CSS for ${e}`)))}):void 0}))}function s(e){const t=new Event("vite:preloadError",{cancelable:!0});if(t.payload=e,window.dispatchEvent(t),!t.defaultPrevented)throw e}return n.then(t=>{for(const e of t||[])"rejected"===e.status&&s(e.reason);return e().catch(s)})}(async()=>{const{Workbox:e}=await import("./workbox-window.prod.es5-CLYUWRvB.js");return{Workbox:e}},[]).then(({Workbox:e})=>new e("/sw.js",{scope:"/",type:"classic"})).catch(e=>{a?.(e)}),!o)return;o.addEventListener("activated",e=>{(e.isUpdate||e.isExternal)&&window.location.reload()}),o.addEventListener("installed",e=>{e.isUpdate||s?.()}),o.register({immediate:t}).then(e=>{i?i("/sw.js",e):r?.(e)}).catch(e=>{a?.(e)})}}(),async(e=!0)=>{await c}}({onNeedRefresh(){confirm("New content available. Reload?")&&My(!0)},onOfflineReady(){},onRegistered(e){},onRegisterError(e){}}),Uy=document.getElementById("root");if(!Uy)throw new Error('Root element not found. Make sure there is a <div id="root"></div> in your HTML.');me.createRoot(Uy).render(pe.jsx(m.StrictMode,{children:pe.jsx(Py,{})}));
